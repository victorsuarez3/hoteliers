/*
 https://fareharbor.com/about/licenses/
*/
window.FH_VERSION="0.9.0.1";
(function(){window.configure=function(n){var c=window.slipstream?window.slipstream.configuration:"unknown";n.factory("$exceptionHandler",["Raven",function(k){return function(h,d){var f=_.isArray(h.stack)?h.stack.join("\n"):h.stack;window.slipstream&&window.slipstream.isSentryClientSideEnabled&&k.captureException(h,{extra:{cause:d,message:h.message,stack:f}});if("production"!==c){var m="$exceptionHandler: uncaught exception "+h.message;d&&(m+=' (caused by "'+d+'")',h.message+=' (caused by "'+d+'")');
console.error(m,f||"(no stack trace)")}}}]);n.config(["$animateProvider","$compileProvider","$injector","$interpolateProvider","$httpProvider","$locationProvider","$sceProvider","convertProvider",function(k,h,d,f,m,a,p,l){h.debugInfoEnabled("production"!==c);a.html5Mode(!0);a.hashPrefix("!");f.startSymbol("[[");f.endSymbol("]]");f.staticStartSymbol("[!");f.staticEndSymbol("!]");m.defaults.transformResponse.push(function(a){return l.serverResponse(a)});m.defaults.transformRequest.unshift(function(a){return l.clientRequest(a)});
m.defaults.xsrfCookieName="csrftoken";m.defaults.xsrfHeaderName="X-CSRFToken";m.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";m.defaults.headers.common["X-CSRFToken"]=window.slipstream.csrfToken||"";k.classNameFilter(/\banimatable\b/)}]);n.run(["$filter","$browser","$injector","$interpolate","$rootScope",function(c,h,d,f,m){window.$$injector=d;m.max=Math.max;m.addClassIf=c("addClassIf");m.isUndefined=c("isUndefined");m.handheldsMaxWidth=window.slipstream.isEmbedded?549:679;m.T=window.T;
m.cT=window.cT;m.nT=window.nT;m.ncT=window.ncT;m.interpolate=interpolate;m.$bind=function(a,l){var b=this,g=function(){var g=_.get(b,l);_.set(b,a,g)};g();b.$watch(g)};m.$model=function(a){var l=_.bind(a,a,this);l.assign=_.bind(a.assign,a,this);return l};m.$once=function(a,l){var b=this.$on(a,function(){b();return l.apply(this,arguments)});return b};m.isSet=function(a){return _.isUndefined(a)?!1:""===a?!0:this.$eval(a)};var a=m.$new;m.$new=function(p,l){return p?a.call(this,!1,this.$root):a.call(this,
p,l)};m.$safeApply=function(a){if(this.$root){var l=this.$root.$$phase;return"$apply"==l||"$digest"==l?a&&a():this.$apply(a)}};m.$safeDigest=function(){if(this.$root){var a=this.$root.$$phase;"$apply"==a||"$digest"==a||this.$digest()}};m.$asyncApply=function(a){var l=h.defer(_.ignore,31536E6),b=function(){h.defer.cancel(l)};a(b);return b};m.$interpolate=function(a,l){var b=this,g=!1;l&&(b=b.$new(),_.extend(b,l),g=!0);if(_.isUndefined(a))return"";var C=f(a);if(!C)return"";C=C(b);g&&b.$destroy();return C};
window.$$digest=function(a,l){var b=angular.element(document.querySelector("[ng-app]"));l=l||b.injector().get("$rootScope");a=a||100;console.info("digest: running "+a+"...");for(var b=performance.now(),g=0;g<a;g++)l.$digest();g=performance.now();console.info("digest: average time "+(g-b)/a+"ms");var b=0,g=l,C;do if(b+=g.$$watchers?g.$$watchers.length:0,!(C=g.$$childHead||g!==l&&g.$$nextSibling))for(;g!==l&&!(C=g.$$nextSibling);)g=g.$parent;while(g=C);console.info("digest: watcher count",b)};window.$$scope=
function(a){return angular.element(a).scope()}}])}})();angular.module("lib","lib.controllers lib.directives lib.filters lib.factories lib.services lib.services.interpolate".split(" "));
(function(){var n=angular.module("lib.directives",[]),c={isTouchEnabled:"ontouchstart"in window||navigator.msMaxTouchPoints,isTextInput:function(a){return a.is("input")&&_.isUndefined(a.attr("type"))||a.is('input[type="text"], input[type="password"], input[type="email"], input[type="tel"], input[type="number"], input[type="url"], input[type="search"], textarea')},bind:function(a,l,b){a.$watch(b,function(b){a[l]=b})},watcher:function(a,l,b,g,C){var c=a.$eval(l);a.$watch(l,function(a){c=a;g&&g(c)},
C);return function(){return!_.isUndefined(c)?c:b}},observer:function(a,l,b,g){var C;C=a[l];a.$observe(l,function(a){C=a;g&&g(C)});return function(){if(!_.isUndefined(C))return C;if(!_.isUndefined(b))return b;throw Error("d: undefined attribute "+l+" for observer");}},restrictKeypresses:function(a,l){a.on("keypress",function(a){if(a.which&&(!a.metaKey&&!a.controlKey&&!a.altKey)&&!(8===a.which||9===a.which||13===a.which)){var g=String.fromCharCode(a.which);l.test(g)||a.preventDefault()}})},safeInvoke:function(a,
l){return _.isArray(l)?a.invoke(l):l},conditionalDirective:function(a){a=_.extend({operator:_.constant(_.identity),link:_.constant(_.ignore),transclude:_.constant(_.ignore),once:_.never},a);return["$animate","$injector",function(l,b){return _.extend({transclude:"element",priority:800,terminal:!0,restrict:"A",compile:function(g,C,x){var q=c.safeInvoke(b,a.watch),d=c.safeInvoke(b,a.operator),f=c.safeInvoke(b,a.transclude),k=c.safeInvoke(b,_.isBoolean(a.once)?_.constant(a.once):a.once);return function(e,
b,g,C){a.link(e,b,g,C);var c,h,m=q(e,b,g,C),n=f(e,b,g,C),t=d(e,b,g,C),E=e.$watch(m,function(a){c&&(l.leave(c),c=void 0);h&&(h.$destroy(),h=void 0);t(a)&&(h=e.$new(),x(h,function(a){c=a;n(h,a);l.enter(a,b.parent(),b)}));k(e,b,g)&&E()})}}},a.directiveDescription)}]},isDropdownSupported:/iP(od|hone|ad)/i.test(window.navigator.userAgent)||/Android/i.test(window.navigator.userAgent)&&/Mobile/i.test(window.navigator.userAgent)||/BlackBerry|Windows Phone|webOS/i.test(window.navigator.userAgent)?!1:!0};n.constant("d",
c);n.config(["$provide",function(a){a.decorator("ngIfDirective",["$delegate",function(a){a.shift();return a}])}]);var k=function(a){var l=a.$modelValue;_.forEach(a.$formatters,function(a){l=a(l)});a.$viewValue=l;a.$render()},h=function(a,l){n.directive(a,[function(){return{restrict:l,priority:500,require:"form",link:function(a,g,p,l){l.$errorCallbacks=[];l.$successCallbacks=[];g.attr("novalidate","novalidate")}}}])};h("form","E");h("ngForm","A");var d=function(a,l){var b="20"+a,g=parseInt(l,10).toFixed();
if(!isNaN(g))return{month:g,year:b}},f=[{device:"MSR100U",trackSeparator:"^",fullName:function(a){var l=a.split("/");a=(l[1]||"").trim();l=(l[0]||"").trim();return a?a+" "+l:l},details:function(a){var l=/;(\d+)=(\d\d)(\d\d)/.exec(a);l||(l=/%B(\d+)=(\d\d)(\d\d)/.exec(a));if(l&&(a=l[1],l=d(l[2],l[3])))return{number:a,expiryMonth:l.month,expiryYear:l.year}}},{device:"denzer-has-a-weird-one",trackSeparator:"^",fullName:_.identity,details:function(a){var l=/;(\d+)=(\d\d)(\d\d)/.exec(a);if(l&&(a=l[1],l=
d(l[2],l[3])))return{number:a,expiryMonth:l.month,expiryYear:l.year}}},{device:"knock-off-MSR100U",trackSeparator:"",details:function(a){var l=/^(\d+)=(\d\d)(\d\d)/.exec(a);if(l&&(a=l[1],l=d(l[2],l[3])))return{number:a,expiryMonth:l.month,expiryYear:l.year}}}];n.directive("ngOverthrow",[function(){return{restrict:"A",link:function(a,l,b){l.addClass("overthrow")}}}]);n.directive("ngSticky",["$parse","$window","auth","d",function(a,l,b,g){return{restrict:"A",link:function(a,p,q){if(!a.isSet(q.ngStickyAllowTouch)&&
g.isTouchEnabled)console.info("ng-sticky: touch is enabled");else{var c=a.$eval(q.ngStickyEdgeTopMargin)||0;a.$eval(q.ngStickyEdgeBottomMargin);var d=a.$eval(q.ngStickyTopMargin)||0,f=a.$eval(q.ngStickyBottomMargin)||0,e=$(l),h=function(){var a=$(q.ngStickyContent);if(a.length){var g=b.currentUser.isAuthenticated?93:0,l=e.height()-g,C=e.scrollTop(),h=a.offset().top,a=a.outerHeight(),k=p.outerHeight();if(k>a||k>l)return p.removeClass("sticky sticky-pinned sticky-floating").css({top:"",bottom:""}),
"no-sticky";l=C+(c+g);C=h+d;h=l+k>h+a-f;a=l>C&&!h;if(l<=C)return h=d,p.removeClass("sticky-floating"),p.addClass("sticky sticky-pinned").css({top:h,bottom:""}),["sticky-pinned","top",h];if(a)return h=g+c,p.removeClass("sticky-pinned"),p.addClass("sticky sticky-floating").css({top:g+c,bottom:""}),["sticky-floating","top",h];if(h)return p.removeClass("sticky-floating"),p.addClass("sticky sticky-pinned").css({top:"",bottom:f}),["sticky-pinned","bottom",f];console.warn("ng-sticky: nothing makes sense")}},
k,m=function(){var e=h();angular.equals(k,e)||(k=e,a.$apply())};e.on("scroll",m);e.on("resize",m);a.$watch(function(){setTimeout(m)})}}}}]);n.directive("ngSwipe",[function(){return{restrict:"A",link:function(a,l,b){var g=a.$eval(b.ngSwipe),C=function(a){return _.chooseFirst(f,function(b){var g="";if(b.trackSeparator){var p=a.split(b.trackSeparator);if(3!==p.length)return;g=b.fullName(p[1]);if(_.isUndefined(g))return}else p=["","",a];b=b.details(p[2]);if(!_.isUndefined(b))return _.extend(b,{fullName:g})})};
l.on("keypress",function(b){13===b.which&&a.$apply(function(){g(C(l.val()))})});l.on("blur",function(){a.$apply(function(){g()})});l.val("");l.focus()}}}]);n.directive("ngApp",[function(){return{restrict:"A",link:function(a,l,b){$("html").removeClass("html-loading")}}}]);n.directive("ngAutoselect",["d",function(a){return{restrict:"A",link:function(l,b,g){b.attr("readonly","readonly");if(!a.isTouchEnabled){var C=!1;b.on("click",function(){b.focus();C||(b.select(),C=!0)});b.on("blur",function(){C=!1})}}}}]);
n.directive("ngAutofocus",["$timeout","d",function(a,l){var b=function(a){if(a.is("input, textarea, select"))return a;a=a.find("input, textarea, select").first();if(a.length)return a};return{restrict:"A",link:function(g,C,c){var q=g.isSet(c.ngAutofocus),d=g.isSet(c.ngAutofocusSelect),f=g.isSet(c.ngAutofocusOpen);q&&(l.isTouchEnabled?d&&a(function(){var g=b(C);if(g&&!g.is("select"))g.on("focus",function(){a(function(){g[0].setSelectionRange(0,1E3)})})}):a(function(){var a=b(C);a&&(a.hasClass("ng-dropdown")?
(a.trigger("dropdown:focus"),f&&a.trigger("dropdown:open")):(a.focus(),d&&!a.is("select")&&a.select()))}))}}}]);n.directive("ngAutoNavigate",["$location","$timeout","$window","navigation",function(a,l,b,g){return{restrict:"A",link:function(c,d,q){var f=!1;(f=q.ngAutoNavigate?c.$eval(q.ngAutoNavigate):!0)&&l(function(){var l=d.prop("href");a.$$rewrite(l)?g.navigate(l):(b.parent||window).location.href=l})}}}]);n.directive("ngCurrentOption",["$parse",function(a){return{restrict:"A",scope:!0,controller:["$scope",
"$attrs",function(l,b){var g=this,c=a(b.ngCurrentOption),d=a(b.ngCurrentOptionTarget||"currentOption"),q=a(b.ngCurrentOptionCollection),f=l.$eval(b.ngCurrentOptionKey)||"pk",h=function(a,e){var b=_.find(e,function(e){return e[f]===a});b||(b=null);d.assign(l.$parent,b);g.currentOption=b};l.$parent.$watch(c,function(a){var e=q(l);h(a,e)});l.$parent.$watch(function(){return _.pluck(q(l),"uri")},function(){var a=q(l),e=c(l);h(e,a)},!0)}],controllerAs:"currentOptionCtrl"}}]);n.directive("ngWatchHeight",
["$document","$window","db","lightframe",function(a,l,b,g){return{restrict:"A",link:function(b,l,q){var c=function(){if(a[0].body)return a[0].body.offsetHeight},d=function(a){g.updateHeight(a)};b.$watch(c,d);setInterval(function(){d(c())},2500)}}}]);n.directive("ngDimensions",["$document","$parse","$window","$rootScope","scrollbar",function(a,l,b,g,c){var d=function(){return{width:Math.max(a[0].documentElement.clientWidth,b.innerWidth||0),height:Math.max(a[0].documentElement.clientHeight,b.innerHeight||
0)}},q=function(a){return{width:a.width(),height:a.height(),outerWidth:a.outerWidth(),outerHeight:a.outerHeight()}};return{restrict:"A",link:function(a,g,p){if(!p.ngDimensionsWhen||a.$eval(p.ngDimensionsWhen)){var e=a.isSet(p.ngDimensionsViewport)?d:_.bind(q,null,g);g=l(p.ngDimensions||"dimensions");var f=e();g.assign(a,f);var h=Math.max(c.getWidth(),15);g=function(){var b=e();if(!(b.width===f.width&&b.height===f.height)){var g=f.width-b.width;0<g&&g<=h||(_.extend(f,b),a.$digest())}};var k=_.debounce(g,
0),m=_.debounce(g,250);a.$watch(k);$(b).on("resize",m);a.$on("$destroy",function(){$(b).off("resize",m);k.cancel();m.cancel()})}}}}]);n.directive("ngStyleOnce",[function(){return{restrict:"A",link:function(a,l,b){l.css(a.$eval(b.ngStyleOnce))}}}]);h=function(a){n.directive(a.name,[function(){return{restrict:"A",link:function(l,b,g){var c=a.transform||_.identity,d=a.isNumeric&&!_.isUndefined(g[a.name+"AddToInitial"]),q=function(){var q=l.$eval(g[a.name+"Selector"]);return q?$(q):b},f=g[a.name+"ForceInitialValue"]?
l.$eval(g[a.name+"ForceInitialValue"]):q().css(a.property);a.isNumeric&&(f=parseInt(f,10));if(_.isUndefined(f)||_.contains(a.emptyValues,f))f="";var h=function(b){b?(d&&f&&(b+=f),q().css(a.property,c(b))):q().css(a.property,f)};a.interpolate?g.$observe(a.name,h):l.$watch(g[a.name],h);l.$on("$destroy",function(){h()})}}}])};h({name:"ngBackgroundImage",property:"background-image",transform:function(a){return"url("+(-1===a.indexOf("Cdn")?a.replace("Url","CdnUrl"):a)+")"},emptyValues:["none"]});h({name:"ngBackgroundColor",
property:"background-color",emptyValues:["rgba(0, 0, 0, 0)","transparent"]});h({name:"ngTop",property:"top",isNumeric:!0});n.directive("ngLocation",[function(){return{restrict:"A",link:function(a,l,b){var g=function(){var a={width:l[0].offsetWidth,height:l[0].offsetHeight},b;try{b=l.position()}catch(p){b={top:0,left:0}}a={position:b,size:a};g.position=a.position;g.size=a.size;return a};a[b.ngLocation]=g}}}]);n.directive("ngScrollStatic",["$window",function(a){return{restrict:"A",link:function(l,b,
g){var c=g.ngScrollStaticContainer||"html,body",d=!g.ngScrollStaticContainer,q=l.$eval(g.ngScrollStaticPadding)||0;(function(){var b=g.ngScrollStatic,l=$(c),b=l.find(b);if(b.length&&l.length){var b=_.min(_.map(b,function(a){return $(a).position().top||0})),f=_.chooseFirst(l,function(a){if(a.scrollHeight)return a.scrollHeight})||0,e=_.min(_.choose(l,function(a){if(a=$(a).height())return a}));d&&(e=Math.min(e,a.innerHeight));f=Math.max(0,f-e);b-=q;0>b?b=0:b>f&&(b=f);l.scrollTop(b)}})()}}}]);n.directive("ngScrollTo",
["$window",function(a){return{restrict:"A",link:function(l,b,g){var c=l.isSet(g.ngScrollOnClick),d=l.isSet(g.ngScrollSmooth),q=l.isSet(g.ngScrollForce),f=g.ngScrollContainer||"html,body",h=!g.ngScrollContainer,k=function(){var b=g.ngScrollTo;if(b){"top"===b&&(b="body");var l=$(b),b=$(f);if(l.length&&b.length){var l=Math.min.apply(Math,_.map(l,function(a){return $(a).offset().top||0})),c=_.chooseFirst(b,function(a){if(a=$(a).scrollTop())return a})||0,C=_.chooseFirst(b,function(a){if(a.scrollHeight)return a.scrollHeight})||
0,k=Math.min.apply(Math,_.choose(b,function(a){if(a=$(a).height())return a}));h&&(k=Math.min(k,a.innerHeight));var C=Math.max(0,C-k),c=1>Math.abs(l-c),m;0>l?(m=15,l=0):c?m=l-15:l>C&&(m=C-15,l=C);C&&(q&&!_.isUndefined(m)?b.stop().animate({scrollTop:m},250,"swing").animate({scrollTop:l},250,"swing"):d?b.stop().animate({scrollTop:l},500,"swing"):b.scrollTop(l))}}};if(c)b.on("click",function(a){k()});else k()}}}]);n.directive("ngTopScrolled",["$document",function(a){return{restrict:"A",link:function(l,
b,g){l=l.$eval(g.ngTopScrolled)||0;l=a.scrollTop()+l;b.css({top:l})}}}]);n.directive("ngWithLocation",[function(){return{restrict:"A",link:function(a,l,b){a.$watch(b.ngWithLocation,function(g){l.toggleClass("with-location",!!g);if(g){var c=0,d=0;if(b.ngWithLocationOffset)var q=a.$eval(b.ngWithLocationOffset)||{},c=q.x||c,d=q.y||d;q=a.$eval(b.ngWithLocationRight)||!1;d={top:g.position.top+d};d.left=q?g.position.left+-l[0].offsetWidth+c:g.position.left+g.size.width+c;l.toggleClass("left",!q);l.toggleClass("right",
q);l.css(d)}})}}}]);n.directive("ngTranslate",["$window","translate",function(a,l){return{restrict:"A",link:function(a,g){l.initialize(g)}}}]);var m=function(a){return a&&!_.isUndefined(a.x)&&!_.isUndefined(a.y)&&a.width&&a.height};n.directive("ngImage",["$parse",function(a){var l=function(a){return _.map(a,function(a,b){return b+"="+a.toString()}).join("&")};return{restrict:"A",compile:function(b,g){var c=a(g.ngImage),d=_.isUndefined(g.ngImageOnce)?_.always:""===g.ngImageOnce?_.always:a(g.ngImageOnce);
return function(a,b,g){var p=function(e){if(e){var p=a.$eval(g.ngImageCrop),c=a.$eval(g.ngImageSquare),C=a.$eval(g.ngImageMaxWidth),d=a.$eval(g.ngImageMaxHeight),f=a.$eval(g.ngImageMaxSize),h=a.$eval(g.ngImageWidth),k=a.$eval(g.ngImageHeight),x=a.$eval(g.ngImageFilter),D=a.$eval(g.ngImageFilterAmount),n=["blur","sharpen"],K={cache:!0,compress:!0,quality:90};m(p)&&_.extend(K,{crop:p.x.toFixed(0)+","+p.y.toFixed(0)+","+p.width.toFixed(0)+","+p.height.toFixed(0)});c&&_.extend(K,{w:c,h:c,fit:"crop"});
C&&_.extend(K,{w:C,fit:"max"});d&&_.extend(K,{h:d,fit:"max"});f&&_.extend(K,{w:f,h:f,fit:"max"});h&&_.extend(K,{w:h});k&&_.extend(K,{h:k});x&&(-1!==_.indexOf(n,x)&&D)&&(K.filter=x,K[x+"Amount"]=D);e=e+"/convert?"+l(K);b.is("img")?b.attr("src",e):b.css("background-image","url("+e+")");return e}console.info("ng-image: no url supplied")};if(d()){var e=p(c(a));console.info("ng-image: once",e)}else a.$watch(c,function(a){a=p(a);console.info("ng-image: watch",a)})}}}}]);n.directive("ngCrop",["$parse","$timeout",
function(a,l){return{restrict:"A",require:"^form",link:function(b,g,c,d){g.attr("src",b.$eval(c.ngCrop));var q=b.$eval(c.ngCropAspectRatio)||1.9,f=a(c.ngCropModel),h=function(a){b.$safeApply(function(){var e=f(b),l=g[0].naturalWidth/g.width();e.x=Math.floor(a.x*l);e.y=Math.floor(a.y*l);e.width=Math.floor(a.w*l);e.height=Math.floor(a.h*l);d.$setDirty()})},k,e=function(){g.Jcrop({onSelect:h,keySupport:!1,aspectRatio:q},function(){k=this;var a=f(b),e=g[0].naturalWidth/g.width();if(m(a))var l=Math.floor(a.x/
e),p=Math.floor(a.y/e),c=l+Math.floor(a.width/e),a=p+Math.floor(a.height/e);else p=k.getWidgetSize(),l=p[0],p=p[1],l/q<p?(c=l,a=l/q,l=0,p=(p-a)/2):(c=p*q,a=p,l=(l-c)/2,p=0),l=Math.floor(l),p=Math.floor(p),c=l+Math.floor(c),a=p+Math.floor(a);k.setSelect([l,p,c,a])})};l(function(){e();b.$on("$destroy",function(){k&&k.destroy()})})}}}]);n.directive("ngAudio",[function(){return{restrict:"A",link:function(a,l,b){var g=b.ngAudioSrc,c;a[b.ngAudio]=function(){c||(c=$('<audio><source src="'+g+'"></audio>'),
l.append(c));c[0].load();c[0].play()};a.$on("$destroy",function(){c&&c.remove()})}}}]);n.directive("ngTip",["$parse","d",function(a,l){var b;return{restrict:"A",link:function(g,c,d){var q=d.ngTipLocation,f=d.ngTipWhen?a(d.ngTipWhen):_.always,h=$("body"),k=d.ngTipPosition;if(!l.isTouchEnabled||g.$eval(d.ngTipTouch)){b||(b=$('<span class="tip"></span>'),h.append(b));var e=function(){var a=c.attr("class")||"",a=a.split(" "),a=_.choose(a,function(a){if(a)return"tip-ele--"+a});return a=a.join(" ")},m=
function(){var a=c;if(q&&(a=c.find(q),!a.length))return;if(f(g)){var l=k?"tip-"+k:"";b.attr("class","tip").addClass(v()+" "+e()+" "+l);b.html(n());b.css({width:"auto"});var l=a.offset(),p=a.outerWidth();0===p&&a[0]instanceof SVGElement&&(p=a[0].getBoundingClientRect().width);var d=b.outerWidth(),x=b.outerHeight(),m=parseInt(h.css("top"),10)||0,F={};if("right"===k||"left"===k)a=a.outerHeight(),F.top=Math.floor(l.top+a/2-x/2)-m;"right"===k?F.left=l.left+p+8:"left"===k?F.left=l.left-d-8:(F.top=Math.floor(l.top-
x-8-m),F.left=Math.floor(Math.max(l.left+(p-d)/2,0)));b.css(F);b.addClass("showing")}},G=function(){b.attr("class","tip");b.css({top:-100,left:-100})},n=l.observer(d,"ngTip",""),v=l.observer(d,"ngTipClasses","");c.on("mouseenter",m);c.on("mouseleave",G);c.on("retip",function(){window.setTimeout(function(){if(g.$root){var a=b.hasClass("showing");G();a&&m()}})});g.$on("$destroy",G)}}}}]);n.directive("ngRadioFlyer",[function(){return{link:function(a,l,b){var g=function(a){l.find('input[type="radio"]').each(function(){var b=
$(this),g=_.isUndefined(a)?b.is(":checked"):b.val()===a;b.closest("label").toggleClass("radio-selected",g)})};b.ngRadioFlyer?a.$watch(b.ngRadioFlyer,function(a){g(a)}):a.$watch(function(){g()});a.$evalAsync(function(){g()})}}}]);n.directive("ngCheckboxMadness",[function(){return{require:"ngModel",link:function(a,l,b){a.$watch(b.ngModel,function(a){l.closest(".field").toggleClass("checkbox-selected",!!a)})}}}]);n.directive("ngSupportHacks",_.optional(["d","events","?native",function(a,l,b){return{restrict:"A",
link:function(g){var c=$("html");c.addClass(a.isTouchEnabled?"touch":"not-touch");c.addClass(b&&b.isNative?"native":"not-native");l.on(g,"fareharbor.native.inApp",function(a,b){c.addClass("native").removeClass("not-native")})}}}]));n.directive("ngBlurEscape",["$document","d",function(a,l){return{restrict:"A",link:function(b,g,c){a.on("keydown",function(a){if(27===a.which){var b=$(a.target);l.isTextInput(b)&&(a.preventDefault(),a.stopPropagation(),b.trigger("blur"))}})}}}]);n.directive("ngShortcut",
["$parse","navigation","shortcuts",function(a,l,b){return{restrict:"A",compile:function(g,c){var d=a(c.ngShortcut),q=c.ngShortcutAction?a(c.ngShortcutAction):_.ignore;return function(a,g,c){var e=d(a);if(!_.isUndefined(e)){var e=e.split("|"),p=_.ignore;a.isSet(c.ngShortcutClick)&&(p=_.then(p,function(){g.trigger("click")}));a.isSet(c.ngShortcutFocus)&&(p=_.then(p,function(){g.is("input, textarea, select")?setTimeout(function(){g.trigger("focus")}):g.find("input, textarea").first().trigger("focus")}));
if(c.ngShortcutNavigate)var f=a.$interpolate(c.ngShortcutNavigate),p=_.then(p,function(){a.$apply(function(){l.navigate(f)})});c.ngShortcutAction&&(p=_.then(p,function(){a.$apply(function(){q(a)})}));a.isSet(c.ngShortcutOnly)&&g.addClass("ng-hide");_.forEach(e,function(e){var g=b.register({keySet:e,action:p,description:c.ngShortcutDescription||""});a.$on("$destroy",function(){b.unregister(g)})})}}}}}]);n.directive("ngUnclick",["$parse",function(a){return{restrict:"A",link:function(l,b,g){var c=a(g.ngUnclick),
d=function(a){$(a.target).closest("[ng-unclick], [ng-unclick-ignore]").length||c(l)};$("html").on("click",d);l.$on("$destroy",function(){$("html").off("click",d)})}}}]);n.directive("ngGenericForm",[function(){return{link:function(a,l,b){a[b.ngGenericForm]={}}}}]);n.directive("ngSortable",[function(){return{restrict:"A",link:function(a,l,b){var g=a.$eval(b.ngSortable)||_.ignore,c=b.ngSortableHandle||".sortable-handle",d=b.ngSortableSelector||"li.sortable",q='<li class="sortable sortable-placeholder"></li>';
a.$eval(b.ngSortableTable)&&(q='<tbody class="sortable"><tr><td style="height: 50px"></td></tr></tbody>');b={itemSelector:d,placeHolderTemplate:q,dragEnd:function(b,l){var c=$(this),e=$(b),q=$(l),d=c.data("ng-sortable-item"),f=e.data("ng-sortable-item"),C=q.data("ng-sortable-item");d===C&&(C=null);d===f&&(f=null);return a.$apply(function(){return g(d,f,C)})}};c&&(b.dragSelector=c,b.dragSelectorExclude="input, textarea");l.dragsort(b);a.$on("$destroy",function(){l.dragsort("destroy")})}}}]);n.directive("ngSortableItem",
[function(){return{restrict:"A",link:function(a,l,b){if(a=a.$eval(b.ngSortableItem))l.data("ng-sortable-item",a),l.addClass("sortable")}}}]);n.directive("ngDropdown",["$interpolate","$parse","d",function(a,l,b){var g=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,c=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+hide\s+when\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)?$/;
return{restrict:"A",require:"ngModel",compile:function(d,q){var f,h,k,e,m,G,n,v,s,z,u;if(q.ngDropdownRemoteOptions){z="remote-options-mode";f=q.ngDropdownRemoteOptions.match(c);if(!f){console.error("ngDropdown: malformed ngDropdownRemoteOptions expression.");return}m=l(f[2]||f[1]);n=f[3]?l(f[3]):null;v=f[4]?l(f[4]):null;h=f[6];k=f[5]||f[7];e=l(f[2]?f[1]:k);G=l(f[8]);u=q.ngDropdownMinimum?l(q.ngDropdownMinimum):_.constant(2)}else if(q.ngOptions){z="ng-options-mode";f=q.ngOptions.match(g);if(!f){console.error("ngDropdown: ng-options regex must match angular.");
return}h=f[5];k=f[4]||f[6];s=l(f[7])}else{console.error("ngDropdown: ngDropdownRemoteOptions or ngOptions required.");return}var t="ng-options-mode"===z&&!b.isDropdownSupported;f=q.ngPlaceholder||"Choose an option";var E=a(f),L=q.ngPlaceholderValue?l(q.ngPlaceholderValue):_.constant(null),r=q.ngDropdownCurrentOption&&l(q.ngDropdownCurrentOption),K=q.ngDropdownAllowClear&&l(q.ngDropdownAllowClear),w=l(q.ngModel);f=$("<option class='empty-option' value='' label='"+f+"'></option>");d.prepend(f);t?d.addClass("ng-dropdown-disabled"):
(d.css("width","100%"),d.addClass("ng-dropdown"));return function(a,b,g,l){var c=!K||K(a);if(t&&!c)var p=a.$watch(g.ngModel,function(a){""!==b.val()&&(b.find(".empty-option").remove(),p())});var q=L(a);l.$parsers.push(function(a){return null===a?q:a});if(!t){var d,c={minimumResultsForSearch:8,allowClear:c,placeholder:E(a)},f={};c.templateResult=function(a){var b=$("<span>"+a.text+"</span>");a=f[a.id];_.isObject(a)&&a.classes&&b.addClass(a.classes);return b};var C={},x=function(b,e,g){if(!b)return null;
h&&(C[h]=g);C[k]=e;return b(a,C)};if("remote-options-mode"===z){var B=G(a),ja=function(a,b){return{id:a.uri||a.pk.toString(),text:x(m,a,b),disabled:x(v,a,b),ngModelValue:x(e,a,b),originalValue:a}};c.minimumInputLength=u(a);c.ajax={delay:250,transport:function(a,b,e){var g=B(a.data.term);g.$promise.then(function(){b(g)},function(){e(g)});return{abort:g.$promise.cancel}},processResults:function(a){f={};var b=[];_.forEach(a,function(a,e){if(!x(n,a,e)){var g=ja(a,e);b.push(g);f[g.id]=g.ngModelValue}});
return{results:b}}};l.$parsers.unshift(function(a){return f[a]||null})}else if("ng-options-mode"===z){l={"default":function(){var b=s(a);if(_.isArray(b))if(b.length)if(_.isUndefined(b[0].label))if(_.isUndefined(b[0].uri))if(_.isUndefined(b[0].pk)){if(_.isString(b[0]))return b}else return _.pluck(b,"pk");else return _.pluck(b,"uri");else return _.pluck(b,"label");else return b;else if(_.isObject(b))return _.keys(b)},uri:function(){var b=s(a);return _.pluck(b,"uri")},pk:function(){var b=s(a);return _.pluck(b,
"pk")}}[a.$eval(g.ngDropdownWatchType)||"default"];var W=function(){window.setTimeout(function(){b.trigger("change.select2")})};a.$watch(l,function(){f=_.indexBy(s(a),function(a,b){return b.toString()});d.dataAdapter.destroy();W()},!0);a.$watch(g.ngModel,W)}l=b.closest(".ng-dropdown-context");l.length&&(c.dropdownParent=l);_.forEach(["open","focus"],function(a){b.bind("dropdown:"+a,function(){b.select2(a)})});a.$watch(g.ngDisabled,function(a){b.attr("disabled",!!a)});a.$watch(function(){return!!b.parents("fieldset[disabled]").length},
function(a){b.attr("disabled",a)});a.$on("$destroy",function(){d.destroy()});b.select2(c);d=b.data("select2");"remote-options-mode"===z&&r&&(a.$watch(r,function(a){if(!_.isUndefined(a)){var b=[];a&&b.push(ja(a));d.trigger("selection:update",{data:b})}}),a.$watch(w,function(b){b||r.assign(a,null)}),d.on("select",function(b){a.$apply(function(){r.assign(a,b.data.originalValue)})}))}}}}}]);n.directive("ngIf",c.conditionalDirective({watch:["$parse",function(a){return function(l,b,g){var c=a(g.ngIf);return function(){return!!c(l)}}}],
operator:function(a,l,b){return function(g){b.ngThen&&(a[b.ngThen]=g);return g}}}));n.directive("ngIfOnce",c.conditionalDirective({watch:["$parse",function(a){return function(l,b,g){var c=a(g.ngIfOnce);return function(){return!!c(l)}}}],operator:function(a,l,b){return function(g){b.ngThen&&(a[b.ngThen]=g);return g}},once:!0}));n.directive("ngIfInLabs",c.conditionalDirective({watch:["labs",function(a){return function(l,b,g){return function(){var b=g.ngIfInLabs.replace("!",""),c=g.ngIfInLabsVariation,
q=0===g.ngIfInLabs.indexOf("!"),b=a.isInVariation(b,c);g.ngThen&&(l[g.ngThen]=b);return q?!b:b}}}]}));n.directive("ngElse",c.conditionalDirective({watch:["$parse",function(a){return function(l,b,g){var c=a(g.ngElse);return function(){return!c(l)}}}]}));n.directive("ngElseOnce",c.conditionalDirective({watch:["$parse",function(a){return function(l,b,g){var c=a(g.ngElseOnce);return function(){return!c(l)}}}],once:!0}));n.directive("ngWatch",c.conditionalDirective({watch:["$parse",function(a){return function(l,
b,g){return a(g.ngWatch)}}],operator:_.constant(_.always),transclude:["$parse",function(a){return function(l,b,g){var c=a(g.ngWatchAction)||_.ignore;return function(){c(l)}}}]}));n.directive("ngInterval",[function(){return{link:function(a,l,b){l=a.$eval(b.ngInterval)||1;var g=setInterval(function(){a.$digest()},1E3*l);a.$on("$destroy",function(){clearInterval(g)})}}}]);n.directive("ngData",["$q",function(a){return{scope:!0,transclude:!0,templateUrl:"ng-data",controllerAs:"dataCtrl",controller:["$scope",
"$attrs",function(l,b){var g=this;g.status="loading";l.isSet(b.ngDataSmall)?g.type="small":l.isSet(b.ngDataManual)?g.type="manual":g.type="large";g.transcludeOnError="transclude"===(b.ngDataOnError||"");var c=l.$eval(b.ngData);if(_.isUndefined(c))g.status="success";else{var d=_.isArray(c);if(!d&&(!_.isObject(c)||!_.isFunction(c.then)))g.status="success";else{d&&(c=a.all(c));var q=l.$eval(b.ngDataStale);if(!_.isUndefined(q)&&(q=d?q:[q],!_.any(q,"$fresh"))){g.status="success";return}c.then(function(){g.status=
"success"},function(){g.status="error"})}}}]}}]);n.config(["$provide",function(a){a.decorator("ngShowDirective",["$delegate",function(a){a.shift();return a}])}]);n.directive("ngShow",["$parse",function(a){return{restrict:"A",compile:function(l,b){var g=a(b.ngShow);return function(a,b,l){a.$watch(g,function(g){b.toggleClass("ng-hide",!g);l.ngThen&&(a[l.ngThen]=g)})}}}}]);n.directive("ngShowOnce",["$parse",function(a){return{restrict:"A",compile:function(l,b){var g=a(b.ngShowOnce);return function(a,
b,l){var c=g(a);b.toggleClass("ng-hide",!c);l.ngThen&&(a[l.ngThen]=c)}}}}]);n.config(["$provide",function(a){a.decorator("ngHideDirective",["$delegate",function(a){a.shift();return a}])}]);n.directive("ngHideOnce",["$parse",function(a){return{restrict:"A",compile:function(l,b){var g=a(b.ngHideOnce);return function(a,b,l){var c=!!g(a);b.toggleClass("ng-hide",c);l.ngThen&&(a[l.ngThen]=c)}}}}]);n.directive("ngHide",["$parse",function(a){return{restrict:"A",compile:function(l,b){var g=a(b.ngHide);return function(a,
b,l){a.$watch(g,function(g){g=!!g;b.toggleClass("ng-hide",g);l.ngThen&&(a[l.ngThen]=g)})}}}}]);n.directive("ngAutoExporter",["$interpolate","autoExport",function(a,l){return{scope:!0,templateUrl:"auto-exporter",replace:!0,compile:function(b,g){var c=a(g.ngAutoExporter),d=a(g.ngAutoExporterFilename);return function(a,b,g){a.autoExport=l;a.isLeft=a.isSet(g.ngAutoExporterLeft);a.$watch(c,function(b){a.namespace=b});a.$watch(d,function(b){a.filename=b})}}}}]);n.directive("ngAutoExportValue",[function(){return{restrict:"A",
compile:function(a,l){var b=l.ngAutoExportValue||"";l.$set("ngAutoExportValue","");return function(a,l,c){l.data("ngAutoExportValue",function(){return a.$interpolate(b)})}}}}]);n.directive("ngAutoExportSkip",["$parse",function(a){return{restrict:"A",compile:function(l,b){var g=a(b.ngAutoExportSkip||"true");return function(a,b,l){b.data("ngAutoExportSkip",_.bind(g,null,a))}}}}]);n.directive("ngAutoExportOnly",["$parse",function(a){return{restrict:"A",compile:function(l,b){if(b.ngAutoExportOnly){var g=
a(b.ngAutoExportOnly);return function(a,b,l){a.$watch(g,function(a){b.toggleClass("ng-hide",a)})}}l.addClass("ng-hide")}}}]);n.directive("ngAutoExport",["$interpolate","$parse","autoExport",function(a,l,b){return{restrict:"A",scope:!0,compile:function(g,c){var d=a(c.ngAutoExport),q=c.ngAutoExportProcess?l(c.ngAutoExportProcess):null;return function(a,g){var l=d(a),e={};q&&(e.process=_.bind(q,null,a));var c=b.addExport(l,g,e);a.$on("$destroy",function(){b.removeExport(c)})}}}}]);n.directive("ngTableFilters",
["$parse","$rootScope","require",function(a,l,b){return{restrict:"A",scope:!0,controller:function(){var a=this;a.ignore=null;a.filters=[];a.addFilter=function(e){b.assert(e.type,"ng-table-filter: expected filter description to include type");b.assert(e.filter,"ng-table-filter: expected filter description to include filter");a.filters.push(e);k(e)};a.removeFilter=function(b){h(b);_.overwriteWithout(a.filters,b)};a.reset=function(){_.forEach(a.filters,function(a){a.resetValue()});a.update()};a.isFiltering=
function(b){return _.any(_.map(a.filters,function(a){return a.isFiltering()}))};var c=function(b,l){for(var c=[],d=a.filters.length,p,f,q,h=0,k=l.length;h<k;h++){f=l[h];p=!0;if(f&&f!==a.ignore)for(var C=0;C<d;C++)if(q=a.filters[C],q.isFiltering()&&!q.filter(f)){p=!1;break}p&&c.push(f)}_.overwrite(b,c);b.filtered=l.length-c.length},d={},p={};a.update=function(){console.info("ng-table-filters: filtering collections");_.forEach(d,function(a,b){c(p[b],a)});h()};a.debouncedUpdate=_.debounce(function(){l.$apply(function(){a.update()})},
500);a.addCollection=function(a,b){d[a.$id]=b||[];var g=p[a.$id];_.isUndefined(g)&&(g=p[a.$id]=[]);c(g,d[a.$id]);return g};a.removeCollection=function(a){delete d[a.$id];delete p[a.$id]};var f={},h=function(b){f&&(_.isUndefined(b)?_.forEach(a.filters,function(a){h(a)}):!_.isUndefined(b.identifier)&&!_.isUndefined(b.value)&&(f[b.identifier]=b.value))},k=function(b){if(f)if(_.isUndefined(b))_.forEach(a.filters,k);else if(!_.isUndefined(b.identifier)){var l=f[b.identifier];_.isUndefined(l)?b.resetValue():
b.value=l}};a.updateModel=function(b){h();f=b||{};k();a.update();return f};a.storeModel=function(){h();return f}},compile:function(b,l){var c=l.ngTableFilters?a(l.ngTableFilters):null,d=l.ngTableFiltersModel?a(l.ngTableFiltersModel):null,f=l.ngTableFiltersIgnore?a(l.ngTableFiltersIgnore):null;return{pre:function(a,b,e,g){a.$tableFilters=g;d&&a.$watch(d,function(b){d.assign(a,g.updateModel(b))});c&&a.$watchCollection(c,function(b){a.$collection=g.addCollection(a,b)});f&&a.$watch(f,function(a){g.ignore=
a;g.update()})}}}}}]);n.directive("ngTableFilter",["$compile","$parse","$templateCache",function(a,l,b){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],scope:!0,controller:function(){this.name="";this.isFiltering=_.never;this.filter=_.always},compile:function(g,c){var d=b.get(c.ngTableFilterTemplate||"tableFilter.filter");if(d){var f=a(d),h=c.ngTableFilterIdentifier?l(c.ngTableFilterIdentifier):null;return{pre:function(a,b,e,g){var l=g[0],c=g[1];a.$tableFilter=c;c.reset=function(){c.resetValue();
l.update()};c.name=c.identifier=e.ngTableFilter;h&&(c.identifier=h(a));e.$observe("ngTableFilter",function(a){c.name=a});b.addClass("ng-table-filter");a.$watch(function(){return c.isFiltering()},function(a){b.toggleClass("filtering",a)});f(a,function(a){b.append(a)})},post:function(a,b,e,g){var l=g[0],c=g[1];l.addFilter(c);a.$on("$destroy",function(){l.removeFilter(c)})}}}console.error("ng-table-filter-filter: template not found")}}}]);n.directive("ngTableFilterString",["$parse",function(a){return{restrict:"A",
require:["^ngTableFilters","ngTableFilter"],compile:function(l,b){var g=a(b.ngTableFilterString);return{post:function(a,b,l,c){var d=c[0],p=c[1];p.type="string";p.value="";p.resetValue=function(){p.value=""};var e="";p.isFiltering=function(){e=p.value.toLowerCase();return!!e};p.filter=function(b){return 0<=(g(a,{$row:b})||"").toLowerCase().indexOf(e)};a.$watch(function(){return p.value},function(){d.debouncedUpdate()})}}}}}]);n.directive("ngTableFilterDate",["$parse",function(a){return{restrict:"A",
require:["^ngTableFilters","ngTableFilter"],compile:function(l,b){var g=a(b.ngTableFilterDate);return{pre:function(a,b,l,c){var d=c[0],p=c[1];p.operations=[{name:"Before",value:"before"},{name:"On",value:"on"},{name:"After",value:"after"}];var e={},f;e.on=function(b){return(b=g(a,{$row:b})||0)?0===b.diff(f,"days"):!1};e.before=function(b){return(b=g(a,{$row:b})||0)?0>b.diff(f,"days"):!1};e.after=function(b){return(b=g(a,{$row:b})||0)?0<b.diff(f,"days"):!1};p.type="date";p.value={operation:"on",date:""};
p.resetValue=function(){p.value.date=""};p.isFiltering=function(){f=p.value.date?moment(p.value.date,"YYYY-MM-DD"):null;return!!f};p.filter=e[p.value.operation];a.$watch(function(){return p.value.operation},function(a){p.filter=e[a];d.debouncedUpdate()});a.$watch(function(){return p.value.date},function(){d.debouncedUpdate()})}}}}}]);n.directive("ngTableFilterAmount",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(l,b){var g=a(b.ngTableFilterAmount);
return{pre:function(a,b,l,c){var p=c[0],d=c[1];d.operations=[{name:"is",value:"equal"},{name:"less than",value:"less-than"},{name:"greater than",value:"greater-than"}];var e={equal:function(b){return(g(a,{$row:b})||0)===d.value.amount},"less-than":function(b){return(g(a,{$row:b})||0)<d.value.amount},"greater-than":function(b){return(g(a,{$row:b})||0)>d.value.amount}};d.type="amount";d.value={operation:"greater-than",amount:""};d.resetValue=function(){d.value.amount=""};d.isFiltering=function(){return""!==
d.value.amount};d.filter=e[d.value.operation];a.$watch(function(){return d.value.operation},function(a){d.filter=e[a];p.debouncedUpdate()});a.$watch(function(){return d.value.amount},function(){p.debouncedUpdate()})}}}}}]);n.directive("ngTableFilterNumber",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(l,b){var g=a(b.ngTableFilterNumber);return{pre:function(a,b,l,c){var d=c[0],p=c[1];p.operations=[{name:"is",value:"equal"},{name:"less than",
value:"less-than"},{name:"greater than",value:"greater-than"}];var e={equal:function(b){return(g(a,{$row:b})||0)===p.value.number},"less-than":function(b){return(g(a,{$row:b})||0)<p.value.number},"greater-than":function(b){return(g(a,{$row:b})||0)>p.value.number}};p.type="number";p.value={operation:"greater-than",number:""};p.resetValue=function(){p.value.number=""};p.isFiltering=function(){return""!==p.value.number};p.filter=e[p.value.operation];a.$watch(function(){return p.value.operation},function(a){p.filter=
e[a];d.debouncedUpdate()});a.$watch(function(){return p.value.number},function(){d.debouncedUpdate()})}}}}}]);n.directive("ngTableFilterChoice",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(l,b){var g=a(b.ngTableFilterChoice),c=a(b.ngTableFilterChoices),d=a(b.ngTableFilterChoiceName||"$choice.name"),f=a(b.ngTableFilterChoiceValue||"$choice");return{pre:function(a,b,l,e){var p=e[0],h=e[1];b=c(a);var k=_.map(b,function(b){return f(a,{$choice:b})});
h.type="choices";h.choices=b;h.value={};h.resetValue=function(){_.forEach(k,function(a,b){h.value[b]=!1})};h.resetValue();h.isFiltering=function(){return _.any(_.values(h.value))};h.filter=function(b){var e=g(a,{$row:b})||!1;if(_.isArray(e)){for(var l=0,c=e.length;l<c;l++)if(b=k.indexOf(e[l]),0<=b&&h.value[b])return!0;return!1}b=k.indexOf(e);return 0<=b?h.value[b]:!1};h.choiceName=function(b){return d(a,{$choice:b})};a.$watch(function(){return h.value},function(){p.debouncedUpdate()},!0)}}}}}]);n.directive("ngTableFilterYesno",
["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(l,b){var g=a(b.ngTableFilterYesno);return{pre:function(a,b,l,c){var d=c[0],p=c[1],e=p.ANY="any";p.type="yesno";p.value=e;p.resetValue=function(){p.value=e};p.isFiltering=function(){return p.value!==e};p.filter=function(b){return(g(a,{$row:b})||!1)===p.value};a.$watch(function(){return p.value},function(){d.debouncedUpdate()})}}}}}]);n.directive("ngTableFilterView",["$compile","$templateCache",function(a,
l){var b={};return{require:"^ngTableFilter",link:{pre:function(g,c,d,f){d="tableFilter.filters."+f.type;var h=b[d];if(!h){h=l.get(d);if(!h){console.warn("ng-table-filter-view: invalid or custom type",f.type);c.remove();return}h=b[d]=a(h)}h(g,function(a){c.append(a)})}}}}]);n.directive("ngTables",[function(){return{restrict:"A",scope:!0,controllerAs:"tablesCtrl",controller:function(){var a=this;a.tables=[];a.predicate=null;a.addTable=function(l){_.contains(a.tables,l)||a.tables.push(l)};a.removeTable=
function(l){_.overwriteWithout(a.tables,l)};a.toggle=function(l){a.predicate=l;_.forEach(a.tables,function(a){a.toggle(l)})}}}}]);n.directive("ngTable",["$filter",function(a){var l=a("orderBy");return{restrict:"A",scope:!0,controller:["$scope","$attrs","$parse","$element",function(a,g,c,d){var p=this,f,h=g.ngTableName||"$table",k=a.isSet(g.ngTableFiltered)?d.controller("ngTableFilters"):null;p.collection=[];p.predicate=null;p.isReversed=!1;p.isHeadersIgnored=a.isSet(g.ngTableIgnoreHeaders);p.toggle=
function(a){a&&p.predicate===a?p.isReversed=!p.isReversed:(p.predicate=a,p.isReversed=!1);p.update()};p.update=function(a){_.isUndefined(a)||(f=a);a=f;p.predicate&&(a=l(f,p.predicate,p.isReversed));_.overwrite(p.collection,a);_.forEach(e,function(a){a()})};var e=[];p.watch=function(a,b){e.push(b);a.$on("$destroy",function(){_.overwriteWithout(e,b)})};a.tablesCtrl&&a.isSet(g.ngTableTables)&&(a.tablesCtrl.addTable(p),p.predicate=a.tablesCtrl.predicate,a.$on("$destroy",function(){a.tablesCtrl.removeTable(p)}));
g=c(g.ngTable);p.update(g(a));var m;a.$watchCollection(g,function(e){k?m=k.addCollection(a,e):p.update(e)});k&&(a.$watchCollection(function(){return m},function(a){p.update(a);p.filtered=a.filtered}),a.$on("$destroy",function(){k.removeCollection(a)}));_.set(a,h,p)}]}}]);n.directive("ngTableHeader",["tableHeaders","require",function(a,l){return{restrict:"A",require:["^?ngTable","^?ngTables"],link:function(b,g,c,d){var f=d[0]||d[1];f&&(f===d[0]&&f.isHeadersIgnored)&&(f=d[1],l.assert(f,"If ngTable is only for summaries, ngTables is required for headers!"));
l.assert(f,"ngTable or ngTables required");if(!c.ngTableHeaderWhen||b.$eval(c.ngTableHeaderWhen)){var h=a.parsePredicate(b,c.ngTableHeader,b.isSet(c.ngTableHeaderDefault),c.ngTableHeaderKey);b.isSet(c.ngTableHeaderDisabled)||(g.on("click",function(){b.$apply(function(){f.toggle(h)})}),g.addClass("ng-table-header"),b.$watch(function(){return f.predicate===h},function(a){g.toggleClass("active",a)}));h.isDefault&&f.toggle(h)}}}}]);n.directive("ngTableSummary",["$parse","require",function(a,l){return{scope:!0,
restrict:"A",compile:function(b,g){var c=g.ngTableSummary?a(g.ngTableSummary):null,d=g.ngTableSummaryOperator?a(g.ngTableSummaryOperator):function(a,b){return(b.$acc||0)+(b.$row||0)},f=g.ngTableSummaryInitial?a(g.ngTableSummaryInitial):g.ngTableSummaryOperator?null:_.constant(0);g.ngTableSummaries&&(c=a(g.ngTableSummaries),f=function(){return[]},d=function(a,b){_.forEach(b.$row,function(a,e){b.$acc[e]=(b.$acc[e]||0)+(a||0)});return b.$acc});return{pre:function(b,g,h){g=h.ngTableSummaryTableName||
"$table";l.inScope(b,g,"ngTable controller must be in scope");var e=b[g],k=h.ngTableSummaryWhen?a(h.ngTableSummaryWhen):_.always,m=function(){if(!k(b))return"";var a=f?f(b):null;return _.reduce(e.collection,function(a,e){return d(b,{$acc:a,$row:c?c(b,{$row:e}):e})},a)};g=function(){b.$summary=m()};g();b.isSet(h.ngTableSummaryOnce)||(b.isSet(h.ngTableSummaryTableOnly)?e.watch(b,g):b.$watch(g))}}}}}]);n.directive("ngGroup",[function(){return{scope:!0,restrict:"A",require:["ngGroup","^?ngGroups"],controller:function(){var a=
this;a.collection=[];a.groups=[];a.byFn=a.asFn=a.name=null;a.group=function(){var l=!0,b=a.byFn;b||(b=_.constant(""),l=!1);var g=a.asFn?a.asFn:b,c={},d={};if(a.collection.length){var f=_.groupBy(a.collection,function(l){l={$row:l};var f=b(l)||"";if(_.isUndefined(c[f])){var e=g===b?f:g(l);c[f]=e||null}_.isUndefined(d[f])&&(d[f]=a.sortByFn?a.sortByFn(l):c[f]);return f}),h={};_.forEach(a.groups,function(a){h[a.by]=a});f=_.map(f,function(b,g){var e=h[g]||{};_.extend(e,{isGrouped:l,by:g,as:c[g],name:a.name,
rows:b,sortBy:d[g]});return e});_.overwrite(a.groups,_.sortBy(f,"sortBy"))}else _.overwrite(a.groups,[{isGrouped:l,name:a.name,rows:[]}])};a.groupBy=function(l,b,g,c){a.byFn=l;a.asFn=b;a.sortByFn=g;a.name=c;a.group()};a.update=function(l){a.collection=l;a.group()}},link:function(a,l,b,g){var c=g[0],d=g[1];d&&(d.addNgGroupCtrl(c),a.$on("$destroy",function(){d.removeNgGroupCtrl(c)}));a.$groups=c.groups;a.$watchCollection(b.ngGroup,function(a){c.update(a)})}}}]);n.directive("ngGroupBy",["$parse","require",
function(a,c){return{require:["^?ngGroup","^?ngGroups"],compile:function(b,g){var d=g.ngGroupBy?a(g.ngGroupBy):null,f=g.ngGroupAs?a(g.ngGroupAs):null,h=g.ngGroupSortBy?a(g.ngGroupSortBy):null,k=g.ngGroupByModel?a(g.ngGroupByModel):null;return function(a,b,e,p){var m=p[0]||p[1];c.assert(m,"Either ngGroup or ngGroups required on ancestor");var n,v,s;d&&(n=_.bind(d,null,a),v=_.bind(f,null,a));h&&(s=_.bind(h,null,a));var z=function(){m.groupBy(n,v,s,e.ngGroupName)};a.isSet(e.ngGroupDefault)&&z();b.on("click",
function(){k?k.assign(a,g.ngGroupBy):z()});a.$watch(function(){return m.byFn===n},function(a){b.toggleClass("toggled",a)});k&&a.$watch(k,function(a,b){a===g.ngGroupBy&&z()})}}}}]);n.directive("ngGroups",["$parse","events",function(a,c){return{scope:!0,restrict:"A",controller:["$scope","$attrs",function(a,g){var d=this;d.ngGroupCtrls=[];var f=function(a){a.groupBy(d.byFn,d.asFn,d.sortByFn,d.name)};d.groupBy=function(a,b,g,c){d.byFn=a;d.asFn=b;d.sortByFn=g;d.name=c;_.forEach(d.ngGroupCtrls,f)};d.addNgGroupCtrl=
function(a){d.ngGroupCtrls.push(a);d.byFn&&f(a)};d.removeNgGroupCtrl=function(a){_.ref.remove(d.ngGroupCtrls,a)};if(g.ngGroupsRegroupEvent)c.on(a,g.ngGroupsRegroupEvent,function(){_.forEach(d.ngGroupCtrls,f)})}]}}]);n.directive("ngToggle",["$parse","$rootScope","toggles",function(a,c,b){return{restrict:"A",compile:function(g,c){var l=a(c.ngToggleValue),d=a(c.ngToggleDefault),f=a(c.ngToggleGroupValue),h=c.ngToggleWhen?a(c.ngToggleWhen):null;return function(a,e,g){var c=l(a)||g.ngToggle,p=d(a)||!1,
k=f(a)||g.ngToggleGroup,m=a.isSet(g.ngToggleAutoClose),C=a.isSet(g.ngToggleGroupCloseable),n=_.isUndefined(g.ngToggleInteractive)||a.isSet(g.ngToggleInteractive),t=h?_.bind(h,null,a):null;b.create(c,{autoClose:m,defaultState:p,group:k,isCloseableGroup:C,when:t});n&&(p="click",a.isSet(g.ngToggleMousedown)&&(p="mousedown"),e.on(p,function(e){a.$apply(function(){b.toggle(c)})}));a.$watch(function(){return b.state(c)},function(a){e.toggleClass("toggled",a)});a.$on("$destroy",function(){b.destroy(c)})}}}}]);
n.directive("ngToggled",c.conditionalDirective({watch:["toggles",function(a){return function(c,b,g){var d=c.$eval(g.ngToggledValue)||g.ngToggled,f=g.ngToggledAlwaysWhen?c.$eval(g.ngToggledAlwaysWhen):!1;return function(){return f||a.state(d)}}}],operator:["$parse",function(a){return function(c,b,g){var d=g.ngToggledAction?a(g.ngToggledAction):_.ignore;return function(a){d(c,{$value:a});return a}}}]}));n.directive("ngToggledShow",["$parse","toggles",function(a,c){return{link:function(b,g,d){var f=
d.ngToggledAction?a(d.ngToggledAction):_.ignore,h=d.ngToggledAlways?a(d.ngToggledAlways):_.never,k=b.$eval(d.ngToggledShowValue)||d.ngToggledShow;b.$watch(function(){return c.state(k)||h(b)},function(a){f(b,{$value:a});g.css("display",a?"":"none")})}}}]);n.directive("ngWith",["$parse",function(a){return{restrict:"A",scope:!0,priority:900,compile:function(c,b){var g=a(b.ngWith);return{pre:function(a,b,c){g(a);a.$watch(g)}}}}}]);n.directive("ngFadeIn",[function(){return{restrict:"A",link:function(a,
c,b){a=parseInt(b.ngFadeIn);c.hide();c.fadeIn(a)}}}]).directive("ngFadeOut",[function(){return{restrict:"A",link:function(a,c,b){var g=parseInt(b.ngFadeOut);b=b.ngFadeTarget;var d=$(c);c=a;b&&(c=a.$eval(b));c.fadeOut=function(b){d.fadeOut(g,function(){b&&b(a)})}}}}]);n.directive("ngNullForm",[function(){return{name:"form",controller:function(){this.$setPristine=this.$setDirty=this.$removeControl=this.$setValidity=this.$addControl=_.ignore;this.$$renameControl=function(a,c){a.$name=c}},link:{pre:function(a){a.nullForm=
{$dirty:!1,$pristine:!0,$valid:!0,$invalid:!1}}}}}]);n.directive("ngName",[function(){return{restrict:"A",require:["ngModel","^?form"],link:function(a,c,b,g){a.$watch(b.ngName,function(a){c.attr("name",a);var b=g[0],d=g[1];d.$removeControl(b);b.$name=a;d.$addControl(b)})}}}]).directive("ngPrefix",[function(){return{restrict:"A",priority:100,controller:["$scope","$element","$attrs",function(a,c,b){var g=c.attr("name");a.$watch(b.ngPrefix,function(a){var c=g;a&&(c=a+"-"+c);b.$set("name",c)})}]}}]);
n.directive("ngOutboundLink",[function(){return{restrict:"A",priority:-1,link:function(a,c,b){var g=a.$interpolate(b.ngOutboundLink)||"_self";(!b.ngOutboundLinkWhen||a.$eval(b.ngOutboundLinkWhen))&&c.attr("target",g)}}}]);n.directive("ngBackButton",["$window",function(a){return{restrict:"A",link:function(c,b,g){b.on("click",function(b){setTimeout(function(){a.history.back()},50)})}}}]);n.directive("ngSearchLink",["navigation",function(a){return{restrict:"A",link:function(c,b,g){g.$observe("ngSearchLink",
function(d){var f=c.$eval(g.ngSearchLinkCompany)||a.currentCompany;f&&(d=f.$url(urls.dashboard.bookings.index)+"?q="+d,b.attr("href",d))})}}}]);n.directive("ngPrint",_.optional(["$timeout","$window","?native",function(a,c,b){var g=b&&b.isNative;return{restrict:"A",link:function(d,f,h){var k=function(){if(g){var a;if(h.ngPrintNative){a=$(d.$interpolate(h.ngPrintNative));if(!a.length)return;a=a[0]}b.print(a)}else c.print()};f.on("click",function(a){a.preventDefault();a.stopPropagation();k()});d.isSet(h.ngPrintAuto)&&
a(function(){k()},g?0:400)}}}]));n.directive("ngOpenWindow",["$window","d",function(a,c){return{restrict:"A",link:function(b,g,d){var f=c.observer(d,"ngOpenWindow"),h=c.observer(d,"ngOpenWindowArguments","toolbar=0,status=0,scrollbars=1");g.on("click",function(c){if(f()){var g=b.$eval(d.ngOpenWindowWidth);c=b.$eval(d.ngOpenWindowHeight);var l=h();if(g)var e=Math.max(0,(a.screen.width-g)/2),l=l+(",width="+g)+(",left="+e);c&&(g=Math.max(0,(a.screen.height-c)/2),l+=",height="+c,l+=",top="+g);a.open(f(),
"angular-open-winow",l)}})}}}]);n.directive("ngCloseWindow",["$window","d",function(a,c){return{restrict:"A",link:function(b,c,l){c.on("click",function(b){a.close()})}}}]);n.directive("ngTouch",["$parse","d",function(a,c){return{restrict:"A",compile:function(b,g){var d=a(g.ngTouch);return function(a,b){b.on(c.isTouchEnabled?"touchstart":"click",function(){a.$apply(function(){d(a)})})}}}}]);n.directive("ngConfirmClick",[function(){return{priority:-1,restrict:"A",link:function(a,c,b){c.on("click",function(c){var l=
b.ngConfirmClick,d;if(d=l)d=_.isUndefined(b.ngConfirmClickWhen)?!0:a.$eval(b.ngConfirmClickWhen,{$event:c}),d=d&&!confirm(l);d&&(c.stopImmediatePropagation(),c.preventDefault())})}}}]);n.directive("ngCancelClick",[function(){return{priority:-1,restrict:"A",link:function(a,c,b){c.on("click",function(c){a.$eval(b.ngCancelClick)&&(c.stopImmediatePropagation(),c.preventDefault())})}}}]);h=function(a,c){n.directive(a,[function(){return{restrict:"A",link:function(b,g,d){var f=b.isSet(d[a+"Strict"]);g.on("click",
function(g){f&&this!==g.target||c.test(g)&&b.$apply(function(){!1===b.$eval(d[a])&&(g.stopPropagation(),g.preventDefault())})})}}}])};n.config(["$provide",function(a){a.decorator("ngClickDirective",["$delegate",function(a){a.shift();return a}])}]);h("ngClick",{test:function(a){return!a.shiftKey&&!a.ctrlKey&&!a.metaKey&&!a.altKey}});h("ngShiftClick",{test:function(a){return a.shiftKey&&!a.ctrlKey&&!a.metaKey&&!a.altKey}});h("ngControlClick",{test:function(a){return!a.shiftKey&&a.ctrlKey&&!a.metaKey&&
!a.altKey}});h("ngMetaClick",{test:function(a){return!a.shiftKey&&!a.ctrlKey&&a.metaKey&&!a.altKey}});h("ngAltClick",{test:function(a){return!a.shiftKey&&!a.ctrlKey&&!a.metaKey&&a.altKey}});h("ngShiftOrAltClick",{test:function(a){return(a.shiftKey||a.altKey)&&!a.ctrlKey&&!a.metaKey}});n.directive("ngPhoneNumberInput",["d",function(a){return{priority:1,restrict:"A",link:function(c,b){a.restrictKeypresses(b,/\+|\d/)}}}]);n.directive("ngAmountInput",["$parse","d",function(a,c){return{priority:1,require:"ngModel",
restrict:"A",link:function(b,g,d,f){var h=a(d.ngModel),m=parseFloat(d.max),y=parseFloat(d.min),D=d.ngAmountInputMax&&a(d.ngAmountInputMax),e=d.ngAmountInputMin&&a(d.ngAmountInputMin),F=d.ngAmountInputDefault&&a(d.ngAmountInputDefault),n=b.isSet(d.ngAmountInputAllowEmpty),n=!d.required||n,A=function(){return F?F(b)/100:0},v=/[0-9]|\./;if(d.ngAmountInputPositive?!b.$eval(d.ngAmountInputPositive):1)v=/[0-9]|\.|\-/;c.restrictKeypresses(g,v);f.$parsers.push(function(a){if(_.isUndefined(a)||""===a||null===
a){if(n)return"";f.$$lastCommittedViewValue=A().toString();return _.roundHalfToEven(100*A())}f.$setValidity("required",!0);var c=e?Math.max(e(b)/100,y):y,g=D?Math.min(D(b)/100,m):m;!_.isNaN(c)&&a<c&&(a=c,f.$setValidity("min_value",!0));!_.isNaN(g)&&a>g&&(a=g,f.$setValidity("max_value",!0));return _.roundHalfToEven(100*a)});f.$formatters.unshift(function(a){return _.isUndefined(a)||""===a||null===a?n?"":A():_.roundHalfToEven(a/100,2).toFixed(2)});b.$watch(h,function(a,e){!n&&(_.isUndefined(a)&&_.isUndefined(e))&&
h.assign(b,A())});g.on("blur",function(){k(f)})}}}]);n.directive("ngJsonInput",["$parse",function(a){var c=/^(?!^[_\-])(?!.*[_\-]$)[a-zA-Z0-9_\-]+$/,b=function(a){try{_.parseJSON(a)}catch(b){return!1}return!0};return{require:"ngModel",restrict:"A",link:function(g,d,f,h){var k=a(f.ngModel);h.$parsers.push(function(a){a=$.trim(a);if(_.isUndefined(a)||""===a||null===a)return h.$setValidity("valid_json",!0),"";var g=a;c.test(g)&&(g='"'+g+'"');h.$setValidity("valid_json",b(g));return a});g.$watch(k,function(a){a&&
('"'===a.charAt(0)&&'"'===a.slice(-1))&&(a=a.slice(1,a.length-1),(!a||c.test(a))&&k.assign(g,a))})}}}]);n.directive("ngBindOnce",[function(){return{link:function(a,c,b){c.addClass("ng-binding").data("$binding",b.ngBindOnce);a=a.$eval(b.ngBindOnce)||"";c[0].textContent=a.toString()}}}]);n.directive("ngBindHtmlUnsafe",["clientOptions",function(a){return{link:function(c,b,g){b.addClass("ng-binding").data("$binding",g.ngBindHtmlUnsafe);a.reflectUrlsInHrefs(b);c.$watch(g.ngBindHtmlUnsafe,function(a){b.html(a||
"")})}}}]);n.directive("ngBindHtmlUnsafeOnce",["clientOptions",function(a){return{link:function(c,b,g){b.addClass("ng-binding").data("$binding",g.ngBindHtmlUnsafeOnce);a.reflectUrlsInHrefs(b);b.html(c.$eval(g.ngBindHtmlUnsafeOnce)||"")}}}]);var h=function(a,c,b){n.directive(a,["$compile","$filter","$injector","auth","navigation",function(g,d,f,h,k){var m=f.invoke(c.render),D=d("currencySymbol");return{restrict:"A",compile:function(e){e.addClass("notranslate amount");return function(e,c,d){var l,f,
k=function(a,k){if(!(a===f&&k===l)){f=a;l=k;var p=e.$eval(d.ngAmountCurrency)||e.processorCurrency||k;b=b||"viewAmounts";k&&!h.permissions.can(b,k)?(p=D(p,"short"),g('<span ng-tip="You don\'t have permission to see this amount">'+p+"?</span>")(e,function(a){c.empty().append(a)}),c.addClass("amount-hidden")):(p=m(e,d,f,k,p),c.text(p),c.addClass("amount-visible"));c.toggleClass("negative",0>f)}};e.$watch(d[a],function(b){k(b,e.$eval(d[a+"Company"])||e.company||null)});_.isUndefined(d[a+"Company"])||
e.$watch(d[a+"Company"],function(b){k(e.$eval(d[a]),b||null)})}}}}])},a={render:["$filter",function(a){var c=a("amount");return function(a,g,d,f,h){f=a.$eval(g.ngAmountHideCents)||!1;var k=!0;_.isUndefined(g.ngAmountShowCurrencySymbol)||(k=a.$eval(g.ngAmountShowCurrencySymbol));return c(d,h,f,k)}}]};h("ngAmount",a);h("ngInvoiceAmount",a,"viewInvoiceAmounts");h("ngAmountRate",{render:["$filter",function(a){var c=a("percentage");return function(a,g,d){return c(d)}}]});n.directive("ngFloatInput",function(){return{priority:1,
require:"ngModel",link:function(a,c,b,g){a.$eval(b.ngFloatInput);var d=b.ngFloatInputMaxDigits?a.$eval(b.ngFloatInputMaxDigits):null,f=b.ngFloatInputDecimalPlaces?a.$eval(b.ngFloatInputDecimalPlaces):null,h;if(c=b.ngFloatInputMin||b.min){var k=a.$eval(c);h=function(a){g.$setValidity("min_value",a>=k)}}var m;if(b=b.ngFloatInputMax||b.max){var D=a.$eval(b);m=function(a){g.$setValidity("max_value",a<=D)}}g.$parsers.push(function(a){"."===a&&(a="");if(null!==f){var b=a.indexOf(".");-1!==b&&a.length-(b+
1)>f&&(a=a.slice(0,b+1)+a.slice(b+1,b+1+f))}null!==d&&(b=d,_.startsWith(a,"-")&&(b+=1),_.contains(a,".")&&(b+=1),a.length>b&&(a=a.substring(0,b)));b=parseFloat(a);if(isNaN(b))return a;h&&h(b);m&&m(b);return b})}}});n.directive("ngBooleanSelect",function(){return{priority:1,require:"ngModel",link:function(a,c,b,g){g.$parsers.push(function(a){return _.contains([!0,"True","true","1"],a)?!0:_.contains([!1,"False","false","0"],a)?!1:a});g.$formatters.push(function(a){return!0===a?"True":!1===a?"False":
a})}}});n.directive("ngIntInput",["$parse","d",function(a,c){return{require:"ngModel",priority:1,compile:function(b,g){var d=a(g.ngIntInputMin),f=a(g.ngIntInputMax);return function(a,b,g,h){a.isSet(g.ngIntInput)&&(c.restrictKeypresses(b,/[-0-9]/),h.$parsers.push(function(b){var c=d(a),g=f(a);if(""===b)return b;var l=parseInt(b,10);if(isNaN(l))return b;_.isUndefined(c)||(l<c&&(l=c),h.$setValidity("min",!0));_.isUndefined(g)||(l>g&&(l=g),h.$setValidity("max",!0));return l}),b.on("blur",function(){k(h)}))}}}}]);
n.directive("ngLoadTime",["$window",function(a){return{restrict:"A",link:function(){console.info("ng-load-time",(new Date-a.$$loadTime)/1E3)}}}]);n.directive("ngPlaceholder",[function(){return function(a,c,b){b.$observe("ngPlaceholder",function(a){c.attr("placeholder",a);if("SELECT"===c[0].nodeName){var b=c.children("option").first();b.text()||(b.attr("label",a),b.text(a))}else a&&c.placeholder()})}}]);n.directive("ngDatepicker",["$parse","d","localization","moment","Pikaday",function(a,c,b,g,d){return{require:"ngModel",
priority:1,restrict:"A",compile:function(f,h){var m=a(h.ngDatepickerYearRange),y=a(h.ngDatepickerMinDate);return function(a,e,f,p){var x=a.isSet(f.ngDatepickerAllowEmpty),n=b.current().DATE_FORMATS.input||"MM-DD-YYYY",s=a.company&&a.company.features?a.company.features.isSundayBased:!0;_.isUndefined(h.ngDatepickerSundayBased)||(s=a.isSet(h.ngDatepickerSundayBased));var z=$(e);c.restrictKeypresses(e,/[0-9]|\/|\-/);var u=function(a,b){var e=g(a,b);return!e||!e.isValid()?x?"":g():e},s={field:z[0],format:n,
onSelect:function(){a.$apply(function(){p.$setViewValue(t.toString())})},minDate:y,yearRange:m,onOpen:function(){var a=u(p.$modelValue,"YYYY-MM-DD");a&&t.setMoment(a)},firstDay:s?0:1,i18n:{previousMonth:T("Previous Month"),nextMonth:T("Next Month"),months:[T("January"),T("February"),T("March"),T("April"),T("May"),T("June"),T("July"),T("August"),T("September"),T("October"),T("November"),T("December")],weekdays:[T("Sunday"),T("Monday"),T("Tuesday"),T("Wednesday"),T("Thursday"),T("Friday"),T("Saturday")],
weekdaysShort:[cT("Abbreviation of Sunday","Sun"),cT("Abbreviation of Monday","Mon"),cT("Abbreviation of Tuesday","Tue"),cT("Abbreviation of Wednesday","Wed"),cT("Abbreviation of Thursday","Thu"),cT("Abbreviation of Friday","Fri"),cT("Abbreviation of Saturday","Sat")]}},t=new d(s),E=function(a,b,e){return(a=u(a,b))?a.format(e):""};p.$parsers.push(function(a){return E(a,n,"YYYY-MM-DD")});p.$formatters.unshift(function(a){return E(a,"YYYY-MM-DD",n)});!a.$eval(f.ngModel)&&!x&&(f=p.$pristine,p.$pristine=
!1,p.$setViewValue(g().format(n)),p.$render(),p.$pristine=f);e.on("blur",function(){k(p)});a.$on("$destroy",function(){t.destroy()});y&&a.$watch(y,function(a){t.config({minDate:a?a.toDate():void 0});a&&0>g(p.$modelValue,"YYYY-MM-DD").diff(a)&&(p.$modelValue=a.format("YYYY-MM-DD"),p.$$writeModelToScope(),k(p))})}}}}]);n.directive("ngTimepicker",["$parse","$timeout","d","localization","moment",function(a,c,b,g,d){return{require:"ngModel",restrict:"A",link:function(a,f,h,p){var m=g.current().TIME_FORMATS.default;
h=g.current().SERVER_TIME_FORMAT;var e=$(f);b.restrictKeypresses(f,/[0-9]|[:amp]/);var n=e.timepicker({timeFormat:h});f.on("selectTime",function(){a.$safeApply(function(){var a=n.val();a!==p.$viewValue&&p.$setViewValue(a)})});var G=function(a,b,e){b=d(a,b);return!a||!b||!b.isValid()?"":b.format(e)};p.$parsers.push(function(a){return G(a,m,"HH:mm")});p.$formatters.unshift(function(a){var b=G(a,"HH:mm",m);c(function(){n.timepicker("setTime",b)});return b});f.on("blur",function(){k(p)});a.$on("$destroy",
function(){n.timepicker("remove")})}}}]);n.directive("ngInternationalPhoneField",["$compile","$parse","$timeout","auth","localization","models","navigation",function(a,c,b,g,d,f,h){return{require:"ngModel",restrict:"A",link:function(f,k,m,e){var x=c(m.ngModel),n=c(m.ngInternationalPhoneFieldPhoneCountryModel),x=x(f),A=n(f),v=$(k);k=f.$eval(m.ngInternationalPhoneFieldCountries)||[];var s=function(){return v.intlTelInput("getSelectedCountryData")},z=function(){var b=s(),e=v.siblings(".flag-container").find(".selected-flag");
e.attr("ng-tip",function(){return"Country Code"+(_.isEmpty(b)?"":": +"+b.dialCode+" "+b.name)}).attr("ng-tip-classes","tip-indent").attr("title",null);a(e)(f)},u=_.map(k,function(a){return a[0].toLowerCase()}),t=function(a){a=a?a.toLowerCase():"";return _.contains(u,a)},E=function(a){b(function(){n.assign(f,a.toUpperCase())},0)};k=[];if(1<u.length){g.currentUser.isAuthenticated||k.push(d.browser.ACCEPT_LANGUAGE_COUNTRY_CODE.toLowerCase());m=h.currentCompany;var L=m.country;if("US"===m.processorCountry||
!m.country)L=m.processorCountry;k.push(L.toLowerCase());k=_.uniq(k);k=_.filter(k,function(a){return t(a)})}var r="";A&&t(A)?r=A.toLowerCase():x||(k.length?r=k[0]:u.length&&(r=u[0]));v.intlTelInput({autoPlaceholder:"off",formatOnDisplay:!1,onlyCountries:u,preferredCountries:k,initialCountry:r});E(r);z();x&&v.intlTelInput("setNumber",x);f.$watch(n,function(a,b){v.parents(".international-phone-field").toggleClass("no-country",!a);if(a!==b)if(!a||t(a)){var e=a,e=e?e.toLowerCase():"";v.intlTelInput("setCountry",
e)}else E(r)});v.on("countrychange",function(){f.$safeApply(function(){var a;a=s();a=!a||!a.iso2?"":a.iso2.toUpperCase();E(a);e.$setDirty();e.$setViewValue(v.val());z()})});v.on("open:countrydropdown",function(){f.$safeApply(function(){var a=v.siblings(".flag-container").find(".country-list");a.length&&!a.hasClass("tb-flyout")&&a.addClass("tb-flyout")})});f.$on("$destroy",function(){v.intlTelInput("destroy")})}}}]);n.directive("ngSlideshow",["$animate","$compile","$templateCache","$timeout",function(a,
c,b,g){return{restrict:"A",controller:["$scope","$element","$attrs",function(b,c,g){var d=b.$eval(g.ngSlideshowDelay)||4500,l,f,e=this;e.isPlaying=!1;e.slides=[];e.currentSlide=null;e.addSlide=function(a){a={element:a};e.slides.push(a);return a};e.removeSlide=function(a){e.slides[f]===a&&(f+=1,f>=e.slides.length&&(f=0));_.overwriteWithout(e.slides,a);e.slides[f]||(f=void 0)};e.showSlide=function(b){if(e.slides.length){var c=_.indexOf(e.slides,b);0>c||(!_.isUndefined(f)&&e.slides[f]!==b&&(b=e.slides[f],
e.currentSlide=null,a.removeClass(b.element,"slideshow-showing")),f=c,c=e.slides[f],e.currentSlide=c,a.addClass(c.element,"slideshow-showing"),e.isPlaying&&e.play())}};e.next=function(){var a;_.isUndefined(f)?a=0:(a=f+1,a>=e.slides.length&&(a=0));e.showSlide(e.slides[a])};e.previous=function(){var a;_.isUndefined(f)?a=0:(a=f-1,0>a&&(a=e.slides.length-1));e.showSlide(e.slides[a])};e.pause=function(){a.removeClass("slideshow-playing");a.addClass("slideshow-paused");clearTimeout(l);e.isPlaying=!1};var h=
function(){b.$safeApply(function(){l=null;e.slides.length&&e.next()})};e.play=function(a){e.isPlaying=!0;l&&clearTimeout(l);l=setTimeout(h,a?0:d)}}],link:function(a,g,d,f){d=b.get("slideshow-dots");var h=b.get("slideshow-arrows");a=a.$new();a.slideshow=f;g.append(c(d)(a));g.append(c(h)(a));f.play(!0)}}}]);n.directive("ngSlideshowSlide",[function(){return{restrict:"A",require:"^ngSlideshow",link:function(a,c,b,g){c.addClass("slideshow-slide");g.slides.length||c.addClass("slideshow-showing");var d=
g.addSlide(c);a.$on("$destroy",function(){g.removeSlide(d)})}}}]);n.directive("ngDiff",["diff",function(a){return{restrict:"A",link:function(c,b,g){var d=c.$eval(g.ngDiff);c=c.$eval(g.ngDiffWith);if(_.isUndefined(d)||null===d)d="";if(_.isUndefined(c)||null===c)c="";b.addClass("diff");_.forEach(a.diffWords(c,d),function(a){var c=$("<span />");a.added?c.addClass("diff-added"):a.removed?c.addClass("diff-removed"):c.addClass("diff-unchanged");c.text(a.value);b.append(c)})}}}]);n.directive("ngMarkdownFileUpload",
["$q","$window","filepicker","flash",function(a,c,b,g){return{require:"ngModel",restrict:"A",link:function(d,f,h,k){var m=function(){var e=a.defer();b.pickAndStore({},{location:"S3"},function(a){d.$apply(function(){var b=a?_.first(a):"";if(b.url){var g=b.url.replace(c.slipstream.remoteFileDomain,c.slipstream.remoteFileCdnDomain),d=b.filename||"attachment",b=(b.mimetype||"").match(/^image\/\S+$/);e.resolve({url:g,fileName:d,isImage:b})}else e.reject()})},function(a){d.$apply(function(){a&&101===a.code?
e.resolve():e.reject()})});return e.promise},n,e=_.first(f);f.bind("keyup click",function(){_.isUndefined(e.selectionStart)||(n=e.selectionStart)});f.parents(h.ngMarkdownParent).first().find(h.ngMarkdownFileUpload).on("click",function(){m().then(function(a){if(a){var b=k.$viewValue||"",e=_.isUndefined(n)?b.length:n,c=b.substr(0,e);c&&!c.match(/\s$/)&&(c+="\n");(b=b.substr(e))&&!b.match(/^\s/)&&(b="\n"+b);var e=a.url,d=a.fileName;a=a.isImage?"!["+(_.isUndefined(h.ngMarkdownImageDescription)?"Description of image":
h.ngMarkdownImageDescription)+"]("+e+")":"[View "+d+"]("+e+")";k.$setViewValue(c+a+b);k.$render();g.success("Markdown updated")}},function(){g.error("File was not uploaded, please try again")})})}}}]);n.directive("ngMarkdownPreview",["Showdown",function(a){return{require:"ngModel",restrict:"A",link:function(c,b,g,d){var f=new a.converter;c=b.parents(g.ngMarkdownParent).first();b=c.find(g.ngMarkdownPreview);var h=c.find(g.ngMarkdownPreviewResult);b.on("click",function(){var a="",b=d.$viewValue;b&&
(b=_.escape(b),a=f.makeHtml(b));h.html(a)})}}}]);n.directive("ngMailcheck",["Mailcheck",function(a){return{restrict:"A",scope:{email:"=ngMailcheck"},template:'<a ng-show="suggestedEmail">Did you mean <b>[[ suggestedEmail ]]</b>?</a>',link:function(c,b,g,d){c.suggestedEmail="";c.$watch("email",function(b){b?a.run({email:b,suggested:function(a){c.suggestedEmail=a.full},empty:function(){c.suggestedEmail=""}}):c.suggestedEmail=""});b.on("click",function(){c.email=c.suggestedEmail})}}}]);h=function(a){return n.directive(a.name,
[function(){return{restrict:"A",link:function(c,b,g){b="$"+a.name;var d=c[b],f;d&&(f=d.isEnabled,d.isEnabled=!1);if(c.hasOwnProperty(b))throw Error("lib.directives: multiple copies of "+a.name+" modifier in same scope");var h={isEnabled:!0};c[b]=h;var k=$(a.selector),m=a.get(k),n=m;g.$observe(a.name,function(b,c){h.isEnabled&&(n=b,a.set(k,b,c))});c.$on("$destroy",function(){a.set(k,m,n);d&&(d.isEnabled=f)})}}}])};h({name:"ngTitle",selector:"title",get:function(a){return document.title},set:function(a,
c){return document.title=c}});h({name:"ngMetaViewport",selector:'meta[name="viewport"]',get:function(a){return a.attr("content")},set:function(a,c){return a.attr("content",c)}});n.directive("ngBodyClass",[function(){return{restrict:"A",link:function(a,c,b){var g=$("body"),d="";a.$watch(function(){var c=a.$eval(b.ngBodyClass);return _.isObject(c)?_.mapObject(c,function(a){return!!a}):c},function(a){g.removeClass(d);var b="";_.isObject(a)?_.forEach(a,function(a,c){a&&(b+=c+" ")}):b=a;g.addClass(b);
d=b},!0);a.$on("$destroy",function(){g.removeClass(d)})}}}]);n.directive("ngBodyClassOnce",[function(){return{restrict:"A",link:function(a,c,b){c=$("body");a=a.$eval(b.ngBodyClassOnce);var g="";_.isObject(a)?_.forEach(a,function(a,b){a&&(g+=b+" ")}):g=a;c.addClass(g)}}}]);n.directive("ngInline",["$templateCache",function(a){return{restrict:"A",priority:400,compile:function(c,b){var g=b.ngInline,d=a.get(g);d?c.html(d):console.warn("ng-inline: invalid template",g)}}}]);n.directive("ngLink",["$compile",
"$templateCache",function(a,c){var b={};return{restrict:"A",priority:400,link:function(g,d,f){if(f=g.$interpolate(f.ngLink)){var h=b[f];if(!h){h=c.get(f);if(!h){console.warn("ng-link: invalid template",f);return}h=a(h);b[f]=h}h(g,function(a){d.empty().append(a)})}else console.warn("ng-link: invalid template name",f)}}}]);n.directive("ngLoad",["$compile","$http","$templateCache",function(a,c,b){return{restrict:"A",priority:400,compile:function(g,d){var f="/"+d.ngLoad,h=b.get(f);if(h)console.info("ng-load: compiled load",
f),g.html(h);else{(h=b.get("ng-load-spinner"))&&g.html(h);var k;return function(g,d,e){var h=function(){k(g,function(a){d.empty().append(a)})};e=function(e){e=e.data;b.put(f,e);console.info("ng-load: downloaded load",f);k=a(e);h()};k?(console.info("ng-load: linked load",f),h(g,d)):c.get(f).then(null,function(){console.error("ng-load: unable failed to load, retrying...",f);return c.get(f)}).then(e,function(){console.error("ng-load: unable to load",f);var e=b.get("ng-load-error");d.empty().append(a(e)(g))})}}}}}]);
n.directive("ngNewTransportation",["$parse",function(a){return{restrict:"A",require:"^?form",controller:"lib.shared.NewTransportationCtrl",link:{pre:function(a,b,c,d){if(d){d.$setValidity("loading-transportation",!1);var f=a.$watch("newTransportationCtrl.status",function(a){if("success"===a||"error"===a)d.$setValidity("loading-transportation",!0),f()});a.$on("$destroy",function(){d.$setValidity("loading-transportation",!0)})}}}}}]);n.directive("ngPseudoPlaceholder",[function(){return{restrict:"A",
link:function(a,c,b){var g=c.closest(".field");g.addClass("field-pseudo-input-placeholder");a.$watch(function(){return c.val()},function(a){g.toggleClass("showing-pseudo-placeholder",!a)})}}}]);n.directive("ngDebug",[function(){return{restrict:"A",link:function(a,c,b){debugger}}}]);n.directive("ngLog",[function(){return{restrict:"A",link:function(a,c,b){console.log("ng-log: link",a.$eval(b.ngLog));a.$on("$destroy",function(){console.log("ng-log: $destroy",a.$eval(b.ngLog))})}}}]);n.directive("ngCurrentBlock",
["$parse",function(a){return{restrict:"A",link:function(c,b,g){var d=a(g.ngCurrentBlockBlocks);c.$watch(g.ngCurrentBlockAffiliation,function(a){var b;a&&(b=d(c),b=_.find(b,function(b){return b.affiliation===a}));c.currentBlock=b})}}}]);n.directive("ngStartBooking",["navigation","postBook",function(a,c){return{priority:-1,restrict:"A",link:function(b,g,d){g.on("click",function(){b.$apply(function(){var g;g=d.ngStartBooking?b.$interpolate(d.ngStartBooking):a.url;c.startBooking(g)})})}}}]);n.directive("ngDump",
["$parse",function(a){return{restrict:"A",link:function(c,b,g){var d=a(g.ngDump);console.log("ng-dump: link",d(c));c.isSet(g.ngDumpWatch)&&c.$watch(function(){console.log("ng-dump: $watch",d(c))})}}}]);n.directive("ngQrCode",["$interpolate","QRCode",function(a,c){return{restrict:"A",compile:function(b,g){var d=a(g.ngQrCode);return function(a,b){var g=d(a);new c(b[0],{text:g,width:256,height:256,colorDark:"#000000"})}}}}]);n.directive("ngModelDependencies",["$parse",function(a){return{restrict:"A",
controller:function(){var a=this;a.dependents=[];a.addDependent=function(b){a.dependents.push(b)}},compile:function(c,b){var g=a(b.ngModelDependencies);return function(a,b,c,d){a.$watch(g,function(a){a?b.prop("disabled",!1):(b.prop("disabled",!0),_.forEach(d.dependents,function(a){a(!1)}))})}}}}]);n.directive("ngModel",["$parse",function(a){return{require:"^?ngModelDependencies",link:function(c,b,g,d){if(d){console.info("adding dependent",g.ngModel);var f=a(g.ngModel);d.addDependent(function(a){return f.assign(c,
a)})}}}}]);n.directive("ngSelectAll",["$parse",function(a){return{restrict:"A",templateUrl:"ng-select-all",scope:!0,compile:function(c,b){var g=a(b.ngSelectAll),d=a(b.ngSelectAllModel),f=b.ngSelectAllWhen?a(b.ngSelectAllWhen):_.always,h=a(b.ngSelectAllDefaults),k=a(b.ngSelectAllDefaultField);return function(a,c,e){var l=function(e){if(!c.parents("fieldset[disabled]").length){var l=g(a);_.forEach(l,function(b){var c={$element:b};f(a,c)&&d.assign(a,e(b),c)});(l=a.$eval(b.ngSelectAllCallback))&&l()}};
a.selectText=a.$interpolate(e.ngSelectAllText);a.selectAll=_.bind(l,null,_.constant(!0));a.selectNone=_.bind(l,null,_.constant(!1));a.allowDefaults=!!h(a);if(a.allowDefaults){var m=_.makeIteratee(k(a));a.selectDefaults=function(){var b=h(a);l(function(a){return!!b[m(a)]})}}}}}}]);n.directive("ngClearInput",["$parse",function(a){return{restrict:"A",compile:function(c,b){c.addClass("ng-clear-input");var g=a(b.ngClearInput);return function(a,b){a.$watch(g,function(a){b.toggleClass("ng-hide",!a)});b.on("click",
function(){b.prev().focus();a.$apply(function(){g.assign(a,"")})})}}}}]);n.directive("ngDjangoField",["$parse",function(a){return{restrict:"A",compile:function(c,b){var g=a(b.ngDjangoField),d=a(b.ngDjangoFieldModel),f=_.isUndefined(b.ngDjangoFieldRequired)?_.constant(!1):""===b.ngDjangoFieldRequired?_.constant(!0):a(b.ngDjangoFieldRequired),h=_.isUndefined(b.ngDjangoFieldDisabled)?_.constant(!1):a(b.ngDjangoFieldDisabled);return{pre:function(a,b){b.addClass("field")},post:function(a,b){a.$watch(function(){var b=
g(a)||{},c=d(a),l=f(a),k=h(a),c=""===c||_.isUndefined(c);return{"ng-pristine":b.$pristine,"ng-dirty":b.$dirty,"ng-invalid":b.$invalid||c&&l,"ng-disabled":k,"ng-required":l}},function(a){var c=_.map(a,function(a,b){if(a)return b});a=_.map(a,function(a,b){if(!a)return b});b.addClass(c.join(" ")).removeClass(a.join(" "))},!0)}}}}}]);n.directive("ngNoisyInvalidFields",[function(){return{restrict:"A",require:"ngNoisyInvalidFields",controller:["$scope",function(a){var c=this;c.isShowing=!1;var b=function(){$("body").toggleClass("noisy-invalid-fields",
c.isShowing)};c.show=function(a){c.isShowing=_.isUndefined(a)?!0:a;b()};c.hide=function(){c.isShowing=!1;b()};a.$on("$destroy",function(){c.hide()})}],controllerAs:"noisyInvalidFieldsCtrl"}}]);n.directive("ngFiltered",["$parse",function(a){return{restrict:"A",scope:!0,controller:["$scope","$attrs",function(c,b){var g=this,d=a(b.ngFiltered),f=a(b.ngFilteredObjects),h;b.ngFilteredSearchDocument&&(h=a(b.ngFilteredSearchDocument));g.getObjects=function(){var a=f(c);if(!g.searchTerm)return a;var b;return _.filter(a,
function(a){b=h?h(c,{$obj:a}):a;return _.contains(b.toLowerCase(),g.searchTerm.toLowerCase())})};c.$watch(d,function(a){g.searchTerm=a;g.objects=g.getObjects()})}],controllerAs:"filteredCtrl"}}]);n.directive("ngNegateCheckbox",[function(){return{require:"ngModel",link:function(a,c,b,g){g.$parsers.push(function(a){return!a});g.$formatters.push(function(a){return!a})}}}]);n.directive("ngShortcutsOverlay",[function(){return{templateUrl:"lib.shortcutsOverlay"}}]);n.directive("ngSvg",[function(){return{compile:function(a,
c){var b=document.getElementById(c.ngSvg);b?a[0].appendChild(b.cloneNode(!0)):console.warn("ng-svg: unable to find svg:",c.ngSvg)}}}]);n.directive("ngHoursBeforeMidnight",["$parse",function(a){return{templateUrl:"ng-hours-before-midnight",controllerAs:"hoursBeforeMidnightCtrl",controller:["$scope","$attrs",function(c,b){var g=this,d=a(b.ngHoursBeforeMidnight);c.$watch(d,function(a){if(!(_.isUndefined(a)||""===a)){var b=moment().startOf("day").subtract(a,"hours");a=Math.ceil(a/24);var c;0<a?c="before":
0===a?c="day of":(a=-a,c="after");g.time=b;g.days=a;g.before=c}})}]}}])})();
(function(){var n=angular.module("lib.filters",["lib.services"]);n.factory("filterFields",[function(){var c=[void 0,"",null,[],{}],k=function(h){return _.any(c,function(c){return _.isEqual(c,h)})};return{EMPTY_VALUES:c,isEmpty:k,isSet:function(c,d){return k(d)?!k(c):_.isArray(c)&&_.isArray(d)?!_.isEqual(c.sort(),d.sort()):!_.isEqual(c,d)}}}]);n.filter("isNumber",[function(){return _.isNumber}]);n.filter("isBoolean",[function(){return _.isBoolean}]);n.filter("humanize",["convert",function(c){return c.humanize}]);
n.filter("percentage",["localization",function(c){return function(k,h,d,f){_.isUndefined(d)&&(d=1);var m=c.current();if(d)k=k?100*(k/d):0;else return m.formatPercentage(100,0,!h);f?_.isNumber(f)||(f=0):f=4;f=parseFloat(k.toFixed(f));return m.formatPercentage(f,!h)}}]);n.filter("cssPercentage",[function(){return function(c){if(_.isUndefined(c))return"";c=Math.floor(1E4*c)/100;return c+"%"}}]);n.filter("pluralize",[function(){return function(c,k,h){h=h||"s";k=k||"";c=parseInt(c||"0",10);c=isNaN(c)?
0:c;return 1===c?k:h}}]).filter("capitalize",[function(){return function(c){return _.capitalize(c)}}]).filter("lowercase",[function(){return function(c){return c.toLowerCase()}}]).filter("uppercase",[function(){return function(c){return c.toUpperCase()}}]).filter("bracketWrap",[function(){return function(c){return"["+c+"]"}}]).filter("aOrAnBefore",[function(){var c=/[aeiouAEIOU]/;return function(k,h){return(k&&c.test(k.charAt(0))?h?"An":"an":h?"A":"a")+" "+k}}]).filter("css",[function(){return function(c){c=
(c||"").replace(/\s+/g,"-");c=c.replace(/-+/g,"-");c=c.replace(/[^-\w]/g,"");return c.toLowerCase()}}]).filter("addClassIf",[function(){return function(c,k,h){return c?k||"":h||""}}]).filter("addClasses",[function(){return function(c){var k=[];_.forEach(c,function(c,d){c&&k.push(d)});return k.join(" ")}}]).filter("isDefined",[function(){return function(c){return!_.isUndefined(c)}}]).filter("isUndefined",[function(){return function(c){return _.isUndefined(c)}}]).filter("map",[function(){return function(c,
k){return _.map(c,k)}}]).filter("any",[function(){return _.any}]).filter("exclude",[function(){return function(c,k){return _.filter(c,function(c){return!k(c)})}}]).filter("colonless",[function(){var c=/:+\s*$/;return function(k){return(k||"").replace(c,"")}}]).filter("commaSeparated",[function(){return function(c){return!c?"":_.filter(c).join(", ")}}]).filter("replaceAll",[function(){return _.replaceAll}]).filter("ageInYears",[function(){return function(c){return moment().diff(c,"years")}}]);n.factory("localization",
["$browser","$window","auth","convert","db","models","navigation",function(c,k,h,d,f,m,a){var p=f.slipstream("unitsLanguageFormats"),l=f.slipstream("unitsLanguageCodes");k.ldmlnum.round=_.roundHalfToEven;var b=function(a){p[a]||(console.warn("localization: unsupported language",a),a="en-us");var b=p[a],c=_.extend({"export":"MM/YYYY"},b.client.month),e=_.extend({"default":b.client.date.short,"export":"YYYY-MM-DD"},b.client.date);k.ldmlnum.locale.xx=k.ldmlnum.locale(b.groupSymbol,b.decimalSymbol,b.plusSignSymbol,
b.minusSignSymbol);var g=k.ldmlnum(b.decimalPattern,"xx"),d=k.ldmlnum(b.currencyPattern,"xx"),f=RegExp("\\"+b.decimalSymbol+"0+");return{language:a,formatNumber:g,formatCurrency:function(a,b,c){b=b||"";b=d(a).replace("\u00a4\u00a4\u00a4",b).replace("\u00a4\u00a4",b).replace("\u00a4",b);_.isInteger(a)&&c&&(b=b.replace(f,""));return b},formatPercentage:function(a,c){var e=g(a)+b.percentSymbol;c&&(0<a&&-1===e.indexOf(b.plusSignSymbol))&&(e=b.plusSignSymbol+e);return e},PERCENT_SYMBOL:b.percentSymbol,
VALID_DATETIME_FORMATS:"default short shortNoYear dayWithMonthAbbr long longNoYear export input".split(" "),TIME_SEPARATOR:" @ ",HTML_TIME_SEPARATOR:"<br/>@ ",RANGE_SEPARATOR:" - ",HTML_RANGE_SEPARATOR:"<br/>- ",TODAY:"Today",DAY_FORMAT:"dddd",DAYS_FORMATS:{"default":"[[ days ]] [days]"},ALL_DAY_FORMATS:{"default":"[All day]"},MONTH_FORMATS:c,DATE_FORMATS:e}};f=(f.slipstream("acceptLanguage")||"").split(",");f=f.length?_.first(f):"";var g=function(a){if(!a)return"";a=a.toLowerCase().match(/^([a-z]{2}-)?([a-z]{2})$/);
if(!a||3!==a.length)return"";a=a[2];return!a?"":a.toUpperCase()}(f),C="",x={},q=function(a,b,c){c=c||{};c.server&&c.topOfHour&&console.error("localization: unsupported use of `server` and `topOfHour` options in `__getTimeFormat()");var e;c.server?(e="server",c="exact"):(e="client",c=c.topOfHour?"topOfHour":"exact");var g=p[a];if(g){var f=g[e];if(f)if(f=f.time)if(f=f[c]){b=b||g[e].time[c].default;if(g=f.values)return(g=g[d.camelKey(b)])||console.warn("localization: failed to identify time format for:",
a,e,"time",c,"values",b),g;console.warn("localization: failed to identify time format for:",a,e,"time",c,"values")}else console.warn("localization: failed to identify time format for:",a,e,"time",c);else console.warn("localization: failed to identify time format for:",a,e,"time");else console.warn("localization: failed to identify time format for:",a,e)}else console.warn("localization: failed to identify time format for:",a)},n=m.Company,y=function(a,b){b=b||{};b.server&&b.topOfHour&&console.error("localization: unsupported use of `server` and `topOfHour` options in `__fallbackTimeFormat()");
return a===n.TWENTY_FOUR_HOUR_TIME_FORMAT_TYPE?b.server?n.FALLBACK_SERVER_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:b.topOfHour?n.FALLBACK_CLIENT_TOP_OF_HOUR_TWENTY_FOUR_HOUR_TIME_FORMAT:n.FALLBACK_CLIENT_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:b.server?n.FALLBACK_SERVER_EXACT_TWELVE_HOUR_TIME_FORMAT:b.topOfHour?n.FALLBACK_CLIENT_TOP_OF_HOUR_TWELVE_HOUR_TIME_FORMAT:n.FALLBACK_CLIENT_EXACT_TWELVE_HOUR_TIME_FORMAT},D=function(b,c){var e;if(h.currentUser.isAuthenticated){e=h.currentUser.company.isAdmin&&a.currentCompany?
a.currentCompany:h.currentUser.company;var g;g=e.timeFormatType===n.COMPANY_LOCALE_DEFAULT_TIME_FORMAT_TYPE?q(e.language,void 0,c):q(e.language,e.timeFormatType,c);g||(console.warn("localization: falling back for time format type:",e.timeFormatType,c),g=y(e.timeFormatType,c));return g}if(a.currentCompany)return e=a.currentCompany,g=e.anonymousTimeFormatType===n.ANONYMOUS_USER_LOCALE_DEFAULT_TIME_FORMAT_TYPE?q(b,void 0,c):e.anonymousTimeFormatType===n.COMPANY_LOCALE_DEFAULT_TIME_FORMAT_TYPE?q(e.language,
void 0,c):q(e.language,e.anonymousTimeFormatType,c),g||(console.warn("localization: falling back for anonymous time format type:",e.anonymousTimeFormatType,c),g=y(e.anonymousTimeFormatType,c)),g;console.warn("localization: falling back to 12-hour time for an anonymous user with no current company");return n.FALLBACK_CLIENT_EXACT_TWELVE_HOUR_TIME_FORMAT},e=function(a,b){if(_.contains(b,a))return a;var c=a.split("-")[0];if(_.contains(b,c))return c;for(var e=0,g=b.length;e<g;e++){var d=b[e],f=d.split("-")[0];
if(c===f)return d}};return{browser:{ACCEPT_LANGUAGE:f,ACCEPT_LANGUAGE_COUNTRY_CODE:g},setLanguageManuallyForAnonymousUser:function(a,b){var c;a:if(c=e(a,l),!c){if(b&&(c=e(b.language,l)))break a;c="en-us"}p[c]?(console.log("localization: manually setting units language for anonymous user",c,"based on target language",a),C=c):console.warn("localization: unsupported language",c)},current:function(){var a;a=!h.currentUser.isAuthenticated&&C?C:c.cookies()["fh-units-language"]||"en-us";x[a]=x[a]||b(a);
var e=x[a];a={TIME_FORMATS:_.extend({"default":"h:mma","export":"hh:mma"},D(a)),TOP_OF_HOUR_TIME_FORMATS:_.extend({"default":"ha","export":"hh:mma"},D(a,{topOfHour:!0})),SERVER_TIME_FORMAT:D(a,{server:!0})};return _.extend({},e,a)}}}]);n.factory("dates",["$interpolate","localization",function(c,k){var h=k.current,d=function(a,b,g,d){var e=b[g.format]||b["default"];if(!e)return console.warn("dates: invalid date format",g.format,"valid formats",b),"";_.isUndefined(d)||(e=c(e)(d));return!e?"":a.format(e)},
f={format:"short",isRelative:!1,isRelativeTime:!1,isHtml:!1,endAt:null,hideDate:null},m=function(a,b,c,g){return g?b||"":b&&c?b+a+c:b||c},a=function(a,b){if(!moment.isMoment(a)||!moment.isMoment(b))return!1;var c=a.clone().startOf("day"),g=b.clone().startOf("day");return!c.diff(g)},p=function(a){var b=a.clone().startOf("day");return!a.diff(b)},l=function(a){var b=a.clone().startOf("hour");return!a.diff(b)},b=function(a,b){if(b.isRelative&&b.isRelativeTime){var c=moment(),c=a.diff(c,"hours");if(b.isRelative&&
0<=c&&6>c)return a.fromNow()}},g=function(a,c){c=c||f;var g=b(a,c);if(g)return g;if(c.endAt&&p(a)&&p(c.endAt)){g=Math.abs(c.endAt.diff(a,"days"));if(1<g)return d(a,h().DAYS_FORMATS,c,{days:g});if(1===g)return d(a,h().ALL_DAY_FORMATS,c)}return l(a)?d(a,h().TOP_OF_HOUR_TIME_FORMATS,c):d(a,h().TIME_FORMATS,c)},C=function(b,c){c=c||f;return c.isRelative&&a(b,moment())?"Today":d(b,h().DATE_FORMATS,c)},x=function(c,d){d=d||f;if(d.endAt&&p(c)&&p(d.endAt))return C(c,d);var l=C(c,d),k=b(c,d);if(k)return k;
k=_.extend({},d);delete k.endAt;return(k=g(c,k))&&d.isHideDate&&a(c,d.hideDate)?k:m(h().TIME_SEPARATOR,l,k)};return{options:function(a){var b=_.extend({},f);_.contains(a,"short")?console.warn("date: unnecessary short format specifier"):_.find(h().VALID_DATETIME_FORMATS,function(c){if(_.contains(a,c))return b.format=c,!0});b.isRelative=_.contains(a,"relative");b.isRelativeTime=_.contains(a,"relative-time");b.isAlwaysHideDate=_.contains(a,"always-hide-date");b.isHideDate=b.isAlwaysHideDate||_.contains(a,
"hide-date");b.isHtml=_.contains(a,"html");b.is12amPlus1=_.contains(a,"12am+1");_.forEach(a,function(c){moment.isMoment(c)&&(b.endAt?b.isHideDate?b.hideDate=c:console.warn("date: extra moments",a,skipEndAt):b.endAt=c)});return b},isSameDay:a,isMidnight:p,isTopOfHour:l,getMonth:function(a,b){b=b||f;return d(a,h().MONTH_FORMATS,b)},getDay:function(b,c){c=c||f;return c.isRelative&&a(b,moment())?h().TODAY:d(b,h().DAY_FORMAT,c)},getDate:C,getDateRange:function(b,c,g){g=g||f;if(a(b,c))return C(b,g);var d=
g.isHtml?h().HTML_RANGE_SEPARATOR:h().RANGE_SEPARATOR;return m(d,C(b,g),C(c,g))},getTime:g,getRelativeTime:b,getTimeRange:function(a,b,c){c=c||f;var l=c.isHtml?h().HTML_RANGE_SEPARATOR:h().RANGE_SEPARATOR,e=Math.abs(a.diff(b,"days"));if(0===a.diff(b))return g(a,c);if(p(a)&&p(b))return 1<e?d(a,h().DAYS_FORMATS,c,{days:e}):d(a,h().ALL_DAY_FORMATS,c);c=null;return 0===e?m(l,g(a,c),g(b,c)):1===e?m(l,g(a,c),g(b,c)+" (next day)"):m(l,g(a,c),g(b,c)+" ("+e.toString()+" days later)")},getDatetime:x,getDatetimeRange:function(b,
c,d){d=d||f;if(0===b.diff(c))return x(b,d);var l=d.isHtml?h().HTML_RANGE_SEPARATOR:h().RANGE_SEPARATOR;if(p(b)&&p(c))return 1<Math.abs(b.diff(c,"days"))?(c=c.clone(),c.subtract(1,"days"),m(l,C(b,d),C(c,d))):d.isAlwaysHideDate&&a(b,d.hideDate)?g(b,d):C(b,d);var e;if(e=d.is12amPlus1)if(e=p(c)){e=b;var k=c;!moment.isMoment(e)||!moment.isMoment(k)?e=!1:(e=e.clone().startOf("day"),k=k.clone().startOf("day"),e=1===k.diff(e,"days"))}if(a(b,c)||e){c=m(h().RANGE_SEPARATOR,g(b,d),g(c,d));e&&(c+="+1");if(d.isHideDate&&
a(b,d.hideDate))return c;b=C(b,d);d=d.isHtml?h().HTML_TIME_SEPARATOR:h().TIME_SEPARATOR;return m(d,b,c)}d.isHideDate?(e=_.defaults({isHideDate:!1,hideDate:null},d),d=d.isAlwaysHideDate?d:e):d=e=d;return m(l,x(b,d),x(c,e))}}}]);n.filter("dateOffset",["moment",function(c){return function(k,h,d,f){if(!c.isMoment(k))return"";h=h||0;d=d||"minutes";k=k.clone();return f?k.add(h,d):k.subtract(h,d)}}]).filter("dateSubtract",["$filter",function(c){return function(k,h,d){return c("dateOffset")(k,h,d,!1)}}]).filter("dateAdd",
["$filter",function(c){return function(k,h,d){return c("dateOffset")(k,h,d,!0)}}]);n.filter("dateRange",["dates","moment",function(c,k){return function(h){var d=c.options(_.rest(arguments)),f=d.endAt;return!k.isMoment(h)||!k.isMoment(f)?(console.log("dateRange: invalid moments",h,f,d),""):c.getDateRange(h,f,d)}}]).filter("datetimeRange",["dates","moment",function(c,k){return function(h){var d=c.options(_.rest(arguments)),f=d.endAt;return!k.isMoment(h)||!k.isMoment(f)?(console.log("datetimeRange: invalid moments",
h,f,d),""):c.getDatetimeRange(h,f,d)}}]).filter("timeRange",["dates","moment",function(c,k){return function(h){var d=c.options(_.rest(arguments)),f=d.endAt;return!k.isMoment(h)||!k.isMoment(f)?(console.log("timeRange: invalid moments",h,f,d),""):c.getTimeRange(h,f,d)}}]).filter("date",["dates","moment",function(c,k){return function(h){_.isString(h)&&(h=k(h));var d=c.options(_.rest(arguments));return!k.isMoment(h)?(console.log("date: invalid moment",h,d),""):c.getDate(h,d)}}]).filter("day",["dates",
"moment",function(c,k){return function(h){var d=c.options(_.rest(arguments));return!k.isMoment(h)?(console.log("day: invalid moment",h,d),""):c.getDay(h,d)}}]).filter("month",["dates","moment",function(c,k){return function(h){var d=c.options(_.rest(arguments));return!k.isMoment(h)?(console.log("day: invalid moment",h,d),""):c.getMonth(h,d)}}]).filter("datetime",["dates","moment",function(c,k){return function(h){var d=c.options(_.rest(arguments));return!k.isMoment(h)?(console.log("datetime: invalid moment",
h,d),""):c.getDatetime(h,d)}}]).filter("datetimeWithTimezone",["dates","moment",function(c,k){return function(h,d){var f=c.options(_.slice(arguments,2));if(!k.isMoment(h))return console.log("datetimeWithTimezone: invalid moment",h,d,f),"";if(!_.isString(d))return console.log("datetimeWithTimezone: invalid timezone",h,d,f),"";var m=k.tz(h.valueOf(),d);return c.getDatetime(m,f)}}]).filter("timeWithTimezone",["dates","moment",function(c,k){return function(h,d){var f=c.options(_.slice(arguments,2));if(!_.isString(d))return console.log("timeWithTimezone: invalid timezone",
h,d,f),"";var m=k.tz(h.valueOf(),d);return c.getTime(m,f)}}]).filter("dateWithTimezone",["dates","moment",function(c,k){return function(h,d){var f=c.options(_.slice(arguments,2));if(!k.isMoment(h))return console.log("dateWithTimezone: invalid moment",h,d,f),"";var m=k.tz(h.valueOf(),d);return c.getDate(m,f)}}]).filter("time",["dates","moment",function(c,k){return function(h){var d=c.options(_.rest(arguments));return!h||_.isString(h)&&(h=k(h,"HH:mm"),!k.isMoment(h))?"":c.getTime(h,d)}}]);n.filter("range",
[function(){return function(c,k){return _.range(c,k)}}]);n.filter("safeHtml",[function(){return function(c){return c.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")}}]);n.filter("firstLineOfMarkdown",[function(){var c=/^\s*$/,k=/^#+/,h=/([*_]{1,3})(\S.*?\S?)\1/;return function(d){if(!d)return"";d=_.find(d.split("\n"),function(d){return!c.test(d)})||"";return _.trim(d.replace(k,"").replace(h,"$2").replace(h,"$2"))}}]);n.filter("encodeURIComponent",[function(){return function(c){return encodeURIComponent(c)}}]);
n.filter("hostname",[function(){return function(c){if(!c)return"";var k=c.toLowerCase(),h=document.createElement("a");h.setAttribute("href",k);h=h.hostname;return!h||-1===k.indexOf(h)?c:h=h.replace(/^www./,"")}}]);n.filter("withLineBreaks",[function(){return function(c){return c.replace(/\n+/g,"\n<br />\n")}}]);n.factory("phoneNumbers",[function(){var c=_.toTrueKeys([201,202,203,205,206,207,208,209,210,212,213,214,215,216,217,218,219,220,224,225,227,228,229,231,234,239,240,248,251,252,253,254,256,
260,262,267,269,270,272,274,276,278,281,283,301,302,303,304,305,307,308,309,310,312,313,314,315,316,317,318,319,320,321,323,325,327,330,331,334,336,337,339,341,346,347,351,352,360,361,364,369,380,385,386,401,402,404,405,406,407,408,409,410,412,413,414,415,417,419,423,424,425,430,432,434,435,440,442,443,447,458,464,469,470,475,478,479,480,484,501,502,503,504,505,507,508,509,510,512,513,515,516,517,518,520,530,531,534,539,540,541,551,557,559,561,562,563,564,567,570,571,573,574,575,580,582,585,586,601,
602,603,605,606,607,608,609,610,612,614,615,616,617,618,619,620,623,626,627,628,629,630,631,636,641,646,650,651,657,659,660,661,662,667,669,678,679,681,682,689,701,702,703,704,706,707,708,712,713,714,715,716,717,718,719,720,724,725,727,730,731,732,734,737,740,743,747,754,757,760,762,763,764,765,769,770,772,773,774,775,779,781,785,786,801,802,803,804,805,806,808,810,812,813,814,815,816,817,818,828,830,831,832,843,845,847,848,850,854,856,857,858,859,860,862,863,864,865,870,872,878,901,903,904,906,907,
908,909,910,912,913,914,915,916,917,918,919,920,925,927,928,929,930,931,934,935,936,937,938,940,941,947,949,951,952,954,956,959,970,971,972,973,975,978,979,980,984,985,989]),k=function(c){return c?c.replace(/\D/g,""):""},h=function(c){return!c?"":("+"===c[0]?"+":"")+k(c)},d=/^\+?\d{5,15}$/,f=function(d){d=k(d);11===d.length&&"1"===d[0]&&(d=d.slice(1));if(10===d.length){var a=d.slice(0,3);if(c[a])return{isUsPhoneNumber:!0,areaCode:a,exchange:d.slice(3,6),suffix:d.slice(6,10)}}return{isUsPhoneNumber:!1}};
return{cleanPhoneNumber:h,digits:k,isPossiblyValid:function(c){return d.test(h(c))},parseUsPhoneNumber:f,formatUsPhoneNumber:function(c){c=c||"";if("+"===c[0])return c;var a=f(c);return!a.isUsPhoneNumber?c:"("+a.areaCode+") "+a.exchange+"-"+a.suffix}}}]);n.filter("phone",["navigation","phoneNumbers",function(c,k){return function(c){return k.formatUsPhoneNumber(c)}}]);n.filter("contactPhone",["navigation",function(c){return function(k){var h=c.currentCompany,h=h.country||h.processorCountry;return!k.phoneCountry||
k.phoneCountry===h?k.displayPhoneNational:k.displayPhoneInternational}}]);n.filter("currencyClass",[function(){return function(c){return(c=_.resolveCurrency(c))?"currency--"+c:""}}]);n.filter("currencySymbol",["auth","db","localization",function(c,k,h){var d=k.slipstream("currencies");return function(f,k){f=_.resolveCurrency(f);var a=d[f];if(!a)return console.warn("currencySymbol filter: unsupported currency",f),"";c.currentUser.isAuthenticated&&c.currentUser.company.isAdmin&&(k="long");if("short"===
k)return a.symbol;if("long"===k)return a.symbolLong;var p=a.symbolLongByLanguage;return(p?p[h.current().language]:"")||a.symbolLong}}]);n.filter("currencyDisplayName",["db","localization",function(c,k){var h=c.slipstream("currencies");return function(c,f){c=_.resolveCurrency(c);var k=h[c];return!k?(console.warn("currencyDisplayName filter: unsupported currency",c),""):"short"==f?k.displayName:k.displayNameLong}}]);n.filter("amount",["$filter","db","localization","navigation",function(c,k,h,d){var f=
k.slipstream("currencies"),m=c("currencySymbol");return function(a,c,l,b){if(!_.isNumber(a))return"";_.isBoolean(c)&&_.isUndefined(b)&&(b=!l,l=c,c=null);c=_.resolveCurrency(c);c||(d.currentCompany?(console.warn("amount filter: not passed currency, falling back to currentCompany"),c=d.currentCompany.processorCurrency):(console.warn("amount filter: not passed currency, no currentCompany to fall back to"),c="",b=!1));_.isUndefined(b)&&(b=!0);var g=h.current(),k=f[c];k?k=k.decimalPlaces:(console.warn("amount filter: passed unsupported currency:",
c),b=!1,k=2);a/=Math.pow(10,k);c=b?m(c,b):"";return g.formatCurrency(a,c,l)}}]);n.filter("count",["localization",function(c){return function(k,h){if(null===k||void 0===k)return"";Math.round(k)!==k&&(k=parseFloat(k.toFixed(h||4)));return c.current().formatNumber(k)}}]);n.filter("stripNewlines",[function(){return function(c){return c.replace(/\r|\n/g,"").replace(/\s+/g," ")}}]);n.filter("yesno",[function(){return function(c,k,h){k=_.isUndefined(k)?"Yes":k;h=_.isUndefined(h)?"No":h;return c?k:h}}]);
n.filter("name",[function(){return function(c,k,h){k=k||"";return _.isString(c)?c||k:_.isObject(c)?(c.shortName||c.name||c.unicode||k)+(c.isArchived&&!h?" ("+T("archived")+")":""):k}}]);n.filter("value",[function(){return function(c){return _.isString(c)?c:c.value}}]);n.filter("personalizeCompanyName",["auth",function(c){return function(k,h,d){return!c.currentUser||c.currentUser.company!==k?d?h?"Them":"them":k.name:h?"You":"you"}}]);n.filter("lastNameFirst",[function(){return function(c){c=c.split(/\s+/);
var k=c.pop();c.length&&(k+=",");c.unshift(k);return c.join(" ")}}]);n.filter("initials",[function(){return function(c){c=c.split(/\s+/);return 1<c.length?c[0][0]+c[c.length-1][0]:c[0][0]||""}}]);n.filter("onlineStatusClass",[function(){return function(c){return!c?"":c.isBookableOnlyByPhone?"icon-ava-phone":c.isBookable&&c.isUnlisted?"icon-ava-unlisted":!c.isBookable&&(c.isResourcesAvailable||c.item.company.companyFeatures.isResourceBookableCapacityEnabled)?"icon-ava-lock":""}}]);n.filter("capacityIndicatorClass",
[function(){return function(c){var k=_.contains(arguments,"filled"),h=_.contains(arguments,"large")?"icon-user":"icon-user-small";return c.companyFeatures.isResourceBookableCapacityEnabled?k?"cb-square filled":"cb-square":k?h+" full":h+" empty"}}]);n.filter("blockedCapacityClass",[function(){return function(c,k){return 0===c?"ava-is-empty":c===k?"ava-is-full":c>k?"ava-is-overbooked":"ava-is-booked"}}]);n.filter("capacityClass",["models",function(c){return function(k,h,d){var f=k.customerCount,m=k.capacity;
_.isUndefined(h)||(f=h);var a;_.isUndefined(d)&&(d=!0);if(k.cls===c.ItemGroup.cls)return 0<(k.bookingCount||0)?"ava-is-booked":"ava-is-empty";k.cls===c.Block.cls&&(a=k.reservedCapacity-f);k.cls===c.CustomerTypeRate.cls&&(a=m-f);if(k.cls===c.Availability.cls){a=d?"bookableCapacity":"blocksIncludedBookableCapacity";d=d?"nonResourceBookableCapacity":"blocksIncludedNonResourceBookableCapacity";if(!f)return"ava-is-empty";if(k.company.companyFeatures.isResourceBookableCapacityEnabled){a=k[a];if(_.isUndefined(a))return console.log("capacityClass: no capacity information for object",
k.uri),"ava-is-empty";if(k.isOverusingResources||0>k[d])return"ava-is-overbooked"}else{a=k[d];if(_.isUndefined(a))return console.log("capacityClass: no capacity information for object",k.uri),"ava-is-empty";null!==a&&(a+=k.customerCount-f)}}return 0>=f?"ava-is-empty":0>a?"ava-is-overbooked":0===a?"ava-is-full":null===a||0<a?"ava-is-booked":"ava-is-empty"}}]);n.filter("liveCapacityClass",["models",function(c){return function(c,h){if(!c||c.$fresh)return"ava-is-empty";var d=h.bookCountsCtrl.availabilityCustomerCount;
if(!d)return"ava-is-empty";if(0===h.bookCountsCtrl.customerCount&&(h.availability.isOverbooked||h.availability.isOverusingResources)||c.isOverbookingAvailability||c.isOverusingResources)return"ava-is-overbooked";if(0===c.availabilityLiveBookableCapacity)return"ava-is-full";if(0<d&&(null===c.availabilityLiveBookableCapacity||0<c.availabilityLiveBookableCapacity))return"ava-is-booked";console.log("liveCapacityClass: no capacity information.",c,d);return"ava-is-empty"}}]);n.filter("availableClass",[function(){return function(c,
k){var h=c.capacity-c.customerCount;_.isUndefined(k)||(h=k);return 0>=h?"ava-is-unbookable":"ava-is-bookable"}}]);n.filter("hasCustomersClass",[function(){return function(c){return 0<c.customerCount?"ava-is-booked":"ava-is-empty"}}]);n.filter("abs",[function(){return function(c){return Math.abs(c||0)}}]);n.filter("isAllDay",["dates",function(c){return function(k){return!k?(console.warn("isAllDay: invalid range"),!1):!k.startAt||!k.endAt||+k.startAt===+k.endAt?!1:c.isMidnight(k.startAt)&&c.isMidnight(k.endAt)}}]);
n.filter("isMidnight",["dates","moment",function(c,k){return function(h){return!k.isMoment(h)?(console.warn("isMidnight: invalid date",h),!1):c.isMidnight(h)}}]);n.filter("contains",[function(){return function(c,k){return _.contains(c,k)}}]);n.filter("bookingUrl",["auth","navigation","urls",function(c,k,h){return function(d){return c.permissions.can("viewDashboardSection",d.company)?d.$url(h.dashboard.overlay.contact.booking):d.affiliation&&c.permissions.can("viewDashboardSection",d.affiliation.affiliateCompany)?
d.$url(h.dashboard.bookings.contact.affiliateBookingPermalink):d.$url(h.company.item.booking)}}]);n.filter("orderUrl",["auth","navigation","urls",function(c,k,h){return function(d){if(c.permissions.can("viewDashboardSection",d.company))return d.$url(h.dashboard.overlay.contact.order);var f=_.filter(d.allBookings,function(d){return d.affiliation&&c.permissions.can("viewDashboardSection",d.affiliation.affiliateCompany)});return 0<f.length?h.populate(h.dashboard.bookings.contact.affiliateOrderPermalink,
{affiliateShortname:f[0].affiliation.affiliateCompany.shortname,shortname:d.company.shortname,contactPk:d.contact.pk,orderUuid:d.uuid}):d.$url(h.company.order.index)}}]);n.filter("contactUrl",["auth","navigation","urls","require",function(c,k,h,d){return function(d){if(c.permissions.can("viewDashboardSection",d.company))return d.$url(h.dashboard.overlay.contact.index);var k=_.findWhere(c.currentUser.company.partners,{company:d.company});return k&&k.affiliateGroup&&c.permissions.can("viewDashboardSection",
c.currentUser.company)?h.populate(h.dashboard.bookings.contact.affiliateContactPermalink,{affiliateShortname:c.currentUser.company.shortname,shortname:d.company.shortname,contactPk:d.pk}):d.$url(h.company.index)}}]);n.filter("availabilityUrl",["auth","models","urls",function(c,k,h){return function(d){return c.permissions.can("viewDashboardSection",d.item.company)?d.$url(h.dashboard.overlay.availability.index):d.$url(h.company.item.book)}}]);n.filter("itemGroupUrl",["auth","flows","models","urls",
function(c,k,h,d){return function(f,h){var a=c.permissions.can("viewDashboardSection",f.item.company)?d.dashboard.overlay.item.date:d.company.item.date,a=d.populate(a,{shortname:f.item.company.shortname,itemPk:f.item.pk,date:h.format("YYYY-MM-DD")});return a=k.extendWithFlow(a)}}]);n.filter("itemUrl",["auth","urls",function(c,k){return function(h){return c.permissions.can("viewItemsSection",h.company)?h.$url(k.dashboard.items.item.index):h.$url(k.company.item.index)}}]);n.filter("checkinUrl",["db",
"urls",function(c,k){return function(h){return!h?"":c.slipstream("checkinDomain")+k.populate(k.embeds.checkin.qr,{encodedCustomerPk:h.encodedPk})}}]);n.filter("waiverUrl",[function(){return function(c,k){return c.company.smartwaiverUrl+"?auto_waiverid="+c.waiverUuid+"&auto_tag=fh_id_"+k.pk}}]);n.filter("invoiceUrl",["auth","navigation","urls",function(c,k,h){return function(d,f){f=f||"index";var k;k=c.permissions.can("viewDashboardSection",d.company)?h.dashboard.reports.invoices.invoice[f]:d.affiliation&&
c.permissions.can("viewDashboardSection",d.affiliation.affiliateCompany)?h.dashboard.reports.invoices.partnerInvoice[f]:h.company.invoice.index;if(!k)throw Error("invoiceUrl: invalid view "+f);return d.$url(k)}}]);n.filter("uploadUrl",["navigation","urls",function(c,k){return function(h){return k.populate(k.dashboard.reports.accounts.upload,{shortname:c.currentCompany.shortname,uploadPk:h.pk})}}]);n.filter("companyDefaultIntegrationsUrl",["navigation","urls","auth","models",function(c,k,h,d){return function(c){var m=
{shortname:c.shortname};return h.permissions.canList(d.ResellerCompany,c)?c.isAdmin?k.populate(k.dashboard.settings.reseller.apps.index,m):k.populate(k.dashboard.settings.reseller.index,m):k.populate(k.dashboard.settings.integrations.subscribe,m)}}]);n.filter("key",[function(){return function(c){return c.cls+"."+c.pk}}]);n.filter("summary",[function(){return function(c,k,h){return _.reduce(c,function(c,f){return c+(_.getDotted(f,k)||0)},h||0)}}]);n.filter("uniqueCount",["$filter",function(c){var k=
c("pluralize");return function(c,d,f,m){var a={};_.forEach(c,function(c){c=_.get(c,d);_.isObject(c)&&c.uri&&(c=c.uri);a[c]=1});c=_.sum(a);return f||m?c.toString()+" "+k(c,f,m):c}}]);n.filter("uncamel",[function(){var c=/([a-z])([A-Z])/g,k=function(c,d,f){return d+" "+f};return function(h){return h.replace(c,k)}}]);n.filter("activityChange",["$filter","models",function(c,k){var h=c("amount"),d=c("percentage"),f=function(a){moment.isMoment(a)||(a=moment.parseZone(a));return a},m={AmountField:h,PositiveAmountField:h,
PercentField:d,PositivePercentField:d,DateTimeField:function(a){return c("datetime")(f(a))},DateField:function(a){return c("date")(f(a))},ColumnWidthField:function(a){return k.FlowNode.WIDTH_LABELS[a]||a}};return function(a,d){var f=m[d];return f?f(a):_.isObject(a)?c("name")(a):a}}]);n.filter("defaultIfUndefined",[function(){return function(c,k){return _.isUndefined(c)?k:c}}]);n.filter("fieldOrBoolean",["$filter",function(c){return function(k){return!0===k?"is set":!1===k?"is empty":_.isObject(k)?
c("name")(k):k}}]);n.filter("names",["$filter",function(c){return function(k){return _.map(k,c("name")).join(", ")}}]);n.filter("isEmptyFilter",["filterFields",function(c){return function(k){return _.any(c.EMPTY_VALUES,function(c){return _.isEqual(c,k)})}}]);n.filter("defaults",[function(){return _.defaults}]);n.filter("parsePresetDateRange",["dateUtils",function(c){return function(k,h){return c.dateRange(k,h)}}]);n.filter("colorClass",["models",function(c){return function(k,h,d){h=h||"";d=d||"";
if(!k)return d;k.cls===c.Booking.cls?k=k.availability.item:k.item&&(k=k.item);k.color&&(k=k.color);if(!k||!_.isNumber(k))return d;if(!c.Item.isValidColor(k))return console.warn("colorClass filter: unsupported color:",k),d;h&&"-"!==h.charAt(0)&&(h=" "+h);return"color-"+k+h}}]);n.filter("approximate",["$filter",function(c){return function(k,h){var d,f=1,m=h?"+":"";if(1E3<=k)d=100,f=1E3,m="k"+m;else if(100<=k)d=100;else if(10<=k)d=10;else return k;return c("count")((k-k%d)/f,1)+m}}])})();
(function(){var n=angular.module("lib.services",["flash.services","lib.factories","lib.filters","lib.models","lib.processors"]);n.factory("sessionStorage",[function(){var c=function(){var c={};return{get:function(d){d=c[d];if(!_.isUndefined(d))return _.parseJSON(d)},set:function(d,f){c[d]=_.stringifyJSON(f)},del:function(d){delete c[d]},clear:function(){c={}}}},k=c();k.create=c;return k}]);n.factory("storage",["$window","sessionStorage",function(c,k){var h;try{window.localStorage.setItem("$test",
"$test"),window.localStorage.removeItem("$test"),h=!0}catch(d){h=!1}var f;h?(f={key:function(d){try{return c.localStorage.key(d)}catch(a){}},get:function(d){try{var a=c.localStorage.getItem(d);if(_.isString(a))return _.parseJSON(a)}catch(f){}},set:function(d,a){try{c.localStorage.setItem(d,_.stringifyJSON(a))}catch(f){}},del:function(d){try{c.localStorage.removeItem(d)}catch(a){}},clear:function(){try{c.localStorage.clear()}catch(d){}}},Object.defineProperty(f,"length",{get:function(){try{return c.localStorage.length}catch(d){return 0}},
configurable:!1,enumerable:!1})):f=k.create();f.isPersistent=function(){return h};return f}]);n.factory("persistentStorage",["$q","$rootScope","clientOptions","db","events","navigation","require","storage",function(c,k,h,d,f,m,a,p){_.isValidUuid(h.userIdentifier)||(c=p.get("persistentStorageIdentifier"),h.userIdentifier=_.isValidUuid(c)?c:_.uuid());p.set("persistentStorageIdentifier",h.userIdentifier);var l=h.userIdentifier;console.log("persistentStorage: identified user:",h.userIdentifier);var b=
function(b){a.notNull(m.currentCompany,"shortname","persistentStorage needs currentCompany");var c={identifier:h.userIdentifier,shortname:m.currentCompany.shortname};b&&(c.key=b);return c},g={getIdentifier:function(){return h.userIdentifier},setIdentifier:function(a){p.set("persistentStorageIdentifier",a);h.userIdentifier=a;console.log("persistentStorage: re-identified user:",a);f.broadcast("persistentStorage.reIdentifiedUser")},restoreIdentifier:function(){g.setIdentifier(l)},regenerateIdentifier:function(){g.setIdentifier(_.uuid())},
get:function(a){a=b(a);var c=d.persistentStoreItem(a);return c.$promise.then(function(a){return c})},set:function(a,c){var g=b(a),f=d.persistentStoreItem.update(g,c);return f.$promise.then(function(){return f})},del:function(a){a=b(a);return d.persistentStoreItem.remove(a).$promise},clear:function(){var a=b();return d.persistentStoreForCompany.remove(a).$promise},getForAllCompanies:function(a){var b=d.persistentStore({identifier:h.userIdentifier});return b.$promise.then(function(){var c={};_.forEach(b,
function(b){c[b.company.shortname]={company:b.company};c[b.company.shortname][a]=b[a]});return c})}};f.on(k,"auth.logout",g.regenerateIdentifier);f.on(k,"auth.login",g.regenerateIdentifier);return g}]);n.factory("translate",["$rootScope","$window","db",function(c,k,h){var d,f=function(a){0>=a?console.warn("translate: failed to load Google Translate"):!k.google||!k.google.translate||!k.google.translate.TranslateElement?(console.info("translate: not yet loaded, retrying..."),setTimeout(_.bind(f,_,a-
1),1E3)):(console.info("translate: loaded"),c.$apply(function(){m.isReady=!0}))},m={isReady:!1,initialize:function(a){m.isReady?d?a.append(d):(d=$('<div id="google-translate"></div>'),a.append(d),new k.google.translate.TranslateElement({pageLanguage:"en"},d[0])):console.warn("translate: attempting to initialize before load")}};h.slipstream("isAnonymous")&&f(3);return m}]);n.factory("postBook",["$filter","auth","navigation","require",function(c,k,h,d){return{startBooking:function(c){console.log("postBook: start booking",
c);k.sessionStorage.set("postBook.path",c)},stopBooking:function(f){d.assert(f,"postBook: expected booking");var m=c("bookingUrl")(f),a=k.sessionStorage.get("postBook.path");k.sessionStorage.del("postBook.path");console.log("postBook: stop booking",f,m,a);if(!a)return m;f=h.parseMultiUrl(m);if(!f||0!==a.indexOf(f.path))return m;m={};m[f.key]=f.multiPath;_.extend(m,f.search);return h.extendQuery(a,m)}}}]);n.constant("Showdown",window.Showdown);n.constant("Mailcheck",window.Mailcheck);n.constant("moment",
window.moment);n.constant("Pikaday",window.Pikaday);n.constant("QRCode",window.QRCode);n.factory("filepicker",function(){return window.filepicker||null});n.factory("d3",function(){return window.d3});n.factory("Raven",function(){return window.Raven||{}});n.factory("diff",function(){return window.JsDiff});n.factory("exporter",["$q","$rootScope","$timeout","$window","filepicker",function(c,k,h,d,f){var m=document.createElement("a"),a="download"in m&&"Blob"in window,p=function(a,b,d){var l=c.defer();
f.store(a,{filename:b,mimetype:d},function(a){k.$safeApply(function(){l.resolve(a.url)})},function(){k.$safeApply(function(){l.reject()})});return l.promise},l=function(b,l,k){k=k||{};var q=c.defer();if(a)h(function(){var a=new Blob([b],{type:k.mediaType}),a=URL.createObjectURL(a);m.setAttribute("href",a);m.setAttribute("download",l);document.body.appendChild(m);m.click();document.body.removeChild(m);q.resolve()},0,!1);else if(k.openWindow){var n=encodeURIComponent(b);window.open("data:"+k.mediaType+
";charset=utf-8,"+n);q.resolve()}else{if(!f||f._queue)return q.reject(),q.promise;p(b,l,"application/octet-stream").then(function(a){d.location.href=a;q.resolve()},function(){q.reject()})}return q.promise},b=function(a){var b="\ufeff";_.forEach(a,function(a){a=_.map(a,function(a){_.isUndefined(a)?a="":_.isString(a)&&(a=a.replace(/^\s+|\s+$/g,""),a=a.replace(/\s+/g," "),a=a.replace(/,$/,""),a=a.replace(/"/g,'""'),a='"'+a+'"');return a});b+=a.join(",")+"\n"});return b};return{exportToCsvFile:function(a,
c,d){d=d||{};d.mediaType="text/csv";a=b(a);return l(a,c,d)},isDownloadSupported:a}}]);n.factory("xmessage",["$window","db",function(c,k){return{broadcast:function(h,d,f){h={type:h};_.extend(h,d);f=f||"*";d="";try{d=_.stringifyJSON(h),k.slipstream("isDebug")&&console.info("xmessage: broadcast",d),c.parent.postMessage(d,f)}catch(m){console.error("xmessage: unable to broadcast",d)}},on:function(h,d,f,m){m=m||"*";var a=function(a){try{var b=_.parseJSON(a.data);_.isObject(b)&&(k.slipstream("isDebug")&&
console.info("xmessage: on",b),d&&b.type===d&&("*"!==m&&(!m||m!==b.origin)||f(b.data)))}catch(c){}};c.addEventListener("message",a);var p=function(){c.removeEventListener("message",a)};h.$on("$destroy",function(){p()});return p}}}]);n.factory("events",["$rootScope",function(c){return{on:function(c,h,d){return c.$on(h,d)},broadcast:function(){c.$broadcast.apply(c,arguments)}}}]);n.factory("require",function(){var c=function(c,h){c="require: "+c;return h?c+" ("+h+")":c};return{assert:function(k,h){if(!k)throw Error(c("expected '"+
k+"' to be true",h));},assertDefined:function(k,h){if(_.isUndefined(k))throw Error(c("expected '"+k+"' to be defined",h));},notNull:function(k,h,d){if(null===k[h])throw Error(c("expected '"+h+"' not to be null",d));},defined:function(k,h,d){if(_.isUndefined(k[h]))throw Error(c("expected '"+h+"' to be defined",d));},unDefined:function(k,h,d){if(!_.isUndefined(k[h]))throw Error(c("expected '"+h+"' to be undefined",d));},inScope:function(k,h,d){if(_.isUndefined(_.getDotted(k,h)))throw Error(c("expected '"+
h+"' to be in scope",d));},notInScope:function(k,h,d){if(!_.isUndefined(k[h]))throw Error(c("expected '"+h+"' not to be in scope",d));}}});n.provider("convert",["moment",function(c){var k=/_([a-z0-9])/g,h=function(a){a=a||"";return"/"===a[0]?a:a.replace(k,function(a,b){return b.toUpperCase()})},d=function(a,b){if(!a)return null;var d=c(a,"YYYY-MM-DDTHH:mm:ssZZ",!0);if(d.isValid())return d;d=c(a,"YYYY-MM-DDTHH:mm:ss",!0);if(d.isValid())return d;d=c(a,"YYYY-MM-DD",!0);if(d.isValid())return d;throw Error("convert: invalid date "+
b+": "+a);},f=/_at$/,m=function(a){if(_.isArray(a))for(var b=0,c=a.length;b<c;b++)m(a[b]);else if(_.isObject(a))for(b in a)if(a.hasOwnProperty(b)){c=a[b];delete a[b];var g=h(b);f.test(b)||"at"===b?a[g]=d(c,g):a[g]=m(c)}return a},a=function(a,b,c){return b+"_"+c.toLowerCase()},p=/([a-z])([A-Z0-9])/g,l=/([0-9])([a-zA-Z])/g,b=function(b){b=b.replace(p,a);return b.replace(l,a)},g=function(a){var d,f;if(c.isMoment(a))d=a.format();else{if(_.isDate(a))throw Error("convert: expected moment, not date "+a);
if(_.isArray(a)){d=[];f=0;for(var l=a.length;f<l;f++)d.push(g(a[f]))}else if(_.isObject(a))for(l in d={},a)l&&(a.hasOwnProperty(l)&&"$"!==l[0])&&(f=b(l),d[f]=g(a[l]));else d=a}return d},n=function(a,b,c){return b+" "+c},x=function(a,b){a=a.toString();a=a.replace(p,n);a=a.replace(l,n);a=a.replace(/-/g," ");return _[b?"titleize":"capitalize"](a.toLowerCase())};this.serverResponse=m;this.clientRequest=g;this.$get=function(){return{serverResponse:m,clientRequest:g,camelKey:h,unCamelKey:b,humanize:x}}}]);
n.factory("shortcutsOverlay",["$rootScope","auth","db","events",function(c,k,h,d){var f={isShowing:!1,shouldConfirmClose:!1,show:function(){f.isShowing=!0},hide:function(){f.isShowing=!1},confirmClose:function(a){f.shouldConfirmClose=a}},m;d.on(c,"navigation.company.updated",function(a,c){if(!h.slipstream("isDebug")){var d=c.company;d&&m!==d&&(m=d,d.adminNotes&&k.permissions.canAdminUpdate(d)&&f.show())}});return f}]);n.factory("shortcuts",["$document","auth","d",function(c,k,h){var d=[],f={"delete":8,
tab:9,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},m=function(a,c){for(var d=a.length,l=0;l<d;l++)f[a[l]]=c+l};m("1234567890",49);m("abcdefghijklmnopqrstuvwxyz",65);var a={};_.forEach(f,function(b,c){a[b]=c});var p={shift:"shift",ctrl:"ctrl",meta:"meta",alt:"alt"},l=function(a){a=a.split("+");var c={};_.forEach(p,function(a){c[a]=!1});_.forEach(a,function(a){var b=p[a];b?c[b]=
!0:c.keyCode=f[a]});return c};c.on("keydown",function(b){if(k.currentUser.isAuthenticated){var c=$(b.target);if(!h.isTextInput(c)&&!c.is(".js-disable-shortcuts, select")){c={};c.keyCode=f[a[b.which]];c.meta=b.metaKey||!1;c.alt=b.altKey||!1;c.ctrl=b.ctrlKey||!1;c.shift=b.shiftKey||!1;for(var l,m=d.length-1;0<=m;m--)if(l=d[m],c&&l.keys&&c.keyCode===l.keys.keyCode&&c.ctrl===l.keys.ctrl&&c.alt===l.keys.alt&&c.meta===l.keys.meta&&c.shift===l.keys.shift){b.preventDefault();l.action();break}}}});return{shortcuts:d,
register:function(a){a.keys=l(a.keySet);if(a.keys)return d.push(a),a},unregister:function(a){_.overwriteWithout(d,a)}}}]);n.factory("toggles",["$document","$rootScope",function(c,k){$("html").on("click",function(d){var f=$(d.target);f.closest("[ng-toggle], [ng-toggled], [ng-toggled-show]").length||$.contains(c[0].documentElement,d.target)&&(f.closest(".select2-container").length||k.$apply(function(){_.forEach(h.toggles,function(c,a){if(c.autoClose&&(!c.group||c.isCloseableGroup))c.state=!1})}))});
var h={toggles:{},create:function(c,f){var m=h.toggles[c];m?(m.state=f.defaultState||m.state||!1,m.count+=1):(m={autoClose:f.autoClose||!1,state:f.defaultState||!1,group:f.group||null,isCloseableGroup:f.isCloseableGroup||!1,when:f.when||_.always,count:1},h.toggles[c]=m,m.group&&(m.deregisterGroupWatch=k.$watch(function(){return m.state},function(a){a&&_.forEach(h.toggles,function(a,c){m!==a&&m.group===a.group&&(a.state=!1)})})))},destroy:function(c){var f=h.toggles[c];f?(f.count-=1,f.count||(f.deregisterGroupWatch&&
f.deregisterGroupWatch(),delete h.toggles[c])):console.warn("invalid toggle",c)},toggle:function(c,f){var k=h.toggles[c];k?k.when()?(f=_.isUndefined(f)?!k.state:!!f,k.state=k.group?k.isCloseableGroup?f:!0:f):console.info("toggles: disabled toggle",c):console.warn("toggles: invalid toggle",c)},state:function(c){c=h.toggles[c];return!c?!1:c.state},closeAll:function(){_.forEach(h.toggles,function(c){c.state=!1})}};return h}]);angular.module("lib.services.interpolate",[]).provider("$interpolate",[function(){var c=
"{{",k="}}",h="{!",d="!}";this.startSymbol=function(d){return d?(c=d,this):c};this.endSymbol=function(c){return c?(k=c,this):k};this.staticStartSymbol=function(c){return c?(h=c,this):h};this.staticEndSymbol=function(c){return c?(d=c,this):d};this.$get=["$parse","$exceptionHandler","$sce",function(f,m,a){var p=c.length,l=k.length,b=h.length,g=d.length;m=function(m,n,q){for(var B,y,D=0,e=[],F=m.length,G=!1,A,v,s,z,u=[];D<F;)-1!=(B=m.indexOf(c,D))&&-1!=(y=m.indexOf(k,B+p))?(D!=B&&e.push(m.substring(D,
B)),e.push({fn:f(A=m.substring(B+p,y)),exp:A,"static":!1}),D=y+l,G=!0):-1!=(B=m.indexOf(h,D))&&-1!=(y=m.indexOf(d,B+b))?(D!=B&&e.push(m.substring(D,B)),e.push({fn:f(A=m.substring(B+b,y)),exp:A,"static":!0}),D=y+g,G=!0):(D!=F&&e.push(m.substring(D)),D=F);if(!(F=e.length))e.push(""),F=1;if(q&&1<e.length)throw Error("$interpolate: error while interpolating: SCE violation");if(!n||G)return u.length=F,z=function(b){if("undefined"!==typeof z.value)return z.value;try{for(var c=0,d=0,g=F,f;d<g;d++)f=e[d],
"object"===typeof f?(v=f.fn(b),v=q?a.getTrusted(q,v):a.valueOf(v),s=typeof v,null===v||"undefined"===s?v="":"number"===s?v=""+v:"string"!==s&&(v=angular.toJson(v)),f.static?e[d]=v:c++):v=f,u[d]=v;var l=u.join("");c||(z.value=l);return l}catch(h){console.error("unable to interpolate",m,"error",h)}},z.exp=m,z.parts=e,z};m.startSymbol=function(){return c};m.endSymbol=function(){return k};m.staticStartSymbol=function(){return h};m.staticEndSymbol=function(){return d};return m}]}]);n.factory("selectedItems",
["navigation",function(c){return{extendUrl:function(k,h){if(h.length){var d={"selected-items":_.pluck(h,"pk").join(",")};return c.compose(k,d)}return k}}}]);n.factory("parseAttrsForScope",["$parse",function(c){return function(k,h,d,f){var m={},a=_.isString(f)?function(a){return f+_.capitalize(a.slice(0,1))+a.slice(1)}:function(a){return a};_.forEach(d,function(d,f){var b=a(f);"@"===d?m[f]=k[b]:"="===d?m[f]=h.$eval(k[b]):"&"===d&&(m[f]=c(k[b]).bind(null,h))});return m}}]);n.factory("tableHeaders",
["$parse",function(c){return{parsePredicate:function(k,h,d,f){f=f||"$row";var m=_.choose(h.split(";"),function(a){if(a)return c(a)}),m=_.map(m,function(a,c){return function(c){var b={};b[f]=c;b=a(k,b);moment.isMoment(b)&&(b=b.unix());return _.isUndefined(b)?(console.warn("ng-table-header: predicate returned undefined",h,c),0):b}});1===m.length&&(m=m[0]);m.source=h;m.isDefault=d||!1;return m}}}]);n.factory("autoExport",["$filter","$q","$timeout","exporter","flash",function(c,k,h,d,f){var m=c("stripNewlines"),
a=function(a){return a.replace(/\u2011/g,"-")},p=function(a){return _.map(a.contents(),function(a){var b=$(a);if(3===a.nodeType)return b.text();if(b.is(":visible"))return p(b)}).join(" ")},l=function(a){a=!_.isUndefined(a)?a:1;return _.map(_.range(a),_.constant(""))},b=function(a){if(!a||!a.length)console.warn("autoExport: no exports found");else{if(1===a.length)return a[0];var b={rows:a[0].rows,filename:a[0].filename};_.forEach(_.rest(a),function(a){b.rows.push(l());_.ref.append(b.rows,a.rows)});
return b}},g=function(b,c){var d=c?"> .td":"> td",g=[];_.forEach(b.find(c?"> thead > .tr, > .tbody > .tr, > .tfoot > .tr":"> thead > tr, > tbody > tr, > tfoot > tr"),function(b){b=$(b);var c;if(!(c=b.data().ngAutoExportSkip)||!c()){var f=[];_.forEach(b.find(d),function(b){b=$(b);var c=b.data(),e;if(!(e=c.ngAutoExportSkip)||!e()){var d;e=(d=c.ngAutoExportValue)?d():p(b);f.push(a(m(e).trim()));d=(d=b.prop("colspan"))?parseInt(d,10):1;_.ref.append(f,l(d-1))}});g.push(f)}});return{rows:g}},n={},x={status:"ready",
ready:function(){return"ready"===x.status||"error"===x.status},autoExport:function(a,c,l){a=a||"default";c=c||a;if(x.ready()){var m=n[a]||[];if(m.length){var e=function(){x.status="error";f.error("Error exporting "+c)};x.status="processing";h(function(){var a=[];try{var f=[];_.forEach(m,function(b){b.process?(b=b.process(),b=k.when(b),f.push(b),b.then(function(b){b&&a.push({rows:b})})):(b=b.element,b.is("table")||(b=b.find("table")),_.forEach(b,function(b){a.push(g($(b)))}))});k.all(f).then(function(){var g=
b(a);x.status="exporting";d.exportToCsvFile(g.rows,c,l).then(function(){x.status="ready"},e)})}catch(h){e(),console.error("Error exporting",h)}},0,!1)}else console.warn("autoExport: no exports")}else console.warn("autoExport: not ready")},addExport:function(a,b,c){a=a||"default";var d=n[a]=n[a]||[];a={element:b,namespace:a};_.extend(a,c||{});d.push(a);return a},removeExport:function(a){var b=n[a.namespace]=n[a.namespace]||[];_.ref.remove(b,a)},isDownloadSupported:d.isDownloadSupported,canExport:function(a){return n[a]?
0<n[a].length:!1}};return x}]);n.factory("scrollbar",[function(){var c={width:null,getWidth:function(){if(null!==c.width)return c.width;var k=document.createElement("p");k.style.width="100%";k.style.height="200px";var h=document.createElement("div");h.style.position="absolute";h.style.top="0px";h.style.left="0px";h.style.visibility="hidden";h.style.width="200px";h.style.height="150px";h.style.overflow="hidden";h.appendChild(k);document.body.appendChild(h);var d=k.offsetWidth;h.style.overflow="scroll";
k=k.offsetWidth;d==k&&(k=h.clientWidth);document.body.removeChild(h);c.width=Math.max(d-k,0);return c.width}};return c}]);n.factory("dateUtils",["moment","models",function(c,k){var h=/^\d\d:\d\d$/,d=function(a){return _.isUndefined(a)?c():c().tz(a)},f=function(a,b){return function(c){return[d(c).subtract(1,a+"s").startOf(a),b?d(c).subtract(1,a+"s"):d(c).subtract(1,a+"s").endOf(a)]}},m=function(a,b){return function(c){return[d(c).startOf(a),b?d(c):d(c).endOf(a)]}},a=function(a){return function(b){return[d(b).add(1,
a+"s").startOf(a),d(b).add(1,a+"s").endOf(a)]}},p=function(a){return function(b){return[d(b).startOf("day"),d(b).add(a-1,"days").endOf("day")]}},l=function(a){return function(b){return[d(b).subtract(a-1,"days").startOf("day"),d(b).endOf("day")]}},b=k.Report,g={};g[b.TODAY_DATE_RANGE]=m("day");g[b.THIS_WEEK_DATE_RANGE]=m("week");g[b.THIS_WEEK_TO_DATE_DATE_RANGE]=m("week",!0);g[b.THIS_MONTH_DATE_RANGE]=m("month");g[b.THIS_MONTH_TO_DATE_DATE_RANGE]=m("month",!0);g[b.THIS_QUARTER_DATE_RANGE]=m("quarter");
g[b.THIS_QUARTER_TO_DATE_DATE_RANGE]=m("quarter",!0);g[b.THIS_YEAR_DATE_RANGE]=m("year");g[b.THIS_YEAR_TO_DATE_DATE_RANGE]=m("year",!0);g[b.YESTERDAY_DATE_RANGE]=f("day");g[b.LAST_WEEK_DATE_RANGE]=f("week");g[b.LAST_WEEK_TO_DATE_DATE_RANGE]=f("week",!0);g[b.LAST_MONTH_DATE_RANGE]=f("month");g[b.LAST_MONTH_TO_DATE_DATE_RANGE]=f("month",!0);g[b.LAST_QUARTER_DATE_RANGE]=f("quarter");g[b.LAST_QUARTER_TO_DATE_DATE_RANGE]=f("quarter",!0);g[b.LAST_YEAR_DATE_RANGE]=f("year");g[b.LAST_YEAR_TO_DATE_DATE_RANGE]=
f("year",!0);g[b.TOMORROW_DATE_RANGE]=a("day");g[b.NEXT_WEEK_DATE_RANGE]=a("week");g[b.NEXT_MONTH_DATE_RANGE]=a("month");g[b.NEXT_YEAR_DATE_RANGE]=a("year");g[b.LAST_SEVEN_DAYS_DATE_RANGE]=l(7);g[b.LAST_THIRTY_DAYS_DATE_RANGE]=l(30);g[b.NEXT_SEVEN_DAYS_DATE_RANGE]=p(7);g[b.NEXT_THIRTY_DAYS_DATE_RANGE]=p(30);return{DATE_RANGES:g,dateRange:function(a,c){var d=g[a];d||(d=g[b.TODAY_DATE_RANGE]);return d(c)},isInvertedRange:function(a){if(!a[0]||!a[1])return!1;var b=h.test(a[0]),d=b?"HH:mm":null;if(b&&
"00:00"===a[1])return!1;b=c(a[0],d);a=c(a[1],d);return b.isValid()&&a.isValid()&&b>a}}}]);n.factory("searchTerms",[function(){return{}}]);n.factory("flows",["$rootScope","$q","availabilityCalendarController","cache","db","models","navigation","require","urls",function(c,k,h,d,f,m,a,p,l){var b=m.FlowNode,g=a.getPks("selected-items"),n=function(a,c){!a.children.length&&c&&(a.emptyPageChildren=_.map(c,function(c){return{cls:b.cls,uri:"",pk:null,company:a.company,type:b.ITEM_TYPE,parent:a,item:c,properties:{},
unicode:c.unicode}}))},x,q=function(a,b){var c=f.defaultFlowPage({shortname:a});c.$promise.then(function(){b.resolve();B.initialFlowNode=c.flowNode},b.reject)},B={wrapEndpoint:function(a,b){return function(c,d,l,h,k){h=h||{};g.length&&(h.selectedItems=g.join(","));b||(h.isPage=!0);k=k||{};k.ignoreQueryParamsInCacheUri=!0;k.sideKeys=["emptyPageItems"];c=a(c,d,l,h,k);c.$promise.then(function(a){a!==f.CANCELLED&&n(b?a.primaryData.flowNode:a.primaryData,a.emptyPageItems)});return c}},isNoFlow:function(){return B.initialFlowNode===
b.NO_FLOW},currentFlowNodePk:function(){var c=a.get(b.FLOW_QUERY);return"no"===c?!1:c?_.int(c):null},currentFlowNodeUrl:function(a,b){var c=B.currentFlowNodePk();if(!1===c)return null;var d;if(c)return d=b?l.company.flowNode.calendar:l.company.flowNode.index,l.populate(d,{flowNodePk:c,shortname:a.shortname});d=b?l.company.items.calendar:l.company.items.index;return a.$url(d)},currentFlowNodeFromCache:function(a){p.assert(B.initialFlowNode,"flows must be initialized");var b=B.currentFlowNodePk();if(b){a=
{shortname:a,flowNodePk:b};b=l.populate(l.api.flowNode,a);b=d.cache[b];if(!b||!b.breadcrumbs)b=f.flowNode(a);return b}return B.initialFlowNode},initialFlowNode:void 0,initialItemBindings:void 0,initialize:function(c){if(x)return console.log("flows: already initialized"),x;var d=k.defer();x=d.promise;var e=B.currentFlowNodePk();if(!1===e){var g=a.pathStartsWith(l.company.item.index);if(g)return B.initialItemBindings=g,B.initialFlowNode=b.NO_FLOW,d.resolve(),x;a.clear(b.FLOW_QUERY,!0)}if(a.get(b.IS_SUGGESTED_QUERY))g=
[],g.push(f.defaultFlowPage({shortname:c}).$promise),e&&!B.isOnFlowNodePage()&&g.push(f.flowNode({shortname:c,flowNodePk:e}).$promise),k.all(g).then(function(a){B.initialFlowNode=a[0].primaryData.flowNode;d.resolve()},d.reject);else if(e){var h=f.flowNode({shortname:c,flowNodePk:e});h.$promise.then(function(){B.initialFlowNode=h;d.resolve()},function(e){a.clear(b.FLOW_QUERY,!0);q(c,d)})}else q(c,d);return x},initialUrl:function(){p.assert(B.initialFlowNode,"flows must be initialized");return B.initialFlowNode===
b.NO_FLOW?l.populate(l.company.item.index,B.initialItemBindings):B.initialFlowNode.$url(l.company.flowNode.index)},extendWithFlow:function(c){var d=b.FLOW_QUERY,e=a.get(d);if(_.isUndefined(e))return c;var g={};g[d]=e;return a.compose(c,g,!0)},calendarController:function(a,b,c){var d=f.company.calendar,l={shortname:b.company.shortname},k={allowGrouped:"yes"};0<b.childrenCount?k.flow=b.pk:g.length&&(d=f.items.calendar,l.itemPks=g.join(","));return h(a,_.extend({url:c.url,company:b.company,endpoint:d,
params:l,queryParams:k},c))},rootOf:function(a){p.assert(a.breadcrumbs,"expected full cached flowNode");return _.first(a.breadcrumbs)||a},showInitialFlowNodeLink:function(a){return!B.initialFlowNode||B.initialFlowNode===b.NO_FLOW||B.rootOf(B.initialFlowNode)===B.rootOf(a)?!1:!0},isOnInitialFlowNode:function(){p.assert(B.initialFlowNode,"flows must be initialized");var a=B.currentFlowNodePk();return null===a||a===B.initialFlowNode.pk},isOnFlowNodePage:function(){return!(!a.pathEquals(l.company.items.index)&&
!a.pathStartsWith(l.company.items.calendar))},initialFlowNodeUrl:function(){var c={};c[b.IS_SUGGESTED_QUERY]="";return a.compose(B.initialFlowNode.$url(l.company.flowNode.index),c)}};return B}]);n.run(["$rootScope","flows","searchTerms","shortcutsOverlay","toggles","translate",function(c,k,h,d,f,m){c.toggles=f;c.translate=m;c.searchTerms=h;c.shortcutsOverlay=d;c.flows=k}])})();
(function(){var n=angular.module("lib.controllers",["auth.services","db.services","lib.services"]);n.controller("lib.shared.CompanyAdminNotesEditableCtrl",["$scope","auth","controllers","db","models","require","shortcutsOverlay",function(c,k,h,d,f,m,a){m.inScope(c,"company");h.editController(c,{collectionKey:"companies",elementKey:"company",modelKey:"editableCompany",update:d.company.adminNotes.update,editCallback:_.partial(a.confirmClose,!0),cancelCallback:_.partial(a.confirmClose,!1),successCallback:function(){c.editCtrl.editing=
!1;a.confirmClose(!1)},params:function(){return{shortname:c.company.shortname}}})}]);n.controller("lib.shared.NewTransportationCtrl",["$scope","$attrs","$injector","$interpolate","$parse","auth","controllers","convert","db","require","models",function(c,k,h,d,f,m,a,p,l,b,g){b.inScope(c,"customField","lib.shared.NewTransportationCtrl");var n=h.get("plusbook"),x=h.get("rebook"),q=f(k.ngNewTransportation),B=q(c);B&&_.isString(B)&&(B=p.serverResponse(_.parseJSON(B)));var y=function(a){c.newTransportationCtrl.data=
a;a.lodging?(c.newTransportationCtrl.currentLodging=_.find(c.newTransportationCtrl.lodgings,function(b){return b.pk===a.lodging}),c.newTransportationCtrl.currentLodging||(a.lodging="")):c.newTransportationCtrl.currentLodging=null;a.route&&!n.currentSourceBooking&&!e()?(c.newTransportationCtrl.currentRoute=_.find(c.newTransportationCtrl.routes,function(b){return b.pk===a.route}),c.newTransportationCtrl.currentRoute||(a.route="")):c.newTransportationCtrl.currentRoute=null;a.stop&&c.newTransportationCtrl.currentRoute?
(c.newTransportationCtrl.currentStop=_.find(c.newTransportationCtrl.currentRoute.stops,function(b){return b.pk===a.stop}),c.newTransportationCtrl.currentStop||(a.stop="")):(a.route="",c.newTransportationCtrl.currentRoute=null,a.stop="",c.newTransportationCtrl.currentStop=null);c.newTransportationCtrl.needsTransportation=!!c.newTransportationCtrl.currentStop||c.customFieldPricing.visibility.isRequired;c.newTransportationCtrl.needsTransportation&&x.currentBooking&&D()},D=function(){c.newTransportationCtrl.rebookingTransportation=
!0;c.newTransportationCtrl.rebookTransportationOptions=[];c.newTransportationCtrl.rebookTransportationOption=null;var a=function(a){_.find(c.newTransportationCtrl.rebookTransportationOptions,function(b){return b.route===a.route&&b.stop===a.stop})||(c.newTransportationCtrl.rebookTransportationOptions.push(a),c.newTransportationCtrl.rebookTransportationOption||(c.newTransportationCtrl.rebookTransportationOption=a))};if(c.availability.defaultRoute){if(x.currentBooking.stop){var b=_.find(c.availability.defaultRoute.stops,
function(a){return a.pickup===x.currentBooking.stop.pickup});b&&a({text:"Match pickup location",tip:"Move to route of new availability but keep same pickup location",route:c.availability.defaultRoute,stop:b})}(b=_.chooseFirst(c.newTransportationCtrl.currentLodging.preferredPickups,function(a){return _.find(c.availability.defaultRoute.stops,function(b){if(b.pickup===a.pickup)return b})}))&&a({text:"Use new availability's default",tip:"Use the lodging's preferred stop on the default route",route:c.availability.defaultRoute,
stop:b})}c.newTransportationCtrl.currentRoute&&c.newTransportationCtrl.currentStop&&a({text:"Keep old booking's options",route:c.newTransportationCtrl.currentRoute,stop:c.newTransportationCtrl.currentStop});if(c.newTransportationCtrl.canOverrideTransportation){var e={text:"Pick new options",route:c.availability.defaultRoute||"",stop:""};a(e)}c.newTransportationCtrl.rebookTransportationOption&&(c.newTransportationCtrl.data.route=c.newTransportationCtrl.rebookTransportationOption.route.pk,c.newTransportationCtrl.currentRoute=
c.newTransportationCtrl.rebookTransportationOption.route,c.newTransportationCtrl.data.stop=c.newTransportationCtrl.rebookTransportationOption.stop.pk,c.newTransportationCtrl.currentStop=c.newTransportationCtrl.rebookTransportationOption.stop);var d=!1;c.$watch("newTransportationCtrl.data",function(a,b){var g=_.find(c.newTransportationCtrl.rebookTransportationOptions,function(b,c){return b.route.pk===a.route&&b.stop.pk===a.stop}),g=g||e;g!==c.newTransportationCtrl.rebookTransportationOption&&(c.newTransportationCtrl.rebookTransportationOption=
g,d=!0,c.$evalAsync(function(){d=!1}))},!0);c.$watch("newTransportationCtrl.rebookTransportationOption",function(a,b){a&&a!==b&&!d&&(a.route&&(c.newTransportationCtrl.data.route=a.route.pk,c.newTransportationCtrl.currentRoute=a.route),c.$evalAsync(function(){c.newTransportationCtrl.data.stop=a.stop?a.stop.pk:"";c.newTransportationCtrl.currentStop=a.stop||null}))})};c.availability||(c.availability={company:c.company,startAt:moment()});c.newTransportationCtrl={canOverrideTransportation:m.permissions.can("overrideTransportation",
g.Booking,c.availability.company),needsTransportation:void 0,rebookingTransportation:!1,rebookingTransportationOptions:[],rebookingTransportationOption:null,data:{lodging:"",lodgingRoomNumber:"",selfLodgingAddress:"",route:"",stop:""},status:"loading"};c.newTransportationCtrl.needsTransportation=c.customFieldPricing.visibility.isRequired?!0:c.newTransportationCtrl.canOverrideTransportation?!1:void 0;var e=function(){return c.newTransportationCtrl.canOverrideTransportation&&!c.booking&&!c.availability.defaultRoute};
c.newTransportationCtrl.showSelfTransportation=function(){return e()||!c.newTransportationCtrl.currentLodging?!1:!c.newTransportationCtrl.isTransportationAvailable()||!1===c.newTransportationCtrl.needsTransportation};c.newTransportationCtrl.isTransportationAvailable=function(){if(e()||!c.newTransportationCtrl.routes.length||!c.newTransportationCtrl.currentLodging)return!1;var a;if(a=!c.newTransportationCtrl.canOverrideTransportation)if(a=!c.customFieldPricing.visibility.isRequired)a=G(),a=!v(a);return a?
!1:!0};c.newTransportationCtrl.showRoutes=function(){return 1>=c.newTransportationCtrl.routes.length?!1:c.newTransportationCtrl.canOverrideTransportation};c.newTransportationCtrl.showStops=function(){return 0>=c.newTransportationCtrl.stops.length?!1:c.newTransportationCtrl.canOverrideTransportation?!0:!v(c.newTransportationCtrl.currentRoute)};c.newTransportationCtrl.showNeedsTransportation=function(){return c.customFieldPricing.visibility.isRequired?!1:c.newTransportationCtrl.isTransportationAvailable()};
c.newTransportationCtrl.showTransportationPrice=function(){return!c.customField.isPricingHidden&&(g.PriceLine.showOffset(c.customFieldPricing)||g.PriceLine.showRate(c.customFieldPricing))};var F=function(){c.newTransportationCtrl.stops=c.newTransportationCtrl.currentRoute?c.newTransportationCtrl.currentRoute.stops:[]},G=function(){return 1===c.newTransportationCtrl.routes.length?c.newTransportationCtrl.routes[0]:c.availability.defaultRoute?c.availability.defaultRoute:null},A=function(){var a=G();
a?(c.newTransportationCtrl.data.route=a.pk,c.newTransportationCtrl.currentRoute=a):(c.newTransportationCtrl.data.route="",c.newTransportationCtrl.currentRoute=null)},v=function(a){if(c.newTransportationCtrl.currentLodging&&a)return 1===c.newTransportationCtrl.stops.length&&(c.newTransportationCtrl.canOverrideTransportation||c.customFieldPricing.visibility.isRequired)?c.newTransportationCtrl.stops[0]:_.chooseFirst(c.newTransportationCtrl.currentLodging.preferredPickups,function(b){return _.chooseFirst(a.stops,
function(a){if(a.pickup===b.pickup)return a})})},s=function(){var a=v(c.newTransportationCtrl.currentRoute);if(a)return c.newTransportationCtrl.data.stop=a.pk,c.newTransportationCtrl.currentStop=a,!0;c.newTransportationCtrl.data.stop="";c.newTransportationCtrl.currentStop=null;!c.newTransportationCtrl.canOverrideTransportation&&!c.customFieldPricing.visibility.isRequired&&(c.newTransportationCtrl.data.route="",c.newTransportationCtrl.currentRoute=null);return!1},z=function(a){return{route:a,run:{capacity:a.capacity,
customerCount:0,bookingCount:0},pk:a.pk}};c.newTransportationCtrl.routeSelectionText=function(a){var b=a.route;a=a.run;if(!c.newTransportationCtrl.canOverrideTransportation||!a.customerCount)return b.name;var e=a.customerCount.toString();null!==a.capacity&&(e+=" of "+a.capacity.toString());return b.name+" "+("("+e+" people booked so far)")};var u,t,E,L=function(){u=l.lodgings({shortname:c.availability.company.shortname},null,null,null,{tagAlong:!0});t=c.newTransportationCtrl.canOverrideTransportation?
l.routes({shortname:c.availability.company.shortname},null,null,null,{tagAlong:!0}):c.availability.defaultRoute?l.route({shortname:c.availability.company.shortname,routePk:c.availability.defaultRoute.pk},null,null,null,{tagAlong:!0}):[];E=c.newTransportationCtrl.canOverrideTransportation?l.runs.searchByDate({shortname:c.availability.company.shortname,date:c.availability.startAt.format("YYYY-MM-DD")},null,null,null,{tagAlong:!0}):[];a.dataController(c,{promises:[u.$promise,t.$promise,E.$promises],
successCallback:r,errorCallback:function(){c.newTransportationCtrl.status="error"}})},r=function(){c.newTransportationCtrl.status="success";c.newTransportationCtrl.lodgings=u;c.newTransportationCtrl.routes=_.isArray(t)?t:[t];c.newTransportationCtrl.routeSelections=_.map(c.newTransportationCtrl.routes,z);_.forEach(E,function(a){var b=_.find(c.newTransportationCtrl.routeSelections,function(b){return b.route===a.route});b&&(b.run=a)});B&&y(B);c.$watch("customFieldPricing.visibility.isRequired",function(a){a&&
(c.newTransportationCtrl.needsTransportation=!0)});c.$watch("newTransportationCtrl.currentLodging",function(a,b){a&&c.newTransportationCtrl.needsTransportation&&(c.newTransportationCtrl.currentRoute||A(),a!==b&&s(),a===b&&(!c.newTransportationCtrl.canOverrideTransportation&&!c.newTransportationCtrl.currentStop)&&(F(),s()))});c.$watch("newTransportationCtrl.currentRoute",function(a,b){F();a!==b&&a&&s()});c.$watch("newTransportationCtrl.needsTransportation",function(a,b){a!==b&&(a?(c.newTransportationCtrl.currentRoute||
A(),s()):(c.newTransportationCtrl.data.route="",c.newTransportationCtrl.currentRoute=null,c.newTransportationCtrl.data.stop="",c.newTransportationCtrl.currentStop=null))});c.$watch("newTransportationCtrl.data",function(){c.newTransportationCtrl.data.lodging?q.assign(c,_.stringifyJSON(p.clientRequest(c.newTransportationCtrl.data))):q.assign(c,"")},!0)};c.availability.pk&&_.isUndefined(c.availability.defaultRoute)?l.availability({shortname:c.availability.company.shortname,itemPk:c.availability.item.pk,
availabilityPk:c.availability.pk}).$promise.then(function(){L()}):L()}])})();
(function(){var n=angular.module("lib.factories",[]);n.factory("dataController",["$q","cache","db",function(c,k,h){var d={};return function(f,m){m=m||{};var a=m.successCallback||_.ignore,p=m.errorCallback||_.ignore;f.dataCtrl={STALE:d,status:"loading",isStale:!1};var l=!1;f.$on("$destroy",function(){_.forEach(m.promises,function(a){a&&a.cancel&&a.cancel()});l=!0});var b=function(a){if(a){var b=h.errorStatus(a.status);b&&(p(a),f.dataCtrl.status=b,f.dataCtrl.isStale=!1)}},g=function(b){if(!l)return a(),
f.dataCtrl.status="success",f.dataCtrl.isStale=!1,b},n=function(){f.dataCtrl.status="loading";var d=_.choose(m.promises||[]);if(!d.length)return g();m.stale&&_.every(m.stale,function(a){return!_.isUndefined(a)&&!k.fresh(a)})&&(a(f.dataCtrl.STALE),f.dataCtrl.isStale=!0,f.dataCtrl.status="success");c.all(d).then(g,b)};f.dataCtrl.showLoading=function(){f.dataCtrl.status="loading"};f.dataCtrl.showComplete=function(){f.dataCtrl.status="success"};m.retry&&(f.retry=function(){n()});n();return f}}]);n.factory("navigationController",
["navigation",function(c){return function(k,h){k.navigationCtrl={entries:h.entries||[]};_.forEach(k.navigationCtrl.entries,function(d){_.isUndefined(d.isCurrent)&&(d.isCurrent=function(){var f=d.navigationUrl||d.url;return!f?!1:(d.equals?c.pathEquals:c.pathStartsWith)(f)})});k.navigationCtrl.isVisible=function(c){return _.isUndefined(c.isVisible)?!0:_.isFunction(c.isVisible)?c.isVisible():c.isVisible};return k}}]);n.factory("headerController",["$timeout","auth","models","navigation","navigationController",
"urls",function(c,k,h,d,f,m){return function(a,p){a.headerCtrl={};a.headerCtrl.logout=function(){a.headerCtrl.company?d.navigate(a.headerCtrl.company.$url(m.company.login)):d.navigate(m.index);c(function(){k.logout()})};k.currentUser.isAuthenticated&&(a.headerCtrl.relatedCompanies=k.relatedCompanies());a.$watch(p.companyFn,function(c){a.headerCtrl.company=c;f(a,{entries:[{text:"Admin",url:c.$url(m.dashboard.admin.index),isVisible:function(){return c.isAdmin&&k.permissions.can("viewAdminSection",c)},
shortcut:"shift+a",shortcutDescription:"Show Admin."},{text:"Bookings",url:c.$url(m.dashboard.bookings.index),isVisible:function(){return(c.isCharter||c.isAffiliate)&&k.permissions.can("viewBookingsSection",c)},shortcut:"shift+b",shortcutDescription:"Show Bookings calendar."},{text:"Manifest",url:c.$url(m.dashboard.manifest.index),isVisible:function(){return c.isCharter&&k.permissions.can("viewManifestSection",c)},shortcut:"shift+m",shortcutDescription:"Show Manifest."},{text:"Reports",url:c.$url(m.dashboard.reports.index),
isVisible:function(){return k.permissions.canList(h.Report,c)},shortcut:"shift+r",shortcutDescription:"Show Reports."},{text:"Items",url:c.$url(m.dashboard.items.index),isVisible:function(){return c.isCharter&&k.permissions.can("viewItemsSection",c)},shortcut:"shift+i",shortcutDescription:"Show Items.",isCurrent:function(){return d.pathStartsWith(m.dashboard.items.index)||d.pathStartsWith(m.dashboard.resources.index)}},{text:"Settings",url:c.$url(m.dashboard.settings.index),shortcut:"shift+s|shift+e",
shortcutDescription:"Show Settings."},{text:"Website Admin",url:"https://content.fareharbor.me/wp-admin/",isVisible:_.getter(c,"isAdmin"),isOutbound:!0},{text:"Help",url:c.$url(m.root.help),isOutbound:!0}]})});return a}}]);n.factory("cannedMessagesController",["auth","db","models","navigation","require",function(c,k,h,d,f){return function(m,a){f.defined(a,"modelKey");f.defined(a,"noteField");m.cannedMessagesCtrl={};var p=function(a){if(c.permissions.canList(h.CannedMessage,a)){var d=k.cannedMessages({shortname:a.shortname});
m.cannedMessagesCtrl.promises.push(d.$promise);d.$promise.then(function(){m.cannedMessagesCtrl.cannedMessages=m.cannedMessagesCtrl.cannedMessages.concat(d);_.forEach(d,function(a){_.contains(m.cannedMessagesCtrl.TYPES,a.type)&&m.cannedMessagesCtrl.cannedMessagesByType[a.type].push(a)})})}};m.cannedMessagesCtrl.select=function(b){var c=m[a.modelKey][a.noteField]||"",c=c.replace(/\s+$/g,"");""!==c&&(c=c.concat("\n\n"));m[a.modelKey][a.noteField]=c.concat(b.message)};m.cannedMessagesCtrl.TYPES=a.types||
h.CannedMessage.TYPES;m.cannedMessagesCtrl.displayType=h.CannedMessage.displayType;m.cannedMessagesCtrl.cannedMessagesByType={};_.forEach(m.cannedMessagesCtrl.TYPES,function(a){m.cannedMessagesCtrl.cannedMessagesByType[a]=[]});m.cannedMessagesCtrl.cannedMessages=[];m.cannedMessagesCtrl.promises=[];var l=[d.currentCompany];c.currentUser.company&&l.push(c.currentUser.company);a.company&&l.push(a.company);l=_.unique(l);_.forEach(l,function(a){p(a)});return m}}]);n.factory("imageUploadController",["$q",
"filepicker","require",function(c,k,h){return function(d,f){h.defined(f,"modelKey");var m=f.id||"image",a=f.field||"imageUrl",p=f.width||2560,l=f.height||2560,b=_.isUndefined(f.resetAfterSubmit)?!0:f.resetAfterSubmit,g=function(){_.extend(d.imageUploadCtrl[m],{url:"",urls:{},initialUrls:{},isSelected:!1,isPristine:!0,isUploading:!1,isCropping:!1,isSavingCrop:!1,crop:{},unCroppedUrl:null})},n=function(a){var b=c.defer();k.store({url:a},{location:"S3"},function(a){console.log("imageUploadCtrl: stored image ",
a.url);b.resolve(a)},function(a){console.error("imageUploadCtrl: unable to store image",a);b.reject(a)});return b.promise},x=function(a){var b=c.defer(),g={height:l,width:p,fit:"max"};k.convert(a,g,function(a){d.$safeApply(function(){console.log("imageUploadCtrl: converted image",a.url,g);b.resolve(a)})},function(a){d.$safeApply(function(){console.error("imageUploadCtrl: unable to convert image",a);b.reject(a)})});return b.promise};if(!d.imageUploadCtrl||d.imageUploadCtrl.scope!==d)d.imageUploadCtrl=
{scope:d,ids:[]},d.imageUploadCtrl.isPristine=function(){return _.every(d.imageUploadCtrl.ids,function(a){return d.imageUploadCtrl[a].isPristine})},d.imageUploadCtrl.isUploading=function(){return _.some(d.imageUploadCtrl.ids,function(a){return d.imageUploadCtrl[a].isUploading})};d.imageUploadCtrl.ids.push(m);d.imageUploadCtrl[m]={};d.imageUploadCtrl[m].clear=function(){d.imageUploadCtrl[m].urls[a]="";d[f.modelKey][a]="";_.extend(d.imageUploadCtrl[m],{url:"",isSelected:!1,isPristine:!1,crop:{},unCroppedUrl:null})};
d.imageUploadCtrl[m].select=function(){d.imageUploadCtrl[m].isUploading=!0;k.pick({mimetypes:["image/*"],services:["COMPUTER","WEBCAM","FACEBOOK","INSTAGRAM","URL"]},function(b){d.$apply(function(){x(b).then(function(b){d.imageUploadCtrl[m].urls[a]=b.url;d[f.modelKey][a]=b.url;_.extend(d.imageUploadCtrl[m],{url:b.url,isSelected:!0,isPristine:!1,isUploading:!1,crop:{},unCroppedUrl:null})},function(a){console.error("imageUploadCtrl.select: unable to convert image",a);d.imageUploadCtrl[m].isUploading=
!1})})},function(a){d.$apply(function(){101!==a.code&&console.error("imageUploadCtrl.select: unable to pick image",a);d.imageUploadCtrl[m].isUploading=!1})})};d.imageUploadCtrl[m].edit=function(){h.defined(f,"elementKey");var b=d[f.elementKey][a];d.imageUploadCtrl[m].urls[a]=b;d.imageUploadCtrl[m].initialUrls[a]=b;d[f.modelKey][a]=b;_.extend(d.imageUploadCtrl[m],{url:b,isSelected:!!b,crop:{},unCroppedUrl:null})};d.imageUploadCtrl[m].submit=function(){var f=d.imageUploadCtrl[m].urls[a],f=d.imageUploadCtrl[m].initialUrls[a]!==
f&&f?n(f):c.reject();d.imageUploadCtrl[m].isPristine=!0;b&&g();return f};d.imageUploadCtrl[m].cancel=function(){g()};d.imageUploadCtrl[m].saveCrop=function(){d.imageUploadCtrl[m].isSavingCrop=!0;var b={fit:"crop",crop:[d.imageUploadCtrl[m].crop.x,d.imageUploadCtrl[m].crop.y,d.imageUploadCtrl[m].crop.width,d.imageUploadCtrl[m].crop.height],format:"jpg",quality:90},c=d.imageUploadCtrl[m].url;k.stat({url:c},function(g){g.url=c;k.convert(g,b,function(b){d.$safeApply(function(){d[f.modelKey][a]=b.url;
d.imageUploadCtrl[m].urls[a]=b.url;_.extend(d.imageUploadCtrl[m],{url:b.url,isPristine:!1,isCropping:!1,isSavingCrop:!1,unCroppedUrl:c})})},function(a){console.error("imageUploadCtrl.saveCrop: unable to crop image",a)})})};d.imageUploadCtrl[m].startCropping=function(){d.imageUploadCtrl[m].unCroppedUrl&&(d.imageUploadCtrl[m].url=d.imageUploadCtrl[m].unCroppedUrl);d.imageUploadCtrl[m].isCropping=!0};d.imageUploadCtrl[m].cancelCrop=function(){d.imageUploadCtrl[m].isCropping=!1;d.imageUploadCtrl[m].url=
d[f.modelKey][a]};g();return d}}]);n.factory("splitPaymentController",["require","toggles",function(c,k){return function(c,d){c.splitPaymentCtrl={customerCount:d.customerCount(),amount:d.amount(),divideByPeople:1,payForPeople:1,splitAmount:0};c.$watch(function(){return d.amount()},function(d){c.splitPaymentCtrl.amount=d});c.$watch(d.customerCount,function(d){d=Math.max(1,d);c.splitPaymentCtrl.customerCount=d;c.splitPaymentCtrl.divideByPeople=d;c.splitPaymentCtrl.payForPeople=Math.min(c.splitPaymentCtrl.divideByPeople,
c.splitPaymentCtrl.payForPeople)});c.$watch(function(){var d=_.roundHalfToEven(c.splitPaymentCtrl.amount*c.splitPaymentCtrl.payForPeople/c.splitPaymentCtrl.divideByPeople);isFinite(d)||(d=0);return d},function(d){c.splitPaymentCtrl.splitAmount=d});c.splitPaymentCtrl.useSplitAmount=function(){var f=Math.min(c.splitPaymentCtrl.splitAmount,d.max());0>=f||(d.amount(f),k.toggle("splitPaymentCalc",!1))}}}]);n.factory("reorderController",["$window","db","flash",function(c,k,h){return function(d,f){var m=
f.reorderCallback||_.ignore,a=f.reorderConfirm,p=f.reorderConfirmWhen||(a?_.always:_.never);d=d||{};d.reorderCtrl={};d.reorderCtrl.reorder=function(l,b,g){var n={},x=0;b&&(n.previousPk=b.pk,x=(b.sortableIndex||0)+0.1);g&&(n.nextPk=g.pk,x=(g.sortableIndex||0)-0.1);var q;f.collectionKey?q=_.get(d,f.collectionKey):f.collectionFn&&(q=f.collectionFn(l));if(q){if(p(l,b,g)&&!c.confirm(a||"Are you sure you want to reorder this list?"))return!1;l.sortableIndex=x;_.ref.reorder(q,l,b,g);l=k.reorder({shortname:(l.company?
l.company:f.company).shortname,objectCls:l.cls?l.cls:f.cls,objectPk:l.pk},{},null,n);m(l);l.$promise.then(function(){h.success("Sort order saved.")},function(){h.error("Sort order not saved, please try again.")})}};return d}}]);n.factory("listController",["reorderController","urls","events",function(c,k,h){return function(d,f){var m=f.get,a=f.create||m&&m.create,p=f.remove,l=f.successCallback||_.ignore,b=f.errorCallback||_.ignore,g=f.submitCallback||_.ignore,n=f.removeCallback||_.ignore,x=_.isFunction(f.params)?
f.params:_.constant(f.params||{}),q=k.extract,B=_.isUndefined(f.reset)?!0:f.reset,y=f.defaultModel||{};_.isFunction(y)||(y=_.constant(y));d[f.modelKey]=_.extend({},y());m&&(f.collectionKey&&!_.isArray(_.get(d,f.collectionKey)))&&_.set(d,f.collectionKey,m(x()));d.listCtrl={};d.listCtrl.submit=function(c){var e=d[f.modelKey],k=g(c);k&&(e=_.extend({},e,k));var m=(f.createFn?f.createFn():a)(x(),e,c);m.$promise.then(function(a){if(f.collectionKey){var b=_.get(d,f.collectionKey);b&&(_.isArray(m)?f.overwrite?
_.overwrite(b,m):_.ref.append(b,m):b.push(m))}d.listCtrl.cancel(c);f.refreshActivities&&h.broadcast("dashboard.shared.ActivitiesCtrl.refresh");l(m,c,a)},function(a){b(a,c)})};d.listCtrl.adding=f.adding||!1;d.listCtrl.cancel=function(a){d.listCtrl.adding=!1;B&&(d[f.modelKey]=_.extend({},y()));a.$setPristine()};d.listCtrl.add=function(){d.listCtrl.adding=!0};d.listCtrl.toggle=function(){d.listCtrl.adding=!d.listCtrl.adding};f.sortable&&f.collectionKey&&(d.listCtrl.reorder=c(d,{collectionKey:f.collectionKey,
reorderCallback:f.reorderCallback,reorderConfirm:f.reorderConfirm,reorderConfirmWhen:f.reorderConfirmWhen,company:f.company}).reorderCtrl.reorder);f.remove&&(d.listCtrl.remove=function(a,b){d.listCtrl.status="removing";p(q(a),{},b).$promise.then(function(){d.listCtrl.status="success";b&&_.overwrite(b,{});f.collectionKey&&_.overwriteWithout(_.get(d,f.collectionKey),_.isReferenceEqualTo(a));f.refreshActivities&&h.broadcast("dashboard.shared.ActivitiesCtrl.refresh");n(a)})});return d}}]);n.factory("createController",
[function(){return function(c,k){var h=k.get||{},d=k.create||h.create,f=k.successCallback||_.ignore,m=k.errorCallback||_.ignore,a=k.submitCallback||_.ignore,p=_.isFunction(k.params)?k.params:_.constant(k.params||{}),l=_.isUndefined(k.reset)?!0:k.reset,b=k.defaultModel||{},g=function(a){return _.set(c,k.modelKey,a)};g(_.extend({},b));c.createCtrl={};c.createCtrl.creating=!1;c.createCtrl.submit=function(b){a(b);var g=d(p(),_.get(c,k.modelKey),b);g.$promise.then(function(){c.createCtrl.cancel(b);f(g,
b)},function(a){m(a,b)})};c.createCtrl.cancel=function(a){l&&g(_.extend({},b));a.$setPristine();c.createCtrl.creating=!1};return c}}]);n.factory("removeController",[function(){return function(c,k){var h=k.remove||k.get.remove,d=k.removeCallback||_.ignore,f=_.isFunction(k.params)?k.params:_.constant(k.params||{});c.removeCtrl={status:"success"};c.removeCtrl.remove=function(m){c.removeCtrl.status="removing";h(f(),{},m).$promise.then(function(){c.removeCtrl.status="success";m&&_.overwrite(m,{});k.collectionKey&&
_.overwriteWithout(c[k.collectionKey],_.isReferenceEqualTo(c[k.elementKey]));d(c[k.elementKey],m)},function(){c.removeCtrl.status="error"})};return c}}]);n.factory("editController",["events","navigation","flash",function(c,k,h){return function(d,f){var m=f.get||_.ignore,a=f.update||m.update,p=f.remove||m.remove,l=f.successCallback||_.ignore,b=f.errorCallback||_.ignore,g=f.editCallback||_.ignore,n=f.removeCallback||_.ignore,x=f.cancelCallback||_.ignore,q=f.submitCallback||_.ignore,B=_.isFunction(f.params)?
f.params:_.constant(f.params||{}),y=f.jsonFieldKeys||[];d.editCtrl={};d.editCtrl.editing=!1;d.editCtrl.status="success";if(!_.isUndefined(_.get(d,f.collectionKey))||f.remove)d.editCtrl.remove=function(a){d.editCtrl.status="removing";p(B(),{},a).$promise.then(function(){d.editCtrl.status="success";a&&_.overwrite(a,{});var b=_.get(d,f.collectionKey);b&&_.overwriteWithout(b,_.isReferenceEqualTo(d[f.elementKey]));f.refreshActivities&&c.broadcast("dashboard.shared.ActivitiesCtrl.refresh");f.flashAfterRemove&&
(b=_.isString(f.flashAfterRemove)?f.flashAfterRemove:"Deleted "+d[f.elementKey].unicode+".",h.success(b));f.navigateAfterRemove&&k.navigate(f.navigateAfterRemove);n(d[f.elementKey],a)},function(){d.editCtrl.status="error"})};var D=function(){var a={};_.forEach(d[f.elementKey],function(b,c){if(!_.isObject(b)||_.includes(y,c))a[c]=b});f.modelFields&&(a=_.pick(a,f.modelFields));d[f.modelKey]=a};d.editCtrl.edit=function(a,b){b||D();d.editCtrl.editing=!0;g(a)};d.editCtrl.cancel=function(a){d.editCtrl.editing=
!1;D();x(a);a&&a.$setPristine();f.editing&&d.editCtrl.edit(a)};d.editCtrl.submit=function(e){var g=d[f.modelKey],k=q(e);k&&(g=_.extend({},g,k));d.editCtrl.status="submitting";var h=a(B(),g,e);h.$promise.then(function(a){d.editCtrl.status="success";e.$setPristine();d.editCtrl.editing=!1;f.refreshActivities&&c.broadcast("dashboard.shared.ActivitiesCtrl.refresh");l(h,e,a);f.editing&&d.editCtrl.edit(e)},function(a){d.editCtrl.status="error";b(a,e);f.editing&&d.editCtrl.edit(e,f.skipResetAfterError)})};
f.editing&&d.editCtrl.edit();return d}}]);n.factory("calendarController",["$filter","$injector","auth","cache","db","events","localization","navigation","require","urls",function(c,k,h,d,f,m,a,p,l,b){return function(c,l){var n=k.get("flows"),q=b.calendarUrls(l.url),B=_.isFunction(l.params)?l.params:_.constant(l.params||{}),y=_.isFunction(l.queryParams)?l.queryParams:_.constant(l.queryParams||{}),D=l.endpoint,e=l.beforeRequest||_.ignore,F=l.largeDaySelected||_.ignore,G=l.smallDaySelected||_.ignore,
A=_.isFunction(l.isSundayBased)?l.isSundayBased:_.isBoolean(l.isSundayBased)?_.constant(l.isSundayBased):_.constant(l.company?l.company.features.isSundayBased:!0);c.calendarCtrl={status:"uninitialized",company:l.company||null,isSundayBased:A,calendar:{},isRetrieving:!1,isEmptyAllowed:l.isEmptyAllowed||!1,date:moment().startOf("day"),isCalendarEmpty:l.isCalendarEmpty||_.ignore,isWeekEmpty:l.isWeekEmpty||_.ignore,isDayEmpty:l.isDayEmpty||_.ignore,isDayUsed:l.isDayUsed||_.ignore,isEditable:l.isEditable||
!1,editDay:l.editDay||_.ignore};var v=moment().startOf("day");c.calendarCtrl.dropdownMonths=_.map("January February March April May June July August September October November December".split(" "),function(a,b){return{value:b,text:a}});c.calendarCtrl.dropdownYears=_.map(_.range(v.year()-2,v.year()+5),function(a){return{value:a,text:a}});var s=!1,z,u,t=c.calendarCtrl.refresh=function(a){s=!1;if(!1!==e()){var b=_.extend({year:c.calendarCtrl.date.format("YYYY"),month:c.calendarCtrl.date.format("MM")},
B()),l=y();if(a||!angular.equals([b,l],[z,u]))z=b,u=l,c.calendarCtrl.status="loading",L={},c.calendarCtrl.calendar.$promise&&c.calendarCtrl.calendar.$promise.cancel(),c.calendarCtrl.calendar=D(_.extend({},b),{},null,l),d.fresh(c.calendarCtrl.calendar)?c.calendarCtrl.isRetrieving=!0:O(),c.calendarCtrl.calendar.$promise.then(function(a){a!==f.CANCELLED&&(O(),c.calendarCtrl.status="success",c.calendarCtrl.isRetrieving=!1)},function(){c.calendarCtrl.status="error";c.calendarCtrl.isRetrieving=!1})}},E=
function(a,b){var c=v-a.at;return 0===c?b.current||"":0<c?b.past||"":b.future||""};c.calendarCtrl.dayPastPresentFutureClass=function(a){return E(a,{past:"past-day",current:"current-day"})};c.calendarCtrl.isPastWeek=function(a){return E(_.last(a.days),{past:!0})};var L={},r=v.clone().startOf("month");c.calendarCtrl.showingPastWeek=function(a){return 0!==c.calendarCtrl.date.clone().startOf("month").diff(r)||L[a.number]};c.calendarCtrl.showPastWeek=function(a){L[a.number]=!0};p.watch(c,function(a){if(p.pathEquals(q.index))p.redirect(b.populate(q.month,
{year:c.calendarCtrl.date.format("YYYY"),month:c.calendarCtrl.date.format("MM")}));else{var e;(e=p.pathEquals(q.month))?(a=e.year,e=e.month-1,a=moment({year:a,month:e,day:1}),c.calendarCtrl.style="month",c.calendarCtrl.date=a,c.calendarCtrl.monthDropdown=a.month(),c.calendarCtrl.yearDropdown=a.year(),m.broadcast("lib.shared.CalendarCtrl.month",{date:c.calendarCtrl.date}),t()):console.warn("calendarController: invalid calendar url",a)}});var K=c.calendarCtrl.monthUrl=function(a){return b.populate(q.month,
{year:a.format("YYYY"),month:a.format("MM")})};c.calendarCtrl.nextMonthUrl=function(){var a=c.calendarCtrl.date.clone();a.add(1,"months");return K(a)};c.calendarCtrl.currentMonthUrl=function(){return K(v)};c.calendarCtrl.previousMonthUrl=function(){var a=c.calendarCtrl.date.clone();a.add(-1,"months");return K(a)};c.$watch("calendarCtrl.yearDropdown",function(a,b){if(!_.isUndefined(b)&&a!==b){var e=c.calendarCtrl.date.clone();e.year(a);e=K(e);p.pathEquals(e)||p.navigate(n.extendWithFlow(e))}});c.$watch("calendarCtrl.monthDropdown",
function(a,b){if(!_.isUndefined(b)&&a!==b){var e=c.calendarCtrl.date.clone();e.month(a);e=K(e);p.pathEquals(e)||p.navigate(n.extendWithFlow(e))}});c.calendarCtrl.isCurrentMonth=function(){return c.calendarCtrl.date.year()===v.year()&&c.calendarCtrl.date.month()===v.month()};m.on(c,"lib.shared.CalendarCtrl.refresh",function(){t(!0)});var w=function(a){var b=c.calendarCtrl.calendar.weeks;if(!b)return null;var e=null;_.some(b,function(b){return _.some(b.days,function(b){return b.at.isSame(a,"day")?(e=
b,!0):!1})});return e};c.calendarCtrl.goToToday=function(){p.navigate(c.calendarCtrl.currentMonthUrl());c.calendarCtrl.selectedDay=w(moment());L={}};c.calendarCtrl.selectLargeDay=function(a){c.calendarCtrl.selectedDay=a;F(a)};c.calendarCtrl.dayLabel=function(b,e){return e===c.calendarCtrl.calendar.weeks[0]&&b===e.days[0]?b.at.format(a.current().DATE_FORMATS.dayWithMonthAbbr):1===b.number?b.at.format(a.current().DATE_FORMATS.dayWithMonthAbbr):b.number};c.calendarCtrl.selectSmallDay=function(a){c.calendarCtrl.selectedDay=
a;G(a);s=!0};var O=function(){if(h.currentUser.isAuthenticated){var a;a=s?c.calendarCtrl.selectedDay.at:c.calendarCtrl.date.year()===v.year()&&c.calendarCtrl.date.month()===v.month()?v:c.calendarCtrl.date;c.calendarCtrl.selectedDay=w(a)}else c.calendarCtrl.selectedDay=null};c.calendarCtrl.debouncedRefresh=_.debounce(function(a){c.$safeApply(function(){c.calendarCtrl.refresh(a)})},1E3,{leading:!0});c.calendarCtrl.effectiveRange=function(a,b){var c=a.startAt,e=a.endAt;c<b.at&&(c=b.at);e>b.at+864E5&&
(e=b.at.clone().add(1,"day").startOf("day"));return{startAt:c,endAt:e}};return c}}]);n.factory("availabilityCalendarController",["$filter","auth","calendarController","events","navigation",function(c,k,h,d,f){return function(k,a){var p=_.isFunction(a.params)?a.params:_.constant(a.params||{}),l=a.beforeRequest||_.ignore,b=_.isUndefined(a.autoOpenItemGroups)?!0:a.autoOpenItemGroups,g=a.openLightframe?a.openLightframe:f.navigate,n=a.items||null;d.on(k,"dashboard.bookings.NavigationCtrl.calendarFilter.items",
function(a,b){var c=b.items||[],d=_.difference(c,k.calendarCtrl.items).length;k.calendarCtrl.items=c;d&&k.calendarCtrl.debouncedRefresh(!0)});d.on(k,"dashboard.bookings.NavigationCtrl.filterChoicesUpdated",function(a,b){b&&(k.calendarCtrl.items=b.filteredItems||[]);k.calendarCtrl.refresh()});_.extend(a,{isCalendarEmpty:function(){return!k.calendarCtrl.calendar.availabilityCount},isWeekEmpty:function(a){return!a.availabilityCount},isDayEmpty:function(a){var b=a.availabilities;a=a.itemGroups||[];return!b.length&&
!a.length?!0:k.isCalendarFiltered?_.all(b,k.isCalendarFiltered)&&_.all(a,k.isCalendarFiltered):!1},isDayUsed:function(a){var b=a.availabilities;a=a.itemGroups||[];k.isCalendarFiltered&&(b=_.reject(b,k.isCalendarFiltered),a=_.reject(a,k.isCalendarFiltered));b=_.sum(_.pluck(b,"customerCount"));a=_.sum(_.pluck(a,"customerCount"));return 0<b+a},smallDaySelected:function(a){var d=a.availabilities,f=a.itemGroups||[];b&&(!d.length&&1===f.length)&&(a=c("itemGroupUrl")(f[0],a.at),g(a))},beforeRequest:function(){return k.calendarCtrl.items&&
!k.calendarCtrl.items.length?!1:l()},params:function(){var a=_.extend({},p());if(k.calendarCtrl.items){var b=_.pluck(k.calendarCtrl.items,"pk").join(",");a.itemPks=b}return a}});h(k,a);_.extend(k.calendarCtrl,{items:n,nextBookableMonthUrl:function(){var a=k.calendarCtrl.calendar.nextBookableStartAt;if(a)return k.calendarCtrl.monthUrl(a)},alreadyRedirectedToNextBookableMonth:!1,redirectToNextBookableMonth:function(){k.calendarCtrl.alreadyRedirectedToNextBookableMonth||(k.calendarCtrl.alreadyRedirectedToNextBookableMonth=
!0,f.redirect(k.calendarCtrl.nextBookableMonthUrl()))}});return k}}]);n.factory("emailPreviewController",["convert","models","navigation","urls",function(c,k,h,d){var f={type:"type",emails:"emails",subject:"subject",note:"note"};return function(m,a){var p=_.extend({},f,a.fields),l=_.isFunction(a.params)?a.params:_.constant(a.params||{}),b;a.data&&(b=_.isFunction(a.data)?a.data:function(){return a.data});m.emailPreviewCtrl={};m.emailPreviewCtrl.previewUrl=function(){var g={};_.forEach(p,function(b,
c){b&&(g[c]=m[a.modelKey][b]||"")});b&&_.extend(g,c.clientRequest(b()));var f=d.populate(a.url,l(g.type));return h.compose(f,g)};var g=_.isFunction(a.isPreviewable)?a.isPreviewable:_.constant(a.isPreviewable);m.emailPreviewCtrl.isPreviewable=function(){var b=m[a.modelKey][p.type],c=m[a.modelKey][p.emails],d=m[a.modelKey][p.subject];if(!b||!c||!d)return!1;c=g(b);return!_.isUndefined(c)?c:k.Notification.isPreviewable(b)};return m}}]);n.factory("affiliationController",["$q","auth","cache","db","editController",
"events","models",function(c,k,h,d,f,m,a){return function(p,l){var b=function(a){return(l.prefix?l.prefix+"-":"")+"voucher-"+a};p.affiliationCtrl={status:"success",substatus:"success",showDesks:!1};p.affiliationCtrl.agentName=function(b){return b===a.Agent.OTHER_AGENT?b.name:b.name+" (#"+b.pk+")"};p[l.modelKey][b("agent")]="";p[l.modelKey][b("agentName")]="";p[l.modelKey][b("desk")]="";p[l.modelKey][b("deskName")]="";var g=function(b){p.affiliationCtrl.agents=[];p.affiliationCtrl.desks=[];p.affiliationCtrl.showDesks=
!1;if(b){var g={agents:k.permissions.canCreate(a.Agent,b),desks:k.permissions.canCreate(a.Desk,b)},f={agents:a.Agent.OTHER_AGENT,desks:a.Desk.OTHER_DESK},l=function(a,b){_.overwrite(p.affiliationCtrl[a],b);g[a]&&p.affiliationCtrl[a].push(f[a])},m=[];if(k.permissions.canList(a.Agent,b.affiliateCompany)){var e=d.agents({shortname:b.affiliateCompany.shortname}),n=e.$promise.then(function(){l("agents",e)});h.fresh(e)?m.push(n):l("agents",e)}if(k.permissions.canList(a.Desk,b.affiliateCompany)){var C=d.desks({shortname:b.affiliateCompany.shortname});
b=C.$promise.then(function(){p.affiliationCtrl.showDesks=0<C.length;l("desks",C)});h.fresh(C)?m.push(b):(p.affiliationCtrl.showDesks=0<C.length,l("desks",C))}m.length&&(p.affiliationCtrl.substatus="loading",c.all(m).then(function(){p.affiliationCtrl.substatus="success"}))}};p.$watch(l.affiliateModelKey+".currentAffiliation",function(a,c){g(a);if(a&&c&&a!==c||!a)p[l.modelKey][b("agent")]="",p[l.modelKey][b("agentName")]="",p[l.modelKey][b("desk")]="",p[l.modelKey][b("deskName")]=""});var n=function(b){var c=
l.booking?l.booking.company:l.company;k.permissions.canList(a.Affiliation,c)?c.affiliatesCount>a.Affiliation.MAX_SELECTABLE_AFFILIATES?(p.affiliationCtrl.affiliatesNgDropdownEndpoint=d.searchEndpoint(d.affiliates.pickable,{shortname:c.shortname}),p.affiliationCtrl.status="success"):(p.affiliationCtrl.affiliations=d.affiliates.pickable({shortname:c.shortname},null,null,null,{flashError:!!l.booking}),p.affiliationCtrl.status=h.fresh(p.affiliationCtrl.affiliations)?"loading":"stale",p.affiliationCtrl.affiliations.$promise.then(function(){p.affiliationCtrl.status=
"success";l.booking&&l.booking.affiliation&&!_.contains(p.affiliationCtrl.affiliations,l.booking.affiliation)&&p.affiliationCtrl.affiliations.unshift(l.booking.affiliation)},function(){l.booking&&p.editCtrl.cancel(b)})):p.affiliationCtrl.status="success"};l.booking?f(p,{elementKey:"affiliation",modelKey:l.modelKey,update:d.booking.affiliation.update,editCallback:function(a){n(a);p[l.modelKey].isBlockable=l.booking.isBlockable;p[l.modelKey].affiliation=l.booking.affiliation?l.booking.affiliation.pk:
"";p[l.modelKey][b("agent")]=l.booking.agent?l.booking.agent.pk:"";p[l.modelKey][b("desk")]=l.booking.desk?l.booking.desk.pk:"";p[l.modelKey][b("voucherNumber")]=l.booking.voucherNumber;p[l.affiliateModelKey].currentAffiliation=l.booking.affiliation||null},successCallback:function(a){var c=-1==p[l.modelKey][b("agent")],d=-1==p[l.modelKey][b("desk")];(c||d)&&g(a.booking.affiliation);m.broadcast("dashboard.shared.ActivitiesCtrl.refresh")},params:function(){return{shortname:l.booking.company.shortname,
bookingUuid:l.booking.uuid}}}):n()}}]);n.factory("controllers",["affiliationController","calendarController","cannedMessagesController","createController","dataController","editController","emailPreviewController","headerController","imageUploadController","listController","navigationController","removeController","reorderController","splitPaymentController",function(c,k,h,d,f,m,a,p,l,b,g,n,x,q){return{affiliationController:c,calendarController:k,cannedMessagesController:h,createController:d,dataController:f,
editController:m,emailPreviewController:a,headerController:p,imageUploadController:l,listController:b,navigationController:g,removeController:n,reorderController:x,splitPaymentController:q}}])})();
(function(){var n=angular.module("lib.models",[]);n.factory("models",["$filter","$injector","convert","require",function(c,k,h,d){var f=c("orderBy"),m=c("pluralize"),a=c("name"),p=[["US","USA"],["AF","Afghanistan"],["AL","Albania"],["DZ","Algeria"],["AS","American Samoa"],["AD","Andorra"],["AO","Angola"],["AI","Anguilla"],["AQ","Antarctica"],["AG","Antigua & Barbuda"],["AR","Argentina"],["AM","Armenia"],["AW","Aruba"],["AU","Australia"],["AT","Austria"],["AZ","Azerbaijan"],["BS","Bahama"],["BH","Bahrain"],
["BD","Bangladesh"],["BB","Barbados"],["BY","Belarus"],["BE","Belgium"],["BZ","Belize"],["BJ","Benin"],["BM","Bermuda"],["BT","Bhutan"],["BO","Bolivia"],["BA","Bosnia and Herzegovina"],["BW","Botswana"],["BV","Bouvet Island"],["BR","Brazil"],["IO","British Indian Ocean Territory"],["VG","British Virgin Islands"],["BN","Brunei Darussalam"],["BG","Bulgaria"],["BF","Burkina Faso"],["BI","Burundi"],["KH","Cambodia"],["CM","Cameroon"],["CA","Canada"],["CV","Cape Verde"],["KY","Cayman Islands"],["CF","Central African Republic"],
["TD","Chad"],["CL","Chile"],["CN","China"],["CX","Christmas Island"],["CC","Cocos (Keeling) Islands"],["CO","Colombia"],["KM","Comoros"],["CG","Congo"],["CK","Cook Iislands"],["CR","Costa Rica"],["HR","Croatia"],["CU","Cuba"],["CY","Cyprus"],["CZ","Czech Republic"],["DK","Denmark"],["DJ","Djibouti"],["DM","Dominica"],["DO","Dominican Republic"],["TP","East Timor"],["EC","Ecuador"],["EG","Egypt"],["SV","El Salvador"],["GQ","Equatorial Guinea"],["ER","Eritrea"],["EE","Estonia"],["ET","Ethiopia"],["FK",
"Falkland Islands (Malvinas)"],["FO","Faroe Islands"],["FJ","Fiji"],["FI","Finland"],["FR","France"],["FX","France, Metropolitan"],["GF","French Guiana"],["PF","French Polynesia"],["TF","French Southern Territories"],["GA","Gabon"],["GM","Gambia"],["GE","Georgia"],["DE","Germany"],["GH","Ghana"],["GI","Gibraltar"],["GR","Greece"],["GL","Greenland"],["GD","Grenada"],["GP","Guadeloupe"],["GU","Guam"],["GT","Guatemala"],["GN","Guinea"],["GW","Guinea-Bissau"],["GY","Guyana"],["HT","Haiti"],["HM","Heard & McDonald Islands"],
["HN","Honduras"],["HK","Hong Kong"],["HU","Hungary"],["IS","Iceland"],["IN","India"],["ID","Indonesia"],["IQ","Iraq"],["IE","Ireland"],["IR","Islamic Republic of Iran"],["IL","Israel"],["IT","Italy"],["CI","Ivory Coast"],["JM","Jamaica"],["JP","Japan"],["JO","Jordan"],["KZ","Kazakhstan"],["KE","Kenya"],["KI","Kiribati"],["KP","Korea, Democratic People's Republic of"],["KR","Korea, Republic of"],["KW","Kuwait"],["KG","Kyrgyzstan"],["LA","Lao People's Democratic Republic"],["LV","Latvia"],["LB","Lebanon"],
["LS","Lesotho"],["LR","Liberia"],["LY","Libyan Arab Jamahiriya"],["LI","Liechtenstein"],["LT","Lithuania"],["LU","Luxembourg"],["MO","Macau"],["MG","Madagascar"],["MW","Malawi"],["MY","Malaysia"],["MV","Maldives"],["ML","Mali"],["MT","Malta"],["MH","Marshall Islands"],["MQ","Martinique"],["MR","Mauritania"],["MU","Mauritius"],["YT","Mayotte"],["MX","Mexico"],["FM","Micronesia"],["MD","Moldova, Republic of"],["MC","Monaco"],["MN","Mongolia"],["MS","Monserrat"],["MA","Morocco"],["MZ","Mozambique"],
["MM","Myanmar"],["NA","Namibia"],["NR","Nauru"],["NP","Nepal"],["NL","Netherlands"],["AN","Netherlands Antilles"],["NC","New Caledonia"],["NZ","New Zealand"],["NI","Nicaragua"],["NE","Niger"],["NG","Nigeria"],["NU","Niue"],["NF","Norfolk Island"],["MP","Northern Mariana Islands"],["NO","Norway"],["OM","Oman"],["PK","Pakistan"],["PW","Palau"],["PA","Panama"],["PG","Papua New Guinea"],["PY","Paraguay"],["PE","Peru"],["PH","Philippines"],["PN","Pitcairn"],["PL","Poland"],["PT","Portugal"],["PR","Puerto Rico"],
["QA","Qatar"],["RE","Reunion"],["RO","Romania"],["RU","Russian Federation"],["RW","Rwanda"],["LC","Saint Lucia"],["WS","Samoa"],["SM","San Marino"],["ST","Sao Tome & Principe"],["SA","Saudi Arabia"],["SN","Senegal"],["RS","Serbia"],["SC","Seychelles"],["SL","Sierra Leone"],["SG","Singapore"],["SK","Slovakia"],["SI","Slovenia"],["SB","Solomon Islands"],["SO","Somalia"],["ZA","South Africa"],["GS","South Georgia and the South Sandwich Islands"],["ES","Spain"],["LK","Sri Lanka"],["SH","St. Helena"],
["KN","St. Kitts and Nevis"],["PM","St. Pierre & Miquelon"],["VC","St. Vincent & the Grenadines"],["SD","Sudan"],["SR","Suriname"],["SJ","Svalbard & Jan Mayen Islands"],["SZ","Swaziland"],["SE","Sweden"],["CH","Switzerland"],["SY","Syrian Arab Republic"],["TW","Taiwan"],["TJ","Tajikistan"],["TZ","Tanzania, United Republic of"],["TH","Thailand"],["TG","Togo"],["TK","Tokelau"],["TO","Tonga"],["TT","Trinidad & Tobago"],["TN","Tunisia"],["TR","Turkey"],["TM","Turkmenistan"],["TC","Turks & Caicos Islands"],
["TV","Tuvalu"],["UG","Uganda"],["UA","Ukraine"],["AE","United Arab Emirates"],["GB","United Kingdom (Great Britain)"],["UM","United States Minor Outlying Islands"],["VI","United States Virgin Islands"],["US","USA"],["ZZ","Unknown or unspecified country"],["UY","Uruguay"],["UZ","Uzbekistan"],["VU","Vanuatu"],["VA","Vatican City State (Holy See)"],["VE","Venezuela"],["VN","Viet Nam"],["WF","Wallis & Futuna Islands"],["EH","Western Sahara"],["YE","Yemen"],["YU","Yugoslavia"],["ZR","Zaire"],["ZM","Zambia"],
["ZW","Zimbabwe"]],l=function(a){var b=k.get("db").slipstream("currencyChoices");return _.isUndefined(b)?(console.warn("getCurrencyChoices: currency choices undefined"),[]):!a?b:_.filter(b,function(b){return _.contains(a,b[0])})},b={NETWORK_FILTER:"#network",COMPANY_FILTER:"#company",ADMIN_FILTER:{},filterUrl:function(a){return a===b.COMPANY_FILTER?"":a===b.ADMIN_FILTER?"admin/":a===b.NETWORK_FILTER?"network/":"network/"+a.shortname+"/"}};c=function(a,b,c,e){return function(d){return d[a]===b?d[c]:
e}};var g={US_COUNTRY_CODE:"US",ADMIN_TYPE:"admin",CHARTER_TYPE:"charter",AFFILIATE_TYPE:"affiliate",CALL_CENTER_SHORTNAME:"fhcallcenter",NO_FEE_TYPE:"no-fee",PERCENTAGE_FEE_TYPE:"percentage-fee",FLAT_FEE_TYPE:"flat-fee",TIERED_FEE_TYPE:"tiered-fee",WATERFALL_FEE_TYPE:"waterfall-fee",ROLLING_WINDOW_PERIOD_TYPE:"rolling-window-period",IMMEDIATE_PERIOD_TYPE:"immediate-period",ADMIN_SHORTNAME:"admin",isAdmin:function(a){return a&&a.shortname===g.ADMIN_SHORTNAME},MONTH_VIEW:"month",DAY_VIEW:"day",AGENDA_VIEW:"agenda",
GRID_VIEW:"grid",TIMELINE_VIEW:"timeline",AVAILABILITY_TIMELINE:"availability",RESOURCE_TIMELINE:"resource",MANIFEST_AVAILABILITIES_VIEW:"availabilities",MANIFEST_ITEMS_VIEW:"items",MANIFEST_BOOKINGS_VIEW:"bookings",MANIFEST_RUNS_VIEW:"runs",MANIFEST_RESOURCES_VIEW:"resources",TAKE_PAYMENT_PREFERENCE:"take",INFO_PAYMENT_PREFERENCE:"info",SKIP_PAYMENT_PREFERENCE:"skip",NO_INDEX_COMPANIES:["furycat"],DEFAULT_TIERED_FEE_SCHEDULE:[{cutoff:0,rate:"0.06"}],forObject:function(a){if(a)return a.cls===g.cls?
a:a.company},INVOICE_FEE_RATE:1.9,INVOICE_FLAT_FEE:30,COUNTRIES:p,getCurrencyChoices:l,getCurrencyCodes:function(){var a=k.get("db").slipstream("currencies");return _.isUndefined(a)?(console.warn("getCurrencyCodes: currency data undefined"),[]):_.keys(a)},DEFAULT_LANGUAGE:"en-us",DEFAULT_INCLUDED_TAX_PERCENTAGE_BY_COUNTRY:{AU:10},DEFAULT_TAX_DISPLAY_NAME:"Taxes",DEFAULT_TAX_DISPLAY_NAMES:{AU:"GST"},taxDisplayName:function(a){return a.features.taxDisplayName?a.features.taxDisplayName:g.DEFAULT_TAX_DISPLAY_NAMES[a.processorCountry]||
g.DEFAULT_TAX_DISPLAY_NAME},COMPANY_LOCALE_DEFAULT_TIME_FORMAT_TYPE:"company_locale_default",ANONYMOUS_USER_LOCALE_DEFAULT_TIME_FORMAT_TYPE:"user_locale_default",TWELVE_HOUR_TIME_FORMAT_TYPE:"12_hour",TWENTY_FOUR_HOUR_TIME_FORMAT_TYPE:"24_hour",FALLBACK_SERVER_EXACT_TWELVE_HOUR_TIME_FORMAT:"g:iA",FALLBACK_SERVER_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:"H:i",FALLBACK_CLIENT_EXACT_TWELVE_HOUR_TIME_FORMAT:"h:mma",FALLBACK_CLIENT_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:"HH:mm",FALLBACK_CLIENT_TOP_OF_HOUR_TWELVE_HOUR_TIME_FORMAT:"ha",
FALLBACK_CLIENT_TOP_OF_HOUR_TWENTY_FOUR_HOUR_TIME_FORMAT:"HH:mm",FAST_PAYOUT_TIMEZONES:["US/Eastern","US/Central","US/Mountain","US/Arizona","US/Pacific"],isFastPayoutsAvailable:function(a){return!1}},n=_.map([g.MONTH_VIEW,g.DAY_VIEW,g.AGENDA_VIEW,g.GRID_VIEW,g.TIMELINE_VIEW],function(a){return[a,_.capitalize(a)]}),x=_.filter(n,function(a){return a[0]!==g.DAY_VIEW});g.dashboardBookingsViewChoices=function(a){return a?n:x};g.rollingWindowDays=c("payoutPeriodType",g.ROLLING_WINDOW_PERIOD_TYPE,"rollingWindowDays",
0);g.flatFee=c("feeType",g.FLAT_FEE_TYPE,"flatFee",0);g.percentageFeeRate=c("feeType",g.PERCENTAGE_FEE_TYPE,"percentageFeeRate",0);var q={BOOKING_TYPE:"booking",CUSTOMERS_TYPE:"customers",FOR_ALL_CUSTOMER_PROTOTYPES:"Every customer",forCustomerPrototypes:function(a){return a.type===q.BOOKING_TYPE?"Whole booking":!a.customerPrototypeRequirements.length?q.FOR_ALL_CUSTOMER_PROTOTYPES:_.map(a.customerPrototypeRequirements,function(a){a=a.customerPrototype;return a.name||a.customerType.name}).join(", ")}},
B={MAX_COLOR:12,DEFAULT_RECEIPT_FOOTER:"Thanks for your order!",isValidColor:function(a){return _.isNumber(a)&&0<=a&&a<=B.MAX_COLOR},checklistName:function(a){var b=a.name;a.isPrivate?b="<span class='badge badge-lock ghost'>Private</span> "+b:a.isUnlisted&&(b="<span class='badge'>Unlisted</span> "+b);a.shortName&&(b=b+" <span class='fh-grey'>("+a.shortName+")</span>");return b},verboseName:"item",verboseNamePlural:"items",publicItems:function(a){return _.filter(a,function(a){return!a.isPrivate})}},
y={NO_FLOW:{pk:!1,name:"None"},PAGE_TYPE:"page",LINK_TYPE:"link",ITEM_TYPE:"item",FLOW_QUERY:"flow",IS_SUGGESTED_QUERY:"suggested-flow",verboseName:"flow page",verboseNamePlural:"flow pages",WIDTH_ONE_THIRD:"1-3",WIDTH_HALF:"1-2",WIDTH_TWO_THIRDS:"2-3",WIDTH_FULL:"1-1",HEIGHT_1:1,HEIGHT_2:2,HEIGHT_3:3,singleItemRedirect:function(a){return a&&a!==y.NO_FLOW&&y.isAllItems(a)&&a.emptyPageChildren&&1===a.emptyPageChildren.length?a.emptyPageChildren[0].item:null},effectiveChildren:function(a){var b=a.children;
y.isAllItems(a)&&(b=a.emptyPageChildren);return b||[]},childItems:function(a){return _.compact(_.pluck(y.effectiveChildren(a),"item"))},childPages:function(a){return _.filter(a.children,{type:y.PAGE_TYPE})},isCalendarIncluded:function(a){if(!a.isCalendarIncluded)return!1;a=y.effectiveChildren(a);return _.any(a,function(a){return a.type===y.PAGE_TYPE||a.type===y.ITEM_TYPE&&!a.item.isRetail})},breadcrumbName:function(a){return a.shortName||a.name},isAllItems:function(a){return 0===a.childrenCount},
isSingleLevelFlow:function(a){d.assert(a.children&&a.breadcrumbs,"Flow node must be fully loaded");return 0<a.breadcrumbs.length||0<y.childPages(a).length?!1:!0},gridColumnCount:function(a){a=y.effectiveChildren(a).length;return 6<=a||3===a?3:4<=a||2===a?2:1},defaultBlockWidth:function(a){if(!y.isAllItems(a))return y.WIDTH_ONE_THIRD;a=y.gridColumnCount(a);return 3===a?y.WIDTH_ONE_THIRD:2===a?y.WIDTH_HALF:y.WIDTH_FULL},emptyGridBlockCount:function(a){if(!y.isAllItems(a))return 0;var b=y.gridColumnCount(a);
return(a=y.effectiveChildren(a).length%b)?b-a:0},heading:function(a){return a.properties.heading||(a.item?a.item.name:a.name)},subheading:function(a){return a.properties.subheading?a.properties.subheading:a.item?a.item.headline:""},imageUrl:function(a){return a.imageCdnUrl?a.imageCdnUrl:a.item?a.item.imageCdnUrl:null},imageMaxWidth:function(a){return!a.properties.width?550:y.isTallBlock(a)?null:y.imageMinWidth(a)},imageMaxHeight:function(a){return!a.properties.width?null:y.isTallBlock(a)?y.imageMinHeight(a):
null},imageMinWidth:function(a){switch(a.properties.width){case y.WIDTH_ONE_THIRD:return 604;case y.WIDTH_HALF:return 920;case y.WIDTH_TWO_THIRDS:return 1236;case y.WIDTH_FULL:return 1868;default:return 0}},imageMinHeight:function(a){switch(a.properties.height){case y.HEIGHT_1:return 332;case y.HEIGHT_2:return 692;case y.HEIGHT_3:return 1052;default:return 0}},isTallBlock:function(a){return a.properties.height>y.HEIGHT_1&&(a.properties.width===y.WIDTH_ONE_THIRD||a.properties.width===y.WIDTH_HALF)||
a.properties.width===y.WIDTH_TWO_THIRDS&&a.properties.height===y.HEIGHT_3},WIDTH_LABELS:{}};y.WIDTH_LABELS[y.WIDTH_ONE_THIRD]="one-third";y.WIDTH_LABELS[y.WIDTH_HALF]="half";y.WIDTH_LABELS[y.WIDTH_TWO_THIRDS]="two-thirds";y.WIDTH_LABELS[y.WIDTH_FULL]="full";var D={find:function(a,b,c){var e;c||(e=_.find(a,function(a){return a.customerPrototype===b.customerPrototype}));e||(e=_.find(a,function(a){return a.customerPrototype.customerType===b.customerPrototype.customerType}));return e}},e={ANY_CONDITIONS_TYPE:"any",
ALL_CONDITIONS_TYPE:"all",isVisibleWhenBooking:function(a,b,c){return a.isHidden?!1:!a.customFieldInstanceConditions.length?!0:(a.conditionsType===e.ANY_CONDITIONS_TYPE?_.any:_.all)(a.customFieldInstanceConditions,function(a){return F.isMatch(a,b,c)})},find:function(a,b){return _.contains(a,b)?b:_.find(a,{customField:b.customField})}},F={SELECTED_TYPE:"selected",NOT_SELECTED_TYPE:"not-selected",EXACT_TYPE:"exact",NOT_EXACT_TYPE:"not-exact",SELECTED_NOT_EXACT_TYPE:"selected-ne",SELECTED_OPTIONS:[{name:"is not empty",
value:"selected"},{name:"is empty",value:"not-selected"}],EXACT_OPTIONS:[{name:"is not empty",value:"selected"},{name:"is empty",value:"not-selected"},{name:"is:",value:"exact"},{name:"is not:",value:"selected-ne"},{name:"is empty or not:",value:"not-exact"}],isValidParent:function(a){return _.contains([t.SHORT_TYPE,t.YES_NO_TYPE,t.CODE_GENERATOR_TYPE,t.EXTENDED_OPTION_TYPE,t.MULTI_CAMPAIGN_TYPE,t.COUNT_TYPE],a.customField.type)},types:function(a){return F.needsExactValue(a)?F.EXACT_OPTIONS:F.SELECTED_OPTIONS},
needsExactValue:function(a){return _.contains([t.SHORT_TYPE,t.EXTENDED_OPTION_TYPE,t.COUNT_TYPE],a.customField.type)},needsCustomField:function(a){return _.contains([F.EXACT_TYPE,F.NOT_EXACT_TYPE,F.SELECTED_NOT_EXACT_TYPE],a.type)},isMatch:function(a,b,c){c=c||{};var d=c[a.uri];if(!_.isUndefined(d))return d;c[a.uri]=!1;var g=a.parentCustomFieldInstance;if(!g||g.isHidden||!e.isVisibleWhenBooking(g,b,c))return!1;d=a.type;b=b(g);d=d===F.SELECTED_TYPE?!!b:d===F.NOT_SELECTED_TYPE?!b:d===F.EXACT_TYPE?a.exactValue===
b:d===F.NOT_EXACT_TYPE?!b||a.exactValue!==b:d===F.SELECTED_NOT_EXACT_TYPE?!!b&&a.exactValue!==b:!1;return c[a.uri]=d}},G={CHECKED_IN_TYPE:"checked-in",NO_SHOW_TYPE:"no-show",MIXED_CHECKIN_STATUS:{pk:"mixed",name:"Set check-in per customer...",type:"mixed"},EMPTY_CHECKIN_STATUS:{pk:"",name:"Not yet checked in"},isCheckedIn:function(a){return a&&a.type===G.CHECKED_IN_TYPE},isNoShow:function(a){return a&&a.type===G.NO_SHOW_TYPE},isMixed:function(a){return a===G.MIXED_CHECKIN_STATUS},bookingCheckinStatus:function(a){if(a&&
a.customers&&a.customers.length){var b=a.customers[0]?a.customers[0].checkinStatus:null;return _.every(a.customers,{checkinStatus:b})?b:G.MIXED_CHECKIN_STATUS}},bookingCheckinStatusObject:function(a){return G.bookingCheckinStatus(a)||G.EMPTY_CHECKIN_STATUS},bookingCheckinBreakdown:function(a){var b={};_.forEach(a.customers,function(a){var c=a.customerTypeRate.customerPrototype.customerType,e=a.checkinStatus||null;a=c.uri+":"+(e?e.uri:"");c=b[a]||{count:0,customerType:c,checkinStatus:e};c.count+=1;
b[a]=c});a=f(_.values(b),function(a){return!a.checkinStatus?[1,2,0,a.customerType.sortableIndex]:[0,a.checkinStatus.type===N.CheckinStatus.NOT_CHECKED_IN_TYPE?1:0,a.checkinStatus.sortableIndex,a.customerType.sortableIndex]});return _.map(a,function(a){var b=a.customerType.shortName||m(a.count,a.customerType.singular,a.customerType.plural);return a.count.toString()+"\u00a0"+b+"\u00a0"+(a.checkinStatus?a.checkinStatus.name:"not checked in")}).join(", ")},checkinStatusClass:function(a){return a?a.type:
"not-checked-in"},checkinStatusSort:function(a){return[!!a,G.isCheckedIn(a),G.isMixed(a),G.isNoShow(a),a?a.sortableIndex:0]}};c=function(a){return function(b){return A.effectiveBookingRestriction(b,a)}};var A={AUTO_STATUS:"auto",OPEN_STATUS:"open",CALL_STATUS:"call",CLOSED_STATUS:"closed",DISPLAY_STATUS_BY_STATUS:{auto:"Auto close",open:"Open",call:"Closed & Call to book",closed:"Closed & hidden"},displayStatus:function(a){return A.DISPLAY_STATUS_BY_STATUS[a]},cutoffReachedStart:function(a){var b=
A.cutoffReachedKind(a),c=A.cutoffReachedHours(a);return ga.cutoffStart(b,c,a.utcStartAt)},cutoffUnreachedStart:function(a){var b=A.cutoffUnreachedKind(a),c=A.cutoffUnreachedHours(a);return ga.cutoffStart(b,c,a.utcStartAt)},effectiveBookingRestriction:function(a,b){return a.bookingRestriction?a.bookingRestriction[b]:a.item.bookingRestriction?a.item.bookingRestriction[b]:a.item[b]},soldOutText:c("soldOutText"),isBookableEverByPhone:c("isBookableEverByPhone"),cutoffReachedKind:c("cutoffReachedKind"),
cutoffReachedHours:c("cutoffReachedHours"),cutoffUnreachedKind:c("cutoffUnreachedKind"),cutoffUnreachedHours:c("cutoffUnreachedHours"),isInPast:function(a){var b=a.utcEndAt;a=a.customerCount?A.cutoffReachedStart(a):A.cutoffUnreachedStart(a);b=Math.max(b.unix(),a.unix());a=moment().unix();return b<a},minimumPartySize:function(a){return a.customerCount?A.effectiveBookingRestriction(a,"minimumSubsequentPartySize"):A.effectiveBookingRestriction(a,"minimumInitialPartySize")},maximumPartySize:function(a){return a.customerCount?
A.effectiveBookingRestriction(a,"maximumSubsequentPartySize"):A.effectiveBookingRestriction(a,"maximumInitialPartySize")},blockedCustomerCount:function(a){return _.sum(a.blocks,"customerCount")},reservedCapacity:function(a){return _.sum(a.blocks,"reservedCapacity")},AFFILIATE_SORT_ORDER:"affiliate",BOOKED_AT_SORT_ORDER:"bookedAt",BOOKED_BY_SORT_ORDER:"bookedBy",CONTACT_NAME_SORT_ORDER:"name",PAID_STATUS_SORT_ORDER:"status",PAX_COUNT_SORT_ORDER:"paxCount"},v={items:function(a){return s.uniqueItems(a.allBookings)},
isNoTax:function(a){return _.all(a.contributingBookings,"availability.item.isNoTax")},receiptFooter:function(a){a=_.uniq(_.map(v.items(a),"receiptFooter"));return 1===a.length&&a[0]?a[0]:B.DEFAULT_RECEIPT_FOOTER}};c={COUNTRIES:p};var s={CANCELLED_STATUS:"cancelled",UNCANCELLED_STATUS:"uncancelled",PAID_PAID_STATUS:"paid",UNPAID_PAID_STATUS:"unpaid",OVERPAID_PAID_STATUS:"overpaid",UNDERPAID_PAID_STATUS:"underpaid",adjustBookingFee:function(a,b,c,e){b+=c;return!b||!e?a:e<b?_.roundHalfToEven(a*((b-e)/
b)):0},affiliateCompany:function(a){return a.affiliation?a.affiliation.affiliateCompany:void 0},newTransportation:function(a){if(a.customFieldValues)return _.find(a.customFieldValues,function(a){return a.customFieldInstance.customField.type===t.NEW_TRANSPORTATION_TYPE});console.warn("models.Booking.newTransportation: booking has no custom field values")},waiverCustomFields:function(a){var b=[],c=function(a){return a.customFieldInstance.customField.type===t.WAIVER_TYPE},e=function(a){return a.customFieldInstance.customField},
d=_.map(_.filter(a.customFieldValues,c),e),g=[];_.forEach(a.customers,function(a){g.push(_.map(_.filter(a.customFieldValues,c),e))});g=_.flatten(g);b=b.concat(g,d);if(b.length)return _.uniq(b,"pk");console.warn("models.Booking.waivers: booking has no waiver custom fields")},generatedCustomFields:function(a){var b={};_.forEach(a.generatedCodes,function(a){var c=a.generatingCampaign,e=c.customField,d=b[e.uri]||{customField:e,generatedCampaigns:{}};b[e.uri]=d;e=d.generatedCampaigns[c.uri]||{generatingCampaign:c,
generatedCodes:[]};d.generatedCampaigns[c.uri]=e;e.generatedCodes.push(a)});a=_.sortBy(_.values(b,function(a){return a.customField.name}));_.forEach(a,function(a){a.generatedCampaigns=_.sortBy(_.values(a.generatedCampaigns,function(a){return a.generatingCampaign.campaign.name}))});return a},isCountedTowardsOrderTotal:function(a){return a.status!==s.CANCELLED_STATUS||a.receipt&&a.receipt.gross},isEligibleForAutoFollowUpEmail:function(a){return a.item.isFollowUpEnabled&&a.contact.email},isEligibleForAutoReminderEmail:function(a){return a.item.isReminderEnabled&&
a.contact.email},isEligibleForAutoReminderSms:function(a){return a.company.isSmsEnabled&&a.item.isSmsReminderEnabled&&a.isSmsEnabled&&K.isEligiblePhoneNumber(a.contact.phone,a.contact.phoneCountry,a.contact.company)},isEligibleForReviewExpress:function(a){return a.item.isReviewExpressEnabled&&a.contact.email},isEligibleForOnlineCancellation:function(a){var b="paid"===a.paidStatus,c=_.filter(a.payments,function(a){return!a.isRefunded&&!a.isAnyCreditCardType});return!A.isInPast(a.availability)&&!a.isCancelled&&
a.company.features.isCancellationPoliciesEnabled&&a.company.features.isOnlineCancellationEnabled&&!!a.effectiveCancellationRule&&a.effectiveCancellationRule.isCancellationAllowed&&b&&!c.length},charterInvoiceRevenue:function(a){return!a.affiliation?null:a.invoicedToCharter+a.invoiceableToCharter},charterInvoiceOwed:function(a){return!a.affiliation?null:a.invoicedToAffiliate+a.invoiceableToAffiliate},isEligibleForCancellation:function(a,b){if(!a.company.features.isCancellationPoliciesEnabled||!a.effectiveCancellationRule||
!a.effectiveCancellationRule.isCancellationAllowed)return!1;var c=b?b.company:null;return a.affiliation&&a.affiliation.affiliateCompany===c&&_.any(a.payments,function(a){return!a.isDeferred&&!a.isCollectedByAffiliate})?!1:!0},isEligibleForRebook:function(a,b){return s.isEligibleForCancellation(a,b)},itemsInOrder:function(a){return a.isOrder?_.uniq(_.pluck(a.order.allBookings,"item")):[a.item]},hasEmailableDisputes:function(a){return _.some(a.payments,function(a){return I.isOpenDisputeStatus(a)})},
customerTypeRateCountKey:function(a){return"customerTypeRate"+a.pk+"-count"},customFieldInstanceKey:function(a,b,c){b=_.isObject(b)?b.cls===D.cls?b.pk.toString()+"-"+c.toString():b.key:_.isString(b)?b:"Booking";return"customFieldInstance"+a.pk+"For"+b+"-value"},uniqueItems:function(a){return _.uniq(_.map(a,"item"))}},z={PERCENTAGE_COMMISSION_TYPE:"percentage",FLAT_COMMISSION_TYPE:"flat",AFFILIATE_TAKE_PAYMENT_PREFERENCE:"affiliate-take",CARD_ON_FILE_PAYMENT_PREFERENCE:"card-on-file",TAKE_PAYMENT_PREFERENCE:g.TAKE_PAYMENT_PREFERENCE,
INFO_PAYMENT_PREFERENCE:g.INFO_PAYMENT_PREFERENCE,SKIP_PAYMENT_PREFERENCE:g.SKIP_PAYMENT_PREFERENCE,MAX_SELECTABLE_AFFILIATES:400,isOnlineBookingEnabled:function(a){return(a=a.affiliateGroup&&a.affiliateGroup.groupPermissions)&&a.canCreateBookings},verboseName:"affiliate",verboseNamePlural:"affiliates",name:function(a){return!a?"":!a.affiliateCompany?a.unicode:a.affiliateCompany.name}},u={NEW_STATUS:"new",PENDING_STATUS:"pending",RUNNING_STATUS:"running",FAILED_STATUS:"failed",SUCCEEDED_STATUS:"succeeded",
CANCELLED_STATUS:"cancelled",ALL_PARTNER_FILTER_OPTION:"all",DIRECT_PARTNER_FILTER_OPTION:"direct",ALL_AFFILIATE_FILTER_OPTION:"all",DIRECT_AFFILIATE_FILTER_OPTION:"direct",ALL_ITEM_FILTER_OPTION:"all",ALL_USER_FILTER_OPTION:"all",ONLINE_USER_FILTER_OPTION:"online",ORIGINAL_USER_TYPE_FILTER_OPTION:"original",CURRENT_USER_TYPE_FILTER_OPTION:"current",ALL_CANCELLED_BOOKINGS_FILTER_OPTION:"all",NO_CANCELLED_BOOKINGS_FILTER_OPTION:"none",NON_REFUNDED_CANCELLED_BOOKINGS_FILTER_OPTION:"non-refunded",ONLY_CANCELLED_BOOKINGS_FILTER_OPTION:"only",
AVAILABILITY_DATE_TYPE:"availability",BOOKING_DATE_TYPE:"booking",BOOKING_ORIGINAL_DATE_TYPE:"booking-original",DISPUTE_DATE_TYPE:"dispute",PAYMENT_DATE_TYPE:"payment",PAYMENT_OR_REFUND_DATE_TYPE:"payment-or-refund",PAYMENT_OR_REFUND_ACCRUAL_DATE_TYPE:"payment-or-refund-accrual",LINE_ITEM_DATE_TYPE:"line-item",ALL_TRANSACTION_TAG_FILTER_OPTION:"all",ALL_SALESPERSON_FILTER_OPTION:"all",ALL_DISPUTE_STATUS_FILTER_OPTION:"all",ALL_CLOSED_DISPUTE_STATUS_FILTER_OPTION:"all-closed",ALL_OPEN_DISPUTE_STATUS_FILTER_OPTION:"all-open",
ALL_CURRENCY_FILTER_OPTION:"all",UNCANCELLED_FILTER_OPTION:"uncancelled",REFUNDED_CANCELLED_FILTER_OPTION:"refunded",UNREFUNDED_CANCELLED_FILTER_OPTION:"unrefunded",ADVANCED_TYPE:"advanced",emptyFilters:function(){return _.mapValues(N.Report.MODELS,function(){return[]})},emptyColumns:function(){return _.mapValues(N.Report.MODELS,function(){return{}})},emptyCompanyOptions:function(a){return _.keyBy(a,"pk",function(a){var b={};a.isCharter&&(b.filters=u.emptyFilters());a.isAffiliate&&(b.selectedAllPartners=
void 0,b.allPartnerFilters=u.emptyFilters(),b.partners={},b.selectedPartners={});return b})},emptyReportOptions:function(a){return{modelName:"",presetDateRange:"",startDate:"",endDate:"",dateType:"",filters:u.emptyFilters(),companies:u.emptyCompanyOptions(a),selectedCharters:{},selectedAffiliates:{},groups:[],isDetailed:"",columns:u.emptyColumns(),isOpened:!1,customFieldValueModel:""}},defaultGroups:function(){return[u.ITEM_GROUP]},defaultBookingCancelledStatusFilter:function(){return{type:u.CANCELLED_STATUS_FILTER_TYPE,
data:{value:[u.UNCANCELLED_FILTER_OPTION,u.UNREFUNDED_CANCELLED_FILTER_OPTION]}}},defaultFilters:function(){return _.extend(u.emptyFilters(),{Booking:[u.defaultBookingCancelledStatusFilter()]})},defaultBookingColumns:function(){return _.toTrueKeys([u.BOOKING_COUNT_COLUMN,u.BOOKING_ID_COLUMN,u.BOOKING_BOOKED_BY_COLUMN,u.CREATED_AT_COLUMN,u.AVAILABILITY_DATETIME_COLUMN,u.TOTAL_COST_PRICE_COLUMN,u.TOTAL_COST_TAX_COLUMN,u.TOTAL_COST_TOTAL_COLUMN,u.CONTACT_NAME_COLUMN,u.CUSTOMER_COUNT_COLUMN,u.AFFILIATE_COLUMN,
u.VOUCHER_NUMBER_COLUMN,u.INVOICEABLE_TO_CHARTER_COLUMN,u.INVOICEABLE_TO_AFFILIATE_COLUMN,u.RECEIPT_PROCESSING_FEE_COLUMN,u.COLLECTED_TOTAL_COST_TOTAL_COLUMN,u.RECEIPT_NET_COLUMN])},defaultCustomerColumns:function(){return _.toTrueKeys([u.CUSTOMER_COUNT_COLUMN,u.TOTAL_COST_PRICE_COLUMN,u.TOTAL_COST_TAX_COLUMN,u.TOTAL_COST_TOTAL_COLUMN,u.COLLECTED_TOTAL_COST_PRICE_COLOUMN,u.COLLECTED_TOTAL_COST_TAX_COLOUMN,u.COLLECTED_TOTAL_COST_TOTAL_COLUMN])},defaultCustomFieldValueColumns:function(){return _.toTrueKeys([u.USE_COUNT_COLUMN,
u.TOTAL_COST_PRICE_COLUMN,u.TOTAL_COST_TAX_COLUMN,u.TOTAL_COST_TOTAL_COLUMN,u.COLLECTED_TOTAL_COST_PRICE_COLOUMN,u.COLLECTED_TOTAL_COST_TAX_COLOUMN,u.COLLECTED_TOTAL_COST_TOTAL_COLUMN])},defaultLineItemColumns:function(){return _.toTrueKeys([u.CREATED_AT_COLUMN,u.TOTAL_COST_PRICE_COLUMN,u.TOTAL_COST_TAX_COLUMN,u.TOTAL_COST_TOTAL_COLUMN,u.LINE_ITEM_DESCRIPTION_COLUMN])},defaultPaymentColumns:function(){return _.toTrueKeys([u.CREATED_AT_COLUMN,u.PAYMENT_OR_REFUND_COLUMN,u.PAYMENT_OR_REFUND_ID_COLUMN,
u.PAYMENT_TYPE_COLUMN,u.PAYMENT_AND_REFUND_GROSS_COLUMN,u.PAYMENT_AND_REFUND_PROCESSING_FEE_COLUMN,u.PAYMENT_AND_REFUND_NET_COLUMN,u.PAYMENT_COUNT_COLUMN,u.REFUND_COUNT_COLUMN,u.PAYMENT_TOTAL_TAX_COLUMN,u.REFUND_TOTAL_PRICE_COLUMN])},defaultPaymentColumnsWithTax:function(){return _.extend(u.defaultPaymentColumns(),_.toTrueKeys([u.PAYMENT_AND_REFUND_TOTAL_TAX_COLUMN]))},defaultCustomerReportColumns:function(){return _.extend(u.emptyColumns(),{Customer:u.defaultCustomerColumns(),Booking:_.toTrueKeys([u.BOOKING_ID_COLUMN,
u.BOOKING_COUNT_COLUMN,u.CUSTOMER_COUNT_COLUMN,u.TOTAL_COST_TOTAL_COLUMN])})},defaultColumns:function(){return _.extend(u.emptyColumns(),{Booking:u.defaultBookingColumns(),Customer:u.defaultCustomerColumns(),CustomFieldValue:u.defaultCustomFieldValueColumns(),LineItem:u.defaultLineItemColumns()})},defaultReportOptions:function(a){var b=_.defaults({dateType:u.AVAILABILITY_DATE_TYPE,presetDateRange:u.YESTERDAY_DATE_RANGE,isDetailed:!1,groups:u.defaultGroups(),columns:u.defaultColumns(),filters:u.defaultFilters(),
customFieldValueModel:X.cls},u.emptyReportOptions(a));a=a[0];b.selectedCharters[a.pk]=a.isCharter;b.selectedAffiliates[a.pk]=!a.isCharter&&a.isAffiliate;return b}},t={STACK_PRICING_TYPE:"stack",CURRENT_PRICING_TYPE:"current",INITIAL_PRICING_TYPE:"initial",ZERO_PRICING_TYPE:"zero",SHORT_TYPE:"short",LONG_TYPE:"long",YES_NO_TYPE:"yes-no",OPTION_TYPE:"option",EXTENDED_OPTION_TYPE:"extended-option",HEADER_TYPE:"header",NOTE_TYPE:"note",TRANSPORTATION_TYPE:"transportation",NEW_TRANSPORTATION_TYPE:"new-transportation",
CODE_TYPE:"code",MULTI_CAMPAIGN_TYPE:"multi-campaign",CODE_GENERATOR_TYPE:"code-generator",CARD_GENERATOR_TYPE:"card-generator",COUNT_TYPE:"count",WAIVER_TYPE:"waiver",DISPLAY_ONLY_TYPES:["note","header"],suggestedAmounts:function(a){if(a.type!==t.CARD_GENERATOR_TYPE)return[];a=a.cardSuggestedAmount||2500;return[a,2*a,4*a]},isDisplayOnly:function(a){return _.contains(t.DISPLAY_ONLY_TYPES,a.type)},isManifestField:function(a){return t.isDisplayOnly(a)?!1:!_.contains([t.NEW_TRANSPORTATION_TYPE,t.CODE_GENERATOR_TYPE,
t.WAIVER_TYPE],a.type)},isAggregatable:function(a){return _.contains([N.CustomField.EXTENDED_OPTION_TYPE,N.CustomField.OPTION_TYPE,N.CustomField.CODE_TYPE,N.CustomField.MULTI_CAMPAIGN_TYPE,N.CustomField.YES_NO_TYPE,N.CustomField.TRANSPORTATION_TYPE,N.CustomField.COUNT_TYPE],a.type)},usesCheckbox:function(a){return _.contains([t.YES_NO_TYPE,t.CODE_GENERATOR_TYPE],a.type)},needsRequired:function(a){return t.isDisplayOnly(a)?!1:!_.contains([t.TRANSPORTATION_TYPE,t.COUNT_TYPE],a.type)},needsPricing:function(a){return _.contains([t.YES_NO_TYPE,
t.OPTION_TYPE,t.CODE_TYPE,t.CODE_GENERATOR_TYPE,t.CARD_GENERATOR_TYPE,t.NEW_TRANSPORTATION_TYPE,t.COUNT_TYPE],a.type)},needsAlwaysPerCustomer:function(a){return t.needsPricing(a)||_.contains([t.EXTENDED_OPTION_TYPE],a.type)},pricedByValue:function(a){return a.type===t.CARD_GENERATOR_TYPE},pricedByOptions:function(a){return _.contains([t.EXTENDED_OPTION_TYPE,t.MULTI_CAMPAIGN_TYPE],a.type)},needsBookingNotes:function(a){return _.contains([t.OPTION_TYPE,t.CODE_TYPE,t.CODE_GENERATOR_TYPE,t.CARD_GENERATOR_TYPE,
t.MULTI_CAMPAIGN_TYPE,t.YES_NO_TYPE,t.TRANSPORTATION_TYPE,t.NEW_TRANSPORTATION_TYPE,t.EXTENDED_OPTION_TYPE,t.COUNT_TYPE],a.type)},needsHint:function(a){return _.contains([t.SHORT_TYPE,t.LONG_TYPE,t.CODE_TYPE,t.NEW_TRANSPORTATION_TYPE,t.MULTI_CAMPAIGN_TYPE],a.type)},hasExtraOptions:function(a){return _.contains([t.EXTENDED_OPTION_TYPE,t.TRANSPORTATION_TYPE,t.MULTI_CAMPAIGN_TYPE],a.type)},isDefaultValueAllowed:function(a){return _.contains(t.DEFAULT_VALUE_TYPES,a.type)},isValidRawValue:function(a,b){return a.type===
t.EXTENDED_OPTION_TYPE?""===b?!0:_.isNumber(b)&&_.find(a.extendedOptions,{pk:b}):a.type===t.COUNT_TYPE?_.isNumber(b)&&b>=a.countMin&&b<=a.countMax:!0},displayForRawValue:function(b,c){if(b.type===t.EXTENDED_OPTION_TYPE){if(""===c)return"";var e=_.find(b.extendedOptions,{pk:c});return e?a(e):"Deleted option"}return b.type===t.YES_NO_TYPE?c?"Yes":"No":_.isUndefined(c)||null===c?"":c.toString()},isOptionAvailable:function(a,b){if(""===b)return!0;var c=a.type;return c===t.OPTION_TYPE?_.contains(a.options,
b):c===t.EXTENDED_OPTION_TYPE?_.some(a.extendedOptions,function(a){return a.pk===b}):c===t.TRANSPORTATION_TYPE?_.some(a.transportationOptions,function(a){return a.pk===b}):c===t.COUNT_TYPE?b>=a.countMin&&b<=a.countMax:!0},autofillValue:function(a,b,c){if(!_.isUndefined(b)&&(a=a.customField,t.isOptionAvailable(a,b)))return c&&a.type===t.NEW_TRANSPORTATION_TYPE&&(b=void 0),_.clone(b)},verboseName:"custom field",verboseNamePlural:"custom fields",dropdownName:function(a){return"["+a.shortDisplayType+
"] "+a.name}};_.extend(t,{GROUPED_TYPES:{text:[t.SHORT_TYPE,t.LONG_TYPE],checkbox:[t.YES_NO_TYPE,t.CODE_GENERATOR_TYPE],dropdown:[t.EXTENDED_OPTION_TYPE,t.OPTION_TYPE],quantity:[t.COUNT_TYPE],transportation:[t.NEW_TRANSPORTATION_TYPE,t.TRANSPORTATION_TYPE],code:[t.MULTI_CAMPAIGN_TYPE,t.CODE_TYPE],label:[t.HEADER_TYPE],waiver:[t.WAIVER_TYPE],"gift-card":[t.CARD_GENERATOR_TYPE]},groupedType:function(a){return _.findKey(t.GROUPED_TYPES,function(b){return _.contains(b,a)})},DEFAULT_VALUE_TYPES:[t.SHORT_TYPE,
t.YES_NO_TYPE,t.CODE_GENERATOR_TYPE,t.EXTENDED_OPTION_TYPE,t.COUNT_TYPE]});var E=function(a){return _.some(a.payments,function(a){return a.type===I.AFFILIATE_TYPE?!1:!a.isDeferred&&!a.isRefunded})},L=function(a){return _.some(a.payments,function(a){return a.type===I.AFFILIATE_TYPE?!1:!a.isDeferred&&!!a.refundCount})},r={AVAILABILITY_MANIFEST_TYPE:"availability-manifest",ORDER_CONFIRMATION_TYPE:"order-confirmation",ORDER_CANCELLATION_TYPE:"order-cancellation",ORDER_RECEIPT_TYPE:"order-receipt",ORDER_REFUNDED_TYPE:"order-refunded",
ORDER_SHARE_TYPE:"order-share",BOOKING_CANCELLATION_TYPE:"booking-cancellation",BOOKING_CONFIRMATION_TYPE:"booking-confirmation",BOOKING_FOLLOW_UP_TYPE:"booking-follow-up",BOOKING_MESSAGE_TYPE:"booking-message",BOOKING_RECEIPT_TYPE:"booking-receipt",BOOKING_REBOOKED_TYPE:"booking-rebooked",BOOKING_REFUNDED_TYPE:"booking-refunded",BOOKING_REMINDER_TYPE:"booking-reminder",BOOKING_SHARE_TYPE:"booking-share",NOTIFICATION_FAILURE_TYPE:"notification-failure",CREW_CHANGE_TYPE:"crew-change",CREW_REMINDER_TYPE:"crew-reminder",
DAILY_MANIFEST_TYPE:"daily-manifest",DISPUTE_TYPE:"dispute",INVOICE_PAYMENT_REQUEST_TYPE:"invoice-payment-request",INVOICE_UPLOAD_STATUS_UPDATE_TYPE:"invoice-upload-status-update",STORED_VALUE_CARD_TYPE:"stored-value-card",DEFAULT_SUBJECT_BY_TYPE:{"booking-cancellation":"Your booking has been cancelled","booking-confirmation":"Booking Confirmation","booking-follow-up":"Thank you!","booking-message":"","booking-receipt":"Your payment has been processed","booking-rebooked":"You've been rebooked","booking-refunded":"You've been refunded",
"booking-reminder":"Booking Reminder","booking-share":"Booking Confirmation Share","order-cancellation":"Your order has been updated","order-confirmation":"Order Confirmation","order-share":"Order Confirmation Share","order-receipt":"Your payment has been processed","order-refunded":"You've been refunded"},displayType:function(a){a=a.replace("booking-","").replace("order-","");return _.capitalize(a)},notificationTypesForOrder:function(a){var b=[];a.contributingBookingCount&&b.push(r.ORDER_CONFIRMATION_TYPE);
_.any(a.allBookings,E)&&b.push(r.ORDER_RECEIPT_TYPE);_.any(a.allBookings,L)&&b.push(r.ORDER_REFUNDED_TYPE);_.any(a.allBookings,"isCancelled")&&b.push(r.ORDER_CANCELLATION_TYPE);return b},notificationTypesForBooking:function(a){if(a.rebookedTo)return[];var b=[];a.isCancelled?b.push(r.BOOKING_CANCELLATION_TYPE):a.rebookedFrom?(b.push(r.BOOKING_REBOOKED_TYPE),b.push(r.BOOKING_REMINDER_TYPE),b.push(r.BOOKING_CONFIRMATION_TYPE)):(b.push(r.BOOKING_CONFIRMATION_TYPE),b.push(r.BOOKING_REMINDER_TYPE));E(a)&&
b.push(r.BOOKING_RECEIPT_TYPE);L(a)&&b.push(r.BOOKING_REFUNDED_TYPE);b.push(r.BOOKING_MESSAGE_TYPE);b.push(r.BOOKING_FOLLOW_UP_TYPE);return b},isPreviewable:function(a){return _.contains([r.ORDER_CANCELLATION_TYPE,r.ORDER_CONFIRMATION_TYPE,r.BOOKING_CANCELLATION_TYPE,r.BOOKING_CONFIRMATION_TYPE,r.BOOKING_FOLLOW_UP_TYPE,r.BOOKING_MESSAGE_TYPE,r.BOOKING_REMINDER_TYPE,r.INVOICE_PAYMENT_REQUEST_TYPE],a)},isSubjectEditable:function(a){return _.contains([r.BOOKING_CANCELLATION_TYPE,r.BOOKING_FOLLOW_UP_TYPE,
r.BOOKING_MESSAGE_TYPE,r.BOOKING_REBOOKED_TYPE,r.BOOKING_RECEIPT_TYPE,r.BOOKING_REFUNDED_TYPE,r.DISPUTED_TYPE,r.ORDER_RECEIPT_TYPE,r.ORDER_REFUNDED_TYPE],a)},filterByType:function(a,b){return _.filter(a,function(a){return a.type===b})},bookingConfirmationNotifications:function(a){return r.filterByType(a,r.BOOKING_CONFIRMATION_TYPE)},bookingFollowUpNotifications:function(a){return r.filterByType(a,r.BOOKING_FOLLOW_UP_TYPE)},bookingRebookedNotifications:function(a){return r.filterByType(a,r.BOOKING_REBOOKED_TYPE)},
bookingReminderNotifications:function(a){return r.filterByType(a,r.BOOKING_REMINDER_TYPE)},invoicePaymentRequestNotifications:function(a){return r.filterByType(a,r.INVOICE_PAYMENT_REQUEST_TYPE)},UNKNOWN_STATUS:"unknown",PROCESSED_STATUS:"processed",DEFERRED_STATUS:"deferred",DELIVERED_STATUS:"delivered",USER_OPENED_STATUS:"open",USER_CLICKED_URL_STATUS:"click",BOUNCE_STATUS:"bounce",DROPPED_STATUS:"dropped",USER_REPORTED_SPAM_STATUS:"spamreport",USER_UNSUBSCRIBED_STATUS:"unsubscribe",isOpened:function(a){return _.contains([r.USER_OPENED_STATUS,
r.USER_CLICKED_URL_STATUS,r.USER_REPORTED_SPAM_STATUS,r.USER_UNSUBSCRIBED_STATUS],a)},isFailed:function(a){return _.contains([r.BOUNCE_STATUS,r.DROPPED_STATUS],a)},subjectForDisputeType:function(a){return"[Response Needed] New Dispute for Booking #"+a.pk+" ("+a.contact.name+")"}},K={US_COUNTRY_CODE:"US",INTERNATIONAL_ENABLED_COUNTRIES:p,INTERNATIONAL_DISABLED_COUNTRIES:[["US","USA"]],TEST_NUMBERS:"+15005550001 +15005550002 +15005550003 +15005550004 +15005550006 +15005550009".split(" "),INTERNATIONAL_ENABLED_NUMBER_REGEX:/^\+?\d{5,15}$/,
INTERNATIONAL_DISABLED_NUMBER_REGEX:/^(\+1|1)?\d{10}$/,INTERNATIONAL_ENABLED_NUMBER_MAX_LENGTH:16,INTERNATIONAL_DISABLED_NUMBER_MAX_LENGTH:12,isTestNumber:function(a){a="+"+k.get("phoneNumbers").digits(a);return _.contains(K.TEST_NUMBERS,a)},isTestNumberAllowed:function(){return window.slipstream&&"production"!=window.slipstream.configuration&&window.slipstream.isTwilioTestAccountEnabled},isEligiblePhoneNumber:function(a,b,c){if(K.isTestNumberAllowed()&&K.isTestNumber(a))return!0;var e=k.get("phoneNumbers");
return!e.isPossiblyValid(a)?!1:b?"US"===b?e.parseUsPhoneNumber(a).isUsPhoneNumber:!c?(console.warn("SmsNotification.isEligiblePhoneNumber: company not provided"),!1):c.features.isInternationalSmsEnabled:e.parseUsPhoneNumber(a).isUsPhoneNumber?!0:!c?(console.warn("SmsNotification.isEligiblePhoneNumber: company not provided"),!1):c.features.isInternationalSmsEnabled}},w={AVAILABILITY_MANIFEST_TYPE:r.AVAILABILITY_MANIFEST_TYPE,BOOKING_CONFIRMATION_TYPE:r.BOOKING_CONFIRMATION_TYPE,BOOKING_CANCELLATION_TYPE:r.BOOKING_CANCELLATION_TYPE,
NOTIFICATION_FAILURE_TYPE:r.NOTIFICATION_FAILURE_TYPE,CREW_CHANGE_TYPE:r.CREW_CHANGE_TYPE,CREW_REMINDER_TYPE:r.CREW_REMINDER_TYPE,DAILY_MANIFEST_TYPE:r.DAILY_MANIFEST_TYPE,DISPUTE_TYPE:r.DISPUTE_TYPE,INVOICE_UPLOAD_STATUS_UPDATE_TYPE:r.INVOICE_UPLOAD_STATUS_UPDATE_TYPE,DIRECT_BOOKING_OPTION:"isDirect",ONLINE_BOOKING_OPTION:"isOnline",AFFILIATE_BOOKING_OPTION:"isAffiliate",REBOOKED_BOOKING_OPTION:"isRebooked",isTypeSupported:function(a,b){return b===w.INVOICE_UPLOAD_STATUS_UPDATE_TYPE?(a.isAffiliate||
a.isCharter)&&a.isInvoicingEnabled:a.isCharter},isAnyTypeSupported:function(a){return _.some(w.TYPES,function(b){return w.isTypeSupported(a,b)})},isUserSubscribed:function(a,b,c){return _.some(a,function(a){return a.user===b&&a.type===c})}};w.TYPES=[w.AVAILABILITY_MANIFEST_TYPE,w.BOOKING_CANCELLATION_TYPE,w.BOOKING_CONFIRMATION_TYPE,w.NOTIFICATION_FAILURE_TYPE,w.CREW_CHANGE_TYPE,w.CREW_REMINDER_TYPE,w.DAILY_MANIFEST_TYPE,w.DISPUTE_TYPE,w.INVOICE_UPLOAD_STATUS_UPDATE_TYPE];w.ITEM_SUBSCRIPTION_TYPES=
[w.AVAILABILITY_MANIFEST_TYPE,w.BOOKING_CONFIRMATION_TYPE,w.BOOKING_CANCELLATION_TYPE,w.NOTIFICATION_FAILURE_TYPE,w.CREW_CHANGE_TYPE,w.CREW_REMINDER_TYPE];w.HOURS_BEFORE_SUBSCRIPTION_TYPES=[w.AVAILABILITY_MANIFEST_TYPE,w.CREW_REMINDER_TYPE,w.DAILY_MANIFEST_TYPE];w.HOURS_BEFORE_DEFAULTS={};w.HOURS_BEFORE_DEFAULTS[w.AVAILABILITY_MANIFEST_TYPE]=24;w.HOURS_BEFORE_DEFAULTS[w.CREW_REMINDER_TYPE]=24;w.HOURS_BEFORE_DEFAULTS[w.DAILY_MANIFEST_TYPE]=-6;w.CREW_AVAILABILITIES_ONLY_TYPES=[w.AVAILABILITY_MANIFEST_TYPE,
w.BOOKING_CONFIRMATION_TYPE];w.BOOKING_OPTION_TYPES=[w.BOOKING_CANCELLATION_TYPE,w.BOOKING_CONFIRMATION_TYPE];w.BOOKING_OPTIONS=[w.DIRECT_BOOKING_OPTION,w.ONLINE_BOOKING_OPTION,w.AFFILIATE_BOOKING_OPTION,w.REBOOKED_BOOKING_OPTION];w.BOOKING_OPTIONS_BY_TYPE={};w.BOOKING_OPTIONS_BY_TYPE[w.BOOKING_CANCELLATION_TYPE]=[w.DIRECT_BOOKING_OPTION,w.ONLINE_BOOKING_OPTION,w.AFFILIATE_BOOKING_OPTION];w.BOOKING_OPTIONS_BY_TYPE[w.BOOKING_CONFIRMATION_TYPE]=[w.DIRECT_BOOKING_OPTION,w.ONLINE_BOOKING_OPTION,w.AFFILIATE_BOOKING_OPTION,
w.REBOOKED_BOOKING_OPTION];var p={ORDER_CONFIRMATION_TYPE:r.ORDER_CONFIRMATION_TYPE,CANCELLATION_TYPE:r.BOOKING_CANCELLATION_TYPE,CONFIRMATION_TYPE:r.BOOKING_CONFIRMATION_TYPE,FOLLOW_UP_TYPE:r.BOOKING_FOLLOW_UP_TYPE,MESSAGE_TYPE:r.BOOKING_MESSAGE_TYPE,RECEIPT_TYPE:r.BOOKING_RECEIPT_TYPE,REBOOKED_TYPE:r.BOOKING_REBOOKED_TYPE,REFUNDED_TYPE:r.BOOKING_REFUNDED_TYPE,INVOICE_PAYMENT_REQUEST_TYPE:r.INVOICE_PAYMENT_REQUEST_TYPE,TYPES:[r.BOOKING_CANCELLATION_TYPE,r.BOOKING_CONFIRMATION_TYPE,r.BOOKING_FOLLOW_UP_TYPE,
r.BOOKING_MESSAGE_TYPE,r.BOOKING_RECEIPT_TYPE,r.BOOKING_REBOOKED_TYPE,r.BOOKING_REFUNDED_TYPE,r.INVOICE_PAYMENT_REQUEST_TYPE],BOOKING_TYPES:[r.BOOKING_CANCELLATION_TYPE,r.BOOKING_CONFIRMATION_TYPE,r.BOOKING_FOLLOW_UP_TYPE,r.BOOKING_MESSAGE_TYPE,r.BOOKING_RECEIPT_TYPE,r.BOOKING_REBOOKED_TYPE,r.BOOKING_REFUNDED_TYPE],ORDER_TYPES:[r.BOOKING_CANCELLATION_TYPE,r.BOOKING_CONFIRMATION_TYPE,r.BOOKING_MESSAGE_TYPE,r.BOOKING_RECEIPT_TYPE,r.BOOKING_REFUNDED_TYPE],displayType:r.displayType},O={PENDING_STATUS:"pending",
DISPUTED_STATUS:"disputed",WON_STATUS:"won",LOST_STATUS:"lost",REFUNDED_STATUS:"refunded",displayStatus:function(a){return _.capitalize(a)}};O.OPEN_STATUSES=[O.PENDING_STATUS,O.DISPUTED_STATUS];O.CLOSED_STATUSES=[O.WON_STATUS,O.LOST_STATUS,O.REFUNDED_STATUS];O.STATUSES=O.OPEN_STATUSES.concat(O.CLOSED_STATUSES);var I={CC_TYPE:"balanced-cc",LEGACY_CC_TYPE:"cc",IN_STORE_TYPE:"in-store",AFFILIATE_TYPE:"affiliate",STORED_VALUE_CARD_TYPE:"stored-value-card",MIN_CHARGE_AMOUNT:50,PENDING_DISPUTE_STATUS:"pending",
DISPUTED_DISPUTE_STATUS:"disputed",WON_DISPUTE_STATUS:"won",LOST_DISPUTE_STATUS:"lost",REFUNDED_DISPUTE_STATUS:"refunded",isOpenDisputeStatus:function(a){return _.contains(I.OPEN_DISPUTE_STATUES,a.disputeStatus)},isClosedDisputeStatus:function(a){return _.contains(I.CLOSED_DISPUTE_STATUSES,a.disputeStatus)},isDisputedAndNonRefundable:function(a){return a.disputeStatus===I.DISPUTED_DISPUTE_STATUS||a.disputeStatus===I.LOST_DISPUTE_STATUS||a.disputeStatus===I.REFUNDED_DISPUTE_STATUS},isEmv:function(a){return a.type===
I.CC_TYPE&&a.metadata&&a.metadata.isEmv},isEmvSignatureRequired:function(a){return I.isEmv(a)&&a.metadata.isEmvSignatureRequired},emvDetails:function(a){if(!I.isEmv(a))return[];var b=_.toTrueKeys("Date;Time;Amount;Description;Name;Address;Zip;City;Country;Contact;Additional Information;Account".split(";"));return _.filter(a.metadata.emvDetails,function(a){return!b[a.key]})},isPartialRefundAllowed:function(a){return!I.isAnyCreditCardType(a)||!a.isDisputed||a.disputeStatus===I.WON_DISPUTE_STATUS||a.disputeStatus===
I.PENDING_DISPUTE_STATUS},COUNTRIES_WITH_POSTAL_CODES:["US"],DEMO_CARD_NUMBERS:["4111111111111111","5105105105105100","341111111111111","4242424242424242"],isNotCardOnFileCreditCardType:function(a){return I.isAnyCreditCardType(a)&&!a.isCardOnFile},isAnyCreditCardType:function(a){return a.type===I.CC_TYPE||a.type===I.LEGACY_CC_TYPE},isDemoCardNumber:function(a){return _.contains(I.DEMO_CARD_NUMBERS,a)},needsPostalCode:function(a){return _.contains(I.COUNTRIES_WITH_POSTAL_CODES,a)},cardPayments:function(a,
b){var c={};_.forEach(a,function(a){if(!b&&a.type===I.CC_TYPE||b&&I.isAnyCreditCardType(a)){var e=a.cardType+"-"+a.cardLast4;c[e]||(c[e]=a)}});return _.values(c)},relatedCardPayments:function(a,b){return _.union.apply(null,_.map(a.contact.relatedBookings,function(a){return I.cardPayments(a.payments,b)}))},isGratuityEnabled:function(a){return _.any(_.map(a.bookings?a.bookings:[a.booking],"item"),{isGratuityEnabled:!0})},receiptFooters:function(a){return _.filter(_.map(I.items(a),"receiptFooter"))},
order:function(a){return a.bookings&&a.bookings.length?a.bookings[0].order:null},hasMultipleVisibleContributingBookings:function(a){return!a.bookings?!1:1<a.bookings.length+ +!!a.invisibleBookingCount},items:function(a){return a.booking?[a.booking.item]:s.uniqueItems(a.bookings)},sortByCreatedAt:function(a){return _.sortByOrder(a,function(a){return moment.isMoment(a.createdAt)?a.createdAt.unix():0},!1)},printablePayments:function(a){a=_.map(a,function(a){return a.aggregatedPayment&&a.aggregatedPayment.isAggregated?
a.aggregatedPayment:a});return _.filter(a,function(a){return!a.isDeferred&&a.type!==I.AFFILIATE_TYPE})}};I.OPEN_DISPUTE_STATUES=[I.PENDING_DISPUTE_STATUS,I.DISPUTED_DISPUTE_STATUS];I.CLOSED_DISPUTE_STATUSES=[I.WON_DISPUTE_STATUS,I.LOST_DISPUTE_STATUS,I.REFUNDED_DISPUTE_STATUS];var R={NO_REPEAT:"none",WEEKLY_REPEAT:"weekly",MONTHLY_REPEAT:"monthly",ALL_DAY_PERIOD:"all-day",TIME_RANGE_PERIOD:"time-range",DAY_RANGE_PERIOD:"day-range",FAILED_STATUS:"failed",SUCCEEDED_STATUS:"succeeded",WEEK_DAYS:"sunday monday tuesday wednesday thursday friday saturday".split(" "),
WEEK_DAYS_SHORT:{sunday:"Su",monday:"M",tuesday:"T",wednesday:"W",thursday:"Th",friday:"F",saturday:"S"},weekDaysDefaultModel:function(){var a={};_.forEach(R.WEEK_DAYS,function(b){a[b]=!0});return a},defaultRule:function(){var a={period:R.TIME_RANGE_PERIOD,repeat:R.NO_REPEAT,hours:"",time:"",startOn:null,endOn:null};_.extend(a,R.weekDaysDefaultModel());return a}},H={ADJUSTMENT_TAG:"adjustment",FUND_BOOKING_FEE_PROCESSING_FEE_TAG:"fund-booking-fee",FUND_PROCESSING_FEE_TAG:"fund-processing-fee",OTHER_TAG:"other",
PAYMENT_BOOKING_FEE_TAG:"payment-booking-fee",PAYMENT_BOOKING_FEE_PROCESSING_FEE_TAG:"payment-booking-fee-processing-fee",PAYMENT_GROSS_TAG:"payment-gross",PAYMENT_PROCESSING_FEE_TAG:"payment-processing-fee",PAYOUT_TAG:"payout",REFUND_GROSS_TAG:"refund-gross",REFUND_BOOKING_FEE_TAG:"refund-booking-fee",REFUND_BOOKING_FEE_PROCESSING_FEE_TAG:"refund-booking-fee-processing-fee",REFUND_PROCESSING_FEE_TAG:"refund-processing-fee",TRANSFER_TAG:"transfer",UPLOAD_TAG:"upload",UNKNOWN_TAG:"",displayTag:function(a){return a===
H.UNKNOWN_TAG?"Unknown":_.capitalize(a.split("-").join(" "))}};H.TAGS=[H.ADJUSTMENT_TAG,H.FUND_BOOKING_FEE_PROCESSING_FEE_TAG,H.FUND_PROCESSING_FEE_TAG,H.OTHER_TAG,H.PAYMENT_BOOKING_FEE_TAG,H.PAYMENT_BOOKING_FEE_PROCESSING_FEE_TAG,H.PAYMENT_GROSS_TAG,H.PAYMENT_PROCESSING_FEE_TAG,H.PAYOUT_TAG,H.REFUND_GROSS_TAG,H.REFUND_BOOKING_FEE_TAG,H.REFUND_BOOKING_FEE_PROCESSING_FEE_TAG,H.REFUND_PROCESSING_FEE_TAG,H.TRANSFER_TAG,H.UPLOAD_TAG,H.UNKNOWN_TAG];var ca={INDIVIDUAL_ACCOUNT_HOLDER_TYPE:"individual",COMPANY_ACCOUNT_HOLDER_TYPE:"company",
ROUTING_NUMBER_REGEX_BY_COUNTRY:{AU:/^[\d]{6}$/,CA:/^0?[\d]{5}-?[\d]{3}$/,GB:/^[\d]{2}-?[\d]{2}-?[\d]{2}$/,NZ:/^[\d]{6}$/,US:/^[\d]{9}$/},isIbanRequired:function(a){if(!a)return!1;var b=k.get("db").slipstream("ibanBankAccountCountries");return!_.isArray(b)?(console.warn("BankAccount.isIbanRequired: invalid value for ibanBankAccountCountries",b),!1):_.contains(b,a)},isRoutingNumberRequired:function(a){return!ca.isIbanRequired(a)}},l={getCurrencyChoices:l},Z={VALID_VALIDITY:"valid",INVALID_VALIDITY:"invalid",
DATE_RANGE_FOR_AVAILABILITY_TYPE:"range-for-booking",DATE_RANGE_FOR_BOOKING_TYPE:"range-for-availability",displayDayPattern:function(a){if(!_.contains([Z.DATE_RANGE_FOR_AVAILABILITY_TYPE,Z.DATE_RANGE_FOR_BOOKING_TYPE],a.type))return"";a=a.dayPattern||[];return!a.length||a.length===R.WEEK_DAYS.length?"":_.map(a,function(a){return R.WEEK_DAYS_SHORT[a]}).join(", ")}},aa={FLAT_FEE_RULE_TYPE:"flat",MAXIMUM_FEE_RULE_TYPE:"maximum",calculateFeeableForFee:function(a,b){return _.roundHalfToEven(a/b)},calculateFeeableForRule:function(a,
b,c){if(a.feeType!==g.PERCENTAGE_FEE_TYPE||!a.percentageFeeRate)return 0;a=a.percentageFeeRate;if(c.type===aa.FLAT_FEE_RULE_TYPE)return aa.calculateFeeableForFee(c.amount,a);if(c.type===aa.MAXIMUM_FEE_RULE_TYPE){var e=_.roundHalfToEven(b*a);c=c.amount;return e>c?aa.calculateFeeableForFee(c,a):b}console.warn("StoredValueCard.calculateFeeableForRule: invalid rule type",c.type);return 0},calculateFeeable:function(a,b){if(!a.features.isStoredValueCardBookingFeesEnabled)return 0;var c=k.get("db").slipstream("storedValueCardFeeableRules");
if(_.isUndefined(c))return console.warn("StoredValueCard.calculateFeeable: rules are not defined"),0;c=c[a.country];if(!c)return 0;if(c.isUnrestricted)return b;var e=a.province;if(_.contains(c.unrestrictedProvinces,e))return b;c=c.provinceRules[e];return!c?0:aa.calculateFeeableForRule(a,b,c)},NUMBER_REGEX:/^[a-zA-Z0-9\-_\#\%$]+$/,isNumberValid:function(a){return aa.NUMBER_REGEX.test(a)}},ea={MIN_QR_CODE_SIZE:1,MAX_QR_CODE_SIZE:1.3,STANDARD:{name:"Standard",settings:{isCompanyInformationIncluded:!0,
isRotated:!1,len:5.5,height:2,marginTop:0.125,marginRight:0.125,marginBottom:0.125,marginLeft:0.125,hasLeadingStub:!0,leadingStubLength:1,leadingStubMarginTop:0.125,leadingStubMarginBottom:0.125,hasTrailingStub:!1,trailingStubLength:1,trailingStubMarginTop:0.125,trailingStubMarginBottom:0.125}},BLANK:{name:"",settings:{isCompanyInformationIncluded:!0,isRotated:!1,len:5.5,height:2,marginTop:0.125,marginRight:0.125,marginBottom:0.125,marginLeft:0.125,hasLeadingStub:!0,leadingStubLength:1,leadingStubMarginTop:0.125,
leadingStubMarginBottom:0.125,hasTrailingStub:!1,trailingStubLength:1,trailingStubMarginTop:0.125,trailingStubMarginBottom:0.125}},mainLeft:function(a){var b=a.settings.marginLeft;a.settings.hasTrailingStub&&(b+=a.settings.trailingStubLength);return b},mainRight:function(a){var b=a.settings.marginRight;a.settings.hasLeadingStub&&(b+=a.settings.leadingStubLength);return b},qrCodeSize:function(a){a=a.settings.height-a.settings.marginTop-a.settings.marginBottom;a<ea.MIN_QR_CODE_SIZE&&(a=ea.MIN_QR_CODE_SIZE);
a>ea.MAX_QR_CODE_SIZE&&(a=ea.MAX_QR_CODE_SIZE);return a},BOCA_PRINT_FORMAT:"boca",RECEIPT_PRINT_FORMAT:"receipt"},fa={ADMIN_ONLY_TYPE:"admin",ADMIN_ONLY_TYPES:"admin admin-charge-disputed admin-dispute-closed duplicated-x-companies duplicated-x-companies-single generated-report ran-report rejected-sms updated-sms-notification-status card-error processor-webhook-error transferred-payment was-transferred-payment webhook-request-failed webhook-request-succeeded".split(" "),CHANGED_TYPES:["changed","changed-company-admin-notes",
"changed-booking-note","changed-customer-checkin-status"],isAdminOnly:function(a){return _.contains(fa.ADMIN_ONLY_TYPES,a.type)},isChangedType:function(a){return _.contains(fa.CHANGED_TYPES,a)},objectUrl:function(a){var b;a.object&&(b=a.object.$url());b||(b=a.company.$url());return b},_changesByFieldName:{},changesByFieldName:function(a){var b=fa._changesByFieldName[a.uri];if(b)return b;b={};_.forEach(a.context.changes,function(a){b[h.camelKey(a.field)]=a});return fa._changesByFieldName[a.uri]=b}},
J={NO_CUSTOM_TAX:"no",ONLY_TAXED_CUSTOM_TAX:"only-taxed",ALL_CUSTOM_TAX:"all",ALWAYS_CUSTOM_TAX:"always",INHERIT_TAX_INCLUSION:"inherit",INCLUDED_TAX_INCLUSION:"included",NOT_INCLUDED_TAX_INCLUSION:"not-included",displayTaxInclusion:function(a){var b={};b[J.INHERIT_TAX_INCLUSION]="Inherit";b[J.INCLUDED_TAX_INCLUSION]="Tax included";b[J.NOT_INCLUDED_TAX_INCLUSION]="Tax not included";return b[a]},isTaxOnly:function(a){return a!==N.PriceLine.NO_CUSTOM_TAX},displayCustomTax:function(a){var b={};b[J.NO_CUSTOM_TAX]=
"Standard tax";b[J.ONLY_TAXED_CUSTOM_TAX]="Custom tax";b[J.ALL_CUSTOM_TAX]="Custom tax (include untaxed)";b[J.ALWAYS_CUSTOM_TAX]="Custom tax (include untaxed, even on untaxed sheets)";return b[a]||b[J.NO_CUSTOM_TAX]},INHERIT_PRICE_TYPE:"inherit",CHANGE_PRICE_TYPE:"change",INHERIT_SHEET_RATE_TYPE:"inherit",CHANGE_SHEET_RATE_TYPE:"change",OFFSET_MODIFIER_KIND:"offset",PERCENTAGE_MODIFIER_KIND:"percentage",ADJUST_MODIFIER_TYPE:"adjust",SET_MODIFIER_TYPE:"set",NONE_MODIFIER_TYPE:"none",showOffset:function(a){return J.isTaxOnly(a.price.customTax)||
a.price.modifierType===J.NONE_MODIFIER_TYPE?!1:a.price.modifierKind===J.OFFSET_MODIFIER_KIND&&(a.price.offset||a.price.modifierType===J.SET_MODIFIER_TYPE)},showRate:function(a){return J.isTaxOnly(a.price.customTax)||a.price.modifierType===J.NONE_MODIFIER_TYPE?!1:a.price.modifierKind===J.PERCENTAGE_MODIFIER_KIND&&(a.price.rate||a.price.modifierType===J.SET_MODIFIER_TYPE)},effectiveOffset:function(a,b){if(a.price.modifierType===J.NONE_MODIFIER_TYPE)return 0;b=_.isUndefined(b)?1:b;return _.roundHalfToEven(a.price.offset*
a.sheetRate.sheetRate*b)},effectiveRate:function(a,b){if(a.price.modifierType===J.NONE_MODIFIER_TYPE)return 0;b=_.isUndefined(b)?1:b;return a.price.rate*b},modifierKindChoices:function(a){var b,c=k.get("db").slipstream("currencies");if(c){var e=_.resolveCurrency(a);if(c=c[e])b=c.symbol}b||(console.warn("modifierKindChoices: unable to determine currency symbol",a),b="$");return[[J.PERCENTAGE_MODIFIER_KIND,"%"],[J.OFFSET_MODIFIER_KIND,b]]}},ya=_.property("isOnline"),za=_.property("isBase"),ja=_.property("isTotalBase"),
W=_.property("isInvoiceBase"),U=function(a){return!a.isBase&&!a.isTotalBase&&!a.isInvoiceBase},Q={NONE_TAXABILITY:"none",PRO_RATE_TAXABILITY:"pro-rate",FULL_TAXABILITY:"full",OFFSET_MODIFIER_KIND:"offset",PERCENTAGE_MODIFIER_KIND:"percentage",ADJUST_MODIFIER_TYPE:"adjust",SET_MODIFIER_TYPE:"set",baseSheet:function(a){return _.find(a,za)},nonBaseSheets:function(a){return _.filter(a,U)},sheetRateToModel:function(a){return _.roundHalfToEven(100*a,7)},sheetRateFromModel:function(a){return a/100},taxable:function(a){if(a.price.modifierType===
J.NONE_MODIFIER_TYPE)return 0;var b=a.price.taxability;if(b===Q.NONE_TAXABILITY)return 0;if(b===Q.PRO_RATE_TAXABILITY)return J.effectiveOffset(a);if(b===Q.FULL_TAXABILITY)return a.price.offset;console.warn("invalid taxability",b);return 0},isNonBase:U};J.NONE_PRICING={visibility:{isVisible:!0,isHiddenWhenBooking:!1,isHiddenOnReceipts:!1,isRequired:!1},price:{modifierType:J.NONE_MODIFIER_TYPE,taxability:Q.PRO_RATE_TAXABILITY},sheetRate:{sheetRate:1}};J.HIDDEN_PRICING={visibility:{isVisible:!1,isHiddenWhenBooking:!1,
isHiddenOnReceipts:!1,isRequired:!1},price:{modifierType:J.NONE_MODIFIER_TYPE},sheetRate:{sheetRate:1}};var M=_.extend({baseSheet:Q.baseSheet,totalBaseSheet:function(a){return _.find(a,ja)},nonBaseSheets:Q.nonBaseSheets,onlineSheets:function(a){return _.filter(a,ya)},displaySheetRate:function(a){return a-1},fromDisplaySheetRate:function(a){return a+1}},Q),oa=_.extend({INHERIT_VISIBILITY:"inherit",VISIBLE_VISIBILITY:"visible",HIDDEN_VISIBILITY:"hidden"},J),V=_.extend({AFFILIATE_RELATIONSHIP:"affiliate",
CHARTER_RELATIONSHIP:"charter",invoiceBaseSheet:function(a){return _.find(a,W)},nonBaseSheets:Q.nonBaseSheets,displaySheetRate:function(a,b){if(b===V.CHARTER_RELATIONSHIP)return 1-a;if(b===V.AFFILIATE_RELATIONSHIP)return a},fromDisplaySheetRate:function(a,b){if(b===V.CHARTER_RELATIONSHIP)return 1-a;if(b===V.AFFILIATE_RELATIONSHIP)return a},displayRelationship:function(a){return a===V.CHARTER_RELATIONSHIP?"reseller":a===V.AFFILIATE_RELATIONSHIP?"referral":"none"}},Q),Aa=_.extend({},J),X={},ha=function(){var a=
{GOOGLE_ANALYTICS_TYPE:"google-analytics",FACEBOOK_TYPE:"facebook",ADROLL_TYPE:"adroll",OPTIMIZELY_TYPE:"optimizely",CUSTOM_CODE_TYPE:"custom-code",IDENTIFIERS_BY_TYPE:{},IDENTIFIER_LABELS:{googleAnalyticsUa:"UA Code",facebookPixel:"Pixel ID",adrollAdvertiser:"Advertiser ID",adrollPixel:"Pixel ID",optimizelyAccount:"Account ID",optimizelyProject:"Project ID",optimizelyEventKey:"Goal Event",optimizelyGoals:"Goal ID(s)",customCode:"Code",customIdentifiers:"Identifiers"},needsCrossDomainField:function(b){return _.includes([a.GOOGLE_ANALYTICS_TYPE,
a.FACEBOOK_TYPE,a.ADROLL_TYPE,a.OPTIMIZELY_TYPE],b)},displayIdentifier:function(b){return a.IDENTIFIER_LABELS[b]}},b=a.IDENTIFIERS_BY_TYPE;b[a.GOOGLE_ANALYTICS_TYPE]=["googleAnalyticsUa"];b[a.FACEBOOK_TYPE]=["facebookPixel"];b[a.ADROLL_TYPE]=["adrollAdvertiser","adrollPixel"];b[a.OPTIMIZELY_TYPE]=["optimizelyAccount","optimizelyProject","optimizelyEventKey","optimizelyGoals"];b[a.CUSTOM_CODE_TYPE]=["customCode","customIdentifiers"];return a}(),ka=function(a){var b=a.split("-")[0];return pa.DISPLAY_LANGUAGES[a]||
pa.DISPLAY_LANGUAGES[b]},pa={display:function(a){return ka(a).name},displayLocal:function(a){return ka(a).nameLocal}},ga={BEFORE_MIDNIGHT_CUTOFF_KIND:"before-midnight",BEFORE_START_CUTOFF_KIND:"before-start",RESTRICTION_FIELDS:"minimumInitialPartySize minimumSubsequentPartySize maximumInitialPartySize maximumSubsequentPartySize isBookableEverByPhone soldOutText cutoffUnreachedKind cutoffUnreachedHours isCutoffUnreachedCallToBook cutoffReachedKind cutoffReachedHours isCutoffReachedCallToBook autoOpenHours autoOpenKind".split(" "),
DEFAULT_AUTO_OPEN_HOURS:720,cutoffStart:function(a,b,c){if(a===ga.BEFORE_START_CUTOFF_KIND)return c.clone().subtract(b,"hours");if(a===ga.BEFORE_MIDNIGHT_CUTOFF_KIND)return c.clone().startOf("day").subtract(b,"hours");console.error("BookingRestriction.cutoffStart: invalid kind "+a)}},N={Order:v,Contact:c,Booking:s,Customer:{},LineItem:{},ItemGroup:{},Availability:A,Company:g,User:{OWNER_TYPE:"owner",ADMIN_TYPE:"admin",EMPLOYEE_TYPE:"employee",ICS_RESELLER_KEY_NAME:"ICS Calendar"},TagGroup:{},Tag:{},
TagInstance:{},Item:B,FlowNode:y,CustomFieldInstanceGroup:{},CustomFieldInstanceCondition:F,CustomFieldInstance:e,CustomerType:{},CustomerPrototype:{name:function(a){return a.displayName},customerTypeSuffix:function(a){(a=_.compact([a.name?a.customerType.shortName||a.customerType.plural:"",a.isExclusive?"exclusive":""]).join(", "))&&(a="("+a+")");return a}},CustomerTypeRate:D,CheckinStatus:G,Image:{CAROUSEL_GALLERY:"carousel"},CustomField:t,ExtendedOption:{},TransportationOption:{},ConnectedCampaign:{},
GeneratingCampaign:{},CannedMessage:p,Notification:r,SmsNotification:K,ReviewExpressNotification:{},Subscription:w,Payment:I,Dispute:O,InStorePaymentType:{isUsable:function(a,b){var c=b.isCharter&&a.isVisibleWhenCollectedByCharter;return b.isAffiliate&&a.isVisibleWhenCollectedByAffiliate||c},isVisibleWhenCollectedByCharter:function(a){return _.filter(a,"isVisibleWhenCollectedByCharter")},isVisibleWhenCollectedByAffiliate:function(a){return _.filter(a,"isVisibleWhenCollectedByAffiliate")}},EmvDevice:{},
Refund:{FAILED_TRANSFER_STATUS:"failed",SUCCEEDED_TRANSFER_STATUS:"succeeded"},Receipt:{ALL_PAYMENT_RECEIPTS:"all",printedAt:function(){return moment()}},Rule:R,Payout:{SUCCEEDED_STATUS:"succeeded",PAID_STATUS:"paid",PENDING_STATUS:"pending",FAILED_STATUS:"failed",PROCESSED_STATUS:"processed"},Fund:{},Transfer:{},Upload:{SUCCEEDED_STATUS:"succeeded",PENDING_STATUS:"pending",FAILED_STATUS:"failed"},Transaction:H,Account:{BANK_TYPE:"bank",DEPOSIT_TYPE:"deposit",ESCROW_TYPE:"escrow"},Adjustment:l,Campaign:{},
CampaignValidityRule:Z,Code:{},StoredValueType:{},StoredValueCard:aa,StoredValueAdjustment:{},TicketLayout:ea,CustomCalendar:{},CustomManifest:{},CustomReport:{QUERY_PARAM:"saved",QUERY_PARAM_KEY:"pk"},SuggestedReport:{QUERY_PARAM:"suggested",QUERY_PARAM_KEY:"slug",DEFAULT_SLUG:"default"},Activity:fa,Block:{},Agent:{OTHER_AGENT:{name:"Add new agent",pk:-1}},Desk:{OTHER_DESK:{name:"Add new desk",pk:-1}},Affiliation:z,CrewMember:{},Role:{},Hotel:{},Lodging:{},PreferredPickup:{},Pickup:{},Route:{},Stop:{},
Run:{},Report:u,Invoice:{PAID_STATUS:"paid",PENDING_STATUS:"pending",UNPAID_STATUS:"unpaid",OVERDUE_STATUS:"overdue",isInvoicedToCharter:function(a){return 0<a}},InvoiceEntry:{},Location:{},SupportedLanguage:pa,Translation:{displayNameForInstance:function(a){return a.name||a.displayName||a.title||a.unicode},fieldDisplayValue:function(a,b){var c=_.camelCase(a.fieldName);return b[c]},modelNameForUrl:function(a){return _.kebabCase(a)},modelNameFromUrl:function(a){return _.startCase(a).replace(/ /g,"")},
fieldNameForUrl:function(a){return _.kebabCase(a)},fieldNameFromUrl:function(a){return _.snakeCase(a)}},ViatorMapping:{},Waiver:{},ConnectedWaiver:{},WaiverInstance:{},Group:{AFFILIATE_TYPE:"affiliate",COMPANY_TYPE:"company",PARTNER_TYPE:"partner"},GroupOverride:{companyLevelOverrides:function(a){return _.filter(a,function(a){return null===a.relatedUser})}},PriceSheet:Q,PriceLine:J,TotalSheet:M,TotalLine:oa,InvoiceSheet:V,InvoiceLine:Aa,BankAccount:ca,Card:{},CardAffiliation:{},CustomFieldValue:{},
BookingCustomFieldValue:X,CustomerCustomFieldValue:{},Resource:{NONE_GRANULARITY:"none"},RequirementGroup:{},Requirement:q,CustomerPrototypeRequirement:{},ResourceRequirement:{START_TIMING:"start-timing",END_TIMING:"end-timing",DATE_TIMING:"date-timing",PADDING_END_AT_KIND:"padding-kind",LENGTH_END_AT_KIND:"length-kind"},ResourceUse:{displayOption:function(a){return a?a.isIgnoreOveruse?"Create uses, don't check overuse":a.isSkipResourceUseCreation?"Don't create uses, check overuse":"Create uses, check overuse":
""},equals:function(a,b){return _.isUndefined(a.customerTypeRate)||_.isUndefined(b.customerTypeRate)?a.booking.pk===b.booking.pk&&a.resourceRequirement.pk===b.resourceRequirement.pk&&a.useCount===b.useCount:a.customerTypeRate.pk===b.customerTypeRate.pk&&a.resourceRequirement.pk===b.resourceRequirement.pk&&a.useCount===b.useCount},resourceUseSummaries:function(a,b){b=b||[];return _.reduce(function(a){return _.reduce(a,function(a,b){var c=b.resourceRequirement.resource;a[c.pk]=a[c.pk]||[];a[c.pk].push(b);
return a},{})}(a),function(a,c,e){a[e]=a[e]||{};a[e].totalUseCount=parseFloat(_.sum(c,"useCount").toFixed(2));a[e].resourcePk=e;a[e].resourceName=c[0].resourceRequirement.resource.name;a[e].isOverused=-1<_.map(b,"pk").indexOf(parseInt(e));return a},{})},resourceUseSummaryKey:function(a,b){return a+"-"+b}},ResourceOverride:{},Calendar:b,Day:{},ResellerCompany:{},ResellerCompanyMapping:{},ResellerItem:{},ResellerItemMapping:{},ResellerCustomerType:{},ResellerCustomerTypeMapping:{},ResellerOption:{},
ResellerOptionMapping:{},ResellerKey:{},ResellerApp:{},ResellerAppCompany:{},AnalyticsService:ha,CancellationPolicy:{},CancellationRule:{ALWAYS_TYPE:"always",HOURS_BEFORE_AVAILABILITY_START_TYPE:"hours-before-start",HOURS_BEFORE_AVAILABILITY_MIDNIGHT_TYPE:"hours-before-midnight",HOURS_BEFORE_PSEUDO_TYPE:"hours-before"},BookingRestriction:ga},qa=_.keys(N);_.forEach(qa,function(a){N[a].cls=a});N.inject=function(a){_.forEach(qa,function(b){a[b]=N[b]})};return N}]);n.run(["$filter","$rootScope","db",
"emv","models","navigation","processors","urls",function(c,k,h,d,f,m,a,p){f.inject(k);k.nullModel={};f.Company.taxDisplayRate=function(a){return a.features.includedTaxRate?c("percentage")(a.features.includedTaxRate,!0):""};f.Availability.manifestUrl=function(a){return m.compose(p.populate(p.dashboard.manifest.availabilities,{shortname:a.company.shortname,date:a.startAt?a.startAt.format("YYYY-MM-DD"):void 0}),{items:a.item.pk,availabilities:a.pk})};f.Run.manifestUrl=function(a){return m.compose(p.populate(p.dashboard.manifest.runs,
{shortname:a.route.company.shortname,date:a.startAt?a.startAt.format("YYYY-MM-DD"):void 0}),{routes:a.route.pk})};f.Item.manifestUrl=function(a,b){return m.compose(p.populate(p.dashboard.manifest.availabilities,{shortname:a.company.shortname,date:b}),{items:a.pk})};f.Resource.manifestUrl=function(a,b){return m.compose(p.populate(p.dashboard.manifest.resources,{shortname:a.company.shortname,date:b}),{resources:a.pk})};f.Booking.processorTypes=function(a){a=a||[];return _.filter(_.sortBy(_.uniq(_.pluck(a,
"processorType"))))};f.Booking.statementText=function(b,c){var d=b.statementText,l=f.Booking.processorTypes(c);return _.map(l,function(b){return'"'+a.get(b).STATEMENT_TEXT_PREFIX+d+'"'}).join(" or ")};f.Booking.pendingStatementText=function(b){b=f.Booking.processorTypes([b]);return _.map(b,function(b){return'"'+a.get(b).PENDING_STATEMENT_TEXT+'"'}).join(" or ")};f.Payment.isDefaultCreditCardType=function(b){return b.type===f.Payment.CC_TYPE&&b.processorType===a.DEFAULT_PROCESSOR_TYPE};f.Payment.isLegacyCreditCardType=
function(a){return f.Payment.isAnyCreditCardType(a)&&!f.Payment.isDefaultCreditCardType(a)};var l=f.Report;l.MODELS={};l.MODELS[f.Booking.cls]={name:"Bookings",singular:"Booking",slug:"bookings",model:f.Booking,submodels:[]};l.MODELS[f.Customer.cls]={name:"Customers",singular:"Customer",slug:"customers",model:f.Customer,submodels:[f.Booking]};l.MODELS[f.LineItem.cls]={name:"Expenses and Discounts",singular:"Expense and discount",slug:"expenses-and-discounts",model:f.LineItem,submodels:[f.Booking]};
l.MODELS[f.CustomFieldValue.cls]={name:"Custom Field Answers",singular:"Custom field answer",slug:"custom-field-answers",model:f.CustomFieldValue,submodels:[f.Customer,f.Booking]};l.MODELS[f.Payment.cls]={name:"Sales",singular:"Sales",slug:"payments-and-refunds",model:f.Payment,submodels:[f.Booking]};l.ORDERED_MODELS=[f.Payment,f.Booking,f.Customer,f.CustomFieldValue,f.LineItem];l.UNSOUND_AGGREGATES={Payment:[f.Booking],Booking:[],Customer:[f.Booking],CustomFieldValue:[f.Booking,f.Customer],LineItem:[f.Booking]};
l.advancedUrl=function(a,b){return p.populate(p.dashboard.reports.advanced.index,{shortname:a.shortname,modelSlug:l.MODELS[b].slug})};l.SWITCH_QUERY_PARAM_KEY="switch";l.advancedSwitchUrl=function(a,b){var c={};c[l.SWITCH_QUERY_PARAM_KEY]=!0;return m.compose(l.advancedUrl(a,b),c)};l.VALID_COLUMNS=h.slipstream("reports.validColumns");l.VALID_GROUPS=h.slipstream("reports.validGroups");l.VALID_FILTERS=h.slipstream("reports.validFilters");l.PROHIBITED_GROUPS=h.slipstream("reports.prohibitedGroups");l.PROHIBITED_HIGHER_GROUPS=
h.slipstream("reports.prohibitedHigherGroups");l.ALWAYS_UNSOUND_GROUPINGS=h.slipstream("reports.alwaysUnsoundGroupings");_.extend(l,h.slipstream("reports.allColumns"));_.extend(l,h.slipstream("reports.allGroups"));_.extend(l,h.slipstream("reports.allFilters"));_.extend(l,h.slipstream("reports.allDateRanges"));l.MODELS_BY_GROUP={};_.forEach(l.VALID_GROUPS,function(a,b){_.forEach(a,function(a){l.MODELS_BY_GROUP[a]=l.MODELS_BY_GROUP[a]||[];l.MODELS_BY_GROUP[a].push(f[b])})});f.ResourceUse.OPTIONS=h.slipstream("resourceUse.options");
f.ResourceUse.OPTIONS_VALUES_KEYS_MAP=_.reduce(f.ResourceUse.OPTIONS,function(a,b){a[b.value]=b.key;return a},{});f.ResourceUse.OPTIONS_KEYS_DISPLAY_TEXT_MAP=_.reduce(f.ResourceUse.OPTIONS,function(a,b){a[b.key]=b.displayText;return a},{});f.ResourceUse.getUseSettings=function(a){var b;a.cls===f.ResourceRequirement.cls?b=[String(a.isSkipCreation),String(a.isIgnoreResourceOveruse)].join("-"):a.cls===f.Resource.cls?b=[String(a.isSkipResourceUseCreation),String(a.isIgnoreOveruse)].join("-"):console.error("invalid object passed to ResourceUse.getUseSettings");
return f.ResourceUse.OPTIONS_VALUES_KEYS_MAP[b]};f.ResourceUse.getDisplayText=function(a){a=f.ResourceUse.getUseSettings(a);return f.ResourceUse.OPTIONS_KEYS_DISPLAY_TEXT_MAP[a]};f.CustomReport.url=function(a){var b=l.advancedUrl(a.company,a.options.modelName),c={};c[f.CustomReport.QUERY_PARAM]=a[f.CustomReport.QUERY_PARAM_KEY];return m.compose(b,c)};f.SuggestedReport.url=function(a,b){var c=l.advancedUrl(b,a.options.modelName),d={};d[f.SuggestedReport.QUERY_PARAM]=a.slug;return m.compose(c,d)};f.Item.frontendUrl=
function(a,b){return b?p.populate(p.company.item.month,{shortname:a.company.shortname,itemPk:a.pk,year:b.format("YYYY"),month:b.format("MM")}):a.$url(p.company.item.index)};f.FlowNode.frontendUrl=function(a,b){var c="";return c=a.externalUrl?a.externalUrl:a.item?f.Item.frontendUrl(a.item,b):a.$url(p.company.flowNode.index)};f.FlowNode.suggestedItemUrl=function(a,b){var c;c=a.item&&a.item.externalUrl&&!a.externalUrl?a.item.externalUrl:f.FlowNode.frontendUrl(a,b);var d={};a.type!==f.FlowNode.PAGE_TYPE&&
(d[f.FlowNode.FLOW_QUERY]=a.parent.pk);d[f.FlowNode.IS_SUGGESTED_QUERY]=!0;return m.compose(c,d,!0)};_.extend(f.CampaignValidityRule,h.slipstream("campaignValidityRules.allTypes"));if(d.isDebugging){f.Payment.isEmv=function(a){return a.type===f.Payment.CC_TYPE};f.Payment.isEmvSignatureRequired=function(a){return 0===a.pk%2};var b=f.Payment.emvDetails;f.Payment.emvDetails=function(a){a.metadata||(a.metadata={});a.metadata.emvDetails=d.debugDetails;return b(a)}}f.SupportedLanguage.DISPLAY_LANGUAGES=
h.slipstream("displayLanguages")}])})();
(function(){var n=angular.module("lib.processors",["auth.services","db.services","lib.services","navigation.services"]),c={UNSUPPORTED:"Unsupported processor. Please refresh the page and try again. If you continue to have trouble please contact support@fareharbor.com.",SCRIPT:"Could not contact processor. Please refresh the page and try again.",TIMEOUT:"Connection error. Please check your internet connection and try again.",WAIT:"Please wait a few moments and try again.",TRY_AGAIN:"Please try again.",
REFRESH:"Please refresh the page and try again.",GENERIC_BANK_ACCOUNT:"Could not update bank account. Please make sure all details have been entered correctly and try again.",REFRESH_BANK_ACCOUNT:"Could not update bank account. Please refresh the page and try again.",TRY_AGAIN_BANK_ACCOUNT:"Could not update bank account. Please try again.",GENERIC_CARD:"Could not process payment. Please refresh the page and try again ensuring all card details have been entered correctly. If you continue to have trouble please contact support@fareharbor.com.",
REFRESH_CARD:"Could not process payment. Please refresh the page and try again.",TRY_AGAIN_CARD:"Could not process payment. Please try again.",BAD_CARD:"Could not process payment. Please make sure all card details have been entered correctly. If you are still unsuccessful you may need to call the card issuer or try a different card.",INVALID_ROUTING_NUMBER:"Invalid routing number.",INVALID_CARD_NUMBER:"Invalid card number. Please check that you have entered your card number correctly and try again.",
BAD_CARD_NUMBER:"Incorrect card number. Please check that you have entered your card number correctly and try again.",INVALID_DEMO_CARD_NUMBER:"Only demo card numbers can be used while demo mode is enabled.",INVALID_EXPIRATION:"Invalid card expiration date. Please check that you've selected the correct expiration date for your card and try again.",BAD_EXPIRATION:"Expired card. Please enter a valid card.",INVALID_SECURITY_CODE:"Invalid CVC (card security code). Please check that you've entered your card's security code correctly and try again.",
BAD_SECURITY_CODE:"Incorrect CVC (card security code). Please check that you've entered your card's security code correctly and try again.",INVALID_COUNTRY_CODE:"Invalid country. Plesae check that your billing country is correct and try again.",INVALID_POSTAL_CODE:"Invalid postal (zip) code. Please check that your billing postal code is correct and try again.",BAD_POSTAL_CODE:"Incorrect postal (zip) code. Please check that your billing postal code is correct and try again."};n.factory("processors",
["$injector","auth","convert","db","Raven",function(k,h,d,f,m){var a={INDIVIDUAL_ENTITY_TYPE:"individual",COMPANY_ENTITY_TYPE:"company",DEFAULT_PROCESSOR_TYPE:"stripe",STRIPE_PROCESSOR_TYPE:"stripe",BALANCED_PROCESSOR_TYPE:"balanced",PROCESSOR_TYPES:["stripe","balanced"],VERIFICATION_REQUIREMENTS:f.slipstream("processorVerificationRequirements"),VERIFICATION_REQUIREMENT_TO_FORM_FIELD:f.slipstream("processorVerificationRequirementToCompanyTaxInformationFormField",{doNotConvert:!0}),SUPPORTED_BANK_ACCOUNT_COUNTRIES:f.slipstream("processorSupportedBankAccountCountries"),
BANK_ACCOUNT_VERIFICATION_ENABLED_COUNTRIES:f.slipstream("processorBankAccountVerificationEnabledCountries"),SUPPORTED_CURRENCIES:f.slipstream("processorSupportedCurrencies"),UNVERIFIED_VERIFICATION_STATUS:"unverified",SUBMITTED_VERIFICATION_STATUS:"submitted",PENDING_VERIFICATION_STATUS:"pending",VERIFIED_VERIFICATION_STATUS:"verified",ERRORS:c,SECRET_FIELD:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",secretField:function(c){return Array(Math.max((c||"").length,a.SECRET_FIELD.length)+1).join(a.SECRET_FIELD[0])},
cardType:function(a){if(!a)return"";a=a.toString().trim();var c={};c["51"]=c["52"]=c["53"]=c["54"]=c["55"]="mastercard";c["34"]=c["37"]="american express";c["4"]="visa";c["6"]="discover";c["35"]="jcb";c["30"]=c["36"]=c["38"]="diners club";var b=_.find(_.keys(c),function(b){return 0===a.indexOf(b)});return b?c[b]:"unknown"},cardTypeAbbreviation:function(a){return{visa:"visa",mastercard:"mc","american express":"amex",discover:"discover","diners club":"diners",jcb:"jcb",unknown:"unknown"}[a]||""},cardLast4:function(a){return a.substr(a.length-
4)},verificationRequirements:function(c,d,b){if(a.VERIFICATION_REQUIREMENTS){var f=[c,d,b,"minimum"].join(".");if(f=_.get(a.VERIFICATION_REQUIREMENTS,f))return f}c="processors: verification requirements not identified for "+c+" "+d+" "+b;console.error(c);m.captureMessage(c,{level:a.ERROR})},requiredVerificationFields:function(c,f){try{if(!f)throw Error("missing verification requirements");if(!a.VERIFICATION_REQUIREMENT_TO_FORM_FIELD)throw Error("missing verification mapping");var b=a.VERIFICATION_REQUIREMENT_TO_FORM_FIELD[c];
if(!b)throw Error("missing verification mapping for processor type");var g={};_.each(f,function(a){(a=b[a])&&(g[d.camelKey(a)]=!0)});if(_.isEmpty(g))throw Error("no required fields");return g}catch(k){var h="processors: verification fields not identified for "+c+": "+k.message;console.warn(h);m.captureMessage(h,{extra:{verificationRequirements:f},level:a.ERROR})}},supportedBankAccountCountries:function(c,d,b){if(a.SUPPORTED_BANK_ACCOUNT_COUNTRIES){var f=[c,d,b].join(".");if(f=_.get(a.SUPPORTED_BANK_ACCOUNT_COUNTRIES,
f))return f}c="processors: supported bank account countries not identified for "+c+" "+d+" "+b;console.error(c);m.captureMessage(c,{level:a.ERROR})},verificationEnabledBankAccountCountries:function(c,d){if(a.BANK_ACCOUNT_VERIFICATION_ENABLED_COUNTRIES){var b=[c,d].join(".");if(b=_.get(a.BANK_ACCOUNT_VERIFICATION_ENABLED_COUNTRIES,b))return b}b="processors: unable to identify verification enabled bank account countries for "+c+" "+d;console.error(b);m.captureMessage(b,{level:a.ERROR})},isVerificationEnabledForBankAccountCountry:function(c,
d,b){var f=a.verificationEnabledBankAccountCountries(c,d);if(f)return _.contains(f,b);c="processors: unable to identify whether bank account verification is enabled for "+c+" "+d+" "+b;console.error(c);m.captureMessage(c,{level:a.ERROR})},isBankAccountVerificationEnabled:function(c,d,b){var f=a.verificationEnabledBankAccountCountries(c,d);if(f){if(!f.length)return!1;var k=a.supportedBankAccountCountries(c,d,b);if(k)return!!_.intersection(k,f).length}c="processors: unable to identify whether bank account verification is enabled for "+
c+" "+d+" "+b;console.error(c);m.captureMessage(c,{level:a.ERROR})},supportedCurrencies:function(c,d){if(a.SUPPORTED_CURRENCIES){var b=[c,d].join(".");if(b=_.get(a.SUPPORTED_CURRENCIES,b))return b}b="processors: unable to determine supported currencies for "+c+" "+d;console.error(b);m.captureMessage(b,{level:a.ERROR})},INFO:"info",ERROR:"error",log:function(c,f,b,g){f=f||{};b=b||{};g=g||a.INFO;var k={userIdentifier:h.currentUser.isAuthenticated?h.currentUser.identifier:"anonymous"},k=_.extend(k,b);
try{f=d.clientRequest(f),m.captureMessage(c,{extra:f,tags:k,level:g})}catch(n){console.error("processors: invalid log data",f),m.captureMessage(c,{extra:{message:"invalid log data: "+n.toString()},tags:k,level:g})}console.info("processors: "+c)},get:function(a){return k.get(a||"stripe")}};return a}]);n.factory("stripe",["$q","$rootScope","db","processors","Stripe",function(c,h,d,f,m){var a={invalid_number:f.ERRORS.INVALID_CARD_NUMBER,incorrect_number:f.ERRORS.BAD_CARD_NUMBER,invalid_expiry_month:f.ERRORS.INVALID_EXPIRATION,
invalid_expiry_year:f.ERRORS.INVALID_EXPIRATION,expired_card:f.ERRORS.BAD_EXPIRATION,invalid_cvc:f.ERRORS.INVALID_SECURITY_CODE,incorrect_cvc:f.ERRORS.BAD_SECURITY_CODE,incorrect_zip:f.ERRORS.BAD_POSTAL_CODE,card_declined:f.ERRORS.BAD_CARD,processing_error:f.ERRORS.TRY_AGAIN,rate_limit:f.ERRORS.WAIT},p=[{regex:/^Expired API Key provided/i,message:f.ERRORS.REFRESH}],l=d.slipstream("stripeLivePublishableKey"),b=d.slipstream("stripeTestPublishableKey"),g=function(b,d,g){var p=c.defer();m.setPublishableKey(l);
b={currency:b.processorCurrency,country:d.processorCountry,account_number:d.accountNumber,account_holder_name:d.accountHolderName,account_holder_type:d.accountHolderType};d.routingNumber&&(b.routing_number=d.routingNumber);m.bankAccount.createToken(b,function(b,c){h.$safeApply(function(){if(c.error){f.log("Stripe client-side error ("+(c.status||"unknown error")+")",_.extend({stripeResponse:c},g));var b=c.error.message+".";c.error.code&&(b=a[c.error.code]||b);return p.reject([b])}return p.resolve({processorType:"stripe",
stripeBankAccountToken:c.id})})});return p.promise},n=function(d,g,n,C){var D=c.defer();if(!m)return f.log("Stripe: unable to load stripe.js"),D.reject([f.ERRORS.SCRIPT]),D.promise;m.setPublishableKey(n?b:l);d={number:g.number,exp_month:g.expirationMonth,exp_year:g.expirationYear};g.cvc&&(d.cvc=g.cvc);d.name=g.name||"";d.address_zip=g.postalCode||"";d.address_country=g.countryCode||"";m.card.createToken(d,function(b,c){h.$safeApply(function(){if(!c)return D.reject([f.ERRORS.TIMEOUT]);if(c.error){var b;
c.error.code?b=a[c.error.code]:c.error.message&&_.forEach(p,function(a){if(c.error.message.match(a.regex))return b=a.message,!1});b||(b=f.ERRORS.GENERIC_CARD);var e="card_error"===c.error.type?f.INFO:f.ERROR,d="Stripe client-side "+(c.status||"")+" error",d=d+(" ("+(c.error.type||"unknown error")+")");c.error.message&&(d+=" - "+c.error.message);f.log(d,_.extend({stripeResponse:c,error:b},C),{type:c.error.type},e);return D.reject([b])}return D.resolve({processorType:"stripe",stripeToken:c.id})})});
return D.promise};return{PROCESSOR_TYPE:"stripe",PENDING_STATEMENT_TEXT:"STRIPE",STATEMENT_TEXT_PREFIX:"",tokenizeBankAccount:function(a,b,d){if(!m){var l=c.defer();f.log("Stripe: unable to load stripe.js");l.reject([f.ERRORS.SCRIPT]);return l.promise}l=g(a,b,d);a=g(a,b,d);return c.all([l,a]).then(function(a){return{processorType:"stripe",stripeAccountBankAccountToken:a[0].stripeBankAccountToken,stripeCustomerBankAccountToken:a[1].stripeBankAccountToken}},function(a){return c.reject(_.unique(_.append(a)))})},
tokenizeCard:n,tokenizedCard:function(a){return{processorType:"stripe",stripeToken:a}},testToken:function(a,b){var c={number:"4242424242424242",expirationMonth:1,expirationYear:moment().year()+1,cvc:"123"};b=_.extend(b,{testing:!0});return n(a,c,a.isDemoModeEnabled,b).then(function(a){a=a.stripeToken;console.info("stripe: test token",a);return a})},chargedCard:function(a){var b={processorType:"stripe",stripeChargeId:a.processorId};_.extend(b,a);return b}}}]);n.factory("balanced",["$rootScope","$timeout",
"$q","processors",function(c,h,d,f){c=function(){var c=d.defer();c.reject([f.ERRORS.UNSUPPORTED]);return c.promise};return{PROCESSOR_TYPE:"balanced",PENDING_STATEMENT_TEXT:"BALANCED",STATEMENT_TEXT_PREFIX:"BAL*",tokenizeBankAccount:c,tokenizeCard:c}}]);n.factory("cardflight",function(){return{isTestToken:function(c){return/^test_/.test(c)}}});n.factory("Stripe",function(){return window.Stripe||null});n.factory("payworksEmv",["$rootScope","$q","$timeout","db","events","models","require",function(c,
h,d,f,m,a,p){var l={CONNECTING_TO_ACCESSORY:"Connecting...",INITIALIZING_TRANSACTION:"Initializing...",PROCESSING:"Processing...",WAITING_FOR_CARD_PRESENTATION:"Waiting for card...",WAITING_FOR_CARD_REMOVAL:"Remove card..."},b=function(a,b){return _.extend({tag:a},b)},g=function(a,c){var d="production"===f.slipstream("configuration")&&!c.isDemoModeEnabled?"LIVE":"TEST";return b(a,{type:"LOGIN_MERCHANT_REQUEST",loginMerchantRequest:{providerMode:d,merchantIdentifier:c.payworksMerchantId,merchantSecret:c.payworksMerchantSecretKey}})},
n=function(a,c){return b(a,{type:"ABORT_OPERATION_REQUEST",referenceTag:c,abortOperationRequest:{}})},x=function(a){if(a){var b=a.label;a=a.value;if(b&&a)return{key:b,value:a}}},q=function(a){var b=[],c=a.data||{};_.forEach(["DATE","TIME","AMOUNT_AND_CURRENCY","STATUS_TEXT","SUBJECT"],function(a){(a=x(c[a]))&&b.push(a)});_.forEach(["merchantDetails","clearingDetails","paymentDetails"],function(c){_.forEach(a[c]||[],function(a){(a=x(a))&&b.push(a)})});return b},B=function(c,d,g,k){var m=h.defer(),
p=function(a){a=(x.lastInformation=a)||"Unknown error";c.lastDecline&&(a="");m.reject(a)},x={identifier:_.uuid(),connection:c,amount:g,isAbortable:!1,$promise:m.promise,cancel:function(){x.isAbortable&&c.send(n(_.uuid(),x.identifier));p("Cancelled")},lastInformation:"Waiting...",information:function(){return x.lastInformation},message:function(a){switch(a.type){case "EXECUTE_TRANSACTION_UPDATE":console.info("payworks: transaction update",a);var b=_.get(a,"executeTransactionUpdate.state")||"Processing...";
x.lastInformation=l[b]||b;x.isAbortable=!1!==_.get(a,"executeTransactionUpdate.abortable");break;case "EXECUTE_TRANSACTION_RESPONSE":console.info("payworks: transaction response",a);b=_.get(a,"executeTransactionResponse.state");if(!b){p("Invalid transaction state");break}if("ABORTED"===b){p("Cancelled");break}if("DECLINED"===b){c.lastDecline={customerReceipt:q(a.executeTransactionResponse.transaction.customerReceipt),merchantReceipt:q(a.executeTransactionResponse.transaction.merchantReceipt)};p();
break}b=_.get(a,"executeTransactionResponse.transaction.identifier");if(!b){p("Invalid transaction identifier");break}a=_.get(a,"executeTransactionResponse.transaction.merchantReceipt.data.CLEARING_DETAILS_TRANSACTION_IDENTIFIER.value");if(!a){p("Invalid transaction identifier");break}m.resolve({processorId:a,payworksTransactionId:b});break;case "ABORT_OPERATION_RESPONSE":console.info("payworks: abort response",a);break;default:console.warn("payworks: invalid transaction message",a)}},error:function(a){console.warn("payworks: transaction error",
a);p(a.error.message)}};c.send(b(x.identifier,{type:"EXECUTE_TRANSACTION_REQUEST",resource:"devices/usbMiura",executeTransactionRequest:{mode:"ONLINE",transactionParameters:{amount:_.roundHalfToEven(g/100,2).toFixed(2),currency:c.company.processorCurrency.toUpperCase(),autoCapture:!0,type:"CHARGE",subject:d.cls===a.Booking.cls?"Booking #"+d.pk.toString():"Order #"+d.identifier,customIdentifier:d.cls===a.Booking.cls?d.pk.toString():d.identifier,statementDescriptor:c.company.statementText,applicationFee:_.roundHalfToEven(k/
100,2).toFixed(2),metadata:{configuration:f.slipstream("configuration")}}}}));return x},y=function(a){var b=[],d=function(a){c.$apply(function(){var b=JSON.parse(a.data);if("OK"===b.status)if(p.transaction)console.info("payworks: received transaction message",b),p.transaction.message(b);else switch(b.type){case "LOGIN_MERCHANT_RESPONSE":console.info("payworks: logged in",b);break;default:console.warn("payworks: received unexpected message",b)}else console.error("payworks: error",b),p.transaction&&
p.transaction.error(b)})},f=function(a){console.warn("payworks: unable to connect to pay server",a);p.socket=null},l=function(){console.info("payworks: connection closed");p.transaction&&(p.transaction.cancel(),p.transaction=null)},h=function(){console.info("payworks: connection opened");p.send(g(_.uuid(),p.company))},m=function(){var a=new WebSocket("ws://localhost:8080");a.onmessage=d;a.onerror=f;a.onopen=h;a.onclose=l;return a},p={company:a,socket:m(),send:function(a){b.push(a);p.socket&&p.socket.readyState===
WebSocket.OPEN&&(_.forEach(b,function(a){console.info("payworks: sending",a);p.socket.send(JSON.stringify(a))}),_.clear(b))},destroy:function(){console.info("payworks: destroying connection...");p.transaction&&(p.transaction.cancel(),p.transaction=null);p.socket&&(p.socket.close(),p.socket=null)},createTransaction:function(a,b,c){console.info("payworks: creating transaction",a,b,c);p.lastDecline=null;p.socket||(p.socket=m());p.transaction&&(p.transaction.cancel(),p.transaction=null);p.transaction=
B(p,a,b,c);return p.transaction}};return p},D={providerType:"payworks",CANCELLED:{},connection:null,connect:function(a){p.assert(!D.connection,"payworks: expected no connection");D.connection=y(a)},disconnect:function(){D.connection&&(D.connection.destroy(),D.connection=null)},isConnected:function(){return!!D.connection&&!!D.connection.socket&&D.connection.socket.readyState===WebSocket.OPEN},charge:function(a,b,c,d){D.connection?D.connection.company!==a&&(D.disconnect(),D.connect(a)):(D.connect(a),
D.connection=y(a));return D.connection.createTransaction(b,c,d).$promise},cancel:function(){D.connection&&(D.connection.lastDecline=null,D.connection.transaction&&D.connection.transaction.cancel())},information:function(){return!D.connection?"Not connected":!D.connection.transaction?"Ready...":D.connection.transaction.information()},lastDecline:function(){return D.connection?D.connection.lastDecline:null}};m.on(c,"auth.logout",function(){D.disconnect()});return D}]);n.factory("stripeEmv",["$q","$rootScope",
"$window","auth","db","models",function(c,h,d,f,m,a){if(!d.stripePos)return null;var p=m.slipstream("isDebug"),l=T("Unknown error"),b=T("Cancelled"),g={};g[d.stripePos.CheckoutStatus.IDLE]=T("Waiting...");g[d.stripePos.CheckoutStatus.CHECKOUT]=T("Waiting...");g[d.stripePos.CheckoutStatus.COLLECTING_PAYMENT]=T("Waiting for card...");g[d.stripePos.CheckoutStatus.CHARGING_PAYMENT]=T("Charging card...");g.DISCONNECTED=T("Not connected.");g.UNKNOWN=T("Not connected.");var n=function(a){return{getToken:function(b){return new d.Promise(function(c,
d){var f=m.emvDevice.activate({shortname:a.company.shortname,emvDevicePk:a.pk},null,null,{pos_device_id:b});f.$promise.then(function(){c(f.activationToken)},function(){d(Error("failed to retrieve activation token from Stripe."))})})}}},x,q=f.storage.get("stripeEmvDevicePk"),B=function(a){if((a=_.find(a,{pk:q})||_.first(a))&&q!==a.pk)q=a.pk,f.storage.set("stripeEmvDevicePk",a.pk);return a},y={providerType:"stripe",selectDevice:function(a){y.disconnect();return y.connect(a.company).then(function(){q=
a.pk;f.storage.set("stripeEmvDevicePk",a.pk)})},deselectDevice:function(){y.disconnect()},isDeviceSelected:function(a,b){return B(b)===a},connect:function(b){var e=c.defer();if(!d.Promise)return e.reject(),e.promise;x&&x.endCheckout();if(!f.permissions.canList(a.EmvDevice,b))return e.reject(),e.promise;var g=m.emvDevices({shortname:b.shortname},null,null,{flashError:!1}),l=function(){var a=c.defer();x.connect().then(function(){a.resolve()},function(b){a.reject()});return a.promise};g.$promise.then(function(){var a=
B(g);if(a){var c=b.primaryLocation||b,f=c.name,k={line1:c.street,city:c.city,state:c.province,country:c.country,postalCode:c.postalCode};if(!c||!f||0<=_.values(k).indexOf(""))console.warn("Cannot connect to Stripe EMV because location object is not properly filled."),e.reject("Cannot connect to Stripe EMV because location object is not properly filled.");else return x=d.stripePos.TerminalFactory.create({discovery:{method:"ip",ip:a.ipAddress},storeName:f,address:k,devMode:p?d.stripePos.DevMode.CANARY:
d.stripePos.DevMode.PROD},n(a)),x.delegate={onCheckoutStatusChanged:function(){h.$safeApply()}},l().then(function(){e.resolve()},function(){e.reject()})}else e.reject("No selected device.")},function(){e.reject()});return e.promise},disconnect:function(){x&&x.endCheckout();x=null},isConnected:function(){return x&&x.getConnectionStatus()===d.stripePos.ConnectionStatus.CONNECTED},reconnect:function(a){y.disconnect();y.connect(a)},charge:function(a,d,g,m){var p=c.defer(),n={line_items:[{product_code:d.unicode,
description:d.unicode,quantity:1,unit_price:g,total_price:g,tax_amount:0}],basket_modifiers:[],basket_discounts:[]},q={adjusted_total:g,total:g,tax:0,balance_due:g};x.beginCheckout({transaction_id:d.unicode,operator_id:f.currentUser.identifier}).then(function(){h.$apply();return x.setBasket({basket:n,totals:q})}).then(function(){h.$apply();return x.createPaymentIntent({destination_account:a.defaultProcessorIdentifier,amount:g,currency:a.processorCurrency,basket:n,totals:q})}).then(function(a){h.$apply();
return x.attachSource({payment_intent:a})}).then(function(a){h.$apply();return x.confirmPaymentIntent({payment_intent:a})}).then(function(a){h.$apply();a.error?p.reject(a.error.message):p.resolve({processorId:a.payment_intent.charge.id})}).catch(function(a){h.$apply();var c=l;"Cancelled Attach Source"===a.message?c=b:console.error("stripeEmv: unhandled error",a);p.reject(c)}).finally(function(){h.$apply();x.endCheckout()});return p.promise},cancel:function(){x&&x.cancelAttachSource()},information:function(){return x?
g[x.getCheckoutStatus()]||g.UNKNOWN:g.DISCONNECTED},lastDecline:function(){return null}};return y}]);n.factory("emv",["$rootScope","events","flash","payworksEmv","stripeEmv",function(c,h,d,f,m){var a=null,p=null,l=_.filter([f,m]),b=function(a){return _.find(l,function(b){if(b.providerType===a)return b})},g={PAYWORKS_PROVIDER:"payworks",isConnected:function(){if(p)return p.isConnected()},charge:function(a,b,c,d){return!p?$q.reject():p.charge(a,b,c,d)},information:function(){return!p?"":p.information()},
lastDecline:function(){return!p?null:g.isDebugging?g.debugDecline:p.isConnected()?p.lastDecline():null},cancel:function(){if(p)return p.cancel()}};h.on(c,"auth.logout",function(){p&&p.disconnect()});h.on(c,"navigation.company.updated",function(c,d){var f=d.company;if(!a||f)if(!f||!(a===f&&p&&p.isConnected()))a=f,p&&p.disconnect(),f&&f.features.isEmvEnabled&&(p=b(f.features.emvProvider))&&p.connect(f).catch(function(){console.warn("Unable to connect to device: EMV provider not loaded.")})});g.isDebugging=
!1;g.debugDecline={customerReceipt:[{key:"Date",value:"12/32/17"},{key:"Time",value:"12:32pm"},{key:"Amount",value:"USD$12.32"},{key:"Information",value:"Authorization declined."},{key:"Description",value:"Booking #1234"}],merchantReceipt:[{key:"Date",value:"12/32/17"},{key:"Time",value:"12:32pm"},{key:"Amount",value:"USD$12.32"},{key:"Information",value:"Authorization declined."},{key:"Description",value:"Booking #1234"}]};g.debugDetails=[{key:"Date",value:"12/32/17"},{key:"Time",value:"12:32pm"},
{key:"Amount",value:"USD$12.32"},{key:"Information",value:"Authorization declined."},{key:"Description",value:"Booking #1234"},{key:"Name",value:"Adeventure Extremer"},{key:"Address",value:"12:32pm"},{key:"Zip",value:"12321"},{key:"City",value:"Aina Haina"},{key:"Country",value:"USA"},{key:"Contact",value:"4155551212"},{key:"Transaction",value:"ch_1BLzcrL4FOCDmmKvrGbjEG2t"},{key:"Authorization",value:"123212321"},{key:"Scheme",value:"payworks VISA"},{key:"Account",value:"**** **** **** 4242"},{key:"AID",
value:"A0000000031010"},{key:"Entry Mode",value:"Chip"},{key:"Verification",value:"Signature"}];return g}]);n.run(["$rootScope","emv","processors",function(c,h,d){c.emv=h;c.processors=d}])})();angular.module("auth",["auth.controllers","auth.directives","auth.services"]);
(function(){var n=angular.module("auth.controllers",["lib","navigation"]);n.controller("auth.LoginCtrl",["$scope","auth","flash","navigation","urls",function(c,k,h,d,f){k=d.get("shortname")||"";c.credentials={shortname:k};var m=d.get("next");c.submit=function(a){c.credentials.shortname&&(a=f.populate(f.company.login,{shortname:c.credentials.shortname.replace(/\s+/g,"").toLowerCase()}),m&&(a=d.compose(a,{next:m})),d.navigate(a))}}]);n.controller("auth.CompanyLoginCtrl",["$scope","auth","flash","navigation",
"urls",function(c,k,h,d,f){h=d.currentCompany?d.currentCompany.shortname:"";var m=d.get("username")||"";d.clear("username",!0);c.credentials={shortname:h,username:m,password:""};c.isForceReloadingAfterSuccess=!1;var a=d.get("next"),m="yes"===d.get("require");!m&&k.currentUser.isAuthenticated&&h===k.currentUser.company.shortname?d.redirect(a||k.currentUser.company.$url(f.dashboard.index),"replace"):(c.differentCompanyLoginUrl=f.root.login,a&&(h={next:a},m&&(h.require="yes"),c.differentCompanyLoginUrl=
d.compose(c.differentCompanyLoginUrl,h)),c.submit=function(h){k.login(c.credentials,h).then(function(){c.isForceReloadingAfterSuccess=!0;var l=a||k.currentUser.company.$url(f.dashboard.index);d.navigate(l,null,!0)},function(){c.credentials.password=""})})}]);n.controller("auth.ForgotPasswordCtrl",["$scope","db","flash","navigation","urls",function(c,k,h,d,f){var m=d.get("shortname")||"";d.clear("shortname",!0);var a=d.get("username")||"";d.clear("username",!0);c.alreadyHasCompany=!!m;c.credentials=
{shortname:m,username:a};c.submit=function(a){k.forgot.password({},c.credentials,a).$promise.then(function(){h.success("An email has been sent to the address associated with this account.");d.navigate(f.root.login)})}}]);n.controller("auth.ResetPasswordCtrl",["$scope","db","flash","navigation","urls",function(c,k,h,d,f){var m=d.get("shortname")||"";d.clear("shortname",!0);var a=d.get("username")||"";d.clear("username",!0);var p=d.get("token")||"";d.clear("token",!0);!m||!a||!p?(h.error("Bad password reset link."),
d.navigate(f.root.login)):(c.credentials={token:p,username:a,shortname:m,password:""},c.submit=function(a){k.forgot.password.reset({},c.credentials,a).$promise.then(function(){h.success("Your password has been changed. Please log in.");var a=f.populate(f.company.login,{shortname:m}),a=a+("?username="+c.credentials.username);d.navigate(a)})})}]);n.controller("auth.ForgotCredentialsCtrl",["$scope","db","flash","navigation","urls",function(c,k,h,d,f){c.credentials={email:""};c.submit=function(m){var a=
c.credentials.email;k.forgot.credentials({},c.credentials,m).$promise.then(function(){h.success("We emailed you at <b>"+a+"</b>.");d.navigate(f.root.login)})}}])})();
(function(){angular.module("auth.directives",[]).config(["$compileProvider","d",function(n,c){var k=function(d,f){if(!f.parse||!f.permission)throw Error("auth: "+d+": invalid directive definition");return n.directive(d,c.conditionalDirective({name:d,watch:["$injector","$parse","auth",function(k,a,h){var l=c.safeInvoke(k,f.permission),b=c.safeInvoke(k,f.parse);return function(c,f,k){var h=b(k),m=k.ngCanOnlyWhen?a(k.ngCanOnlyWhen):_.always,p=k.ngCanAlsoWhen?a(k.ngCanAlsoWhen):_.never,n=!k.ngCanOnce||
c.$eval(k.ngCanOnce),e,F=!0;return function(){try{if(p(c))return!0;if(!m(c))return!1;var a;n&&!F?a=e:(a=e=l(h(c)),F=!1);return a}catch(b){throw console.error("auth: "+d+": error checking permission for arguments: "+k[d]),b;}}}}],once:function(c,a,d){return!d.ngCanOnlyWhen&&!d.ngCanAlsoWhen&&(!d.ngCanOnce||c.$eval(d.ngCanOnce))},operator:function(c,a,d){return function(a){d.ngThen&&(c[d.ngThen]=a);return a}}}))},h=function(c,f){return k(c,{parse:["$parse",function(f){return function(a){return f(a[c])}}],
permission:["auth",function(c){return function(a){return c.permissions.can(f.permission,a)}}]})};h("ngCanView",{permission:"view"});h("ngCanUpdate",{permission:"update"});h("ngCanRemove",{permission:"remove"});h("ngCanAdminView",{permission:"adminView"});h("ngCanAdminUpdate",{permission:"adminUpdate"});h("ngCanViewAmounts",{permission:"viewAmounts"});h("ngCanViewDashboardSection",{permission:"viewDashboardSection"});h("ngCanViewAdminSection",{permission:"viewAdminSection"});h("ngCanViewManifestSection",
{permission:"viewManifestSection"});h("ngCanViewInvoiceAmounts",{permission:"viewInvoiceAmounts"});h=function(c,f){return k(c,{parse:["$parse",function(f){return function(a){a=a[c].match(/^\s*([\s\S]+)\s+on\s+([\s\S]+)\s*$/);if(!a)throw Error("auth: "+c+": expected expression of the form '_type_ on _object_'");var k=a[1],l=f(a[2]);return function(a){return{cls:k,owner:l(a)}}}}],permission:["auth",function(c){return function(a){return c.permissions.can(f.permission,a.cls,a.owner)}}]})};h("ngCanCreate",
{permission:"create"});h("ngCanList",{permission:"list"});h("ngCanAdminCreate",{permission:"adminCreate"});h("ngCanAdminList",{permission:"adminList"});k("ngCan",{parse:["$parse",function(c){return function(f){var k=f.ngCan.match(/^\s*([\s\S]+)\s+on\s+([\s\S]+)\s*$/);f=f.ngCan.match(/^\s*([\s\S]+)\s+on\s+([\s\S]+)\s+with\s+([\s\S]+)\s*$/);if(!k&&!f)throw Error("auth: ng-can: expected expression of the form '_type_ on _object_' or '_type_ on _model_ with _object_'");var a=k[1],h=_.never,l=_.never;
f?(h=c(f[2]),l=c(f[3])):l=c(k[2]);return function(b){return{permission:a,object:l(b),cls:h(b)}}}}],permission:["auth",function(c){return function(f){return!f.cls?c.permissions.can(f.permission,f.object):c.permissions.can(f.permission,f.cls,f.object)}}]});k("ngCanAny",{parse:["$parse",function(c){return function(f){var k=c(f.ngCanAny),a,h;f.ngCanAnyWith?(a=c(f.ngCanAnyOn),h=c(f.ngCanAnyWith)):(a=_.never,h=c(f.ngCanAnyOn));return function(c){return{permissions:k(c),object:h(c),cls:a(c)}}}}],permission:["auth",
function(c){return function(f){return!f.cls?_.any(f.permissions,function(k){return c.permissions.can(k,f.object)}):_.any(f.permissions,function(k){return c.permissions.can(k,f.cls,f.object)})}}]})}])})();
(function(){var n=angular.module("auth.services",["db.services","lib.services","urls.services"]);n.factory("auth",["$http","$injector","$rootScope","convert","db","events","models","sessionStorage","storage","urls",function(c,k,h,d,f,m,a,p,l,b){var g=["z","hmleigh"],n=["canUpdateOnlyFutureBookings","canViewOnlyCrewedAvailabilities"],x={isAuthenticated:!1};k={};var q=function(a){var b=E.currentUser;return(a=a||b.company)&&b.isAuthenticated&&b.company&&b.company===a},B=function(){var a=E.currentUser;
return a.isAuthenticated&&a.company&&a.company.isAdmin},y=function(a){return a.affiliation&&a.affiliation.affiliateCompany===E.currentUser.company},D=function(a,b){var c=a.conditions.maxCompanyTier;if(_.isNumber(c)){var d=b.features?b.features.tier:null;if(!_.isNumber(d)||d>c)return!1}return!0},e={},F={};d=function(){F={}};m.on(h,"auth.login",d);m.on(h,"auth.logout",d);m.on(h,"auth.clearEffectiveGroupCache",d);var G=function(a,b){var c,d;if(E.currentUser.company===b)c=E.currentUser.group;else if(E.currentUser.company.isAdmin)(c=
E.currentUser.adminGroup)&&!D(c,b)&&(c=null);else if(E.currentUser.company.isAffiliate){var e=_.findWhere(E.currentUser.company.partners,{company:b});E.currentUser.partnerGroup&&(e&&e.affiliateGroup)&&(d={groupPermissions:_.omit(e.affiliateGroup.groupPermissions,function(a,b){return!(a&&_.get(E.currentUser.partnerGroup.groupPermissions,b,!1))})},_.forEach(n,function(a){if(e.affiliateGroup.groupPermissions[a]||E.currentUser.partnerGroup.groupPermissions[a])d.groupPermissions[a]=!0}))}if(!c){var f=
_.findWhere(E.currentUser.relatedGroupOverrides,{company:b});f||(f=_.findWhere(E.currentUser.company.relatedGroupOverrides,{company:b,relatedUser:null}));f&&(c=f.group)}if(c=c||d)return c;console.warn("auth: user with no effective group",E.currentUser,a,b)},A=function(a){if(!a)throw console.error("auth: invalid permission",this,a,this.cls),Error("auth: invalid permission");a="can"+_.capitalize(a);var b=e[this.cls][a];if(b)return u.call(this,b);console.error("auth: invalid permission configuration",
this,a,e,b);return!1},v=function(b){var c,d,f;if(2===arguments.length)d=(c=arguments[1])?c.cls:"",f=a.Company.forObject(c);else if(3===arguments.length){c=null;if((d=arguments[1])&&!_.isString(d))d=d.cls;f=arguments[2]}else console.error("auth: invalid arguments when checking permission",arguments);if(_.isUndefined(c))throw console.error("auth: invalid object when checking permission",b,c),Error("auth: invalid object when checking permission "+b);if(!d)throw console.error("auth: invalid class when checking permission",
b,d,f),Error("auth: invalid class when checking permission "+b);if(!f)throw console.error("auth: invalid owner when checking permission",b,d,f),Error("auth: invalid owner when checking permission "+b);var g=a.Company.forObject(f);if(!g)throw console.error("auth: invalid company when checking permission",b,d,f,c),Error("auth: invalid company when checking permission "+b);var k;k=c;var l=g;if(E.currentUser.isAuthenticated){var h=l.uri,m=F[h];_.isUndefined(m)&&(m=G(k,l),F[h]=m);k=m}else k=void 0;c={company:g,
instance:c,owner:f,cls:d,group:k,permissions:k?k.groupPermissions:{},can:A};g!==f&&(c[_.uncapitalize(f.cls)]=f);(d=e[d].init)&&d.call(c);return A.call(c,b)};h=function(a){return function(){var b=_.toArray(arguments);b.unshift(a);return v.apply(this,b)}};k.canView=h("view");k.canUpdate=h("update");k.canRemove=h("remove");k.canAdminView=h("adminView");k.canAdminUpdate=h("adminUpdate");k.canCreate=h("create");k.canList=h("list");k.canAdminCreate=h("adminCreate");k.canAdminList=h("adminList");k.can=v;
var s=function(a,b,c){b=b||!1;c=_.isUndefined(c)?b:c;a=_.capitalize(a);var d="canView"+a,e="canEdit"+a,f="canEditPrivateProperties"+a;a="canViewPrivateProperties"+a;return{canView:function(){return b?!0:this.permissions[d]},canList:function(){return c?!0:this.permissions[d]},canCreate:e,canUpdate:e,canRemove:e,canClear:e,canAdminUpdate:f,canAdminCreate:f,canAdminView:a,canAdminList:a}},z=function(b,c){if(!this||!this.permissions)throw console.error("auth: this context needed to check canUpdatePastBooking",
this),Error("auth: this context needed");b=b||this.booking;if(!b)throw console.error("auth: booking reference needed to check canUpdatePastBooking",this),Error("auth: booking reference needed");return c&&b.availability.company.features.isLimitedPastBookingUpdatesEnabled||!this.permissions.canUpdateOnlyFutureBookings||!a.Availability.isInPast(b.availability)};h=function(a,b){b=b||{};var c=b.field||"booking";a=_.capitalize(a);var d=b.permissionOverrides||{},e=_.isUndefined(b.checkPastBooking)?!0:b.checkPastBooking,
f=b.isLimitedPastBookingUpdate||!1,g=d.canView||"canView"+a,k=d.canList||"canView"+a,l=d.canCreate||"canEdit"+a,h=d.canUpdate||"canEdit"+a,m=d.canRemove||"canEdit"+a;return _.extend(s(a,b.canAlwaysView,b.canAlwaysList),{init:function(){this.instance&&(this.booking=_.getDotted(this.instance,c))},canView:function(){return!this.group?!0:!v("view",this.booking)?!1:this.permissions[g]},canList:function(){return!this.group?!0:!v("view",this.booking)?!1:this.permissions[k]},canCreate:function(){return!v("update",
this.booking)||this.booking&&e&&!z.call(this,this.booking,f)?!1:this.permissions[l]},canUpdate:function(){return!v("update",this.booking)||e&&!z.call(this,this.booking,f)?!1:this.permissions[h]},canRemove:function(){return!v("update",this.booking)||e&&!z.call(this,this.booking,f)?!1:this.permissions[m]}})};var u=function(a){if(_.isFunction(a))return a.apply(this);if(_.isString(a))return this.permissions[a]||!1;console.error("auth: invalid permission method",a);return!1};d=function(a,b){return function(){a=
_.isArray(a)?a:[a];var c=!0,d=_.clone(this);d.cls=d.company.cls;_.forEach(a,function(a){if(!d.can(a))return c=!1});return c&&u.call(this,b)}};e[a.Company.cls]=s("company",!0);e[a.Company.cls].canCreate=function(){return!B()?!1:this.permissions.canEditCompanies};e[a.Company.cls].canRemove=function(){return this.instance===E.currentUser.company?!1:this.can("create")};e[a.Company.cls].canUpdateCompanyWebsite="canEditCompany";e[a.Company.cls].canUpdateCompanyPayments=d("viewAmounts","canEditAccounting");
e[a.Company.cls].canEditAccounting=d("viewAmounts","canEditAccounting");e[a.Company.cls].canEditTransportation="canEditTransportation";e[a.Company.cls].canDuplicateAcrossCompanies=function(){return E.currentUser.company.isAdmin&&this.permissions.canEditTransportation};e[a.Company.cls].canViewAmounts=function(){return!this.group&&!E.currentUser.isAuthenticated?!0:this.permissions.canViewAmounts};e[a.Company.cls].canViewInvoiceAmounts="canViewInvoiceAmounts";e[a.Company.cls].canViewPricing=d("viewAmounts",
"canViewSheets");e[a.Company.cls].canUpdatePricing=d("viewAmounts","canEditPricing");e[a.Company.cls].canViewAdminSection=function(){return!E.currentUser.isAuthenticated?!1:E.currentUser.company.isAdmin&&this.permissions.canViewAdminSection};e[a.Company.cls].canViewDashboardSection="canViewDashboardSection";e[a.Company.cls].canViewItemsSection="canViewItemsSection";e[a.Company.cls].canViewSettingsSection="canViewSettingsSection";e[a.Company.cls].canViewBookingsSection="canViewBookingsSection";e[a.Company.cls].canViewManifestSection=
"canViewManifestSection";e[a.Company.cls].canViewReports="canViewReports";e[a.Company.cls].canViewNetworkSettings="canViewNetworkSettings";e[a.Company.cls].canCancel=function(){return this.permissions.canCancelBookings};e[a.Company.cls].canCancelEligible=function(){return this.permissions.canCancelEligibleBookings};e[a.Company.cls].canEditSheets="canEditSheets";e[a.TagGroup.cls]=s("tags",!0);var t=function(){return!B()||!this.company.isAdmin?!1:this.permissions.canEditTags};e[a.TagGroup.cls].canCreate=
t;e[a.TagGroup.cls].canUpdate=t;e[a.TagGroup.cls].canRemove=t;e[a.Tag.cls]=e[a.TagGroup.cls];e[a.TagInstance.cls]=s("tagInstances",!0);t=function(){return!B()||!v("update",this.owner)?!1:this.permissions.canEditTagInstances};e[a.TagInstance.cls].canCreate=t;e[a.TagInstance.cls].canUpdate=t;e[a.TagInstance.cls].canRemove=t;e[a.CustomManifest.cls]=s("customManifests");e[a.CustomCalendar.cls]=s("customCalendars");e[a.CustomReport.cls]=s("customReports");e[a.Role.cls]=s("roles");e[a.CrewMember.cls]=s("crewMembers");
e[a.CrewMember.cls].canCreateSelfAssignable="canEditCrewMembersSelfAssignable";e[a.CrewMember.cls].canUpdate=function(){return this.permissions.canEditCrewMembers?!0:this.instance.user===E.currentUser?this.permissions.canEditCrewMembersSelfAssignable:!1};e[a.CrewMember.cls].canRemove=function(){return this.permissions.canEditCrewMembers?!0:this.instance.user===E.currentUser?this.permissions.canEditCrewMembersSelfAssignable:!1};e[a.CrewMember.cls].canCreate=function(){return this.permissions.canEditCrewMembers};
e[a.Group.cls]=s("groups");e[a.GroupOverride.cls]=s("groups");e[a.User.cls]=s("users",!0);e[a.User.cls].canUpdate=function(){return this.instance===E.currentUser?!0:this.permissions.canEditUsers};e[a.User.cls].canRemove=function(){return this.instance==E.currentUser?!1:this.permissions.canEditUsers};e[a.Agent.cls]=s("agents",!0);e[a.Agent.cls].canCreate=function(){return this.permissions.canEditAgents?!0:!this.affiliation?!1:q(this.affiliation.affiliateCompany)?v("create",a.Agent,this.affiliation.affiliateCompany):
!1};e[a.Desk.cls]=s("desks",!0);e[a.Desk.cls].canCreate=function(){if(this.permissions.canEditDesks)return!0;if(!this.affiliation)return!1;if(q(this.affiliation.affiliateCompany))return v("create",a.Desk,this.affiliation.affiliateCompany)};e[a.Affiliation.cls]=s("network");e[a.Affiliation.cls].canView=function(){return this.permissions.canViewNetwork?!0:!this.instance?!1:v("view",a.Affiliation,this.instance.affiliateCompany)};e[a.Affiliation.cls].canRemove=function(){return this.permissions.canEditNetwork?
!0:!this.instance?!1:v("remove",a.Affiliation,this.instance.affiliateCompany)};e[a.CannedMessage.cls]=s("cannedMessages");e[a.CannedMessage.cls].canListAssociatedItems="canListAssociatedItems";e[a.Item.cls]=s("items",!0);e[a.Item.cls].canView=function(){return!this.instance.isPrivate||this.permissions.canViewItems};e[a.Item.cls].canViewPrivate="canViewPrivateItems";e[a.FlowNode.cls]=s("flowNodes",!0);e[a.Image.cls]=s("images",!0);e[a.CustomField.cls]=s("customFields",!0);e[a.CustomField.cls].canListAssociatedItems=
"canListAssociatedItems";e[a.CustomField.cls].canSkipRecipientName=function(){return!!this.group};e[a.CustomField.cls].canViewPrivate="canViewPrivateCustomFields";e[a.ExtendedOption.cls]=s("customFields",!0);e[a.TransportationOption.cls]=s("customFields",!0);e[a.ConnectedCampaign.cls]=s("customFields",!0,!1);e[a.ConnectedWaiver.cls]=s("customFields",!0,!1);e[a.GeneratingCampaign.cls]=s("customFields",!0);e[a.CustomFieldInstance.cls]=s("customFields",!0);e[a.CustomFieldInstanceCondition.cls]=s("customFields",
!0);e[a.CustomFieldInstanceGroup.cls]=s("customFields",!0);e[a.Availability.cls]=s("availabilities",!0);e[a.Availability.cls].canCreate=function(){return this.permissions.canViewOnlyCrewedAvailabilities?!1:this.permissions.canCreateAvailabilities};e[a.Availability.cls].canOveruseResources="canOveruseResources";e[a.Availability.cls].canBookClosed="canBookClosedAvailabilities";e[a.Availability.cls].canOverbook="canOverbookAvailabilities";e[a.Availability.cls].canBookUnbookable=function(){return this.permissions.canOveruseResources||
this.permissions.canBookClosed||this.permissions.canOverbook};e[a.Availability.cls].canUpdateMultiple=function(){return this.permissions.canViewOnlyCrewedAvailabilities?!1:this.permissions.canEditMultipleAvailabilities};e[a.Availability.cls].canViewCapacities="canViewAvailabilityCapacities";e[a.Availability.cls].canReportOn="canViewAvailabilities";e[a.CustomerType.cls]=s("customerTypes",!0);e[a.CustomerType.cls].canListAssociatedItems="canListAssociatedItems";e[a.CheckinStatus.cls]=s("checkinStatuses");
e[a.Campaign.cls]=s("campaigns",!0);e[a.Code.cls]=s("codes");e[a.CampaignValidityRule.cls]=s("campaigns",!0);e[a.StoredValueType.cls]=s("storedValueCards");e[a.StoredValueCard.cls]=s("storedValueCards",!0,!1);e[a.StoredValueAdjustment.cls]=s("storedValueCards",!0);e[a.Fund.cls]=function(a){a="canView"+_.capitalize(a);return{canView:a,canList:a,canCreate:_.never,canUpdate:_.never,canRemove:_.never}}("accounting");e[a.Fund.cls].canView=e[a.Fund.cls].canList=function(){return!B()?!1:this.permissions.canViewAccounting};
e[a.Transaction.cls]=e[a.Fund.cls];e[a.Contact.cls]=s("contacts",!0);e[a.Contact.cls].canUpdateLanguage=function(){return B()&&this.can("update")};e[a.InStorePaymentType.cls]=s("inStorePaymentTypes");e[a.EmvDevice.cls]=s("emvDevices");e[a.EmvDevice.cls].canView=e[a.EmvDevice.cls].canList=function(){return this.permissions.canCreateCreditCardPayments};e[a.EmvDevice.cls].canCreate=e[a.EmvDevice.cls].canRemove=e[a.EmvDevice.cls].canUpdate=function(){return this.permissions.canEditAccounting};e[a.BankAccount.cls]=
s("bankAccounts");e[a.BankAccount.cls].canCreate=function(){return this.permissions.canEditAccounting};e[a.BankAccount.cls].canRemove=function(){return this.permissions.canEditAccounting};e[a.BankAccount.cls].canUpdate=function(){return this.permissions.canEditAccounting};e[a.Card.cls]=s("cards",!0);e[a.Card.cls].canCreate=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};e[a.Card.cls].canRemove=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};
e[a.Card.cls].canUpdate=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};e[a.CardAffiliation.cls]=s("cards",!0);e[a.CardAffiliation.cls].canCreate=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};e[a.CardAffiliation.cls].canRemove=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};e[a.CardAffiliation.cls].canUpdate=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};
e[a.Account.cls]=s("accounting");e[a.Payout.cls]=s("accounting");e[a.Payout.cls].canRetry=function(){return B()&&this.can("adminUpdate")};e[a.Transfer.cls]=s("accounting");e[a.Adjustment.cls]=s("accounting");e[a.Adjustment.cls].canCreate=function(){return!B()?!1:this.permissions.canEditAccounting};e[a.Adjustment.cls].canUpdate=_.never;e[a.Adjustment.cls].canRemove=_.never;e[a.Invoice.cls]=s("invoices");e[a.InvoiceEntry.cls]=s("invoices");e[a.Upload.cls]=s("accounting");e[a.Upload.cls].canCreateDirectType=
function(){return!this.permissions.canEditAccounting?!1:this.permissions.canCreateDirectUploads};e[a.Hotel.cls]=s("hotels",!0);e[a.Hotel.cls].canCreate=function(){return!B()?!1:this.permissions.canEditHotels};e[a.Hotel.cls].canUpdate=e[a.Hotel.cls].canCreate;e[a.Hotel.cls].canRemove=e[a.Hotel.cls].canCreate;e[a.Lodging.cls]=s("transportation",!0);e[a.Pickup.cls]=s("transportation",!0);e[a.PreferredPickup.cls]=s("transportation",!0);e[a.Route.cls]=s("transportation",!0);e[a.Run.cls]=s("transportation",
!0);e[a.Stop.cls]=s("transportation",!0);e[a.Activity.cls]=s("activities");e[a.Activity.cls].canCreate="canEditActivities";e[a.Activity.cls].canView=function(){return a.Activity.isAdminOnly(this.instance)?B():!0};e[a.Activity.cls].canToggleAdminOnlyStatus=function(){return!B()||this.instance.object&&this.instance.object.cls===a.Activity.cls||a.Activity.isAdminOnly(this.instance)&&!this.instance.context.adminOnlyOriginalType?!1:this.can("update")};e[a.Activity.cls].canCreateNoteOnActivity=function(){return!B()||
this.instance.object&&this.instance.object.cls===a.Activity.cls?!1:this.can("create")};e[a.Activity.cls].canList=function(){return this.permissions.canViewActivities||this.permissions.canViewActivitiesSelf};e[a.Activity.cls].canListFeed=function(){return this.permissions.canViewActivitiesFeed};e[a.Waiver.cls]=s("waivers",!0);e[a.WaiverInstance.cls]=h("waiverInstances");e[a.CustomerPrototype.cls]=s("customFields",!0);e[a.CustomerPrototype.cls].canCreate=function(){return!v("updatePricing",this.company)?
!1:this.permissions.canEditCustomFields};e[a.CustomerTypeRate.cls]=s("availabilities",!0);e[a.Block.cls]=s("blocks");e[a.TotalSheet.cls]=s("sheets");e[a.TotalSheet.cls].canView=_.always;e[a.TotalSheet.cls].canReportOn=function(){return this.can("list")};e[a.InvoiceSheet.cls]=s("sheets");e[a.InvoiceSheet.cls].canView=_.always;e[a.InvoiceSheet.cls].canReportOn=function(){return this.can("list")};e[a.TotalLine.cls]=s("sheets");e[a.TotalLine.cls].canView=_.always;e[a.TotalLine.cls].canCreate="canEditPricing";
e[a.TotalLine.cls].canUpdate="canEditPricing";e[a.TotalLine.cls].canRemove="canEditPricing";e[a.InvoiceLine.cls]=s("sheets");e[a.InvoiceLine.cls].canView=_.always;e[a.InvoiceLine.cls].canCreate="canEditPricing";e[a.InvoiceLine.cls].canUpdate="canEditPricing";e[a.InvoiceLine.cls].canRemove="canEditPricing";e[a.Subscription.cls]=s("users");e[a.Notification.cls]=h("notifications",{checkPastBooking:!1});e[a.Notification.cls].canCreate=_.super(e[a.Notification.cls].canCreate,function(){return!this.booking?
this.permissions.canEditNotifications:this.super()});e[a.Notification.cls].canCreateDisputeType=function(){return!B()?!1:this.can("create",this.booking)};e[a.SmsNotification.cls]=h("smsNotifications",{checkPastBooking:!1});e[a.SmsNotification.cls].canCreate=function(){return this.company.isSmsEnabled&&this.permissions.canEditSmsNotifications&&v("update",this.booking)};e[a.ReviewExpressNotification.cls]=h("reviewExpress",{checkPastBooking:!1});e[a.Order.cls]=s("orders");e[a.Booking.cls]=s("bookings");
e[a.Booking.cls].canSkipPayment="canSkipPayment";e[a.Booking.cls].canBookHiddenFields="canBookHiddenFields";e[a.Booking.cls].canViewAffiliateBookings="canViewAffiliateBookings";e[a.Booking.cls].canOverrideTransportation="canOverrideTransportation";e[a.Booking.cls].canUpdateOnlyFutureBookings="canUpdateOnlyFutureBookings";e[a.Booking.cls].canCreate=function(){return!this.group&&!E.currentUser.isAuthenticated?!0:this.permissions.canCreateBookings};e[a.Booking.cls].canUpdate=function(){return this.permissions.canEditBookings?
!0:y(this.instance)};e[a.Booking.cls].canUpdateExplicitTotal=function(){return!this.permissions.canViewAmounts||this.instance&&!this.can("update")||this.instance&&!z.call(this,this.instance)?!1:this.permissions.canEditBookingExplicitTotals};e[a.Booking.cls].canUpdateExplicitInvoicePrice=function(){return!this.permissions.canViewInvoiceAmounts||this.instance&&!this.can("update")||this.instance&&!z.call(this,this.instance)?!1:this.permissions.canEditBookingExplicitInvoicePrices};e[a.Booking.cls].canViewBookingNote=
"canViewBookingNotes";e[a.Booking.cls].canUpdateBookingNote=function(){return!this.can("viewBookingNote")||this.instance&&!z.call(this,this.instance)?!1:this.permissions.canEditBookingNotes};e[a.Booking.cls].canUpdateBookingAffiliations=function(){return!this.can("update")||!z.call(this,this.instance)?!1:this.permissions.canEditBookingAffiliations};e[a.Booking.cls].canUpdateBookingAffiliationInfo=function(){return!this.can("update")||!z.call(this,this.instance)?!1:this.permissions.canEditBookingAffiliationInfo};
e[a.Booking.cls].canView=function(){return!this.group||this.permissions.canViewBookings?!0:y(this.instance)};e[a.Booking.cls].canCancel=function(){return this.can("update")&&this.permissions.canCancelBookings&&z.call(this,this.instance)};e[a.Booking.cls].canCancelEligible=function(){return!this.can("update")||!a.Booking.isEligibleForCancellation(this.instance,E.currentUser)||!z.call(this,this.instance)?!1:this.permissions.canCancelEligibleBookings};e[a.Booking.cls].canRebook=function(){return!this.can("cancel")?
!1:this.can("create")};e[a.Booking.cls].canRebookEligible=function(){return!this.can("cancelEligible")||!a.Booking.isEligibleForRebook(this.instance,E.currentUser)?!1:this.can("create")};e[a.Booking.cls].canEditCustomFieldValues=function(){return this.can("update")&&this.permissions.canEditCustomFieldValues&&z.call(this,this.instance,!0)};e[a.Booking.cls].canChangePriceSheets=function(){return!this.permissions.canViewAmounts||this.instance&&!z.call(this,this.instance)?!1:this.permissions.canChangePriceSheets};
e[a.Booking.cls].canReapplyResourceUses=function(){return!z.call(this,this.instance)?!1:this.permissions.canOveruseResources};e[a.Booking.cls].canCreateCustomRefunds=function(){return!this.permissions.canViewAmounts||!z.call(this,this.instance,!0)?!1:this.permissions.canCreateCustomRefunds};e[a.Customer.cls]=h("customers");e[a.Customer.cls].canViewCheckinStatus=function(){return!this.booking?this.permissions.canViewCustomerCheckinStatus:this.can("view")&&this.permissions.canViewCustomerCheckinStatus};
e[a.Customer.cls].canUpdateCheckinStatus=function(){return v("update",this.booking)&&this.permissions.canEditCustomerCheckinStatus&&z.call(this)};e[a.BookingCustomFieldValue.cls]=h("customFieldValues",{isLimitedPastBookingUpdate:!0});e[a.CustomerCustomFieldValue.cls]=h("customFieldValues",{isLimitedPastBookingUpdate:!0});e[a.BookingCustomFieldValue.cls].canUpdate=function(){return this.permissions.canEditCustomFieldValues&&z.call(this,this.booking,!0)};e[a.CustomerCustomFieldValue.cls].canUpdate=
function(){return this.permissions.canEditCustomFieldValues&&z.call(this,this.booking,!0)};e[a.Refund.cls]=h("refunds",{isLimitedPastBookingUpdate:!0});e[a.Refund.cls]=h("refunds",{isLimitedPastBookingUpdate:!0});e[a.Refund.cls].canUpdate=d("viewAmounts",e[a.Refund.cls].canUpdate);e[a.Refund.cls].canCreate=d("viewAmounts",e[a.Refund.cls].canCreate);e[a.LineItem.cls]=h("lineItems",{isLimitedPastBookingUpdate:!0});e[a.LineItem.cls].canUpdate=d("viewAmounts",e[a.LineItem.cls].canUpdate);e[a.LineItem.cls].canCreate=
d("viewAmounts",e[a.LineItem.cls].canCreate);e[a.LineItem.cls].canRemove=d("viewAmounts",e[a.LineItem.cls].canRemove);e[a.LineItem.cls].canReportOn=function(){return this.permissions.canViewLineItems};e[a.Payment.cls]=h("payments",{isLimitedPastBookingUpdate:!0});e[a.Payment.cls].canCreatePartial=d("viewAmounts","canSkipPayment");e[a.Payment.cls].canCreateWithoutCVC=function(){return B()||this.permissions.canCreateCreditCardPaymentsWithoutCvv};e[a.Payment.cls].canCreateWithoutCardholdersName="canSkipCardholderInfo";
e[a.Payment.cls].canCreateWithoutPostalCode="canSkipPostalCode";e[a.Payment.cls].canCreateWithoutCountryCode="canSkipPostalCode";e[a.Payment.cls].canCreateCreditCard=d("viewAmounts","canCreateCreditCardPayments");e[a.Payment.cls].canCreateInStore=d("viewAmounts","canCreateInStorePayments");e[a.Payment.cls].canCreateStoredValueCard=d("viewAmounts","canCreateStoredValueCardPayments");e[a.Payment.cls].canCreateDeferred="canCreateDeferredPayments";e[a.Payment.cls].canCreateAffiliate=function(){return this.permissions.canCreateAffiliatePayments?
!0:this.booking?y(this.booking):!1};e[a.TicketLayout.cls]=s("ticketLayouts",!0);e[a.SupportedLanguage.cls]=s("supportedLanguages");e[a.Translation.cls]=s("translations");e[a.Location.cls]=s("locations");e[a.Location.cls].canView="canEditLocations";e[a.Location.cls].canViewSensitive="canEditLocations";e[a.Location.cls].canList="canEditLocations";e[a.Report.cls]=s("reports");e[a.Report.cls].canViewAccountsType="canViewAccounting";e[a.Report.cls].canViewEscrowType="canViewAccounting";e[a.Report.cls].canViewFundsType=
"canViewAccounting";e[a.Report.cls].canViewPayoutsType="canViewAccounting";e[a.Report.cls].canViewTransfersType="canViewAccounting";e[a.Report.cls].canViewInvoicesType="canViewInvoices";e[a.Report.cls].canViewInvoiceableBookingsType="canEditInvoices";e[a.Report.cls].canViewAdvancedType="canViewAdvancedReport";e[a.Report.cls].canViewAgentsSummaryType="canViewAgentsSummaryReport";e[a.Report.cls].canViewBookingTypesSummaryType="canViewBookingTypesSummaryReport";e[a.Report.cls].canViewBookingsType="canViewBookingsReport";
e[a.Report.cls].canViewCampaignsSummaryType="canViewCampaignsSummaryReport";e[a.Report.cls].canViewContactsType="canViewContactsReport";e[a.Report.cls].canViewCrewSummaryType="canViewCrewSummaryReport";e[a.Report.cls].canViewCustomFieldSummaryType="canViewCustomFieldSummaryReport";e[a.Report.cls].canViewCustomerTypesSummaryType="canViewCustomerTypesSummaryReport";e[a.Report.cls].canViewDesksSummaryType="canViewDesksSummaryReport";e[a.Report.cls].canViewItemsSummaryType="canViewItemsSummaryReport";
e[a.Report.cls].canViewLineItemsSummaryType="canViewLineItemsSummaryReport";e[a.Report.cls].canViewLodgingsSummaryType="canViewLodgingsSummaryReport";e[a.Report.cls].canViewPaymentsType="canViewPaymentsReport";e[a.Report.cls].canViewDisputesType="canViewDisputesReport";e[a.Report.cls].canViewPickupLocationsSummaryType="canViewPickupLocationsSummaryReport";e[a.Report.cls].canViewRevenueSummaryType="canViewRevenueSummaryReport";e[a.Report.cls].canViewUsersSummaryType="canViewUsersSummaryReport";e[a.Report.cls].canViewCompaniesType=
"canViewCompaniesReport";e[a.Report.cls].canViewInProgressReportsType="canViewInProgressReportsReport";e[a.Report.cls].canViewTransactionsType="canViewTransactionsReport";e[a.Report.cls].canViewVolumeType="canViewVolumeReport";e[a.Report.cls].canReport=function(){return!!this.group};e[a.ViatorMapping.cls]=s("viator");e[a.Resource.cls]=s("resources");e[a.Resource.cls].canListAssociatedItems="canListAssociatedItems";e[a.Requirement.cls]=s("resources");e[a.RequirementGroup.cls]=s("resources");e[a.CustomerPrototypeRequirement.cls]=
s("resources");e[a.ResourceRequirement.cls]=s("resources");e[a.ResourceOverride.cls]=s("resources");e[a.ResourceUse.cls]=h("resources",{permissionOverrides:{canCreate:"canEditResourceUses",canUpdate:"canEditResourceUses",canRemove:"canEditResourceUses"}});e[a.ResourceUse.cls].canList=_.super(e[a.ResourceUse.cls].canList,function(){return!this.booking?this.permissions.canViewResources:this.super()});e[a.AnalyticsService.cls]=s("analyticsServices",!0);e[a.CancellationPolicy.cls]=s("cancellationPolicies",
!0);e[a.CancellationPolicy.cls].canListAssociatedItems="canListAssociatedItems";e[a.CancellationRule.cls]=s("cancellationPolicies",!0);e[a.BookingRestriction.cls]=s("bookingRestrictions",!0);e[a.BookingRestriction.cls].canListAssociatedItems="canListAssociatedItems";k.canBookWithNoFee=function(a,b){return E.currentUser.isAuthenticated};h=function(a){return _.super(a,function(){return _.isNumber(this.group.conditions&&this.group.conditions.maxCompanyTier)?!1:this.super()})};e[a.ResellerApp.cls]=s("reseller");
e[a.ResellerApp.cls].canList=h(e[a.ResellerApp.cls].canList);e[a.ResellerAppCompany.cls]=s("reseller");e[a.ResellerCompany.cls]=s("reseller");e[a.ResellerCompany.cls].canList=h(e[a.ResellerCompany.cls].canList);e[a.ResellerCompanyMapping.cls]=s("reseller");e[a.ResellerCompanyMapping.cls].canCreate=function(){return!B()?!1:this.permissions.canEditReseller};e[a.ResellerCompanyMapping.cls].canList=function(){return!B()?!1:this.permissions.canViewReseller};e[a.ResellerCompanyMapping.cls].canRemove=function(){return!B()?
!1:this.permissions.canEditReseller};e[a.ResellerItem.cls]=s("reseller");e[a.ResellerItemMapping.cls]=s("reseller");e[a.ResellerCustomerType.cls]=s("reseller");e[a.ResellerCustomerTypeMapping.cls]=s("reseller");e[a.ResellerOption.cls]=s("reseller");e[a.ResellerOptionMapping.cls]=s("reseller");e[a.ResellerKey.cls]=s("reseller");e[a.Order.cls].canCancelEligible=function(){return this.permissions.canCancelEligibleBookings&&!this.can("cancel")};(h=f.slipstream("currentUser"))?h.isAuthenticated=!0:h=x;
d=function(a){var b=function(){return E.currentUser.isAuthenticated?E.currentUser.username+"@"+E.currentUser.company.shortname:"anonymous"};return{get:function(c){return a.get(b()+":"+c)},set:function(c,d){return a.set(b()+":"+c,d)},del:function(c){return a.del(b()+":"+c)},clear:function(){if(a.key&&a.length)for(var c=b(),d,e,f=0;f<a.length;f++)e=a.key(f),d=e.split(":",1)[0],d===c&&a.del(e);else a.clear()}}};var E={permissions:k,storage:d(l),sessionStorage:d(p),currentUser:h,isAuthenticatedForAdminCompany:B,
isAuthenticatedForAdminCompanyAsDeveloper:function(){return B()&&_.contains(g,E.currentUser.username)},relatedCompanies:function(){return!E.currentUser.isAuthenticated?[]:_.sortBy(_.unique(_.append(_.pluck(a.GroupOverride.companyLevelOverrides(E.currentUser.company.relatedGroupOverrides),"company"),_.pluck(E.currentUser.relatedGroupOverrides,"company"))),"name")},login:function(a,b){var c=f.login({},a,b);return c.$promise.then(function(){E.currentUser=c;E.currentUser.isAuthenticated=!0;m.broadcast("auth.login")})},
logout:function(){E.storage.clear();E.sessionStorage.clear();E.currentUser=x;var a=c.post(b.api.logout);m.broadcast("auth.logout");return a}};return window.$$auth=E}]);n.run(["$rootScope","$window","auth",function(c,k,h){c.auth=h;k.$$auth=h}])})();angular.module("cache",["cache.services"]);
(function(){var n=angular.module("cache.services",["lib.services","urls.services"]);n.factory("cache",["moment","urls",function(c,k){var h=function(a,c){c=c||{};for(var f in a)a.hasOwnProperty(f)&&(c[f]=d(a[f]));return c},d=function(a){if(_.isArray(a)){for(var c=[],k=0,b=a.length;k<b;k++)c.push(d(a[k]));return c}return _.isModelObject(a)?f(a):_.isObject(a)?h(a):a},f=function(a,c){if(_.isUndefined(a)||null===a)return c&&delete m.cache[c],a;if(!_.isObject(a))return a;var d=a.uri;c=c||d;var b=m.cache[c];
d&&(c&&c!==d&&!_.isUndefined(b))&&(console.log("cache: overlapping uris",d,c),delete m.cache[c]);b=_.isUndefined(b)?{}:b;d&&(m.cache[d]=b,b.$url||(b.$url=k.populateForObject));d=h(a,b);d.$fresh=!1;return d},m={cache:{},read:function(a,c){if(_.isUndefined(a))throw Error("cache.read: invalid key");c&&(a="["+a+"]");var d=m.cache[a];_.isUndefined(d)&&(d=c?[]:{},d.uri=a,d.$fresh=!0,m.cache[a]=d);return d},update:f,clear:function(){m.cache={}},fresh:function(a){return!!a.$fresh},populate:d,reference:function(a){if(a.cls&&
a.uri)return{cls:a.cls,uri:a.uri}}};return window.$$cache=m}]);n.run(["$rootScope","cache","events",function(c,k,h){h.on(c,"auth.logout",function(){k.clear()})}])})();
(function(){var n=angular.module("cart",["cache","db","navigation"]);n.factory("cart",["$q","$rootScope","$timeout","cache","clientOptions","db","events","flows","navigation","require","persistentStorage","urls","xmessage",function(c,k,h,d,f,m,a,p,l,b,g,n,x){var q=function(a){return{company:a,entries:[],isNoTax:!1,isCardRequired:!0,totals:{price:0,tax:0,total:0}}},B=function(){z.status="success";a.broadcast("cart.loaded")},y=function(a){a.totals.price=_.sum(a.entries,"totals.price");a.totals.tax=
_.sum(a.entries,"totals.tax");a.totals.bookingFee=_.sum(a.entries,"totals.bookingFee");a.isNoTax=_.all(a.entries,"isNoTax");a.isCardRequired=_.any(a.entries,"isCardRequired")},D={},e=function(a,c,d,e,f){b.assert(!!c,"cart: expected availability");b.assert(!!d,"cart: expected breakdown");b.defined(e,"price","cart: expected total price");b.defined(e,"tax","cart: expected total tax");b.defined(e,"bookingFee","cart: expected total total");b.assert(!!f,"cart: expected model");var g=a.company.shortname;
D[g]=D[g]||{};var k=D[g][c.uri];k||(k={availability:c},D[g][c.uri]=k,a.entries.push(k));k.customerBreakdown=d;k.totals=e;k.isNoTax=!k.totals.tax&&c.item.isNoTax;k.isCardRequired=c.item.isCardRequired;k.model=f;y(a)},F=function(a,b){_.overwriteWithout(a.entries,function(a){return a.availability===b.availability});D[a.company.shortname]&&delete D[a.company.shortname][b.availability.uri];y(a)},G=function(a){_.clear(a.entries);D[a.company.shortname]={};y(a)},A=function(a,b){try{var f=_.map(b.entries,
function(a){var b=m.availability(a.availability,null,null,null,{tagAlong:!0});return b.$promise.then(function(){return{availability:b,storedEntry:a}},function(){return null})});return c.all(f).then(function(b){G(a);_.forEach(b,function(b){if(b){var c=b.availability;b=b.storedEntry;var f=_.choose(b.customerBreakdown,function(a){var b=d.read(a.customerTypeRate.uri);if(b)return{count:a.count,customerTypeRate:b}});e(a,c,f,b.totals,b.model)}});console.info("cart: finished hydrating")})}catch(g){return console.warn("cart: unable to load cart",
b,g),c.when(null)}},v=function(a){var b={};b.entries=_.map(a,function(a){var b=_.map(a.customerBreakdown,function(a){return{count:a.count,customerTypeRate:d.reference(a.customerTypeRate)}});return{availability:n.extract(a.availability),customerBreakdown:b,totals:a.totals,model:a.model}});return b},s=function(a){if(z.company){var b=v(z.entries);b?(console.info("cart: storing",b),b=g.set("cart",b)):b=g.del("cart");a&&(b=b.then(function(){x.broadcast("fareharbor.cart.changed")}));return b}},z={status:"success",
add:function(a,b,c,d){e(z,a,b,c,d);return s(!0)},remove:function(a){F(z,a);s(!0)},clear:function(){G(z);s(!0)},search:function(a){return(D[z.company.shortname]||{})[a.uri]||null},keepShoppingUrl:function(a){return p.initialUrl()||a.$url(n.company.index)},permalinkUrl:function(a){a=n.populate(n.company.cart.permalink,{shortname:a.shortname,cartUuid:f.userIdentifier});return p.extendWithFlow(a)},load:function(){if(z.company&&"loading"!==z.status)return z.status="loading",z.$promise=g.get("cart").then(function(a){if(a)return console.info("cart: hydrating...",
a),A(z,a)}).then(B,B),z.$promise},allCompanies:{status:"success",carts:{},load:function(){z.allCompanies.status="loading";z.allCompanies.$promise=g.getForAllCompanies("cart").then(function(a){delete z.allCompanies.$promise;_.clear(z.allCompanies.carts);D={};var b=[];_.forEach(a,function(a){if(a.cart){var c=a.company.shortname;z.allCompanies.carts[c]=q(a.company);console.info("cart: loading all...",a);b.push(A(z.allCompanies.carts[c],a.cart))}});return c.all(b).then(function(){z.company&&z.allCompanies.carts[z.company.shortname]?
_.extend(z,z.allCompanies.carts[z.company.shortname]):_.extend(z,q());z.allCompanies.status="success"},function(){z.allCompanies.status="success"})});return z.allCompanies.$promise}}};_.extend(z,q(null));var u=function(a){a&&z.company!==a&&(console.info("cart: loading for new company",a),s(),z.company=a,z.load())};u(l.currentCompany);a.on(k,"navigation.company.updated",function(a,b){u(b.company)});a.on(k,"persistentStorage.reIdentifiedUser",function(){l.currentCompany&&(z.company=l.currentCompany,
z.load(),console.info("cart: loading for new user"))});return z}]);n.controller("cart.CartCtrl",["$scope","clientOptions","controllers","db","navigation","require",function(c,k,h,d,f,m){k.reflect("userIdentifier")}]);n.controller("cart.ViewCartCtrl",["$scope","cart",function(c,k){k.load()}]);n.directive("ngCart",["analytics","cart","db","flows","lightframe","localization","navigation","paymentController","tracking","urls",function(c,k,h,d,f,m,a,p,l,b){return{templateUrl:"cart.cart",controller:["$scope",
"$attrs",function(g,m){h.slipstream("isDebug")&&(window.$$pop=function(a,b){g.$safeApply(function(){var c=a?a.replace(" ","-"):"z";n.newOrder["contact-name"]=_.capitalize(a||"zach");n.newOrder["contact-phone"]="4158881212";n.newOrder["contact-email"]=c+"@fareharbor.com";n.newOrder["payments-payment-cardNumber"]="4242424242424242";n.newOrder["payments-payment-cardholdersName"]="Zach Snow";n.newOrder["payments-payment-cardExpiryMonth"]="12";n.newOrder["payments-payment-cardExpiryYear"]="2018";n.newOrder["payments-payment-cardCvc"]=
"123";n.newOrder["payments-payment-postalCode"]="12345";n.newBooking["payments-payment-countryCode"]="US";_.extend(n.newBooking,b)})});var n=this,q={};n.setEntryValidity=function(a,b){var c=a.availability.uri;_.isUndefined(b)?delete q[c]:q[c]=!!b};n.addEntryController=function(a){_.contains(n.entryCtrls,a)||n.entryCtrls.push(a)};n.removeEntryController=function(a){_.contains(n.entryCtrls,a)&&_.ref.remove(n.entryCtrls,a)};n.newOrder=g.newOrder={clientUuid:_.uuid()};n.company=g.$eval(m.ngCart);n.attachControl=
function(a,b){n[a]=b;b.cartCtrl=n};n.showCompleteButton=function(a){return!a.$invalid&&!a.$submitting&&0<k.entries.length&&_.all(q)&&n.paymentCtrl&&n.paymentCtrl.isCurrentOptionValid()&&n.paymentCtrl.isCurrentKindValid()&&!n.paymentCtrl.isAmountTooLow()};var B=!1;n.isNavigateAwayAllowed=function(a){return B?!0:!a.$pristine?!1:!0};var y=function(m,e){e=e||_.ignore;var p=_.extend({},n.newOrder);p.bookingCount=k.entries.length;_.forEach(k.entries,function(a,b){var c="booking"+b.toString()+"-";_.extendWithPrefix(c,
p,a.model);p[c+"availability"]=a.availability.pk});console.info("cart: creating order",p);var q=h.orders.create({shortname:n.company.shortname},p,m);q.$promise.then(function(){B=!0;var h=q.$url(b.company.order.index);1===q.contributingBookings.length&&(h=q.contributingBookings[0].$url(b.company.item.booking));h=d.extendWithFlow(h);a.navigate(h);k.clear();m.$submitting=!0;h={company:n.company.shortname,order:q.uuid,total:q.contributingBookingCosts.totalCost.total,bookingCount:q.bookingCount,items:_.unique(_.map(q.contributingBookings,
"item.name")),isLightframe:f.isLightframe()};l.track(g,"completed-order",h);c.trackOrder(q);e()},function(){l.track(g,"failed-order",{company:n.company.shortname,isLightframe:f.isLightframe()});n.paymentCtrl.restoreCard();m.$submitting=!1;e()})};n.submit=function(a){if(k.entries.length)if(a.$valid){a.$submitting=!0;n.paymentCtrl.saveCard();var b=n.paymentCtrl.option();if(b===n.paymentCtrl.CHARGE_OPTION||b===n.paymentCtrl.DEFER_OPTION)n.tokenizingCard=!0;g.$asyncApply(function(b){n.paymentCtrl.createToken(a,
function(){n.tokenizingCard=!1;y(a,b)},function(){n.tokenizingCard=!1;a.$submitting=!1;b()})})}else console.error("cart: attempting to submit invalid order form");else console.error("cart: attempting to submit empty order form")};p(g,{modelKey:"newOrder",fieldPrefix:"payments-payment",company:n.company,gross:function(){return!n.cartTotalsCtrl?0:n.cartTotalsCtrl.totals.preBookingFeeTotal},bookingFee:function(){return!n.cartTotalsCtrl?0:n.cartTotalsCtrl.totals.bookingFee},invoicePrice:0,isAnonymous:!0,
isAffiliate:!1,isCompany:!1,isCardRequired:!!k.isCardRequired});n.attachControl("paymentCtrl",g.paymentCtrl)}],controllerAs:"cartCtrl"}}]);n.directive("ngCartEntry",["cart","db","navigation","urls",function(c,k,h,d){return{restrict:"A",require:"^ngCart",templateUrl:"cart.entry",controller:["$scope","$attrs",function(f,m){var a=this;a.status="loading";a.cartCtrl=f.cartCtrl;a.entry=f.$eval(m.ngCartEntry);a.total=_.sum([a.entry.totals.price,a.entry.totals.tax,a.entry.totals.bookingFee]);a.change=function(){var b=
a.entry.availability.$url(d.company.item.book);h.navigate(b)};a.remove=function(){c.remove(a.entry)};var n={};_.forEach(a.entry.customerBreakdown,function(a){n[a.customerTypeRate.pk]=a.count});var l=k.availability.liveCapacity({shortname:a.entry.availability.item.company.shortname,itemPk:a.entry.availability.item.pk,availabilityPk:a.entry.availability.pk},null,null,{customerTypeRateCounts:_.stringifyJSON(n),totalSheet:a.entry.model.totalSheet});l.$promise.then(function(){a.cartCtrl.setEntryValidity(a.entry,
l.isBookable);a.status=a.entry.availability.isBookable&&l.isBookable?"success":"error";a.isPossiblyBookable=a.entry.availability.isBookable},function(){a.cartCtrl.setEntryValidity(a.entry,!0);a.status="success"});f.$on("$destroy",function(){a.cartCtrl.setEntryValidity(a.entry)})}],controllerAs:"cartEntryCtrl"}}]);n.directive("ngCartTotals",["cart","models","redeemStoredValueCardsController",function(c,k,h){return{restrict:"A",require:"^ngCart",templateUrl:"cart.totals",controller:["$scope",function(d){var f=
this;d.cartCtrl.attachControl("cartTotalsCtrl",f);f.cartCtrl=d.cartCtrl;f.totals=_.extend({},c.totals);f.currentPrice=function(){return f.totals.price};f.currentTax=function(){return f.totals.tax};var m=function(a){return a.availability.uri},a=function(a){return a.totals.price+a.totals.tax},n=function(b){var f=d.redeemStoredValueCardsCtrl.storedValueCards;if(!f.length)return b;var h={};_.forEach(f,function(b){b=d.redeemStoredValueCardsCtrl.applied(b);b=_.prorate(b,c.entries,a,m);h=_.merge(h,b,_.add)});
var l=0;_.forEach(c.entries,function(a){var b=m(a);l+=k.Booking.adjustBookingFee(a.totals.bookingFee,a.totals.price,a.totals.tax,h[b])});return l},l=function(){_.extend(f.totals,c.totals);f.totals.bookingFee=n(f.totals.bookingFee);f.totals.preBookingFeeTotal=f.totals.price+f.totals.tax-d.redeemStoredValueCardsCtrl.totalApplied();f.totals.total=f.totals.preBookingFeeTotal+f.totals.bookingFee};d.$watchCollection("cart.entries",function(){l()});h(d,{company:f.cartCtrl.company,modelKey:"newOrder",price:f.currentPrice,
tax:f.currentTax,toggleName:"applyStoredValueCard"});d.cartCtrl.attachControl("redeemStoredValueCardsCtrl",d.redeemStoredValueCardsCtrl);d.$watch("redeemStoredValueCardsCtrl.storedValueCards.length",function(a){l()})}],controllerAs:"cartTotalsCtrl"}}]);n.directive("ngCartComplete",["cart",function(c){return{restrict:"A",require:"^ngCart",templateUrl:"cart.complete",controller:["$scope",function(c){}],controllerAs:"cartCompleteCtrl"}}]);n.directive("ngCartAdd",["cart","navigation","urls",function(c,
k,h){return{restrict:"A",require:"^ngBook",templateUrl:"cart.add",controller:["$scope",function(d){var f=this;f.isAdding=!1;f.isAvailabilityInCart=!!c.search(d.bookCtrl.availability);f.add=function(){f.isAdding=!0;var h={price:d.bookCtrl.bookTotalsCtrl.totals.price,tax:d.bookCtrl.bookTotalsCtrl.totals.tax,bookingFee:d.bookCtrl.bookTotalsCtrl.totals.bookingFee};d.bookCtrl.isAlreadyBooked=!0;c.add(d.bookCtrl.availability,d.bookCtrl.bookCountsCtrl.customerBreakdown(),h,d.bookCtrl.newBooking).then(function(){k.navigate(c.permalinkUrl(d.bookCtrl.item.company))},
function(){f.isAdding=!1})}}],controllerAs:"cartAddCtrl"}}]);n.directive("ngCartSubmit",[function(){return{restrict:"A",require:"^ngCart",templateUrl:"cart.submit"}}]);n.run(["$rootScope","cart",function(c,k){c.cart=k;window.$$cart=k}])})();angular.module("db",["db.services"]);
(function(){var n=0;angular.module("db.services",["cache.services","lib.services"]).factory("db",["$http","$injector","$rootScope","$q","$window","cache","convert","flash","require","urls",function(c,k,h,d,f,m,a,p,l,b){var g=!1;angular.element(f).on("beforeunload",function(){g=!0});var C={},x=_.debounce(function(){g||p.warn("<b>Could not reach FareHarbor.</b> Please check your internet connection.")},2E3,!0),q=function(a){_.isUndefined(a)&&(a="<b>That didn't work.</b> Please try again.");a&&p.error(a)},
B=_.debounce(function(a){p.error("<b>Too many "+a+'.</b> Please wait a few minutes and try again. If you continue to receive this message please contact <a href="mailto:support@fareharbor.com" target="_blank">support@fareharbor.com</a>.')},2E3,!0),y=_.debounce(function(){p.error("<b>FareHarbor will be right back.</b> Please wait a few minutes and try again.")},2E3,!0),D=function(a,b,c){return c?_.map(a,function(a){return m.update(a)}):m.update(a,b)},e=function(e){var f={},g={isDelete404Success:!0},
k=e.formName||e.key+"Form";return function(h,I,r,s,v){var t=_.extend({},g,e,v),w=!1!==t.flashError,u,R;if(_.isString(h))u=h;else{var A={};_.extend(A,t.defaultParams||{},h);u=b.populate(t.url,A)}R=u;if(_.isUndefined(u))return console.warn("db: invalid endpoint",t.url,A),I=t.isArray?[]:{},I.$promise=d.reject(null),I.$promise.cancel=_.ignore,I;s&&(u+="?"+fb(a.clientRequest(s)),s=null);t.ignoreQueryParamsInCacheUri||(R=u);var z=n+=1;console.log("db: endpoint",u,z);if((h=f[u])&&!t.ignoreInFlight){if(t.tagAlong)return console.log("db: tagging along",
u,z),h.value;"GET"===t.method&&"GET"===h.method&&(console.log("db: already in flight, cancelling",u,z),h.timeout.promise.cancelled=!0,h.timeout.resolve())}var H;H=t.ignoreCache?t.isArray?[]:{}:m.read(R,t.isArray);var E=function(a){a.data&&t.sideKeys&&_.forEach(t.sideKeys,function(b){var c=a.data[b];c&&(a[b]=D(c,null,_.isArray(c)))})},ca=_.identity;t.key&&(ca=t.isArray?function(a){console.log("db: success",u,z);if(H.$requestId!==z)return console.log("db: out of order",u,H.$requestId,z),a;var b=_.isFunction(t.key)?
t.key(a):t.key;_.overwrite(H,D(a.data[b],null,!0));H.$fresh=!1;a.data?(a.primaryData=a.data[b]=H,E(a)):a.primaryData=null;r&&G(r,k)(a,H);return a}:function(a){console.log("db: success",u,z);if(H.$requestId!==z)return console.warn("db: out of order",u,H.$requestId,z),a;var b=_.isFunction(t.key)?t.key(a):t.key,c=a.data[b],c=t.ignoreCache?D(c):D(c,R);a.data?(a.primaryData=a.data[b]=c,E(a)):a.primaryData=null;r&&G(r,k)(a,c);return a});var Z;r&&(Z=F(r,k));h=function(a){return function(b){b=a(b);console.log("db: complete",
u,z);t.ignoreInFlight||(f[u]=null);r&&(r.$submitting=!1);H.$requestId===z&&(delete H.$requestId,delete H.$promise);return b}};r&&(r.$submitting=!0);s=d.defer();var J=c({method:t.method,url:u,data:I||{},timeout:s.promise}).then(h(ca),h(function(a){console.log("db: error",u,z,a);var b=a.status;if(500===b)return p.error("<b>Whoops, an internal error has occurred.</b> FareHarbor has been notified. Please wait a few minutes and try again."),d.reject(a);if(503===b)return y(),d.reject(a);if(403===b)return w&&
p.error('<b>Not allowed.</b> Please <a href="/login/">log in</a> as a different user or request permission from your administrator.'),d.reject(a);if(420===b)return B("connections"),d.reject(a);if(429===b)return B("requests"),d.reject(a);if(324===b)return x(),d.reject(a);if(0===b){if(a.config.timeout&&a.config.timeout.cancelled)return C;x();return d.reject(a)}if(400===b)return Z?Z(a,b):w&&q(a.data.errorMessage||t.errorMessage),d.reject(a);if(404===b){if(t.isDelete404Success&&"DELETE"===t.method)return console.log("db: treating 404 as success",
u,z),ca(a)}else q(a.data.errorMessage||t.errorMessage),console.error("db: unknown error",a,b);return d.reject(a)}));l.assert(!J.success&&!J.error,"db: disallow $http promise interface");t.ignoreInFlight||(f[u]={timeout:s,value:H,requestId:z,method:t.method,uri:u});H.$requestId=z;H.$promise=J;H.$promise.timeout=s;H.$promise.cancel=function(){J.timeout?(J.timeout.promise.cancelled=!0,J.timeout.resolve(),console.log("db: cancelled",u,z)):console.warn("db: cancellation failed",u,z)};return H}},F=function(a,
b){return function(c){var d=c.data[b];_.forEach(d,function(b,c){a[c]||(a[c]={$error:{}});var d=a[c];b&&b.length?d.$error.$server=b:d.$error={}});a.$errorCallbacks&&_.forEach(a.$errorCallbacks,function(a){a(d)})}},G=function(a,b){return function(b,c){_.forEach(a,function(a,b){a&&a.$error&&delete a.$error.$server});a.$successCallbacks&&_.forEach(a.$successCallbacks,function(a){a(c)})}},A=function(a,c){c||(c=a+"s");var d=e({method:"GET",url:b.api[c],isArray:!0,key:c});d.create=e({method:"POST",url:b.api[c],
key:a});return d},v=function(a){var c=e({method:"GET",url:b.api[a],key:a});c.update=e({method:"PUT",url:b.api[a],key:a});c.remove=e({method:"DELETE",url:b.api[a],formName:"disableForm"});return c},s=function(a,b,c){var d={};d[b]=_.isUndefined(c)?"yes":c;return function(b,c,e,f,g){f=_.extend({},d,f);return a(b,c,e,f,g)}},z=function(a){return s(a,"pickable")},u=e({method:"POST",url:b.api.login,key:"user",formName:"loginForm"}),t={};t.password=e({method:"POST",url:b.api.forgotPassword,formName:"forgotPasswordForm"});
t.password.reset=e({method:"POST",url:b.api.resetPassword,formName:"resetPasswordForm"});t.credentials=e({method:"POST",url:b.api.forgotCredentials,formName:"forgotCredentialsForm"});var E=e({method:"GET",url:b.api.reportTest,key:"report"}),L=e({method:"GET",url:b.api.companies,isArray:!0,key:"companies"});L.pickable=z(L);L.jump=s(L,"jump");L.full=s(L,"full");L.create=e({method:"POST",url:b.api.companies,key:"company"});L.admin=e({method:"GET",url:b.api.company,key:"company",defaultParams:{shortname:"admin"}});
L.report=e({method:"GET",url:b.api.reportCompanies,key:"report"});var r=e({method:"GET",url:b.api.company,key:"company"});r.update=e({method:"PUT",url:b.api.company,key:"company"});r.remove=e({method:"DELETE",url:b.api.company});r.styles={};r.styles.update=e({method:"PUT",url:b.api.companyStyles,key:"styles",formName:"companyStylesForm"});r.adminNotes={};r.adminNotes.update=e({method:"PUT",url:b.api.companyAdminNotes,key:"adminNotes",formName:"companyAdminNotesForm"});r.accounts=e({method:"GET",url:b.api.companyAccounts,
key:"accounts"});r.accounts.report=e({method:"GET",url:b.api.reportAccounts,key:"report"});r.nags={};r.nags.update=e({method:"PUT",url:b.api.companyNags,key:"companyNags",formName:"companyNagsForm"});r.companyFeatures={};r.companyFeatures.update=e({method:"PUT",url:b.api.companyFeatures,key:"companyFeatures",formName:"companyFeaturesForm"});r.itemColorsFeature={};r.itemColorsFeature.update=e({method:"PUT",url:b.api.companyItemColorsFeature,key:"companyItemColorsFeature",formName:"companyItemColorsFeatureForm"});
r.contactInformation={};r.contactInformation.update=e({method:"PUT",url:b.api.companyContactInformation,key:"contactInformation",formName:"companyContactInformationForm"});r.taxInformation={};r.taxInformation.update=e({method:"PUT",url:b.api.companyTaxInformation,key:"taxInformation",formName:"companyTaxInformationForm"});r.extendedTaxInformation={};r.extendedTaxInformation.update=e({method:"PUT",url:b.api.companyExtendedTaxInformation,key:"extendedTaxInformation",formName:"companyExtendedTaxInformationForm"});
r.tosAcceptance={};r.tosAcceptance.update=e({method:"PUT",url:b.api.companyTosAcceptance,key:"tosAcceptance",formName:"companyTosAcceptanceForm"});r.escrowReport=e({method:"GET",url:b.api.reportEscrow,key:"report"});r.profile={};r.profile.update=e({method:"PUT",url:b.api.companyProfile,key:"profile",formName:"companyProfileForm"});r.payments={};r.payments.update=e({method:"PUT",url:b.api.companyPayments,key:"payments",formName:"companyPaymentsForm"});r.manifestSettings={};r.manifestSettings.update=
e({method:"PUT",url:b.api.companyManifestSettings,key:"manifestSettings",formName:"manifestSettingsForm"});r.images=e({method:"GET",url:b.api.companyImages,key:"images",isArray:!0});r.images.create=e({method:"POST",url:b.api.companyImages,key:"image"});r.image={};r.image.update=e({method:"PUT",url:b.api.companyImage,key:"image"});r.image.remove=e({method:"DELETE",url:b.api.companyImage});r.activities={};r.activities.all=e({method:"GET",url:b.api.allActivities,isArray:!0,key:"activities"});r.activities.system=
e({method:"GET",url:b.api.systemActivities,isArray:!0,key:"activities"});r.activities.admin=s(r.activities.system,"admin");r.calendar=e({method:"GET",url:b.api.companyCalendar,key:"calendar"});r.summaryReport={};r.summaryReport.items=e({method:"GET",url:b.api.reportItemsSummary,key:"report"});r.summaryReport.users=e({method:"GET",url:b.api.reportUsersSummary,key:"report"});r.summaryReport.bookingTypes=e({method:"GET",url:b.api.reportBookingTypesSummary,key:"report"});r.summaryReport.customerTypes=
e({method:"GET",url:b.api.reportCustomerTypesSummary,key:"report"});r.summaryReport.customField=e({method:"GET",url:b.api.reportCustomFieldSummary,key:"report"});r.summaryReport.lodgings=e({method:"GET",url:b.api.reportLodgingsSummary,key:"report"});r.summaryReport.pickups=e({method:"GET",url:b.api.reportPickupsSummary,key:"report"});r.summaryReport.crew=e({method:"GET",url:b.api.reportCrewSummary,key:"report"});r.summaryReport.agents=e({method:"GET",url:b.api.reportAgentsSummary,key:"report"});r.summaryReport.desks=
e({method:"GET",url:b.api.reportDesksSummary,key:"report"});r.summaryReport.campaigns=e({method:"GET",url:b.api.reportCampaignsSummary,key:"report"});r.summaryReport.revenue=e({method:"GET",url:b.api.reportRevenueSummary,key:"report"});r.advancedReport=e({method:"POST",url:b.api.reportAdvanced,key:"report"});var K=A("group"),w=v("group");w.duplicate=e({method:"POST",url:b.api.duplicateGroup,key:"group",formName:"duplicateGroupForm"});w.remove=e({method:"DELETE",url:b.api.group,formName:"disableForm"});
var O=A("groupOverride");O.related=e({method:"GET",url:b.api.relatedGroupOverrides,isArray:!0,key:"groupOverrides"});var I=v("groupOverride");I.activities=e({method:"GET",url:b.api.groupOverrideActivities,isArray:!0,key:"activities"});var R=A("bankAccount"),H=v("bankAccount");H.remove=e({method:"DELETE",url:b.api.bankAccount,key:"bankAccount"});H.verify=e({method:"PUT",url:b.api.verifyBankAccount,key:"verifiedBankAccount",formName:"verifyBankAccountForm"});var ca=A("card"),Z=v("card");Z.remove=e({method:"DELETE",
url:b.api.card,key:"disableForm"});var aa=e({method:"GET",url:b.api.cardAffiliations,isArray:!0,key:"cardAffiliations"});aa.create=e({method:"POST",url:b.api.cardAffiliations,isArray:!0,key:"cardAffiliations",form:"cardAffiliationsForm"});var ea=A("customManifest"),fa=v("customManifest"),J=A("customCalendar"),ya=v("customCalendar"),za=A("customReport"),ja=v("customReport"),W=e({method:"GET",url:b.api.users,isArray:!0,key:"users"});W.pickable=z(W);W.all=e({method:"GET",url:b.api.allUsers,isArray:!0,
key:"users"});W.related=e({method:"GET",url:b.api.relatedUsers,isArray:!0,key:"users"});W.create=e({method:"POST",url:b.api.users,key:"user",formName:"createUserForm"});var U=e({method:"GET",url:b.api.user,key:"user"});U.update=e({method:"PUT",url:b.api.user,key:"user",formName:"updateUserForm"});U.remove=e({method:"DELETE",url:b.api.user});U.activities=e({method:"GET",url:b.api.userActivities,isArray:!0,key:"activities"});U.subscriptions=e({method:"GET",url:b.api.userSubscriptions,isArray:!0,key:"subscriptions"});
U.itemSubscriptions=e({method:"GET",url:b.api.userItemSubscriptions,isArray:!0,key:"subscriptions"});U.itemSubscriptions.update=e({method:"POST",url:b.api.userItemSubscriptions,isArray:!0,key:"subscriptions"});U.overview=e({method:"GET",url:b.api.userOverview,key:"overview"});U.nags={};U.nags.update=e({method:"PUT",url:b.api.userNags,key:"userNags",formName:"userNagsForm"});var Q=A("item");Q.pickable=z(Q);Q.all=e({method:"GET",url:b.api.allItems,isArray:!0,key:"items"});Q.calendar=e({method:"GET",
url:b.api.itemsCalendar,key:"calendar"});var M=v("item");M.color=e({method:"PUT",url:b.api.itemColor,key:"color",formName:"updateItemColorForm"});M.calendar=e({method:"GET",url:b.api.itemCalendar,key:"calendar"});M.duplicate=e({method:"POST",url:b.api.duplicateItem,key:"item"});M.subscriptions=e({method:"GET",url:b.api.itemSubscriptions,isArray:!0,key:"subscriptions"});M.images=e({method:"GET",url:b.api.itemImages,key:"images",isArray:!0});M.images.create=e({method:"POST",url:b.api.itemImages,key:"image"});
M.image={};M.image.update=e({method:"PUT",url:b.api.itemImage,key:"image"});M.image.remove=e({method:"DELETE",url:b.api.itemImage});M.viatorSettings={};M.viatorSettings.update=e({method:"PUT",url:b.api.viatorSettings,key:"viatorSettings",formName:"viatorSettingsForm"});M.viatorMappings=A("viatorMapping");M.viatorMapping=v("viatorMapping");M.reviewExpressSettings={};M.reviewExpressSettings.update=e({method:"PUT",url:b.api.reviewExpressSettings,key:"reviewExpressSettings",form:"reviewExpressSettingsForm"});
M.picthriveSettings={};M.picthriveSettings.update=e({method:"PUT",url:b.api.picthriveSettings,key:"picthriveSettings",formName:"picthriveSettingsForm"});M.ratings=e({method:"GET",url:b.api.itemRatings,key:"ratings"});M.flowPages=e({method:"GET",isArray:!0,url:b.api.itemFlowPages,key:"flowNodes"});M.flowPages.full=s(M.flowPages,"full");var oa=v("flowNode"),V=function(){return k.get("flows").wrapEndpoint(oa).apply(null,arguments)};V.update=oa.update;V.remove=oa.remove;var Aa=e({method:"GET",url:b.api.defaultFlowPage,
key:"defaultFlowPage"});V.withDescendants=s(e({method:"GET",url:b.api.flowNode,key:"flowNode",ignoreQueryParamsInCacheUri:!0}),"descendants");V.duplicate=e({method:"POST",url:b.api.duplicateFlowNode,key:"flowNode"});var X=A("flowNode");X.multi=e({method:"POST",url:b.api.flowNodes,isArray:!0,key:"flowNodes",formName:"flowNodeForm"});X.root=s(X,"root");X.root.create=s(X.create,"root");X.pages=s(X,"pages");var ha=e({method:"GET",url:b.api.affiliates,isArray:!0,key:"affiliations"});ha.all=e({method:"GET",
url:b.api.allAffiliates,isArray:!0,key:"affiliations"});ha.pickable=z(ha);ha.create=e({method:"POST",url:b.api.affiliates,key:"affiliation",formName:"createAffiliationForm"});var ka=e({method:"GET",url:b.api.affiliate,key:"affiliation"});ka.update=e({method:"PUT",url:b.api.affiliate,key:"affiliation",formName:"updateAffiliationForm"});ka.remove=e({method:"DELETE",url:b.api.affiliate,formName:"disableForm"});var pa=e({method:"GET",url:b.api.affiliateCards,key:"cards",isArray:!0,flashError:!1}),ga=
e({method:"GET",url:b.api.affiliateCardAffiliations,key:"cardAffiliations",isArray:!0,flashError:!1}),N=e({method:"GET",url:b.api.partners,isArray:!0,key:"affiliations"});N.all=s(N,"all");N.pickable=z(N);var qa=e({method:"GET",url:b.api.partner,key:"partner"});qa.remove=e({method:"DELETE",url:b.api.partner,formName:"disableForm"});var jc=e({method:"GET",url:b.api.partnerCards,key:"cards",isArray:!0,flashError:!1}),kc=e({method:"GET",url:b.api.partnerCardAffiliations,key:"cardAffiliations",isArray:!0,
flashError:!1}),db=A("agent");db.all=e({method:"GET",url:b.api.allAgents,isArray:!0,key:"agents"});var lc=v("agent"),eb=A("desk");eb.all=e({method:"GET",url:b.api.allDesks,isArray:!0,key:"desks"});var nc=v("desk"),mc=A("hotel"),oc=v("hotel"),gb=A("lodging");gb.duplicate=e({method:"POST",url:b.api.duplicateLodgingsAcrossCompanies,formName:"duplicateLodgingsAcrossCompaniesForm",key:"lodgings",isArray:!0});var pc=v("lodging"),qc=A("preferredPickup"),rc=v("preferredPickup"),hb=A("pickup");hb.duplicate=
e({method:"POST",url:b.api.duplicatePickupsAcrossCompanies,formName:"duplicatePickupsAcrossCompaniesForm",key:"pickups",isArray:!0});var sc=v("pickup"),ta=A("route");ta.pickable=z(ta);ta.duplicate=e({method:"POST",url:b.api.duplicateRoutesAcrossCompanies,formName:"duplicateRoutesAcrossCompaniesForm",key:"routes",isArray:!0});var ib=v("route");ib.duplicate=e({method:"POST",url:b.api.duplicateRoute,key:"route",formName:"duplicateRouteForm"});var tc=A("stop"),uc=v("stop"),Ba={};Ba.searchByDate=e({method:"GET",
url:b.api.searchRunsByDate,isArray:!0,key:"runs"});Ba.manifest=e({method:"GET",url:b.api.runsManifest,isArray:!0,key:"runs"});var jb=e({method:"GET",url:b.api.campaigns,isArray:!0,key:"campaigns"});jb.create=e({method:"POST",url:b.api.campaigns,key:"campaign"});var ua=e({method:"GET",url:b.api.campaign,key:"campaign"});ua.update=e({method:"PUT",url:b.api.campaign,key:"campaign"});ua.remove=e({method:"DELETE",url:b.api.campaign,formName:"disableForm"});ua.customFields=e({method:"GET",url:b.api.campaignCustomFields,
isArray:!0,key:"customFields"});var kb=e({method:"GET",url:b.api.campaignValidityRules,isArray:!0,key:"campaignValidityRules"});kb.create=e({method:"POST",url:b.api.campaignValidityRules,key:"campaignValidityRule",formName:"createCampaignValidityRuleForm"});var lb=e({method:"GET",url:b.api.campaignValidityRule,key:"campaignValidityRule"});lb.remove=e({method:"DELETE",url:b.api.campaignValidityRule,formName:"disableForm"});var mb=e({method:"GET",url:b.api.codes,isArray:!0,key:"codes"});mb.create=e({method:"POST",
url:b.api.codes,key:"codes",isArray:!0,formName:"createCodesForm"});var Ca=e({method:"GET",url:b.api.code,key:"code"});Ca.update=e({method:"PUT",url:b.api.code,key:"code",formName:"updateCodeForm"});Ca.remove=e({method:"DELETE",url:b.api.code});var vc=A("storedValueType"),wc=v("storedValueType"),Da=e({method:"GET",url:b.api.storedValueCards,isArray:!0,key:"storedValueCards"});Da.create=e({method:"POST",url:b.api.storedValueCards,key:"storedValueCards",isArray:!0,formName:"createStoredValueCardsForm"});
Da.search=e({method:"GET",url:b.api.searchStoredValueCardsByNumber,key:"searchResult"});var va=v("storedValueCard");va.payments=e({method:"GET",url:b.api.storedValueCardPayments,isArray:!0,key:"payments"});va.notifications={};va.notifications.create=e({method:"POST",url:b.api.storedValueCardNotifications,isArray:!0,key:"notifications",formName:"storedValueCardNotificationForm"});var xc=A("storedValueAdjustment"),Ea=v("storedValueAdjustment");delete Ea.update;delete Ea.remove;var yc=A("resellerCompany",
"resellerCompanies"),zc=v("resellerCompany"),Ac=A("resellerCompanyMapping"),Bc=v("resellerCompanyMapping"),Cc=A("resellerItem"),Dc=v("resellerItem"),Ec=A("resellerItemMapping"),Fc=v("resellerItemMapping"),Gc=A("resellerCustomerType"),Hc=v("resellerCustomerType"),Ic=A("resellerCustomerTypeMapping"),Jc=v("resellerCustomerTypeMapping"),Kc=A("resellerOption"),Lc=v("resellerOption"),Mc=A("resellerOptionMapping"),Nc=v("resellerOptionMapping"),Oc=e({method:"GET",url:b.api.resellerUnmappedItems,isArray:!0,
key:"items"}),Pc=e({method:"GET",url:b.api.resellerUnmappedCustomerPrototypes,isArray:!0,key:"customerPrototypes"}),Qc=A("resellerKey"),Rc=v("resellerKey"),Sc=A("resellerApp"),Tc=v("resellerApp"),Uc=A("resellerAppCompany","resellerAppCompanies"),Vc=v("resellerAppCompany"),Fa=e({method:"GET",url:b.api.customFields,isArray:!0,key:"customFields"});Fa.all=e({method:"GET",url:b.api.allCustomFields,isArray:!0,key:"customFields"});Fa.create=e({method:"POST",url:b.api.customFields,key:"customField",formName:"createCustomFieldForm"});
var la=e({method:"GET",url:b.api.customField,key:"customField"});la.items=e({method:"GET",url:b.api.customFieldItems,key:"items",isArray:!0});la.duplicate=e({method:"POST",url:b.api.duplicateCustomField,key:"customField",formName:"duplicateCustomFieldForm"});la.prevalidate=e({method:"POST",url:b.api.prevalidateCustomField,key:"prevalidity",formName:"prevalidateCustomFieldForm",flashError:!1});la.update=e({method:"PUT",url:b.api.customField,key:"customField",formName:"updateCustomFieldForm"});la.remove=
e({method:"DELETE",url:b.api.customField,formName:"disableForm"});var nb={};nb.create=e({method:"POST",url:b.api.transportationOptions,key:"transportationOption"});var Ga={};Ga.update=e({method:"PUT",url:b.api.transportationOption,key:"transportationOption"});Ga.remove=e({method:"DELETE",url:b.api.transportationOption});var ob={};ob.create=e({method:"POST",url:b.api.extendedOptions,key:"extendedOption",formName:"createExtendedOptionForm"});var Ha={};Ha.update=e({method:"PUT",url:b.api.extendedOption,
key:"extendedOption",formName:"updateExtendedOptionForm"});Ha.remove=e({method:"DELETE",url:b.api.extendedOption,key:"extendedOption"});var pb={};pb.create=e({method:"POST",url:b.api.connectedCampaigns,key:"connectedCampaign",formName:"createConnectedCampaignForm"});var qb={};qb.remove=e({method:"DELETE",url:b.api.connectedCampaign});var rb={};rb.create=e({method:"POST",url:b.api.generatingCampaigns,key:"generatingCampaign",formName:"generatingCampaignForm"});var Ia={};Ia.update=e({method:"PUT",url:b.api.generatingCampaign,
key:"generatingCampaign",formName:"generatingCampaignForm"});Ia.remove=e({method:"DELETE",url:b.api.generatingCampaign});var Ja=v("customFieldInstanceGroup"),sb=A("customFieldInstanceGroup");sb.multi=e({method:"POST",url:b.api.customFieldInstanceGroupsMulti,isArray:!0,key:"customFieldInstanceGroups",formName:"customFieldInstanceGroupsForm"});Ja.remove=e({method:"DELETE",url:b.api.customFieldInstanceGroup,key:"customFieldInstanceGroup",formName:"disableForm"});Ja.duplicate=e({method:"POST",url:b.api.duplicateCustomFieldInstanceGroup,
key:"customFieldInstanceGroup",formName:"duplicateForm"});var Wc=v("customFieldInstance"),tb=A("customFieldInstance");tb.multi=e({method:"POST",url:b.api.customFieldInstancesMulti,isArray:!0,key:"customFieldInstances",formName:"customFieldInstancesForm"});var Xc=v("customFieldInstanceCondition"),Yc=A("customFieldInstanceCondition"),Zc=v("supportedLanguage"),$c=A("supportedLanguage"),ad=e({method:"GET",url:b.api.translations,key:"translations"}),bd=e({method:"GET",url:b.api.translationsForModel,key:"translationsForModel",
isArray:!0}),ub=e({method:"GET",url:b.api.translationsForField,key:"translationsAndSourceField"});ub.update=e({method:"POST",url:b.api.translationsForField,key:"updatedTranslations",formName:"translationsForFieldForm",isArray:!0});var cd=e({method:"GET",url:b.api.understoodLanguages,key:"understoodLanguages"}),vb=e({method:"GET",url:b.api.roles,isArray:!0,key:"roles"});vb.create=e({method:"POST",url:b.api.roles,key:"role"});var Ka=e({method:"GET",url:b.api.role,key:"role"});Ka.update=e({method:"PUT",
url:b.api.role,key:"role"});Ka.remove=e({method:"DELETE",url:b.api.role});var wb=e({method:"GET",url:b.api.crewMembers,isArray:!0,key:"crewMembers"});wb.create=e({method:"POST",url:b.api.crewMembers,key:"crewMember"});var La=e({method:"GET",url:b.api.crewMember,key:"crewMember"});La.update=e({method:"PUT",url:b.api.crewMember,key:"crewMember"});La.remove=e({method:"DELETE",url:b.api.crewMember,key:"crewMember"});var xb=v("customerType");xb.items=e({method:"GET",url:b.api.customerTypeItems,key:"items",
isArray:!0});var yb=A("customerType");yb.all=e({method:"GET",url:b.api.allCustomerTypes,isArray:!0,key:"customerTypes"});var zb=v("customerPrototype");zb.duplicate=e({method:"POST",url:b.api.duplicateCustomerPrototype,key:"customerPrototype",formName:"duplicateForm"});var Ma=A("customerPrototype");Ma.all=e({method:"GET",url:b.api.allCustomerPrototypes,isArray:!0,key:"customerPrototypes"});Ma.multi=e({method:"POST",url:b.api.customerPrototypesMulti,isArray:!0,key:"customerPrototypes",formName:"customerPrototypesForm"});
var Ab=v("checkinStatus","checkinStatuses"),dd=A("checkinStatus","checkinStatuses");Ab.updateBookings=e({method:"PUT",url:b.api.checkinStatusForBookings,key:"bookings",isArray:!0,formName:"updateCheckinStatusForBookingsForm"});var ed=A("cannedMessage"),Bb=v("cannedMessage");Bb.items=e({method:"GET",url:b.api.cannedMessageItems,key:"items",isArray:!0});var S={};S.next=e({method:"GET",url:b.api.nextAvailability,key:"availability"});S.update=e({method:"POST",url:b.api.updateAvailabilities,formName:"updateAvailabilitiesForm",
key:"updateAvailabilities"});S.updateByItem=e({method:"POST",url:b.api.updateItemAvailabilities,formName:"updateAvailabilitiesForm",key:"updateAvailabilities"});S.byDate=e({method:"GET",url:b.api.availabilitiesByDate,isArray:!0,key:"availabilities"});S.byTag={};S.byTag.clear=e({method:"DELETE",url:b.api.availabilitiesByTag,formName:"disableForm"});S.searchByDate=e({method:"GET",url:b.api.searchAvailabilitiesByDate,isArray:!0,key:"availabilities"});S.searchByPk=e({method:"GET",url:b.api.searchAvailabilitiesByPk,
isArray:!0,key:"availabilities"});S.manifest=e({method:"GET",url:b.api.availabilitiesManifest,isArray:!0,key:"availabilities"});S.manifestPickable=z(S.manifest);S.searchByUpcoming=e({method:"GET",url:b.api.searchAvailabilitiesByUpcoming,isArray:!0,key:"availabilities"});S.rule=e({method:"POST",url:b.api.rule,key:"createdAvailabilities",formName:"ruleForm"});var Y=e({method:"GET",url:b.api.availability,key:"availability"});Y.update=e({method:"PUT",url:b.api.availability,key:"availability",formName:"updateAvailabilityForm"});
Y.status={};Y.status.update=e({method:"PUT",url:b.api.availabilityStatus,key:"availabilityStatus",formName:"updateAvailabilityStatusForm"});Y.book=e({method:"POST",url:b.api.book,key:"booking",formName:"bookForm"});Y.liveCapacity=e({method:"GET",url:b.api.availabilityLiveCapacity,key:"liveCapacity",formName:"liveCapacityForm"});Y.resourceUses=e({method:"GET",url:b.api.availabilityResourceUses,key:"resourceUses",isArray:!0});Y.remove=e({method:"DELETE",url:b.api.availability,formName:"disableForm"});
Y.notifications=e({method:"POST",url:b.api.notifications,formName:"notificationsForm"});Y.note={};Y.note=e({method:"PUT",url:b.api.availabilityNote,key:"note",formName:"updateAvailabilityNoteForm"});var Cb={};Cb.create=e({method:"POST",url:b.api.customerTypeRates,key:"customerTypeRate"});var Na={};Na.remove=e({method:"DELETE",url:b.api.customerTypeRate,formName:"disableForm"});Na.update=e({method:"PUT",url:b.api.customerTypeRate,key:"customerTypeRate"});var fd=A("block"),gd=v("block"),Oa=v("contact");
Oa.bookings={};Oa.bookings.update=e({method:"PUT",url:b.api.contactBookings,key:"modified"});var Db={};Db.report=e({method:"GET",url:b.api.reportContacts,key:"report"});var hd=e({method:"GET",url:b.api.contactPayments,isArray:!0,key:"payments"}),Pa=e({method:"GET",url:b.api.order,key:"order"});Pa.notification=e({method:"POST",url:b.api.orderNotification,formName:"orderNotificationForm"});Pa.cancel=e({method:"POST",url:b.api.orderCancellation,key:"order",formName:"cancelOrderBookingsForm"});var Eb=
{};Eb.create=e({method:"POST",url:b.api.orders,key:"order",formName:"orderForm"});var Qa=e({method:"GET",url:b.api.orderPayments,isArray:!0,key:"payments"});Qa.create=e({method:"POST",url:b.api.orderPayments,key:"payments"});Qa.refund=e({method:"POST",url:b.api.orderRefunds,isArray:!0,key:"payments"});var da=e({method:"GET",url:b.api.bookings,isArray:!0,key:"bookings"});da.byContact=e({method:"GET",url:b.api.bookingsByContact,isArray:!0,key:"bookings"});da.searchByQuery=e({method:"GET",url:b.api.searchBookingsByQuery,
isArray:!0,key:"bookings"});da.searchByNew=e({method:"GET",url:b.api.searchBookingsByNew,isArray:!0,key:"bookings"});da.report=e({method:"GET",url:b.api.reportBookings,key:"report"});da.invoiceableReport=e({method:"GET",url:b.api.reportInvoiceableBookings,key:"report"});da.manifest=e({method:"GET",url:b.api.bookingsManifest,isArray:!0,key:"bookings"});da.searchByUuid=e({method:"GET",url:b.api.searchBookingsByUuid,isArray:!0,key:"bookings"});var P=e({method:"GET",url:b.api.booking,key:"booking"});
P.byPk=e({method:"GET",url:b.api.bookingByPk,key:"booking",ignoreCache:!0});P.reprice=e({method:"PUT",url:b.api.repriceBooking,key:"repricing",formName:"repriceBookingForm"});P.notification=e({method:"POST",url:b.api.notification,formName:"notificationForm"});P.smsNotification=e({method:"POST",url:b.api.smsNotification,formName:"smsNotificationForm"});P.cancel=e({method:"DELETE",url:b.api.booking,key:"booking",formName:"cancelBookingForm"});P.note={};P.note.update=e({method:"PUT",url:b.api.bookingNote,
key:"note",formName:"updateBookingNoteForm"});P.explicitGross={};P.explicitGross.update=e({method:"PUT",url:b.api.bookingExplicitGross,key:"explicitGross",formName:"updateBookingExplicitGrossForm"});P.explicitInvoicePrice={};P.explicitInvoicePrice.update=e({method:"PUT",url:b.api.bookingExplicitInvoicePrice,key:"explicitInvoicePrice",formName:"updateBookingExplicitInvoicePriceForm"});P.notificationOptions={};P.notificationOptions.update=e({method:"PUT",url:b.api.bookingNotificationOptions,key:"notificationOptions",
formName:"updateBookingNotificationOptionsForm"});P.affiliation={};P.affiliation.update=e({method:"PUT",url:b.api.affiliation,key:"affiliation"});P.checkinStatus={};P.checkinStatus.update=e({method:"PUT",url:b.api.bookingCheckinStatus,key:"bookingCheckinStatus",formName:"updateBookingCheckinStatusForm"});P.effectiveCancellationRule=e({method:"GET",url:b.api.bookingEffectiveCancellationRule,key:"cancellationRule"});var Fb={checkinStatus:{}};Fb.checkinStatus.update=e({method:"PUT",url:b.api.customerCheckinStatus,
key:"customerCheckinStatus",formName:"updateCustomerCheckinStatusForm"});var Gb={};Gb.find=e({method:"GET",url:b.api.searchCustomersByEncodedPk,key:"booking"});var Hb={};Hb.update=e({method:"PUT",url:b.api.bookingCustomFieldValue,key:"customFieldValue"});var Ib={};Ib.update=e({method:"PUT",url:b.api.customerCustomFieldValue,key:"customFieldValue"});var ba=A("report");ba.recent=e({method:"GET",url:b.api.recentReports,key:"reports",isArray:!0});ba.inProgress=e({method:"GET",url:b.api.inProgressReports,
key:"reports",isArray:!0});ba.volumeOverview=e({method:"GET",url:b.api.volumeOverviewReport,key:"volume"});ba.dailyVolumeOverview=e({method:"GET",url:b.api.dailyVolumeOverviewReport,key:"dailyVolume"});ba.paymentOverview=e({method:"GET",url:b.api.paymentOverviewReport,key:"paymentOverview"});ba.itemsSummaryOverview=e({method:"GET",url:b.api.itemsSummaryOverviewReport,key:"itemsSummary"});ba.nextPayoutOverview=e({method:"GET",url:b.api.nextPayoutOverviewReport,key:"nextPayout"});ba.report=e({method:"GET",
url:b.api.reportReports,key:"report"});var ia=v("report");ia.rerun=ia.update;delete ia.update;ia.cancel=e({method:"DELETE",url:b.api.report,formName:"disableForm",key:"report"});delete ia.remove;ia.objects=e({method:"POST",url:b.api.reportObjects,key:"objects",isArray:!1});var Ra=A("invoice");Ra.report=e({method:"GET",url:b.api.reportInvoices,key:"report"});Ra.partnerInvoice=e({method:"GET",url:b.api.partnerInvoice,key:"invoice"});var ma=v("invoice");ma.uploads=e({method:"GET",url:b.api.invoiceUploads,
isArray:!0,key:"uploads"});ma.uploads.create=e({method:"POST",url:b.api.invoiceUploads,key:"upload"});ma.notifications={};ma.notifications.create=e({method:"POST",url:b.api.invoiceNotifications,isArray:!0,key:"notifications",formName:"invoiceNotificationForm"});ma.uuid=e({method:"GET",url:b.api.uuidInvoice,key:"invoice"});var Sa={};Sa.create=e({method:"POST",url:b.api.lineItems,key:"lineItem"});Sa.report=e({method:"GET",url:b.api.reportLineItems,key:"report"});var Ta=e({method:"GET",url:b.api.lineItem,
key:"lineItem"});Ta.remove=e({method:"DELETE",url:b.api.lineItem});Ta.update=e({method:"PUT",url:b.api.lineItem,key:"lineItem"});var id=A("tagGroup"),jd=v("tagGroup"),Jb={};Jb.create=e({method:"POST",url:b.api.tags,key:"tag"});var Ua={};Ua.update=e({method:"PUT",url:b.api.tag,key:"tag"});Ua.remove=e({method:"DELETE",url:b.api.tag,formName:"disableForm"});var Kb=e({method:"GET",url:b.api.objectTags,key:"objectTags",isArray:!0});Kb.update=e({method:"PUT",url:b.api.objectTags,key:"objectTags",isArray:!0});
var na=e({method:"GET",url:b.api.payments,isArray:!0,key:"payments"});na.related=e({method:"GET",url:b.api.relatedPayments,isArray:!0,key:"payments"});na.create=e({method:"POST",url:b.api.payments,key:"payment"});na.refund=e({method:"POST",url:b.api.refunds,isArray:!0,key:"payments"});na.report=e({method:"GET",url:b.api.reportPayments,key:"report"});na.volumeReport=e({method:"GET",url:b.api.reportVolume,key:"report"});var Lb=e({method:"GET",url:b.api.paymentFees,isArray:!0,key:"payments"});Lb.update=
e({method:"POST",url:b.api.paymentFees,key:"payments"});var kd=A("inStorePaymentType"),ld=v("inStorePaymentType"),md=A("emvDevice"),Mb=v("emvDevice");Mb.activate=e({method:"POST",url:b.api.emvDeviceActivate,key:"activation",formName:"emv_device_activation_form",flashError:!1});var Nb={custom:{}};Nb.custom.create=e({method:"POST",url:b.api.customRefunds,key:"refund",formName:"customRefundForm"});var Ob={};Ob.report=e({method:"GET",url:b.api.reportDisputes,key:"report"});var Pb=e({method:"GET",url:b.api.payouts,
isArray:!0,key:"payouts"});Pb.report=e({method:"GET",url:b.api.reportPayouts,key:"report"});var Qb=e({method:"GET",url:b.api.payout,key:"payout"});Qb.retry=e({method:"PUT",url:b.api.payoutRetry,key:"payoutRetry"});var Rb=e({method:"GET",url:b.api.transfers,isArray:!0,key:"transfers"});Rb.create=e({method:"POST",url:b.api.transfers,key:"transfer"});var nd=e({method:"GET",url:b.api.transfer,key:"transfer"}),Sb=e({method:"GET",url:b.api.uploads,isArray:!0,key:"uploads"});Sb.create=e({method:"POST",url:b.api.uploads,
key:"upload"});var od=e({method:"GET",url:b.api.upload,key:"upload"}),Tb=e({method:"GET",url:b.api.funds,isArray:!0,key:"funds"});Tb.report=e({method:"GET",url:b.api.reportFunds,key:"report"});var pd=e({method:"GET",url:b.api.fund,key:"fund"}),Ub=e({method:"GET",url:b.api.adjustments,isArray:!0,key:"adjustments"});Ub.create=e({method:"POST",url:b.api.adjustments,key:"adjustment"});var qd=e({method:"GET",url:b.api.adjustment,key:"adjustment"}),Vb={};Vb.report=e({method:"GET",url:b.api.reportTransactions,
key:"report"});var Va=e({method:"GET",url:b.api.activities,isArray:!0,key:"activities"});Va.notes={};Va.notes.create=e({method:"POST",url:b.api.notes,key:"activity",formName:"noteForm"});var Wb=e({method:"GET",url:b.api.activity,key:"activity"});Wb.update=e({method:"PUT",url:b.api.activity,key:"activity"});var rd=e({method:"PUT",url:b.api.reorder,key:"reorder"}),Xb=e({method:"GET",url:b.api.waivers,isArray:!0,key:"waivers"});Xb.create=e({method:"POST",url:b.api.waivers,key:"waiver"});var Wa=e({method:"GET",
url:b.api.waiver,key:"waiver"});Wa.update=e({method:"PUT",url:b.api.waiver,key:"waiver"});Wa.remove=e({method:"DELETE",url:b.api.waiver,formName:"disableForm"});var Yb={};Yb.create=e({method:"POST",url:b.api.connectedWaivers,key:"connectedWaiver",formName:"createConnectedWaiverForm"});var Zb={};Zb.remove=e({method:"DELETE",url:b.api.connectedWaiver});var $b={};$b.remove=e({method:"DELETE",url:b.api.waiverInstance,key:"waiverInstance"});var Xa=A("totalSheet");Xa.all=s(Xa,"all");var ra=v("totalSheet");
ra.duplicate=e({method:"POST",url:b.api.duplicateTotalSheet,key:"totalSheet",formName:"duplicateSheetForm"});ra.pricing=e({method:"GET",url:b.api.totalPricing,key:"effectivePricings",isArray:!0});ra.pricing.update=e({method:"PUT",url:b.api.totalPricing,key:"effectivePricings",isArray:!0,formName:"priceLineForm"});ra.pricing.stack=e({method:"GET",url:b.api.totalStack,key:"lines",isArray:!0});var Ya=A("invoiceSheet");Ya.all=s(Ya,"all");var sa=v("invoiceSheet");sa.duplicate=e({method:"POST",url:b.api.duplicateInvoiceSheet,
key:"invoiceSheet",formName:"duplicateSheetForm"});sa.pricing=e({method:"GET",url:b.api.invoicePricing,key:"effectivePricings",isArray:!0});sa.pricing.update=e({method:"PUT",url:b.api.invoicePricing,key:"effectivePricings",isArray:!0,formName:"priceLineForm"});sa.pricing.stack=e({method:"GET",url:b.api.invoiceStack,key:"lines",isArray:!0});var Za={};Za.channels=e({method:"GET",url:b.pusher.channels,key:"channels",isArray:!0});Za.members=e({method:"POST",url:b.pusher.members,key:"channels",isArray:!0});
var ac=v("location");ac.items=e({method:"GET",url:b.api.locationItems,key:"items",isArray:!0});var sd=A("location"),bc=A("resource");bc.manifest=e({method:"GET",url:b.api.resourcesManifest,key:"resources",isArray:!0});var $a=v("resource");$a.items=e({method:"GET",url:b.api.resourceItems,key:"items",isArray:!0});$a.availabilities=e({method:"GET",url:b.api.resourceAvailabilities,key:"availabilities",isArray:!0});var wa={};wa.byDate=e({method:"GET",url:b.api.resourceUsesByDate,key:"resourceUses",isArray:!0});
wa.calendar=e({method:"GET",url:b.api.resourceUsesCalendar,key:"calendar"});wa.reapplyBookingResourceUses=e({method:"POST",url:b.api.reapplyBookingResourceUses,key:"reappliedBookingResourceUses",formName:"reapplyBookingResourceUsesForm"});var td=A("requirementGroup"),cc=v("requirementGroup");cc.duplicate=e({method:"POST",url:b.api.duplicateRequirementGroup,key:"requirementGroup",formName:"duplicateRequirementGroupForm"});var ud=A("requirement"),vd=v("requirement"),wd=A("resourceRequirement"),dc=v("resourceRequirement");
dc.update=e({method:"PUT",url:b.api.resourceRequirement,key:"resourceRequirement",sideKeys:["newResourceRequirement"]});var xd=v("resourceUse"),xa=e({method:"GET",url:b.api.resourceOverride,key:"resourceOverride"});xa.update=e({method:"PUT",url:b.api.resourceOverride,key:"resourceOverride",formName:"resourceOverrideForm"});xa.remove=e({method:"DELETE",url:b.api.resourceOverride,formName:"disableForm"});xa.rule=e({method:"POST",url:b.api.resourceOverrideRule,isArray:!0,key:"resourceOverrides",formName:"resourceOverrideRuleForm"});
var ab={byTag:{}};ab.byTag.clear=e({method:"DELETE",url:b.api.resourceOverridesByTag,formName:"disableForm"});ab.byDate=e({method:"GET",url:b.api.resourceOverridesByDate,key:"resourceOverrides",isArray:!0});var yd=A("ticketLayout"),zd=v("ticketLayout"),Ad=A("analyticsService"),Bd=v("analyticsService"),Cd=A("cancellationPolicy","cancellationPolicies"),bb=v("cancellationPolicy"),Dd=A("cancellationRule"),Ed=v("cancellationRule");bb.affiliations=e({method:"GET",isArray:!0,url:b.api.cancellationPolicyAffiliations,
key:"affiliations"});bb.items=e({method:"GET",isArray:!0,url:b.api.cancellationPolicyItems,key:"items"});var Fd=A("bookingRestriction"),ec=v("bookingRestriction");ec.items=e({method:"GET",isArray:!0,url:b.api.bookingRestrictionItems,key:"items"});var fc=e({method:"GET",isArray:!0,url:b.api.persistentStore,key:"persistentStores"});fc.remove=e({method:"DELETE",url:b.api.persistentStore});var gc=e({method:"GET",url:b.api.persistentStoreForCompany,key:"persistentStore"});gc.remove=e({method:"DELETE",
url:b.api.persistentStoreForCompany});var cb=e({method:"GET",url:b.api.persistentStoreItem,key:"value"});cb.update=e({method:"PUT",url:b.api.persistentStoreItem,key:"value",formName:"persistentStoreForm"});cb.remove=e({method:"DELETE",url:b.api.persistentStoreItem});var Gd=e({method:"GET",formName:"noForm",key:function(a){return _.keys(a.data)[0]}}),Hd=e({method:"GET",url:b.api.version,key:"version"}),hc=function(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,
"$").replace(/%2C/gi,",").replace(/%2F/gi,"/").replace(/%20/g,b?"%20":"+")},ic=function(a,b){b=_.isBoolean(b)?b?"yes":"no":b;return hc(a,!0)+"="+hc(b,!0)},fb=function(a){var b=[];_.forEach(a,function(a,c){_.isArray(a)?_.forEach(a,function(a){b.push(ic(c,a))}):b.push(ic(c,a))});return b.join("&")};return{CANCELLED:C,toKeyValue:fb,login:u,forgot:t,companies:L,company:r,users:W,user:U,groups:K,group:w,groupOverrides:O,groupOverride:I,contacts:Db,contact:Oa,contactPayments:hd,customManifests:ea,customManifest:fa,
customCalendars:J,customCalendar:ya,customReports:za,customReport:ja,items:Q,item:M,flowNodes:X,flowNode:V,defaultFlowPage:function(){return k.get("flows").wrapEndpoint(Aa,!0).apply(null,arguments)},activities:Va,activity:Wb,affiliates:ha,affiliate:ka,affiliateCards:pa,affiliateCardAffiliations:ga,partners:N,partner:qa,partnerCards:jc,partnerCardAffiliations:kc,agents:db,agent:lc,desks:eb,desk:nc,cannedMessages:ed,cannedMessage:Bb,customerPrototypes:Ma,customerPrototype:zb,customerTypes:yb,customerType:xb,
checkinStatuses:dd,checkinStatus:Ab,customFields:Fa,customField:la,transportationOptions:nb,transportationOption:Ga,extendedOptions:ob,extendedOption:Ha,connectedCampaigns:pb,connectedCampaign:qb,generatingCampaigns:rb,generatingCampaign:Ia,customFieldInstances:tb,customFieldInstance:Wc,customFieldInstanceConditions:Yc,customFieldInstanceCondition:Xc,customFieldInstanceGroups:sb,customFieldInstanceGroup:Ja,customerCustomFieldValue:Ib,bookingCustomFieldValue:Hb,availabilities:S,availability:Y,customerTypeRates:Cb,
customerTypeRate:Na,blocks:fd,block:gd,orders:Eb,order:Pa,orderPayments:Qa,bookings:da,booking:P,customer:Fb,customers:Gb,lineItems:Sa,lineItem:Ta,payments:na,disputes:Ob,refunds:Nb,paymentFees:Lb,inStorePaymentTypes:kd,inStorePaymentType:ld,emvDevices:md,emvDevice:Mb,bankAccounts:R,bankAccount:H,cards:ca,card:Z,cardAffiliations:aa,supportedLanguages:$c,supportedLanguage:Zc,translations:ad,translationsForModel:bd,translationsForField:ub,understoodLanguages:cd,reports:ba,report:ia,campaigns:jb,campaign:ua,
campaignValidityRules:kb,campaignValidityRule:lb,codes:mb,code:Ca,storedValueTypes:vc,storedValueType:wc,storedValueCards:Da,storedValueCard:va,storedValueAdjustments:xc,storedValueAdjustment:Ea,resellerCompanies:yc,resellerCompany:zc,resellerCompanyMappings:Ac,resellerCompanyMapping:Bc,resellerItems:Cc,resellerItem:Dc,resellerItemMappings:Ec,resellerItemMapping:Fc,resellerCustomerTypes:Gc,resellerCustomerType:Hc,resellerCustomerTypeMappings:Ic,resellerCustomerTypeMapping:Jc,resellerOptions:Kc,resellerOption:Lc,
resellerOptionMappings:Mc,resellerOptionMapping:Nc,resellerUnmappedItems:Oc,resellerUnmappedCustomerPrototypes:Pc,resellerKeys:Qc,resellerKey:Rc,resellerApps:Sc,resellerApp:Tc,resellerAppCompany:Vc,resellerAppCompanies:Uc,reorder:rd,refresh:function(a,b){l.assert(a,"db.refresh: expected uri");return Gd(a,null,null,null,b)},slipstream:function(b,c){c=c||{};if(window.slipstream&&window.slipstream[b]){var d=window.slipstream[b],e=c.doNotConvert||!1;return _.isObject(d)?(d=e?d:a.serverResponse(d),D(d,
null,_.isArray(d))):d}},payouts:Pb,payout:Qb,transfers:Rb,transfer:nd,uploads:Sb,upload:od,adjustments:Ub,adjustment:qd,transactions:Vb,funds:Tb,fund:pd,roles:vb,role:Ka,crewMembers:wb,crewMember:La,hotels:mc,hotel:oc,lodgings:gb,lodging:pc,pickups:hb,pickup:sc,routes:ta,route:ib,stops:tc,stop:uc,runs:Ba,preferredPickups:qc,preferredPickup:rc,testReport:E,invoices:Ra,invoice:ma,totalSheets:Xa,totalSheet:ra,invoiceSheets:Ya,invoiceSheet:sa,locations:sd,location:ac,waivers:Xb,waiver:Wa,connectedWaivers:Yb,
connectedWaiver:Zb,waiverInstance:$b,resources:bc,resource:$a,resourceUses:wa,requirementGroups:td,requirementGroup:cc,requirements:ud,requirement:vd,resourceRequirements:wd,resourceRequirement:dc,resourceUse:xd,resourceOverride:xa,resourceOverrides:ab,ticketLayouts:yd,ticketLayout:zd,analyticsServices:Ad,analyticsService:Bd,cancellationPolicies:Cd,cancellationPolicy:bb,cancellationRules:Dd,cancellationRule:Ed,bookingRestrictions:Fd,bookingRestriction:ec,persistentStore:fc,persistentStoreForCompany:gc,
persistentStoreItem:cb,tagGroups:id,tagGroup:jd,tags:Jb,tag:Ua,objectTags:Kb,version:Hd,serverResponse:D,formErrorHandler:F,errorStatus:function(a){return 0===a&&!g?"disconnect":404===a?"not-found":403===a?"forbidden":"error"},pusher:Za,searchEndpoint:function(a,b){return function(c){return a(b,null,null,{q:c})}}}}])})();angular.module("clientOptions",["clientOptions.services"]);
(function(){var n=angular.module("clientOptions.services",["db","lib","navigation"]);n.factory("clientOptions",["$rootScope","$sniffer","auth","db","events","models","navigation","storage","urls",function(c,k,h,d,f,m,a,n,l){l=/^(?:https?:\/\/)?(?:[a-z0-9\-_]+\.[a-z0-9\-_]+)+.*/i;var b=[{query:"u",key:"userIdentifier",reflect:!n.isPersistent(),reflectExternal:function(){return h.currentUser.isAuthenticated?!1:!0}},{query:"asn",key:"asnAffiliateCompany",reflect:!0},{query:"asn-ref",key:"asnVoucherNumber",
reflect:!0},{query:"sheet",key:"defaultTotalSheetPk",reflect:!0,type:"int"},{query:"full-items",key:"isFullItemsEnabled",reflect:!0,type:"yes-no"},{query:"kiosk",key:"isKioskModeEnabled",isSlipstream:!0,type:"yes-no"},{query:"ref",key:"onlineBookingReference",reflect:!0},{query:"referrer",key:"referrerUrl",pattern:l},{query:"back",key:"backUrl",pattern:l,decode:!0},{query:"preview"},{query:"site-tags",key:"trackingSiteTags",onlyIfDefined:!0,decode:!0},{query:"page-tags",key:"trackingPageTags",onlyIfDefined:!0,
decode:!0},{query:"button-tags",key:"trackingButtonTags",onlyIfDefined:!0,decode:!0},{query:"from-ssl",key:"trackingIsFromSsl",type:"yes-no",onlyIfDefined:!0},{query:"from-embed",key:"trackingFromEmbed",onlyIfDefined:!0},{query:m.FlowNode.FLOW_QUERY,key:"flowNode",reflect:!0,isUpdatedOnLocationChange:!0,isAuthenticatedAllowed:!0},{query:m.FlowNode.IS_SUGGESTED_QUERY,key:"isInSuggestedItems",reflect:!0,type:"yes-no",isUpdatedOnLocationChange:!0}],g=_.filter(b,"isUpdatedOnLocationChange"),C=function(a){a=
a||_.always;var c={};_.forEach(b,function(b){if(a(b)&&b.key){var d=y[b.key];_.isUndefined(d)||("yes-no"===b.type?d&&(c[b.query]="yes"):"int"===b.type?_.isFinite(d)&&(c[b.query]=d):d&&(c[b.query]=d))}});return c},x=function(){return C(function(a){return!!a.reflect})},q=function(){var a=C(function(a){return _.isFunction(a.reflectExternal)?a.reflectExternal():!!a.reflectExternal});return _.mapKeys(a,function(a,b){return"fh-"+b})};c.$on("$locationChangeSuccess",function(){_.forEach(g,D);var b=x();_.forEach(b,
function(b,c){a.set(c,b,!0)})});f.on(c,"navigation.company.updated",function(){a.currentCompany&&(y.asnCharterCompany?y.asnCharterCompany!==a.currentCompany.shortname&&(y.asnCharterCompany="",y.asnAffiliateCompany="",y.asnVoucherNumber=""):y.asnCharterCompany=a.currentCompany.shortname)});c=d.slipstream("domain");var B=d.slipstream("protocol")+"://"+c,y={reflect:function(c){var d=_.find(b,"key",c).query;a.set(d,y[c],!0)},extendUrl:function(b){return a.compose(b,C(),!0)},reflectUrl:function(b){var c;
if("/"===b.charAt(0)||0===b.indexOf(B))c=x();else if(0===b.indexOf("http"))c=q();else return b;return a.compose(b,c,!0)},reflectUrlsInHrefs:function(a){a.on("mousedown","a",function(){var a=$(this);a.attr("href",y.reflectUrl(a.attr("href")))})}},D=function(b){var c=a.get(b.query)||"";!c&&b.isSlipstream&&(c=d.slipstream(b.query)||"");h.currentUser.isAuthenticated&&!b.isAuthenticatedAllowed&&(c="");b.pattern&&!b.pattern.test(c)&&(c="");if(!b.onlyIfDefined||c)"int"===b.type?(c=parseInt(c,10),c=isNaN(c)?
null:c):"yes-no"===b.type&&(c="yes"===c),k.history&&!b.isUpdatedOnLocationChange&&a.clear(b.query,!0),b.decode&&(c=decodeURIComponent(c)),b.key&&(y[b.key]=c)};_.forEach(b,D);h.currentUser.isAuthenticated||(y.asnAffiliateCompany=y.asnAffiliateCompany||d.slipstream("asnAffiliateCompany")||"");y.asnAffiliateCompany||(y.asnAffiliateCompany="",y.asnVoucherNumber="");return y}]);n.run(["$rootScope","clientOptions",function(c,k){c.clientOptions=k}])})();
(function(){angular.module("flash",["flash.services"]);angular.module("flash.services",[]).factory("flash",[function(){return{debug:_.ignore,info:_.ignore,warn:_.ignore,error:_.ignore,success:_.ignore}}])})();angular.module("lightframe",["lightframe.services"]);
(function(){var n=angular.module("lightframe.services",[]);n.factory("lightframe",["$browser","$sniffer","$window","clientOptions","navigation","xmessage",function(c,k,h,d,f,m){c="";var a=!1,n=!1,l=null,b={};k=function(a){try{a=decodeURIComponent(a),b=JSON.parse(a)||{},l=b.parentUrl||null}catch(c){}};/^fareharbor-embed:/.test(h.name)?(k(window.name.substr(17)),c=b.embedId||"",a=b.isLightframed||!1):/^fareharbor-lightframe/.test(h.name)&&(k(window.name.substr(22)),n=!0);var g={embedId:c,isLightframe:function(){return h.top!==
h&&n},isEmbed:function(){return h.top!==h&&g.embedId},isLightframed:function(){return g.isEmbed()&&a},parentUrl:function(){return l},isParentInsecure:function(){return!1},broadcast:function(a,b){b=_.extend({embedId:g.embedId},b);m.broadcast(a,b)},updateHeight:function(a){g.isEmbed()&&a&&g.broadcast("fareharbor.height",{height:a})},open:function(a){a=d.extendUrl(a);g.isEmbed()?g.broadcast("fareharbor.open",{url:a}):h.top.location.href=h.location.protocol+"//"+h.location.hostname+(h.location.port?":"+
h.location.port:"")+a},close:function(){g.broadcast("fareharbor.close")},ready:function(){g.broadcast("fareharbor.ready")},isDirectAccess:function(){return h.top===h},listenForTouch:function(){var a=function(){g.broadcast("fareharbor.touchDetected")};window.addEventListener("touchstart",function q(){a();window.removeEventListener("touchstart",q)},!1);window.addEventListener("pointerdown",function B(b){"touch"==b.pointerType&&(a(),window.removeEventListener("pointerdown",B))},!1)}};return g}]);n.run(["$rootScope",
"lightframe",function(c,k){c.lightframe=k;c.isLightframe=k.isLightframe();k.ready();k.listenForTouch()}])})();(function(){angular.module("tracking",[]).factory("analytics",[function(){return{trackView:_.ignore}}])})();angular.module("urls",["urls.services"]);
(function(){var n=angular.module("urls.services",["lib.services"]);n.factory("urls",["models","require",function(c,k){var h={},d=function(a,c){var d=a,b,f,k;for(k in c)if(c.hasOwnProperty(k)){var m=c[k];k&&void 0!==m&&(f=":"+k+"(?:\\([^\\)/]+\\))?",(b=h[f])||(b=h[f]=RegExp(f)),d=d.replace(b,m))}if(-1===d.indexOf(":"))return d},f={Company:function(a){return{shortname:a.shortname,canonical:{company:"company.index",dashboard:"dashboard.index"}}},Hotel:function(a){return{shortname:a.company.shortname,
hotelPk:a.pk}},Lodging:function(a){return{shortname:a.company.shortname,lodgingPk:a.pk}},PreferredPickup:function(a){return{shortname:a.company.shortname,lodgingPk:a.lodging.pk,preferredPickupPk:a.pk}},Route:function(a){return{shortname:a.company.shortname,routePk:a.pk,canonical:{dashboard:"dashboard.settings.routes.route"}}},Run:function(a){return{shortname:a.company.shortname,routePk:a.route.pk,runPk:a.run.pk}},Stop:function(a){return{shortname:a.company.shortname,routePk:a.route.pk,stopPk:a.pk}},
Pickup:function(a){return{shortname:a.company.shortname,pickupPk:a.pk}},User:function(a){return{username:a.username,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.user.index"}}},CustomManifest:function(a){return{customManifestPk:a.pk,shortname:a.company.shortname}},CustomCalendar:function(a){return{customCalendarPk:a.pk,shortname:a.company.shortname}},CustomReport:function(a){return{customReportPk:a.pk,shortname:a.company.shortname}},Image:function(a){return{imagePk:a.pk,
itemPk:a.item?a.item.pk:void 0,shortname:a.company.shortname,canonical:{dashboard:"dashboard.items.item.index"}}},Resource:function(a){return{resourcePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.resources.resource.index"}}},ResourceOverride:function(a){return{resourceOverridePk:a.pk,resourcePk:a.resource.pk,shortname:a.resource.company.shortname,canonical:{dashboard:"dashboard.resources.resource.uses.index"}}},TagGroup:function(a){return{tagGroupPk:a.pk,shortname:a.company.shortname}},
Tag:function(a){return{tagPk:a.pk,tagGroupPk:a.tagGroup.pk,shortname:a.tagGroup.company.shortname}},Item:function(a){return{itemPk:a.pk,shortname:a.company.shortname,canonical:{company:"company.item.index",dashboard:"dashboard.items.item.index"}}},FlowNode:function(a){return{flowNodePk:a.pk,shortname:a.company.shortname,canonical:{company:"company.flowNode.index",dashboard:"dashboard.settings.flows.flowNode.index"}}},CustomerPrototype:function(a){return{customerPrototypePk:a.pk,itemPk:a.item.pk,shortname:a.company.shortname,
canonical:{dashboard:"dashboard.items.item.prices.customerTypes"}}},Availability:function(a){return{availabilityPk:a.pk,itemPk:a.item.pk,shortname:a.item.company.shortname,date:a.startAt?a.startAt.format("YYYY-MM-DD"):void 0,canonical:{company:"company.item.availability",dashboard:"dashboard.overlay.availability.index"}}},Block:function(a){return{blockPk:a.pk,shortname:a.company.shortname}},Contact:function(a){return{contactPk:a.pk,shortname:a.company.shortname}},Order:function(a){return{contactPk:a.contact.pk,
orderUuid:a.uuid,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.order"}}},Booking:function(a){return{bookingUuid:a.uuid,itemPk:a.item.pk,contactPk:a.contact.pk,shortname:a.company.shortname,affiliateShortname:a.affiliation?a.affiliation.affiliateCompany.shortname:void 0,canonical:{company:"company.item.booking",dashboard:"dashboard.overlay.contact.booking"}}},Campaign:function(a){return{campaignPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.campaigns.campaign.index"}}},
CampaignValidityRule:function(a){return{campaignValidityRulePk:a.pk,campaignPk:a.campaign.pk,shortname:a.campaign.company.shortname,canonical:{dashboard:"dashboard.settings.campaigns.campaign.settings"}}},Code:function(a){return{codePk:a.pk,campaignPk:a.campaign.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.campaigns.campaign.code"}}},StoredValueType:function(a){return{storedValueTypePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.storedValue.storedValueType"}}},
StoredValueCard:function(a){return{storedValueCardPk:a.pk,storedValueCardNumber:a.number,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.storedValue.storedValueCard.index"}}},StoredValueAdjustment:function(a){return{storedValueAdjustmentPk:a.pk,storedValueCardPk:a.storedValueCard.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.storedValue.storedValueCard.storedValueAdjustment"}}},Customer:function(a){return{customerPk:a.pk,bookingUuid:a.booking.uuid,
shortname:a.company.shortname}},CheckinStatus:function(a){return{checkinStatusPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.checkinStatuses"}}},CustomerType:function(a){return{customerTypePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customerTypes.customerType"}}},CustomerTypeRate:function(a){return{customerTypeRatePk:a.pk,shortname:a.company.shortname}},CannedMessage:function(a){return{cannedMessagePk:a.pk,shortname:a.company.shortname,
canonical:{dashboard:"dashboard.settings.cannedMessages.cannedMessage"}}},InStorePaymentType:function(a){return{inStorePaymentTypePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.inStorePaymentTypes"}}},EmvDevice:function(a){return{inStorePaymentTypePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.emvDevices"}}},BankAccount:function(a){return{bankAccountPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.bankAccounts"}}},
Card:function(a){return{cardPk:a.pk,shortname:a.company.shortname}},CardAffiliation:function(a){return{cardAffiliationPk:a.pk,shortname:a.company.shortname}},Payment:function(a){return{paymentPk:a.pk,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,itemPk:a.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Refund:function(a){return{refundPk:a.pk}},LegacyTransfer:function(a){return{transferPk:a.pk,shortname:a.company.shortname}},LegacyTransaction:function(a){return{transactionPk:a.pk}},
Account:function(a){return{accountPk:a.pk,shortname:a.company.shortname}},Payout:function(a){return{payoutPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.payouts.payout"}}},Transfer:function(a){return{transferPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.accounts.transfer"}}},Upload:function(a){return{uploadPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.accounts.upload"}}},Adjustment:function(a){return{adjustmentPk:a.pk,
shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.transactions.adjustment"}}},Transaction:function(a){return{transactionPk:a.pk,shortname:c.Company.ADMIN_SHORTNAME}},LineItem:function(a){return{lineItemPk:a.pk,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,itemPk:a.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Agent:function(a){return{agentPk:a.pk,shortname:a.company.shortname}},Desk:function(a){return{deskPk:a.pk,
shortname:a.company.shortname}},Role:function(a){return{rolePk:a.pk,shortname:a.company.shortname}},CrewMember:function(a){return{crewMemberPk:a.pk,availabilityPk:a.availability.pk,itemPk:a.availability.item.pk,shortname:a.company.shortname}},CustomField:function(a){return{customFieldPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},TransportationOption:function(a){return{transportationOptionPk:a.pk,customFieldPk:a.customField.pk,shortname:a.company.shortname,
canonical:{dashboard:"dashboard.settings.customFields.customField"}}},ExtendedOption:function(a){return{extendedOptionPk:a.pk,customFieldPk:a.customField.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},ConnectedCampaign:function(a){return{connectedCampaignPk:a.pk,customFieldPk:a.customField.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},ConnectedWaiver:function(a){return{connectedWaiverPk:a.pk,
customFieldPk:a.customField.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},GeneratingCampaign:function(a){return{generatingCampaignPk:a.pk,customFieldPk:a.customField.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},CustomFieldInstance:function(a){return{customFieldInstancePk:a.pk,itemPk:a.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.index"}}},CustomFieldInstanceCondition:function(a){return{customFieldInstanceConditionPk:a.pk,
customFieldInstancePk:a.customFieldInstance.pk,itemPk:a.customFieldInstance.item.pk,shortname:a.customFieldInstance.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.index"}}},CustomFieldInstanceGroup:function(a){return{customFieldInstanceGroupPk:a.pk,itemPk:a.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.fieldGroups"}}},RequirementGroup:function(a){return{requirementGroupPk:a.pk,itemPk:a.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.resources"}}},
Requirement:function(a){return{requirementPk:a.pk,requirementGroupPk:a.requirementGroup.pk,itemPk:a.requirementGroup.item.pk,shortname:a.requirementGroup.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.resources"}}},CustomerPrototypeRequirement:function(a){return{customerPrototypeRequirementPk:a.pk,requirementPk:a.requirement.pk,requirementGroupPk:a.requirement.requirementGroup.pk,itemPk:a.requirement.requirementGroup.item.pk,shortname:a.requirement.requirementGroup.company.shortname,
canonical:{dashboard:"dashboard.items.item.prices.resources"}}},ResourceRequirement:function(a){return{resourceRequirementPk:a.pk,requirementPk:a.requirement.pk,requirementGroupPk:a.requirement.requirementGroup.pk,itemPk:a.requirement.requirementGroup.item.pk,shortname:a.requirement.requirementGroup.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.resources"}}},CustomerCustomFieldValue:function(a){return{customerCustomFieldValuePk:a.pk,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,
shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},BookingCustomFieldValue:function(a){return{bookingCustomFieldValuePk:a.pk,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Group:function(a){return{groupPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.group"}}},GroupOverride:function(a){return{groupOverridePk:a.pk,shortname:a.company.shortname}},
ResourceUse:function(a){return{resourceUsePk:a.pk,customerPk:a.customer.pk,contactPk:a.booking.contact.pk,bookingUuid:a.customer.booking.uuid,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Affiliation:function(a){return{affiliationPk:a.pk,shortname:a.company.shortname,partnerShortname:a.affiliateCompany.shortname}},Activity:function(a){return{activityPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.activity.index"}}},Notification:function(a){return{notificationPk:a.pk,
shortname:a.company.shortname,contactPk:a.booking?a.booking.contact.pk:void 0,bookingUuid:a.booking?a.booking.uuid:void 0,availabilityPk:a.availability?a.availability.pk:void 0,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},SmsNotification:function(a){return{smsNotificationPk:a.pk,shortname:a.company.shortname,contactPk:a.booking?a.booking.contact.pk:void 0,bookingUuid:a.booking?a.booking.uuid:void 0,availabilityPk:a.availability?a.availability.pk:void 0,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},
Subscription:function(a){return{subscriptionPk:a.pk,shortname:a.company.shortname}},Invoice:function(a){return{invoicePk:a.pk,invoiceUuid:a.uuid,shortname:a.company.shortname,affiliateShortname:a.affiliation?a.affiliation.affiliateCompany.shortname:void 0}},InvoiceEntry:function(a){return{invoiceEntryPk:a.pk,invoicePk:a.invoice.pk,shortname:a.company.shortname}},Report:function(a){return{reportPk:a.pk,shortname:a.company.shortname,modelSlug:a.type===c.Report.ADVANCED_TYPE?c.Report.MODELS[a.options.modelName].slug:
void 0,canonical:{dashboard:"dashboard.reports.advanced.permalink"}}},ViatorMapping:function(a){return{viatorMappingPk:a.pk,shortname:a.company.shortname,itemPk:a.item.pk}},Waiver:function(a){return{waiverPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.waivers.waiver.index"}}},WaiverInstance:function(a){return{waiverPk:a.waiver.pk,waiverInstancePk:a.waiverInstance.pk,shortname:a.company.shortname}},TotalSheet:function(a){return{totalSheetPk:a.pk,shortname:a.company.shortname,
canonical:{dashboard:"dashboard.settings.pricing.totalSheet"}}},InvoiceSheet:function(a){return{invoiceSheetPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.pricing.invoiceSheet"}}},SupportedLanguage:function(a){return{languagePk:a.pk,shortname:a.company.shortname,modelName:c.Translation.modelNameForUrl(a.modelName),canonical:{dashboard:"dashboard.settings.translations.language.translations.index"}}},Translation:function(a){return{translationPk:a.pk,supportedLanguagePk:a.supportedLanguage.pk,
shortname:a.company.shortname}},Location:function(a){return{locationPk:a.pk,shortname:a.company.shortname}},ResellerCompany:function(a){return{resellerCompanyPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.company.index"}}},ResellerCompanyMapping:function(a){return{resellerCompanyMappingPk:a.pk,resellerCompanyPk:a.resellerCompany.pk,shortname:a.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.company.index"}}},ResellerItem:function(a){return{resellerItemPk:a.pk,
resellerCompanyPk:a.resellerCompany.pk,shortname:a.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.item.index"}}},ResellerItemMapping:function(a){return{resellerItemMappingPk:a.pk,resellerItemPk:a.resellerItem.pk,resellerCompanyPk:a.resellerItem.resellerCompany.pk,shortname:a.resellerItem.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.item.index"}}},ResellerCustomerType:function(a){return{resellerCustomerTypePk:a.pk,resellerItemPk:a.resellerItem.pk,
resellerCompanyPk:a.resellerItem.resellerCompany.pk,shortname:a.resellerItem.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.customerType.index"}}},ResellerCustomerTypeMapping:function(a){return{resellerCustomerTypeMappingPk:a.pk,resellerCustomerTypePk:a.resellerCustomerType.pk,resellerItemPk:a.resellerCustomerType.resellerItem.pk,resellerCompanyPk:a.resellerCustomerType.resellerItem.resellerCompany.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.customerType.index"}}},
ResellerOption:function(a){return{resellerOptionPk:a.pk,resellerItemPk:a.resellerItem.pk,resellerCompanyPk:a.resellerItem.resellerCompany.pk,shortname:a.resellerItem.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.option.index"}}},ResellerOptionMapping:function(a){return{resellerOptionMappingPk:a.pk,resellerOptionPk:a.resellerOption.pk,resellerItemPk:a.resellerOption.resellerItem.pk,resellerCompanyPk:a.resellerOption.resellerItem.resellerCompany.pk,shortname:a.company.shortname,
canonical:{dashboard:"dashboard.settings.reseller.option.index"}}},ResellerKey:function(a){return{resellerKeyPk:a.pk,username:a.user.username,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.user.apiKeys.apiKey"}}},ResellerApp:function(a){return{resellerAppPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.apps.app.index"}}},ResellerAppCompany:function(a){return{resellerAppCompanyPk:a.pk,resellerAppPk:a.resellerApp.pk,shortname:a.resellerApp.company.shortname}},
AnalyticsService:function(a){return{analyticsServicePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.analyticsServices.analyticsService"}}},CancellationPolicy:function(a){return{cancellationPolicyPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.cancellationPolicy.index"}}},CancellationRule:function(a){return{cancellationPolicyPk:a.cancellationPolicy.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.cancellationPolicy.index"}}},
BookingRestriction:function(a){return{bookingRestrictionPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.bookingRestrictions.bookingRestriction"}}},TicketLayout:function(a){return{ticketLayoutPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.ticketLayouts.index"}}}},m={populate:d,populateForObject:function(a){a=a||"";var c;if(this.$urls){if(c=this.$urls[a])return c}else this.$urls={},this.$params=m.extract(this);if(a)c=d(a,this.$params);else{if(!this.$params.canonical)return"";
c=this.$params.canonical.dashboard||this.$params.canonical.company;if(!c)return"";c=d(_.getDotted(m,c),this.$params)}return this.$urls[a]=c},extract:function(a){k.assert(a,"urls: unable to extract from object",a);k.defined(f,a.cls,"urls: unable to extract cls",a);return f[a.cls](a)},calendarUrls:function(a){return{index:a,month:a+":year/:month/",day:a+":year/:month/:day/",agenda:a+":year/:month/:day/",grid:a+":year/:month/:day/",timeline:a+":year/:month/:day/"}},dayUrlForCompany:function(a,f){return d(a.features.isDayViewEnabled?
m.dashboard.bookings.day.date:m.dashboard.bookings.timeline.date+"?timeline-type="+c.Company.AVAILABILITY_TIMELINE,{shortname:a.shortname,date:f.format("YYYY-MM-DD")})},legacyManifest:"/:shortname/manifest/",company:{index:"/:shortname/",login:"/:shortname/login/",about:"/:shortname/about/",faq:"/:shortname/faq/",policies:"/:shortname/policies/",items:{index:"/:shortname/items/",calendar:"/:shortname/items/calendar/"},item:{index:"/:shortname/items/:itemPk(pk)/",calendar:"/:shortname/items/:itemPk(pk)/calendar/",
month:"/:shortname/items/:itemPk(pk)/calendar/:year/:month/",date:"/:shortname/items/:itemPk(pk)/date/:date/",availability:"/:shortname/items/:itemPk(pk)/availability/:availabilityPk/",book:"/:shortname/items/:itemPk(pk)/availability/:availabilityPk/book/",booking:"/:shortname/items/:itemPk(pk)/booking/:bookingUuid/"},storedValueCard:{index:"/:shortname/gift-cards/:storedValueCardNumber/"},cart:{index:"/:shortname/cart/",permalink:"/:shortname/cart/?u=:cartUuid"},order:{index:"/:shortname/orders/:orderUuid/"},
invoice:{index:"/:shortname/invoices/:invoiceUuid/"},flowNode:{index:"/:shortname/items/?flow=:flowNodePk",calendar:"/:shortname/items/calendar/?flow=:flowNodePk"}},dashboard:{index:"/:shortname/dashboard/",overlay:{index:"/:shortname/dashboard/@overlay=/",item:{index:"/:shortname/dashboard/@overlay=/items/:itemPk/",date:"/:shortname/dashboard/@overlay=/items/:itemPk/date/:date/"},availability:{index:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/",bookings:{index:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/bookings/",
cancelled:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/bookings/cancelled/"},message:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/message/",settings:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/settings/",prices:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/prices/",integrations:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/integrations/"},
contact:{index:"/:shortname/dashboard/@overlay=/contacts/:contactPk/",booking:"/:shortname/dashboard/@overlay=/contacts/:contactPk/bookings/:bookingUuid/",order:"/:shortname/dashboard/@overlay=/contacts/:contactPk/orders/:orderUuid/"},deprecatedBooking:{index:"/:shortname/dashboard/@overlay=/bookings/:bookingUuid/"},activity:{index:"/:shortname/dashboard/@overlay=/activities/:activityPk/"},translation:{index:"/:shortname/dashboard/@overlayTop=/translations/:objectType/:objectId/:objectField/"},close:"/:shortname/dashboard/@overlay"},
translationsOverlay:{index:"/:shortname/dashboard/@translations-overlay=/",forField:"/:shortname/dashboard/@translations-overlay=/for-field/:objectType/:objectId/:objectField/",close:"/:shortname/dashboard/@translations-overlay"},admin:{index:"/:shortname/dashboard/admin/"},manifest:{index:"/:shortname/dashboard/manifest/",date:"/:shortname/dashboard/manifest/date/:date/",bookings:"/:shortname/dashboard/manifest/date/:date/bookings/",availabilities:"/:shortname/dashboard/manifest/date/:date/availabilities/",
items:"/:shortname/dashboard/manifest/date/:date/items/",runs:"/:shortname/dashboard/manifest/date/:date/runs/",resources:"/:shortname/dashboard/manifest/date/:date/resources/"},bookings:{index:"/:shortname/dashboard/bookings/",calendar:"/:shortname/dashboard/bookings/calendar/",day:{index:"/:shortname/dashboard/bookings/day/",date:"/:shortname/dashboard/bookings/day/:date/"},grid:{index:"/:shortname/dashboard/bookings/grid/",date:"/:shortname/dashboard/bookings/grid/:date/"},timeline:{index:"/:shortname/dashboard/bookings/timeline/",
date:"/:shortname/dashboard/bookings/timeline/:date/"},agenda:{index:"/:shortname/dashboard/bookings/agenda/",date:"/:shortname/dashboard/bookings/agenda/:date/"},booking:{deprecatedPermalink:"/:shortname/dashboard/bookings/:bookingUuid/view/",deprecatedAffiliatePermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/:bookingUuid/"},contact:{index:"/:shortname/dashboard/bookings/contacts/:contactPk/",order:"/:shortname/dashboard/bookings/contacts/:contactPk/orders/:orderUuid/view/",
booking:"/:shortname/dashboard/bookings/contacts/:contactPk/bookings/:bookingUuid/view/",affiliateContactPermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/contacts/:contactPk/",affiliateBookingPermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/contacts/:contactPk/bookings/:bookingUuid/",affiliateOrderPermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/contacts/:contactPk/orders/:orderUuid/"}},reports:{index:"/:shortname/dashboard/reports/",
type:"/:shortname/dashboard/reports/:type/",invoices:{index:"/:shortname/dashboard/reports/invoices/",create:{index:"/:shortname/dashboard/reports/invoices/create/",permalink:"/:shortname/dashboard/reports/invoices/create/report/:reportPk/"},permalink:"/:shortname/dashboard/reports/invoices/report/:reportPk/",invoice:{index:"/:shortname/dashboard/reports/invoices/invoice/:invoicePk/",multi:"/:shortname/dashboard/reports/invoices/invoices/:invoicePks(pks)/",notification:"/:shortname/dashboard/reports/invoices/invoice/:invoicePk/notification/",
upload:"/:shortname/dashboard/reports/invoices/invoice/:invoicePk/upload/",receiveSignUp:"/:shortname/dashboard/reports/invoices/invoice/:invoicePk/receive-sign-up/"},partnerInvoice:{index:"/:affiliateShortname/dashboard/reports/invoices/partner-invoice/:invoicePk/",notification:"/:affiliateShortname/dashboard/reports/invoices/partner-invoice/:invoicePk/notification/",upload:"/:affiliateShortname/dashboard/reports/invoices/partner-invoice/:invoicePk/upload/",receiveSignUp:"/:affiliateShortname/dashboard/reports/invoices/partner-invoice/:invoicePk/receive-sign-up/"}},
test:{index:"/:shortname/dashboard/reports/test/",permalink:"/:shortname/dashboard/reports/test/report/:reportPk/"},reports:{index:"/:shortname/dashboard/reports/reports/"},accounts:{index:"/:shortname/dashboard/reports/accounts/",permalink:"/:shortname/dashboard/reports/accounts/report/:reportPk/",transfer:"/:shortname/dashboard/reports/accounts/transfer/:transferPk/",upload:"/:shortname/dashboard/reports/accounts/upload/:uploadPk/"},customersRedirect:{index:"/:shortname/dashboard/reports/customers/"},
contacts:{index:"/:shortname/dashboard/reports/contacts/",permalink:"/:shortname/dashboard/reports/contacts/report/:reportPk/"},bookings:{index:"/:shortname/dashboard/reports/bookings/",permalink:"/:shortname/dashboard/reports/bookings/report/:reportPk/"},companies:{index:"/:shortname/dashboard/reports/companies/",permalink:"/:shortname/dashboard/reports/companies/report/:reportPk/"},payments:{index:"/:shortname/dashboard/reports/payments/",permalink:"/:shortname/dashboard/reports/payments/report/:reportPk/"},
disputes:{index:"/:shortname/dashboard/reports/disputes/",permalink:"/:shortname/dashboard/reports/disputes/report/:reportPk/"},lineItems:{index:"/:shortname/dashboard/reports/line-items/",permalink:"/:shortname/dashboard/reports/line-items/report/:reportPk/"},payouts:{index:"/:shortname/dashboard/reports/payouts/",permalink:"/:shortname/dashboard/reports/payouts/report/:reportPk/",payout:"/:shortname/dashboard/reports/payouts/payout/:payoutPk/"},escrow:{index:"/:shortname/dashboard/reports/to-be-paid/",
permalink:"/:shortname/dashboard/reports/to-be-paid/report/:reportPk/"},volume:{index:"/:shortname/dashboard/reports/volume/",permalink:"/:shortname/dashboard/reports/volume/report/:reportPk/"},transactions:{index:"/:shortname/dashboard/reports/transactions/",permalink:"/:shortname/dashboard/reports/transactions/report/:reportPk/",adjustment:"/:shortname/dashboard/reports/transactions/:adjustmentPk/"},bookingTypesSummary:{index:"/:shortname/dashboard/reports/booking-types-summary/",permalink:"/:shortname/dashboard/reports/booking-types-summary/report/:reportPk/"},
crewSummary:{index:"/:shortname/dashboard/reports/crew-summary/",permalink:"/:shortname/dashboard/reports/crew-summary/report/:reportPk/"},customerTypesSummary:{index:"/:shortname/dashboard/reports/customer-types-summary/",permalink:"/:shortname/dashboard/reports/customer-types-summary/report/:reportPk/"},customFieldSummary:{index:"/:shortname/dashboard/reports/custom-field-summary/",permalink:"/:shortname/dashboard/reports/custom-field-summary/report/:reportPk/"},itemsSummary:{index:"/:shortname/dashboard/reports/items-summary/",
permalink:"/:shortname/dashboard/reports/items-summary/report/:reportPk/"},lodgingsSummary:{index:"/:shortname/dashboard/reports/lodging-summary/",permalink:"/:shortname/dashboard/reports/lodging-summary/report/:reportPk/"},pickupsSummary:{index:"/:shortname/dashboard/reports/pickups-summary/",permalink:"/:shortname/dashboard/reports/pickups-summary/report/:reportPk/"},usersSummary:{index:"/:shortname/dashboard/reports/users-summary/",permalink:"/:shortname/dashboard/reports/users-summary/report/:reportPk/"},
agentsSummary:{index:"/:shortname/dashboard/reports/agents-summary/",permalink:"/:shortname/dashboard/reports/agents-summary/report/:reportPk/"},desksSummary:{index:"/:shortname/dashboard/reports/desks-summary/",permalink:"/:shortname/dashboard/reports/desks-summary/report/:reportPk/"},campaignsSummary:{index:"/:shortname/dashboard/reports/campaigns-summary/",permalink:"/:shortname/dashboard/reports/campaigns-summary/report/:reportPk/"},revenueSummary:{index:"/:shortname/dashboard/reports/revenue-summary/",
permalink:"/:shortname/dashboard/reports/revenue-summary/report/:reportPk/"},advanced:{redirect:"/:shortname/dashboard/reports/advanced/",index:"/:shortname/dashboard/reports/advanced/:modelSlug/",permalink:"/:shortname/dashboard/reports/advanced/:modelSlug/:reportPk/"}},items:{index:"/:shortname/dashboard/items/",grid:"/:shortname/dashboard/items/grid/",list:"/:shortname/dashboard/items/list/",item:{index:"/:shortname/dashboard/items/:itemPk/",activity:"/:shortname/dashboard/items/:itemPk/activity/",
calendar:"/:shortname/dashboard/items/:itemPk/calendar/",prices:{index:"/:shortname/dashboard/items/:itemPk/prices/",customerTypes:"/:shortname/dashboard/items/:itemPk/prices/customer-types/",fieldGroups:"/:shortname/dashboard/items/:itemPk/prices/field-groups/",resources:"/:shortname/dashboard/items/:itemPk/prices/resources/"},embeds:"/:shortname/dashboard/items/:itemPk/embeds/",onlineBooking:"/:shortname/dashboard/items/:itemPk/online-booking/",suggestedItems:"/:shortname/dashboard/items/:itemPk/suggested-items/",
info:{index:"/:shortname/dashboard/items/:itemPk/info/",notes:"/:shortname/dashboard/items/:itemPk/info/notes/",basic:"/:shortname/dashboard/items/:itemPk/info/basic/",photos:"/:shortname/dashboard/items/:itemPk/info/photos/",advanced:"/:shortname/dashboard/items/:itemPk/info/advanced/",tags:"/:shortname/dashboard/items/:itemPk/info/tags/"},notifications:{index:"/:shortname/dashboard/items/:itemPk/notifications/",internal:"/:shortname/dashboard/items/:itemPk/notifications/internal/",external:"/:shortname/dashboard/items/:itemPk/notifications/external/"},
integrations:{index:"/:shortname/dashboard/items/:itemPk/integrations/",subscribe:"/:shortname/dashboard/items/:itemPk/integrations/subscribe/",reviewExpress:"/:shortname/dashboard/items/:itemPk/integrations/review-express/",viator:"/:shortname/dashboard/items/:itemPk/integrations/viator/",picthrive:"/:shortname/dashboard/items/:itemPk/integrations/picthrive/"}}},resources:{index:"/:shortname/dashboard/resources/",resource:{index:"/:shortname/dashboard/resources/:resourcePk/",settings:"/:shortname/dashboard/resources/:resourcePk/settings/",
uses:{index:"/:shortname/dashboard/resources/:resourcePk/uses/",overview:"/:shortname/dashboard/resources/:resourcePk/uses/overview/",day:"/:shortname/dashboard/resources/:resourcePk/uses/date/:date/"}}},settings:{index:"/:shortname/dashboard/settings/",actions:"/:shortname/dashboard/settings/actions/",advanced:"/:shortname/dashboard/settings/advanced/",payments:{index:"/:shortname/dashboard/settings/payments/",cards:{index:"/:shortname/dashboard/settings/payments/cards/",card:{index:"/:shortname/dashboard/settings/payments/cards/:cardPk/",
settings:"/:shortname/dashboard/settings/payments/cards/:cardPk/settings/"}},inStorePaymentTypes:"/:shortname/dashboard/settings/payments/payment-types/",emvDevices:"/:shortname/dashboard/settings/payments/emv-devices/",bankAccounts:"/:shortname/dashboard/settings/payments/bank-accounts/"},profile:{index:"/:shortname/dashboard/settings/profile/",style:"/:shortname/dashboard/settings/profile/style/",slideshow:"/:shortname/dashboard/settings/profile/slideshow/",pages:"/:shortname/dashboard/settings/profile/pages/"},
info:{index:"/:shortname/dashboard/settings/info/",notesAndPolicies:"/:shortname/dashboard/settings/info/notes/",contact:"/:shortname/dashboard/settings/info/contact/",socialMedia:"/:shortname/dashboard/settings/info/social-media/",advanced:"/:shortname/dashboard/settings/info/advanced/",tags:"/:shortname/dashboard/settings/info/tags/"},cancellationPolicies:"/:shortname/dashboard/settings/cancellation-policies/",cancellationPolicy:{index:"/:shortname/dashboard/settings/cancellation-policies/:cancellationPolicyPk/",
settings:"/:shortname/dashboard/settings/cancellation-policies/:cancellationPolicyPk/settings/"},tagGroups:{index:"/:shortname/dashboard/settings/tag-groups/",tagGroup:{index:"/:shortname/dashboard/settings/tag-groups/:tagGroupPk/",settings:"/:shortname/dashboard/settings/tag-groups/:tagGroupPk/settings/",tag:"/:shortname/dashboard/settings/tag-groups/:tagGroupPk/tags/:tagPk/"}},permissions:{index:"/:shortname/dashboard/settings/permissions/",groups:"/:shortname/dashboard/settings/permissions/groups/",
group:"/:shortname/dashboard/settings/permissions/groups/:groupPk/",groupOverrides:"/:shortname/dashboard/settings/permissions/outside-users/",groupOverride:"/:shortname/dashboard/settings/permissions/outside-users/:groupOverridePk/",users:"/:shortname/dashboard/settings/permissions/users/",user:{index:"/:shortname/dashboard/settings/permissions/users/:username/",settings:"/:shortname/dashboard/settings/permissions/users/:username/settings/",apiKeys:{index:"/:shortname/dashboard/settings/permissions/users/:username/api-keys/",
apiKey:"/:shortname/dashboard/settings/permissions/users/:username/api-keys/:resellerKeyPk/"}}},agents:{index:"/:shortname/dashboard/settings/agents/",agent:"/:shortname/dashboard/settings/agents/:agentPk/"},desks:{index:"/:shortname/dashboard/settings/desks/",desk:"/:shortname/dashboard/settings/desks/:deskPk/"},campaigns:{index:"/:shortname/dashboard/settings/campaigns/",campaign:{index:"/:shortname/dashboard/settings/campaigns/:campaignPk/",settings:"/:shortname/dashboard/settings/campaigns/:campaignPk/settings/",
code:"/:shortname/dashboard/settings/campaigns/:campaignPk/codes/:codePk/"}},checkinStatuses:"/:shortname/dashboard/settings/check-in/",customerTypes:{index:"/:shortname/dashboard/settings/customer-types/",customerType:"/:shortname/dashboard/settings/customer-types/:customerTypePk/"},customFields:{index:"/:shortname/dashboard/settings/custom-fields/",type:"/:shortname/dashboard/settings/custom-fields/type/:type/",customField:"/:shortname/dashboard/settings/custom-fields/:customFieldPk(pk)/"},cannedMessages:{index:"/:shortname/dashboard/settings/canned-messages/",
cannedMessage:"/:shortname/dashboard/settings/canned-messages/:cannedMessagePk/"},network:{index:"/:shortname/dashboard/settings/network/",affiliates:{index:"/:shortname/dashboard/settings/network/affiliates/",affiliate:{index:"/:shortname/dashboard/settings/network/affiliates/:affiliationPk/",cards:"/:shortname/dashboard/settings/network/affiliates/:affiliationPk/cards/"}},partners:{index:"/:shortname/dashboard/settings/network/partners/",partner:{index:"/:partnerShortname/dashboard/settings/network/partners/:affiliationPk/",
cards:"/:partnerShortname/dashboard/settings/network/partners/:affiliationPk/cards/"}}},hotels:{index:"/:shortname/dashboard/settings/hotels/",hotel:"/:shortname/dashboard/settings/hotels/:hotelPk/"},lodgings:{index:"/:shortname/dashboard/settings/lodgings/",lodging:"/:shortname/dashboard/settings/lodgings/:lodgingPk/"},pickups:{index:"/:shortname/dashboard/settings/pickups/",pickup:"/:shortname/dashboard/settings/pickups/:pickupPk/"},routes:{index:"/:shortname/dashboard/settings/routes/",route:"/:shortname/dashboard/settings/routes/:routePk/"},
translations:{index:"/:shortname/dashboard/settings/languages/",language:{index:"/:shortname/dashboard/settings/languages/:languagePk/",settings:"/:shortname/dashboard/settings/languages/:languagePk/settings/",translations:{index:"/:shortname/dashboard/settings/languages/:languagePk/translations/",forModel:"/:shortname/dashboard/settings/languages/:languagePk/translations/:modelName/"}}},pricing:{index:"/:shortname/dashboard/settings/pricing/",sheets:"/:shortname/dashboard/settings/pricing/sheets/",
totalSheet:"/:shortname/dashboard/settings/pricing/total-sheets/:totalSheetPk/",invoiceSheet:"/:shortname/dashboard/settings/pricing/invoice-sheets/:invoiceSheetPk/",overview:"/:shortname/dashboard/settings/pricing/overview/"},activity:"/:shortname/dashboard/settings/activity/",embeds:"/:shortname/dashboard/settings/embeds/",integrations:{index:"/:shortname/dashboard/settings/integrations/",subscribe:"/:shortname/dashboard/settings/integrations/subscribe/"},reseller:{index:"/:shortname/dashboard/settings/integrations/channels/",
company:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/",settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/settings/"},item:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/",settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/settings/"},customerType:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/customer-types/:resellerCustomerTypePk/",
settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/customer-types/:resellerCustomerTypePk/settings/"},option:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/options/:resellerOptionPk/",settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/options/:resellerOptionPk/settings/"},apps:{index:"/:shortname/dashboard/settings/integrations/apps/",app:{index:"/:shortname/dashboard/settings/integrations/apps/:resellerAppPk/",
settings:"/:shortname/dashboard/settings/integrations/apps/:resellerAppPk/settings/"}}},waivers:{index:"/:shortname/dashboard/settings/waivers/",waiver:{index:"/:shortname/dashboard/settings/waivers/:waiverPk/"}},locations:{index:"/:shortname/dashboard/settings/locations/",settings:"/:shortname/dashboard/settings/locations/settings/",location:"/:shortname/dashboard/settings/locations/location/:locationPk/"},storedValue:{index:"/:shortname/dashboard/settings/gift-cards/",storedValueTypes:"/:shortname/dashboard/settings/gift-cards/types/",
storedValueType:"/:shortname/dashboard/settings/gift-cards/types/:storedValueTypePk/",storedValueCards:"/:shortname/dashboard/settings/gift-cards/cards/",storedValueCard:{index:"/:shortname/dashboard/settings/gift-cards/cards/:storedValueCardPk/",settings:"/:shortname/dashboard/settings/gift-cards/cards/:storedValueCardPk/settings/",storedValueAdjustment:"/:shortname/dashboard/settings/gift-cards/cards/:storedValueCardPk/adjustments/:storedValueAdjustmentPk/"}},analyticsServices:{index:"/:shortname/dashboard/settings/analytics/",
analyticsService:"/:shortname/dashboard/settings/analytics/:analyticsServicePk/"},flows:{index:"/:shortname/dashboard/settings/flows/",flowNode:{index:"/:shortname/dashboard/settings/flows/:flowNodePk/"}},ticketLayouts:{index:"/:shortname/dashboard/settings/ticket-layouts/",ticketLayout:{index:"/:shortname/dashboard/settings/ticket-layouts/:ticketLayoutPk/"}},suggestedItems:"/:shortname/dashboard/settings/suggested-items/",bookingRestrictions:{index:"/:shortname/dashboard/settings/booking-restrictions/",
bookingRestriction:"/:shortname/dashboard/settings/booking-restrictions/:bookingRestrictionPk/"}}},root:{index:"/",login:"/login/",forgot:{index:"/forgot/",password:"/forgot/password/",resetPassword:"/forgot/password/reset/",credentials:"/forgot/credentials/"},version:"/version/",help:"/help/"},email:{bookingNotification:"/email/:type/:shortname/bookings/:bookingUuid/",orderNotification:"/email/:type/:shortname/orders/:orderUuid/",invoicePaymentRequest:"/email/:type/:shortname/invoice/:invoicePk/"},
embeds:{calendar:{index:"/embeds/calendar/:shortname/",all:"/embeds/calendar/:shortname/all/",items:"/embeds/calendar/:shortname/items/:itemPks(pks)/"},cart:{index:"/embeds/cart/"},checkin:{index:"/embeds/checkin/",company:{index:"/embeds/checkin/:shortname/",booking:{index:"/embeds/checkin/:shortname/bookings/:bookingUuid/",customer:"/embeds/checkin/:shortname/bookings/:bookingUuid/customers/:customerPk/"}},qr:"/:encodedCustomerPk"},book:{index:"/embeds/book/:shortname/",storedValueCard:{index:"/embeds/book/:shortname/gift-cards/:storedValueCardNumber/"},
items:{index:"/embeds/book/:shortname/items/",calendar:"/embeds/book/:shortname/items/calendar/"},item:{index:"/embeds/book/:shortname/items/:itemPk(pk)/",calendar:"/embeds/book/:shortname/items/:itemPk(pk)/calendar/",month:"/embeds/book/:shortname/items/:itemPk(pk)/calendar/:year/:month/",date:"/embeds/book/:shortname/items/:itemPk(pk)/date/:date/",availability:"/embeds/book/:shortname/items/:itemPk(pk)/availability/:availabilityPk/",book:"/embeds/book/:shortname/items/:itemPk(pk)/availability/:availabilityPk/book/",
booking:"/embeds/book/:shortname/items/:itemPk(pk)/booking/:bookingUuid/"},cart:{index:"/embeds/book/:shortname/cart/",permalink:"/embeds/book/:shortname/cart/?u=:cartUuid"},order:{index:"/embeds/book/:shortname/orders/:orderUuid/"},flowNode:{index:"/embeds/book/:shortname/items/?flow=:flowNodePk",calendar:"/embeds/book/:shortname/items/calendar/?flow=:flowNodePk"}},partners:{index:"/embeds/partners/",company:"/embeds/partners/:shortname/"},items:{index:"/embeds/items/:shortname/"},analytics:{booking:"/embeds/a/:shortname/booking/:bookingUuid/"}},
pusher:{auth:"/realtime/auth/",channels:"/realtime/:shortname/channels/",members:"/realtime/:shortname/members/"},api:{login:"/api/v1/login/",logout:"/api/v1/logout/",forgotPassword:"/api/v1/forgot/password/",resetPassword:"/api/v1/forgot/password/reset/",forgotCredentials:"/api/v1/forgot/credentials/",companies:"/api/v1/companies/",company:"/api/v1/companies/:shortname/",companyNags:"/api/v1/companies/:shortname/nags/",companyFeatures:"/api/v1/companies/:shortname/features/",companyItemColorsFeature:"/api/v1/companies/:shortname/item-colors-feature/",
companyProfile:"/api/v1/companies/:shortname/profile/",companyContactInformation:"/api/v1/companies/:shortname/contact-information/",companyTaxInformation:"/api/v1/companies/:shortname/tax-information/",companyExtendedTaxInformation:"/api/v1/companies/:shortname/tax-information/extended/",companyTosAcceptance:"/api/v1/companies/:shortname/tos/",companyAccounts:"/api/v1/companies/:shortname/accounts/",companyStyles:"/api/v1/companies/:shortname/styles/",companyAdminNotes:"/api/v1/companies/:shortname/admin-notes/",
companyPayments:"/api/v1/companies/:shortname/payments/",companyManifestSettings:"/api/v1/companies/:shortname/manifest-settings/",companyCalendar:"/api/v1/companies/:shortname/calendar/:year/:month/",companyImages:"/api/v1/companies/:shortname/images/",companyImage:"/api/v1/companies/:shortname/images/:imagePk/",tagGroups:"/api/v1/companies/:shortname/tag-groups/",tagGroup:"/api/v1/companies/:shortname/tag-groups/:tagGroupPk/",tags:"/api/v1/companies/:shortname/tag-groups/:tagGroupPk/tags/",tag:"/api/v1/companies/:shortname/tag-groups/:tagGroupPk/tags/:tagPk/",
objectTags:"/api/v1/companies/:shortname/tags/:objectCls/:objectPk/",inStorePaymentTypes:"/api/v1/companies/:shortname/in-store-payment-types/",inStorePaymentType:"/api/v1/companies/:shortname/in-store-payment-types/:inStorePaymentTypePk/",emvDevices:"/api/v1/companies/:shortname/emv-devices/",emvDevice:"/api/v1/companies/:shortname/emv-devices/:emvDevicePk/",emvDeviceActivate:"/api/v1/companies/:shortname/emv-devices/:emvDevicePk/activate/",bankAccounts:"/api/v1/companies/:shortname/bank-accounts/",
bankAccount:"/api/v1/companies/:shortname/bank-accounts/:bankAccountPk/",cards:"/api/v1/companies/:shortname/cards/",card:"/api/v1/companies/:shortname/cards/:cardPk/",cardAffiliations:"/api/v1/companies/:shortname/cards/:cardPk/card-affiliations/",verifyBankAccount:"/api/v1/companies/:shortname/bank-accounts/:bankAccountPk/verify/",hotels:"/api/v1/companies/:shortname/hotels/",hotel:"/api/v1/companies/:shortname/hotels/:hotelPk/",lodgings:"/api/v1/companies/:shortname/lodgings/",duplicateLodgingsAcrossCompanies:"/api/v1/companies/:shortname/lodgings/duplicate/",
lodging:"/api/v1/companies/:shortname/lodgings/:lodgingPk/",preferredPickups:"/api/v1/companies/:shortname/lodgings/:lodgingPk/preferred-pickups/",preferredPickup:"/api/v1/companies/:shortname/lodgings/:lodgingPk/preferred-pickups/:preferredPickupPk/",pickups:"/api/v1/companies/:shortname/pickups/",duplicatePickupsAcrossCompanies:"/api/v1/companies/:shortname/pickups/duplicate/",pickup:"/api/v1/companies/:shortname/pickups/:pickupPk/",routes:"/api/v1/companies/:shortname/routes/",duplicateRoutesAcrossCompanies:"/api/v1/companies/:shortname/routes/duplicate/",
route:"/api/v1/companies/:shortname/routes/:routePk/",duplicateRoute:"/api/v1/companies/:shortname/routes/:routePk/duplicate/",stops:"/api/v1/companies/:shortname/routes/:routePk/stops/",stop:"/api/v1/companies/:shortname/routes/:routePk/stops/:stopPk/",customManifests:"/api/v1/companies/:shortname/custom-manifests/",customManifest:"/api/v1/companies/:shortname/custom-manifests/:customManifestPk/",customCalendars:"/api/v1/companies/:shortname/custom-calendars/",customCalendar:"/api/v1/companies/:shortname/custom-calendars/:customCalendarPk/",
customReports:"/api/v1/companies/:shortname/custom-reports/",customReport:"/api/v1/companies/:shortname/custom-reports/:customReportPk/",users:"/api/v1/companies/:shortname/users/",allUsers:"/api/v1/companies/:shortname/users/all/",relatedUsers:"/api/v1/companies/:shortname/users/related/",user:"/api/v1/companies/:shortname/users/:username/",userNags:"/api/v1/companies/:shortname/users/:username/nags/",userActivities:"/api/v1/companies/:shortname/users/:username/activities/",userSubscriptions:"/api/v1/companies/:shortname/users/:username/subscriptions/",
userItemSubscriptions:"/api/v1/companies/:shortname/users/:username/subscriptions/items/:itemPk/",userOverview:"/api/v1/companies/:shortname/users/:username/overview/",reorder:"/api/v1/companies/:shortname/reorder/:objectCls/:objectPk/",activities:"/api/v1/companies/:shortname/activities/:activityObjectCls/:activityObjectPks/",activity:"/api/v1/companies/:shortname/activities/:activityPk(pk)/",allActivities:"/api/v1/companies/:shortname/activities/all/",systemActivities:"/api/v1/companies/:shortname/activities/system/",
notes:"/api/v1/companies/:shortname/activities/:activityObjectCls/:activityObjectPk/notes/",items:"/api/v1/companies/:shortname/items/",allItems:"/api/v1/companies/:shortname/items/all/",item:"/api/v1/companies/:shortname/items/:itemPk/",itemColor:"/api/v1/companies/:shortname/items/:itemPk/color/",duplicateItem:"/api/v1/companies/:shortname/items/:itemPk/duplicate/",itemCalendar:"/api/v1/companies/:shortname/items/:itemPk/calendar/:year/:month/",itemSubscriptions:"/api/v1/companies/:shortname/items/:itemPk/subscriptions/",
itemImages:"/api/v1/companies/:shortname/items/:itemPk/images/",itemImage:"/api/v1/companies/:shortname/items/:itemPk/images/:imagePk/",itemRatings:"/api/v1/companies/:shortname/items/:itemPk/ratings/",itemFlowPages:"/api/v1/companies/:shortname/items/:itemPk/flow-nodes/",itemsCalendar:"/api/v1/companies/:shortname/items/:itemPks(pks)/calendar/:year/:month/",flowNodes:"/api/v1/companies/:shortname/flow-nodes/",flowNode:"/api/v1/companies/:shortname/flow-nodes/:flowNodePk/",defaultFlowPage:"/api/v1/companies/:shortname/flow-nodes/default/",
duplicateFlowNode:"/api/v1/companies/:shortname/flow-nodes/:flowNodePk/duplicate/",cannedMessages:"/api/v1/companies/:shortname/canned-messages/",cannedMessage:"/api/v1/companies/:shortname/canned-messages/:cannedMessagePk/",cannedMessageItems:"/api/v1/companies/:shortname/canned-messages/:cannedMessagePk/items/",allCustomerTypes:"/api/v1/companies/:shortname/customer-types/all/",customerTypes:"/api/v1/companies/:shortname/customer-types/",customerType:"/api/v1/companies/:shortname/customer-types/:customerTypePk/",
customerTypeItems:"/api/v1/companies/:shortname/customer-types/:customerTypePk/items/",customerPrototypes:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/",customerPrototype:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/:customerPrototypePk/",duplicateCustomerPrototype:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/:customerPrototypePk/duplicate/",allCustomerPrototypes:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/all/",customerPrototypesMulti:"/api/v1/companies/:shortname/items/customer-prototypes/multi/",
checkinStatuses:"/api/v1/companies/:shortname/checkin-statuses/",checkinStatus:"/api/v1/companies/:shortname/checkin-statuses/:checkinStatusPk/",checkinStatusForBookings:"/api/v1/companies/:shortname/checkin-statuses/bookings/",roles:"/api/v1/companies/:shortname/roles/",role:"/api/v1/companies/:shortname/roles/:rolePk/",crewMembers:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/crew-members/",crewMember:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/crew-members/:crewMemberPk/",
customFields:"/api/v1/companies/:shortname/custom-fields/",allCustomFields:"/api/v1/companies/:shortname/custom-fields/all/",customField:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/",customFieldItems:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/items/",duplicateCustomField:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/duplicate/",prevalidateCustomField:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/prevalidate/total-sheets/:totalSheetPk/availabilities/:availabilityPk/",
transportationOptions:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/transportation-options/",transportationOption:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/transportation-options/:transportationOptionPk/",extendedOptions:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/extended-options/",extendedOption:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/extended-options/:extendedOptionPk/",connectedCampaigns:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-campaigns/",
connectedCampaign:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-campaigns/:connectedCampaignPk/",generatingCampaigns:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/generating-campaigns/",generatingCampaign:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/generating-campaigns/:generatingCampaignPk/",campaigns:"/api/v1/companies/:shortname/campaigns/",campaign:"/api/v1/companies/:shortname/campaigns/:campaignPk/",campaignValidityRules:"/api/v1/companies/:shortname/campaigns/:campaignPk/campaign-validity-rules/",
campaignValidityRule:"/api/v1/companies/:shortname/campaigns/:campaignPk/campaign-validity-rules/:campaignValidityRulePk/",campaignCustomFields:"/api/v1/companies/:shortname/campaigns/:campaignPk/custom-fields/",storedValueTypes:"/api/v1/companies/:shortname/stored-value-types/",storedValueType:"/api/v1/companies/:shortname/stored-value-types/:storedValueTypePk/",storedValueCards:"/api/v1/companies/:shortname/stored-value-cards/",storedValueCard:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/",
storedValueCardPayments:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/payments/",storedValueCardNotifications:"/api/v1/companies/:shortname/stored-value-cards/notifications/?q=:storedValueCardNumber",searchStoredValueCardsByNumber:"/api/v1/companies/:shortname/stored-value-cards/search/",storedValueAdjustments:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/adjustments/",storedValueAdjustment:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/adjustments/:storedValueAdjustmentPk/",
codes:"/api/v1/companies/:shortname/campaigns/:campaignPk/codes/",code:"/api/v1/companies/:shortname/campaigns/:campaignPk/codes/:codePk/",allAffiliates:"/api/v1/companies/:shortname/affiliates/all/",affiliates:"/api/v1/companies/:shortname/affiliates/",affiliate:"/api/v1/companies/:shortname/affiliates/:affiliationPk/",affiliateCards:"api/v1/companies/:shortname/affiliates/:affiliationPk/cards/",affiliateCardAffiliations:"/api/v1/companies/:shortname/affiliates/:affiliationPk/card-affiliations/",
partners:"/api/v1/companies/:shortname/partners/",partner:"/api/v1/companies/:shortname/partners/:affiliationPk/",partnerCards:"/api/v1/companies/:shortname/partners/:affiliationPk/cards/",partnerCardAffiliations:"/api/v1/companies/:shortname/partners/:affiliationPk/card-affiliations/",allAgents:"/api/v1/companies/:shortname/agents/all/",agents:"/api/v1/companies/:shortname/agents/",agent:"/api/v1/companies/:shortname/agents/:agentPk/",allDesks:"/api/v1/companies/:shortname/desks/all/",desks:"/api/v1/companies/:shortname/desks/",
desk:"/api/v1/companies/:shortname/desks/:deskPk/",customFieldInstances:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instances/",customFieldInstancesMulti:"/api/v1/companies/:shortname/items/custom-field-instances/multi/",customFieldInstance:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instances/:customFieldInstancePk/",customFieldInstanceConditions:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instances/:customFieldInstancePk/conditions/",customFieldInstanceCondition:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instances/:customFieldInstancePk/conditions/:customFieldInstanceConditionPk/",
customFieldInstanceGroups:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instance-groups/",customFieldInstanceGroup:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instance-groups/:customFieldInstanceGroupPk/",customFieldInstanceGroupsMulti:"/api/v1/companies/:shortname/items/custom-field-instance-groups/multi/",duplicateCustomFieldInstanceGroup:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instance-groups/:customFieldInstanceGroupPk/duplicate/",supportedLanguages:"/api/v1/companies/:shortname/supported-languages/",
supportedLanguage:"/api/v1/companies/:shortname/supported-languages/:languagePk/",translationsForModel:"/api/v1/companies/:shortname/supported-languages/:languagePk/translations/:modelName/",translationsForField:"/api/v1/companies/:shortname/translations/:objectType/:objectId/:objectField/",understoodLanguages:"/api/v1/companies/:shortname/understood-languages/",nextAvailability:"/api/v1/companies/:shortname/items/:itemPk/availabilities/next/",availabilitiesByDate:"/api/v1/companies/:shortname/items/:itemPk/availabilities/date/:date/",
availabilitiesByResource:"/api/v1/companies/:shortname/items/:itemPk/availabilities/date/:date/resource/:resourcePk/",availabilitiesByTag:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:tag/",availability:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/",availabilityStatus:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/status/",availabilityLiveCapacity:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/live/",
availabilityResourceUses:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/resource-uses/",updateItemAvailabilities:"/api/v1/companies/:shortname/items/:itemPk/availabilities/update/",updateAvailabilities:"/api/v1/companies/:shortname/availabilities/update/",availabilityNote:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/note/",sendConfirmations:" /api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/send-confirmations/",notifications:" /api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/notifications/",
customerTypeRates:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/customer-type-rates/",customerTypeRate:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/customer-type-rates/:customerTypeRatePk/",blocks:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/blocks/",block:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/blocks/:blockPk/",rule:"/api/v1/companies/:shortname/items/:itemPk/availabilities/rule/",
orders:"/api/v1/companies/:shortname/orders/",order:"/api/v1/companies/:shortname/orders/:orderUuid/",orderPayments:"/api/v1/companies/:shortname/orders/:orderUuid/payments/",orderNotification:"/api/v1/companies/:shortname/orders/:orderUuid/notification/",orderCancellation:"/api/v1/companies/:shortname/orders/:orderUuid/cancel/",book:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/book/",bookings:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/bookings/",
booking:"/api/v1/companies/:shortname/bookings/:bookingUuid/",bookingByPk:"/api/v1/companies/:shortname/bookings/:bookingPk/",repriceBooking:"/api/v1/companies/:shortname/bookings/:bookingUuid/reprice/",bookingCheckinStatus:"/api/v1/companies/:shortname/bookings/:bookingUuid/checkin-status/",customerCheckinStatus:"/api/v1/companies/:shortname/bookings/:bookingUuid/customers/:customerPk/checkin-status/",bookingNote:"/api/v1/companies/:shortname/bookings/:bookingUuid/note/",bookingExplicitGross:"/api/v1/companies/:shortname/bookings/:bookingUuid/explicit-gross/",
bookingExplicitInvoicePrice:"/api/v1/companies/:shortname/bookings/:bookingUuid/explicit-invoice-price/",bookingNotificationOptions:"/api/v1/companies/:shortname/bookings/:bookingUuid/notification-options/",bookingEffectiveCancellationRule:"/api/v1/companies/:shortname/bookings/:bookingUuid/effective-cancellation-rule/",searchCustomersByEncodedPk:"/embeds/redirect/checkin/:encodedPk/",contact:"/api/v1/companies/:shortname/contacts/:contactPk/",contactBookings:"/api/v1/companies/:shortname/contacts/:contactPk/bookings/",
contactPayments:"/api/v1/companies/:shortname/contacts/:contactPk/payments/",affiliation:"/api/v1/companies/:shortname/bookings/:bookingUuid/affiliation/",notification:"/api/v1/companies/:shortname/bookings/:bookingUuid/notification/",smsNotification:"/api/v1/companies/:shortname/bookings/:bookingUuid/sms-notifications/",lineItems:"/api/v1/companies/:shortname/bookings/:bookingUuid/line-items/",lineItem:"/api/v1/companies/:shortname/bookings/:bookingUuid/line-items/:lineItemPk/",customerCustomFieldValue:"/api/v1/companies/:shortname/bookings/:bookingUuid/customers/custom-field-values/:customerCustomFieldValuePk/",
bookingCustomFieldValue:"/api/v1/companies/:shortname/bookings/:bookingUuid/custom-field-values/:bookingCustomFieldValuePk/",payments:"/api/v1/companies/:shortname/bookings/:bookingUuid/payments/",relatedPayments:"/api/v1/companies/:shortname/bookings/:bookingUuid/payments/related/",refunds:"/api/v1/companies/:shortname/bookings/:bookingUuid/refunds/",orderRefunds:"/api/v1/companies/:shortname/orders/:orderUuid/refunds/",customRefunds:"/api/v1/companies/:shortname/bookings/:bookingUuid/refunds/custom/",
availabilitiesManifest:"/api/v1/companies/:shortname/manifest/availabilities/date/:date/",bookingsManifest:"/api/v1/companies/:shortname/manifest/bookings/date/:date/",runsManifest:"/api/v1/companies/:shortname/manifest/runs/date/:date/",resourcesManifest:"/api/v1/companies/:shortname/manifest/resources/date/:date/",searchAvailabilitiesByDate:"/api/v1/companies/:shortname/search/items/:itemPks(pks)/availabilities/date/:date/",searchAvailabilitiesByUpcoming:"/api/v1/companies/:shortname/search/availabilities/upcoming/:filter",
searchAvailabilitiesByPk:"/api/v1/companies/:shortname/search/availabilities/:availabilityPks/",searchBookingsByQuery:"/api/v1/companies/:shortname/search/bookings/query/:filter",searchBookingsByNew:"/api/v1/companies/:shortname/search/bookings/new/:filter",searchBookingsByUuid:"/api/v1/companies/:shortname/search/bookings/:bookingUuids/",searchRunsByDate:"/api/v1/companies/:shortname/search/runs/date/:date/",bookingsByContact:"/api/v1/companies/:shortname/search/bookings/contact/:contactPk/",invoices:"/api/v1/companies/:shortname/invoices/",
invoice:"/api/v1/companies/:shortname/invoices/:invoicePk/",uuidInvoice:"/api/v1/companies/:shortname/invoices/uuid/:invoiceUuid/",invoiceNotifications:"/api/v1/companies/:shortname/invoices/:invoicePk/notifications/",invoiceUploads:"/api/v1/companies/:shortname/invoices/:invoicePk/uploads/",partnerInvoice:"/api/v1/companies/:shortname/invoices/partner-invoices/:invoicePk/",groups:"/api/v1/companies/:shortname/groups/",group:"/api/v1/companies/:shortname/groups/:groupPk/",duplicateGroup:"/api/v1/companies/:shortname/groups/:groupPk/duplicate/",
groupOverrides:"/api/v1/companies/:shortname/group-overrides/",groupOverride:"/api/v1/companies/:shortname/group-overrides/:groupOverridePk/",groupOverrideActivities:"/api/v1/companies/:shortname/group-overrides/:groupOverridePk/activities/",relatedGroupOverrides:"/api/v1/companies/:shortname/group-overrides/related/",reports:"/api/v1/companies/:shortname/reports/",recentReports:"/api/v1/companies/:shortname/reports/recent/",inProgressReports:"/api/v1/companies/:shortname/reports/in-progress/",volumeOverviewReport:"/api/v1/companies/:shortname/reports/volume-overview/",
dailyVolumeOverviewReport:"/api/v1/companies/:shortname/reports/daily-volume-overview/",paymentOverviewReport:"/api/v1/companies/:shortname/reports/payment-overview/",itemsSummaryOverviewReport:"/api/v1/companies/:shortname/reports/items-summary-overview/",nextPayoutOverviewReport:"/api/v1/companies/:shortname/reports/next-payout-overview/",report:"/api/v1/companies/:shortname/reports/:reportPk(pk)/",reportObjects:"/api/v1/companies/:shortname/reports/:reportPk(pk)/objects/",reportReports:"/api/v1/companies/:shortname/reports/reports/",
reportContacts:"/api/v1/companies/:shortname/reports/contacts/",reportBookings:"/api/v1/companies/:shortname/reports/bookings/",reportInvoiceableBookings:"/api/v1/companies/:shortname/reports/invoiceable-bookings/",reportTest:"/api/v1/companies/:shortname/reports/test/",reportLineItems:"/api/v1/companies/:shortname/reports/line-items/",reportPayments:"/api/v1/companies/:shortname/reports/payments/",reportDisputes:"/api/v1/companies/:shortname/reports/disputes/",reportPayouts:"/api/v1/companies/:shortname/reports/payouts/",
reportInvoices:"/api/v1/companies/:shortname/reports/invoices/",reportAccounts:"/api/v1/companies/:shortname/reports/accounts/",reportTransactions:"/api/v1/companies/:shortname/reports/transactions/",reportEscrow:"/api/v1/companies/:shortname/reports/escrow/",reportVolume:"/api/v1/companies/:shortname/reports/volume/",reportCompanies:"/api/v1/companies/:shortname/reports/companies/",reportItemsSummary:"/api/v1/companies/:shortname/reports/summary/items/",reportUsersSummary:"/api/v1/companies/:shortname/reports/summary/users/",
reportBookingTypesSummary:"/api/v1/companies/:shortname/reports/summary/booking-types/",reportCustomerTypesSummary:"/api/v1/companies/:shortname/reports/summary/customer-types/",reportCustomFieldSummary:"/api/v1/companies/:shortname/reports/summary/custom-field/",reportLodgingsSummary:"/api/v1/companies/:shortname/reports/summary/lodgings/",reportPickupsSummary:"/api/v1/companies/:shortname/reports/summary/pickups/",reportCrewSummary:"/api/v1/companies/:shortname/reports/summary/crew/",reportAgentsSummary:"/api/v1/companies/:shortname/reports/summary/agents/",
reportDesksSummary:"/api/v1/companies/:shortname/reports/summary/desks/",reportCampaignsSummary:"/api/v1/companies/:shortname/reports/summary/campaigns/",reportRevenueSummary:"/api/v1/companies/:shortname/reports/summary/revenue/",reportAdvanced:"/api/v1/companies/:shortname/reports/advanced/",viatorSettings:"/api/v1/companies/:shortname/items/:itemPk/viator-settings/",viatorMappings:"/api/v1/companies/:shortname/items/:itemPk/viator-mappings/",viatorMapping:"/api/v1/companies/:shortname/items/:itemPk/viator-mappings/:viatorMappingPk/",
reviewExpressSettings:"/api/v1/companies/:shortname/items/:itemPk/review-express-settings/",picthriveSettings:"/api/v1/companies/:shortname/items/:itemPk/picthrive-settings/",payouts:"/api/v1/companies/:shortname/payouts/",payout:"/api/v1/companies/:shortname/payouts/:payoutPk/",payoutRetry:"/api/v1/companies/:shortname/payouts/:payoutPk/retry/",transfers:"/api/v1/companies/:shortname/transfers/",transfer:"/api/v1/companies/:shortname/transfers/:transferPk/",uploads:"/api/v1/companies/:shortname/uploads/",
upload:"/api/v1/companies/:shortname/uploads/:uploadPk/",adjustments:"/api/v1/companies/:shortname/adjustments/",adjustment:"/api/v1/companies/:shortname/adjustments/:adjustmentPk/",waivers:"/api/v1/companies/:shortname/waivers/",waiver:"/api/v1/companies/:shortname/waivers/:waiverPk/",waiverInstance:"/api/v1/companies/:shortname/waivers/:waiverPk/waiver-instances/:waiverInstancePk/",connectedWaivers:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-waivers/",connectedWaiver:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-waivers/:connectedWaiverPk/",
locations:"/api/v1/companies/:shortname/locations/",location:"/api/v1/companies/:shortname/locations/:locationPk/",locationItems:"/api/v1/companies/:shortname/locations/:locationPk/items/",totalSheets:"/api/v1/companies/:shortname/total-sheets/",totalSheet:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/",duplicateTotalSheet:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/duplicate/",totalPricing:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/pricing/:objectCls/:objectPk/",
totalStack:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/pricing/:objectCls/:objectPk/stack/",invoiceSheets:"/api/v1/companies/:shortname/invoice-sheets/",invoiceSheet:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/",duplicateInvoiceSheet:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/duplicate/",invoicePricing:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/pricing/:objectCls/:objectPk/",invoiceStack:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/pricing/:objectCls/:objectPk/stack/",
resources:"/api/v1/companies/:shortname/resources/",resource:"/api/v1/companies/:shortname/resources/:resourcePk/",resourceItems:"/api/v1/companies/:shortname/resources/:resourcePk/items/",resourceAvailabilities:"/api/v1/companies/:shortname/resources/:resourcePk/availabilities/date/:date/",resourceUsesByDate:"/api/v1/companies/:shortname/resources/:resourcePk/resource-uses/:date/",resourceUsesCalendar:"/api/v1/companies/:shortname/resources/:resourcePk/resource-uses/calendar/:year/:month/",reapplyBookingResourceUses:"/api/v1/companies/:shortname/bookings/:bookingUuid/reapply-resource-uses/",
requirementGroups:"/api/v1/companies/:shortname/items/:itemPk/requirement-groups/",requirementGroup:"/api/v1/companies/:shortname/items/:itemPk/requirement-groups/:requirementGroupPk/",duplicateRequirementGroup:"/api/v1/companies/:shortname/items/:itemPk/requirement-groups/:requirementGroupPk/duplicate/",requirements:"/api/v1/companies/:shortname/items/:itemPk/requirement-groups/:requirementGroupPk/requirements/",requirement:"/api/v1/companies/:shortname/items/:itemPk/requirement-groups/:requirementGroupPk/requirements/:requirementPk/",
resourceRequirements:"/api/v1/companies/:shortname/items/:itemPk/requirement-groups/:requirementGroupPk/requirements/:requirementPk/resource-requirements/",resourceRequirement:"/api/v1/companies/:shortname/items/:itemPk/requirement-groups/:requirementGroupPk/requirements/:requirementPk/resource-requirements/:resourceRequirementPk/",resourceUse:"/api/v1/companies/:shortname/bookings/:bookingUuid/resource-uses/:resourceUsePk/",resourceOverride:"/api/v1/companies/:shortname/resources/:resourcePk/resource-overrides/:resourceOverridePk/",
resourceOverrideRule:"/api/v1/companies/:shortname/resources/:resourcePk/resource-override-rule/",resourceOverridesByTag:"/api/v1/companies/:shortname/resources/:resourcePk/resource-overrides/:tag/",resourceOverridesByDate:"/api/v1/companies/:shortname/resources/:resourcePk/resource-overrides/:date/",resellerCompanies:"/api/v1/companies/:shortname/reseller-companies/",resellerCompany:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/",resellerCompanyMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-company-mappings/",
resellerCompanyMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-company-mappings/:resellerCompanyMappingPk/",resellerItems:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/",resellerItem:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/",resellerItemMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-item-mappings/",
resellerItemMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-item-mappings/:resellerItemMappingPk",resellerCustomerTypes:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/",resellerCustomerType:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/",resellerCustomerTypeMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/reseller-customer-type-mappings/",
resellerCustomerTypeMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/reseller-customer-type-mappings/:resellerCustomerTypeMappingPk/",resellerOptions:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/",resellerOption:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/:resellerOptionPk/",
resellerOptionMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/:resellerOptionPk/reseller-option-mappings/",resellerOptionMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/:resellerOptionPk/reseller-option-mappings/:resellerOptionMappingPk/",resellerUnmappedItems:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/unmapped/items/",
resellerUnmappedCustomerPrototypes:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/unmapped/customer-prototypes/",resellerKeys:"/api/v1/companies/:shortname/users/:username/reseller-keys/",resellerKey:"/api/v1/companies/:shortname/reseller-keys/:resellerKeyPk/",resellerApps:"/api/v1/companies/:shortname/reseller-apps/",resellerApp:"/api/v1/companies/:shortname/reseller-apps/:resellerAppPk/",resellerAppCompanies:"/api/v1/companies/:shortname/reseller-apps/:resellerAppPk/reseller-app-companies/",
resellerAppCompany:"/api/v1/companies/:shortname/reseller-apps/:resellerAppPk/reseller-app-companies/:resellerAppCompanyPk",ticketLayouts:"/api/v1/companies/:shortname/ticket-layouts/",ticketLayout:"/api/v1/companies/:shortname/ticket-layouts/:ticketLayoutPk/",analyticsServices:"/api/v1/companies/:shortname/a-services/",analyticsService:"/api/v1/companies/:shortname/a-services/:analyticsServicePk/",cancellationPolicies:"/api/v1/companies/:shortname/cancellation-policies/",cancellationPolicy:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/",
cancellationRules:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/cancellation-rules/",cancellationRule:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/cancellation-rules/:cancellationRulePk/",cancellationPolicyAffiliations:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/affiliations/",cancellationPolicyItems:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/items/",bookingRestrictions:"/api/v1/companies/:shortname/booking-restrictions/",
bookingRestriction:"/api/v1/companies/:shortname/booking-restrictions/:bookingRestrictionPk/",bookingRestrictionItems:"/api/v1/companies/:shortname/booking-restrictions/:bookingRestrictionPk/items/",persistentStore:"/api/v1/persistence/:identifier/",persistentStoreForCompany:"/api/v1/persistence/:identifier/:shortname/",persistentStoreItem:"/api/v1/persistence/:identifier/:shortname/:key/",version:"/api/v1/version/"}};return m}]);n.run(["$rootScope","urls",function(c,k){c.urls=k}])})();
angular.module("native",["native.services"]);
(function(){var n=angular.module("native.services",[]);n.factory("native",["$rootScope","$window","auth","db","events",function(c,k,h,d,f){var m={STRONG_SUCCESS_INDICATION:"fareharbor.native.indicate.strongSuccessIndication",WEAK_SUCCESS_INDICATION:"fareharbor.native.indicate.weakSuccessIndication",STRONG_ERROR_INDICATION:"fareharbor.native.indicate.strongErrorIndication",WEAK_ERROR_INDICATION:"fareharbor.native.indicate.weakErrorIndication"},a=d.slipstream("isNative")||!1,n=d.slipstream("nativeClient")||
"",l=d.slipstream("nativeClientVersion")||"",b=d.slipstream("isDebug"),g=d.slipstream("domain"),C=d.slipstream("protocol"),x={isNative:a,client:n,version:l,broadcast:function(a,b){console.info("native: triggering",a,b);k.webkit&&k.webkit.messageHandlers&&k.webkit.messageHandlers.fareharbor?(b=_.extend({type:a},b),k.webkit.messageHandlers.fareharbor.postMessage(b)):console.warn("native: native client unavailable")},indicate:function(a){a=a||m.WEAK_SUCCESS_INDICATION;x.broadcast("fareharbor.native.indicate",
{indication:a})},print:function(a){var b={};if(a){var c=["<!DOCTYPE html>",'<html class="native-print">',"<head>",'<meta name="viewport" content="initial-scale=1.0" />'];_.forEach($('head link[type="text/css"][href^="/"]'),function(a){a=$(a).attr("href");a=_.startsWith(a,"//")?C+":"+a:C+"://"+g+a;c.push('<link rel="stylesheet" href="'+a+'" type="text/css">')});c.push("</head>");c.push("<body>");c.push(a.outerHTML);c.push("</body>");c.push("</html>");b.html=c.join("\n")}console.info("native: print",
b);x.broadcast("fareharbor.native.print",b)}};_.extend(x,m);f.on(c,"auth.logout",function(){x.broadcast("fareharbor.native.loggedOut")});h.currentUser.isAuthenticated||x.broadcast("fareharbor.native.logOut");k.FH={nativeEvent:function(a){c.$apply(function(){f.broadcast(a.type,a)})}};x.broadcast("fareharbor.native.ready");f.on(c,"fareharbor.native.inApp",function(a,b){x.isNative=!0;x.client=b.client||x.client||"unknown";x.version=b.version||x.version||"unknown"});if(b)f.on(c,"fareharbor.native.test",
function(a,b){k.confirm("fareharbor.native.test triggered; respond?")&&x.broadcast("fareharbor.native.testSucceeded",{number:42})});return x}]);n.run(["$rootScope","native",function(c,k){c.native=k}])})();angular.module("navigation",["navigation.services","navigation.directives"]);
(function(){var n=angular.module("navigation.directives",["clientOptions.services","lib.services"]);n.directive("ngNavigationActive",["d","navigation",function(c,h){return{restrict:"A",link:function(d,f,m){var a=d.isSet(m.ngNavigationExact)?h.pathEquals:h.pathStartsWith,n,l=function(){var b=n();b?_.isString(b)?f.toggleClass("current",!!a(b)):_.isArray(b)?f.toggleClass("current",_.any(b,function(c){return!c?(console.warn("ng-navigation-active: empty url in list",c,b,m.ngNavigationActive,m.ngHref),
!1):!!a(c)})):console.warn("ng-navigation-active: invalid url",b,m.ngNavigationActive,m.ngHref):(console.warn("ng-navigation-active: no url",b,m.ngNavigationActive,m.ngHref),f.removeClass("current"))};if(m.ngNavigationActive)n=c.watcher(d,m.ngNavigationActive,"",l,!0);else if(m.ngHref)n=c.observer(m,"ngHref","",l);else{console.warn("invalid use of ng-navigation-active");return}h.watch(d,l);l()}}}]);var c=function(c,h){n.directive(c,["$injector","$parse","navigation",function(d,f,m){var a=d.invoke(h);
return{transclude:"element",priority:1E3,terminal:!0,restrict:"A",compile:function(d,h,b){d=c+"When";var g=h[d]?f(h[d]):null;return function(c,d,f){var k=a(c,d,f),h,l,e=function(a){l&&l.$destroy();l=c.$new();l.route={bindings:a};b(l,function(a){h&&h.remove();d.after(a);h=a})},m;c.$watch(function(){return g&&!g(c)?!1:(m=k())?JSON.stringify(m):!1},function(a,b){f.ngThen&&(c[f.ngThen]=!!a);a&&b?e(m):a?e(m):b&&(l&&l.$destroy(),h&&(h.remove(),h=null))})}}}}])};c("ngNavigationSpec",["$parse","navigation",
function(c,h){var d={prefix:"pathStartsWith",path:"pathEquals"};return function(f,m,a){var n=_.bind(c(a.ngNavigationSpec),null,f),l=function(a){return h[d[a[0]]](a[1])};return function(){var a=n();return _.chooseFirst(a,l)}}}]);c("ngNavigationPrefix",["$parse","navigation",function(c,h){return function(d,f,m){var a=_.bind(c(m.ngNavigationPrefix),null,d),n=function(a){if(!a)throw Error("ng-navigation-prefix: invalid paths: "+m.ngNavigationPrefix);return h.pathStartsWith(a)};return function(){var c=
a();if(_.isUndefined(c))throw Error("ng-navigation-prefix: undefined paths: "+m.ngNavigationPrefix);_.isArray(c)||(c=[c]);if(!c.length)throw Error("ng-navigation-prefix: empty paths: "+m.ngNavigationPrefix);return _.chooseFirst(c,n)}}}]);c("ngNavigationPath",["$parse","navigation",function(c,h){return function(d,f,m){var a=_.bind(c(m.ngNavigationPath),null,d),n=function(a){if(!a)throw Error("ng-navigation-path: invalid paths: "+m.ngNavigationPath);return h.pathEquals(a)};return function(){var c=a();
if(_.isUndefined(c))throw Error("ng-navigation-path: undefined paths: "+m.ngNavigationPath);_.isArray(c)||(c=[c]);if(!c.length)throw Error("ng-navigation-path: empty paths: "+m.ngNavigationPath);return _.chooseFirst(c,n)}}}]);c("ngNavigationSection",["navigation",function(c){var h={root:"inRootSection",company:"inCompanySection",manifest:"inManifestSection",dashboard:"inDashboardSection"};return function(d,f,m){return function(){return c[h[m.ngNavigationSection]]()}}}]);c("ngNavigationInvoiceLogin",
["navigation","urls",function(c,h){var d=h.dashboard.reports.invoices.partnerInvoice.index,f=function(d){var a=c.get("next");return!a?!1:c.parseQuery(a).source===d};return function(h,a,n){return function(){return c.nextPathEquals(d)&&(f("uuid-invoice")||f("email"))}}}]);n.directive("ngConfirmNavigateAway",["$parse","$rootScope","$window",function(c,h,d){return{restrict:"A",require:"form",compile:function(f,h){var a=h.ngConfirmNavigateAwayWhen?c(h.ngConfirmNavigateAwayWhen):null;return function(c,
f,b,g){if(!d.slipstream.isEmbedded||d.slipstream.isBookEmbed){var k=function(){return b.ngConfirmNavigateAway?b.ngConfirmNavigateAway:"Your changes will be lost."},h=function(){if(a?a(c,{$url:void 0}):g.$dirty)return k()};c.$on("$locationChangeStart",function(b,f){(a?a(c,{$url:f}):g.$dirty)&&!d.confirm("Are you sure you want to leave this page? "+k())&&b.preventDefault()});var m=angular.element(d);m.on("beforeunload",h);c.$on("$destroy",function(){m.off("beforeunload",h)})}}}}}]);n.config(["$provide",
function(c){c.decorator("ngHrefDirective",["$delegate",function(c){c.shift();return c}])}]);n.directive("ngHref",["$browser","$location","$parse","clientOptions","d","navigation",function(c,h,d,f,m,a){return{restrict:"A",link:function(c,d,b){var g=!1,k=function(){var c=h();g&&(c=a.multiUrl(c));c=f.reflectUrl(c);b.$set("href",c)},h=m.observer(b,"ngHref","",function(b){!g&&a.parseMultiUrl(b)?(g=!0,a.watch(c,k)):k()})}}}]);c=function(c,h){return n.directive(c,["d","navigation",function(d,f){return{restrict:"A",
link:function(m,a,n){var l=m.isSet(n[c+"Strict"]),b=d.observer(n,c);a.on("click",function(c){var d=$(c.target),k=b();if(k&&h.test(c)&&!c.defaultPrevented&&(!l||a.is(d)))if(!d.is("a")||a.is(d))m.$apply(function(){f.navigate(k)}),h.preventDefault&&c.preventDefault()})}}}])};c("ngNavigate",{test:function(c){return!c.shiftKey&&!c.controlKey&&!c.metaKey&&!c.altKey}});c("ngShiftNavigate",{test:function(c){return c.shiftKey&&!c.controlKey&&!c.metaKey&&!c.altKey}});c("ngControlNavigate",{test:function(c){return!c.shiftKey&&
c.ctrlKey&&!c.metaKey&&!c.altKey}});c("ngMetaNavigate",{test:function(c){return!c.shiftKey&&!c.controlKey&&c.metaKey&&!c.altKey}});c("ngAltNavigate",{test:function(c){return!c.shiftKey&&!c.controlKey&&!c.metaKey&&c.altKey},preventDefault:!0});c("ngShiftOrAltNavigate",{test:function(c){return(c.shiftKey||c.altKey)&&!c.controlKey&&!c.metaKey}});n.directive("ngRedirect",["navigation",function(c){return{restrict:"A",link:function(h,d,f){d=h.$eval(f.ngRedirect);h=h.$eval(f.ngRedirectMode)||"";if(!d)throw Error("ng-redirect: no url: "+
f.ngRedirect);c.redirect(d,h)}}}]);n.directive("ngReload",["navigation",function(c){return{restrict:"A",link:function(h,d,f){c.reload()}}}]);n.directive("ngReloadRoot",["$location","$window","navigation","urls",function(c,h,d,f){return{restrict:"A",link:function(){var m=d.compose(f.root.index,c.search());h.location.replace(m)}}}])})();
(function(){var n=angular.module("navigation.services",["auth.services","db.services","lib.services","urls.services"]);n.factory("navigation",["$rootScope","$browser","$injector","$location","$timeout","$window","auth","db","events","models","urls",function(c,k,h,d,f,m,a,n,l,b,g){n.slipstream("isDebug");var C=n.slipstream("protocol"),x=n.slipstream("domain"),q=k.baseHref();"/"===q[q.length-1]&&(q=q.slice(0,q.length-1));var B=function(a){return!q&&"/embeds/"===a.slice(0,8)||!q&&"/"!==a.slice(0,1)?
!1:a.slice(0,q.length)===q},y=function(a){return!B(a)?q+a:a},D="_top"===$("base").attr("target"),e=function(a,b){var c=m;D&&(c=m.top);b?c.location.replace(a):c.location.assign(a)},F={admin:"admin-section",company:"company-section",dashboard:"dashboard-section",root:"root-section"};F.all=_.values(F).join(" ");var G=function(a,b){b?($("body").removeClass(F.all),$("body").addClass(F[a])):$("body").removeClass(F[a])},A={glob:"([a-zA-Z0-9-_.]+)",slug:"([a-z0-9-_.]+)",path:"([a-z-/]+)",pk:"([0-9]+)",pks:"(([0-9]+)(,[0-9]+)*)"},
v=function(a,b,c){a=a.replace(/\//g,"\\/");a=a.replace(/:(\w+)(\((\w+)\))?/g,function(a,b,d,e){c.push(b);return d?A[e]:A.glob});return RegExp("^"+a+(b?"$":""))},s={},z=function(a,b){if(!a)throw Error("navigation: matcher not given path");if(!_.isString(a))throw console.error("navigation: matcher not given a string path",a,b),Error("navigation: matcher not given string path");var c=a+(b?"$":""),e=s[c];if(e)return e;var f=[],g,h=w.parseMultiUrl(a);if(h&&h.multiPath){g=v(h.path,!1,f);var k=[],l=v(h.multiPath,
b,k),e=function(){var a=d.search()[h.key];if(_.isUndefined(a))return!1;a=a||"/";"/"!==a[a.length-1]&&(a+="/");var b=w.path;"/"!==b[b.length-1]&&(b+="/");b=_.toArray(g.exec(b));if(!b.length)return!1;a=_.toArray(l.exec(a));if(!a.length)return!1;var c={};_.forEach(_.rest(b),function(a,b){c[f[b]]=a});_.forEach(_.rest(a),function(a,b){c[k[b]]=a});return c}}else g=v(a,b,f),e=function(){var a=w.path;"/"!==a[a.length-1]&&(a+="/");a=_.toArray(g.exec(a));if(!a.length)return!1;var b={};_.forEach(_.rest(a),function(a,
c){b[f[c]]=a});return b};return s[c]=e},u={};b=function(a,b){return function(c,d){var e=a+c;if(!d&&!_.isUndefined(u[e]))return u[e];var f=b(c);return u[e]=f}};var t=function(a,b){return function(){if(!_.isUndefined(u[a]))return u[a];var c=b();return u[a]=c}},E=function(a){try{return decodeURIComponent(a)}catch(b){}},L=function(a){var b={},c,d;_.forEach((a||"").split("&"),function(a){a&&(c=a.replace(/\+/g,"%20").split("="),d=E(c[0]),_.isUndefined(d)||(a=!_.isUndefined(c[1])?E(c[1]):!0,Object.hasOwnProperty.call(b,
d)?_.isArray(b[d])?b[d].push(a):b[d]=[b[d],a]:b[d]=a))});return b},r=function(a){var b=a.replace("%3F","?");return _.contains(b,"?")?b.split("?")[0]:a},K=function(a){return a&&(a=a.replace("%3F","?"),_.contains(a,"?"))?(a=a.split("?")[1],L(a)):{}},w={base:q,url:y(d.url()||"/"),path:y(d.path()||"/"),compose:function(a,b,c){c&&(b=_.pick(b,function(b,c){return!RegExp("[&\\?]"+c+"=").test(a)}));if(b=n.toKeyValue(b)){c="";var d=a.indexOf("#");-1!==d&&(c=a.slice(d),a=a.slice(0,d));return _.contains(a,"?")?
a+"&"+b+c:a+"?"+b+c}return a},parseQuery:K,extendQuery:function(a,b){var c=w.parseQuery(a);_.extend(c,b);a=r(a);return w.compose(a,c)},pathStartsWith:b("pathStartsWith",function(a){return z(a)()}),pathEquals:b("pathEquals",function(a){return z(a,!0)()}),nextPathEquals:b("nextPathEquals",function(a){a=v(a,!0,[]);var b=d.search().next;if(_.isUndefined(b))return!1;b=r(b);return(a=a.exec(b))&&a.length}),inCompanySection:t("inCompanySection",function(){var a,b=!w.inRootSection()&&!w.inDashboardSection()&&
!w.inLegacyManifestSection()&&!!(a=w.pathStartsWith(g.company.index));G("company",b);return a}),inDashboardSection:t("inDashboardSection",function(){var a,b=!w.inRootSection()&&!!(a=w.pathStartsWith(g.dashboard.index));G("dashboard",b);return a}),inLegacyManifestSection:t("inLegacyManifestSection",function(){var a,b=!w.inRootSection()&&!!(a=w.pathStartsWith(g.legacyManifest));G("dashboard",b);return a}),inRootSection:t("inRootSection",function(){var a=!1;_.forEach(g.root,function(b){a=b===g.root.index?
a||w.pathEquals(b):_.isObject(b)?a||w.pathStartsWith(b.index):a||w.pathStartsWith(b)});G("root",a);return a}),reload:function(){c.$evalAsync(function(){location.reload(!0)})},redirect:function(a,b){if(d.$$replace)f(_.bind(w.redirect,w,a,b));else{a=w.multiUrl(a||"/",b||"extend");if(B(a))return a=B(a)?a.slice(q.length):a,d.replace(),d.url(a),a;e(a,!0)}},navigate:function(a,b,c){a=w.multiUrl(a||"/",b||"replace");if(!B(a)||c)e(a);else return a=B(a)?a.slice(q.length):a,d.url(a),a},forceNavigate:function(a){return c.$apply(function(){return w.navigate(a)})},
open:function(a,b,c){c&&(c.stopPropagation(),c.preventDefault());b=_.extend({},{status:1,scrollbars:1,resizable:1},b);b=_.map(b,function(a,b){return b+"="+a}).join(",");m.open(a,"$$window",b)},get:function(a){return d.search()[a]},set:function(a,b,c){c&&d.replace();return d.search(a,b)},clear:function(a,b){b&&d.replace();return d.search(a,null)},getInt:function(a){a=_.int(this.get(a));if(!isNaN(a))return a},getPk:function(a){a=w.getInt(a);if(!_.isUndefined(a)&&!(0>=a))return a},getPks:function(a){return _.splitPks(this.get(a))},
parseMultiUrl:function(a){if(_.isUndefined(a))console.warn("navigation: invalid multi-url",a);else if(!/^(https?|ftp|mailto|tel)/.test(a)){var b=_.split(a,"@",2);if(2===b.length&&(a=b[0],b=b[1])){var b=_.split(b,"=",2),c=b[0],d=b[1]||"",e={},b=_.split(d,"?",2);2===b.length&&(d=b[0],e=L(b[1]));return{path:a,key:c,multiPath:d,search:e}}}},multiUrl:function(a,b,c){if(!a)throw Error("navigation: bad url to multi");b=b||"replace";var e=w.parseMultiUrl(a),f={};e&&(b="extend",e.multiPath&&(f[e.key]=e.multiPath),
_.extend(f,e.search));"extend"===b&&(f=_.extend({},d.search(),f),e&&!e.multiPath&&delete f[e.key]);e&&(a=e.path,c?a=c:w.pathStartsWith(e.path)&&(a=w.path));return w.compose(a,f)},watch:function(a,b,c){var d=function(){a.$safeApply(function(){b(w.path,w.url)})},e=function(a,b){if(_.isObject(c)&&c.search)if(a===b)d();else{var e=c.search,f=K(a),g=K(b);e&&(f=_.pick(f,e),g=_.pick(g,e));_.isEqual(f,g)||d()}else d()};return"path"===c?a.$watch(function(){var a=w.parseMultiUrl(w.url);return a?a.path:w.path},
d):"multiPath"===c?a.$watch(function(){var a=w.parseMultiUrl(w.url);return a?a.key+"="+a.multiPath:""},d):a.$watch(function(){return w.url},e)},currentCompany:null,updateCurrentCompany:function(a,b){var c=h.get("analytics");w.currentCompany=b;c.trackCompany(w.currentCompany);l.broadcast("navigation.company.updated",{company:w.currentCompany});a.$on("$destroy",function(){w.currentCompany=null;c.trackCompany(null);l.broadcast("navigation.company.updated",{company:w.currentCompany})})},isCurrentCompany:function(a){return w.currentCompany&&
_.isUriEqual(w.currentCompany,a)},absoluteUrl:function(a){a=_.isUndefined(a)?w.url:y(a);return C+"://"+x+a},loginRedirectUrl:function(a){var b;b=w.currentCompany?w.currentCompany.$url(g.company.login):g.root.login;var c=w.path,e=_.extend({},d.search());delete e.next;var e=w.compose(c,e),f={};/\/login\//g.test(c)||(f.next=e,a&&(f.require="yes"));return w.compose(b,f)},startBookingUrl:function(b,c){if(!b)return c.company.$url(g.dashboard.bookings.index);var d=b.availability.startAt,e=b.company,f=moment().startOf("day");
0>d.diff(f)&&(d=f);b.affiliation&&b.affiliation.affiliateCompany===a.currentUser.company&&(a.storage.set("currentPartnerSelection",b.company.uri),e=b.affiliation.affiliateCompany);if(w.pathStartsWith(g.dashboard.bookings.day.index))f=g.dashboard.bookings.day.date;else if(w.pathStartsWith(g.dashboard.bookings.agenda.index))f=g.dashboard.bookings.agenda.date;else if(w.pathStartsWith(g.dashboard.bookings.calendar))f=g.calendarUrls(g.dashboard.bookings.calendar).month;else if(w.pathStartsWith(g.dashboard.bookings.grid.index))f=
g.dashboard.bookings.grid.date;else if(w.pathStartsWith(g.dashboard.bookings.timeline.index))f=g.dashboard.bookings.timeline.date;else return w.compose(g.populate(g.dashboard.bookings.index,{shortname:e.shortname}),{date:d.format("YYYY-MM-DD")});return g.populate(f,{shortname:e.shortname,year:d.format("YYYY"),month:d.format("MM"),date:d.format("YYYY-MM-DD")})}},O=!0;c.$on("$locationChangeStart",function(a){c.$evalAsync(function(){c.$broadcast("$locationChangeComplete",!a.defaultPrevented);a.defaultPrevented&&
c.$broadcast("$locationChangeCancelled")})});c.$on("$locationChangeSuccess",function(a,b,c){b=b?b.replace(/^https?:\/\/[^\/]+/,""):"/";b=y(b);c=c?c.replace(/^https?:\/\/[^\/]+/,""):"/";c=y(c);a=d.path();a=y(a||"/");"/"!==a[a.length-1]?w.redirect(w.compose(a+"/",d.search())):(u={},w.url=b,w.path=a,(b!==c||O)&&f(function(){console.info("navigation: navigation complete",w.url,b);k.notifyWhenNoOutstandingRequests(function(){w.url===b&&h.get("analytics").trackView(b)})}),O=!1)});m.$$navigation=w;m.$$location=
d;return w}]);n.run(["$rootScope","navigation",function(c,k){c.navigation=k}])})();
(function(){var n=angular.module("embeds.cart","lib auth cache cart clientOptions db flash lightframe native navigation tracking urls".split(" "));configure(n);n.controller("embeds.cart.IndexCtrl",["$scope","cart","events","lightframe","navigation","xmessage",function(c,k,h,d,f,m){c.indexCtrl={carts:[],cartEntriesTotal:0};var a,n=function(){c.indexCtrl.cartEntriesTotal=0;c.indexCtrl.carts=_.filter(k.allCompanies.carts,function(a){c.indexCtrl.cartEntriesTotal+=a.entries.length;return!!a.entries.length});
m.broadcast(c.indexCtrl.carts.length?"fareharbor.cart.show":"fareharbor.cart.hide");a=moment()},l=function(){k.allCompanies.load().then(n)};l();m.on(c,"fareharbor.cart.changed",l);m.on(c,"fareharbor.window.focused",_.debounce(l,1E4,{leading:!0,trailing:!1}));setInterval(function(){(!a||12E4<=moment().diff(a))&&l()},12E4);c.indexCtrl.selectedCart=null;c.viewCart=function(a){if(a=a||c.indexCtrl.selectedCart)a=k.permalinkUrl(a.company),a=f.compose(a,{"from-embed":"cart"}),d.open(a),c.indexCtrl.selectedCart=
null};c.hide=function(){m.broadcast("fareharbor.cart.hide")}}])})();
